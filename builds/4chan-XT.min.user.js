// ==UserScript==
// @name         4chan XT
// @version      2.20.0
// @minGMVer     1.14
// @minFFVer     74
// @namespace    4chan-XT
// @description  4chan XT is a script that adds various features to anonymous imageboards.
// @license      MIT; https://github.com/TuxedoTako/4chan-xt/blob/project-XT/LICENSE
// @include      https://boards.4chan.org/*
// @include      https://sys.4chan.org/*
// @include      https://www.4chan.org/*
// @include      https://i.4cdn.org/*
// @include      https://is.4chan.org/*
// @include      https://is2.4chan.org/*
// @include      https://erischan.org/*
// @include      https://www.erischan.org/*
// @include      https://fufufu.moe/*
// @include      https://kakashinenpo.com/*
// @include      https://www.kakashinenpo.com/*
// @include      https://kissu.moe/*
// @include      https://www.kissu.moe/*
// @include      https://original.kissu.moe/*
// @include      https://lainchan.org/*
// @include      https://www.lainchan.org/*
// @include      https://merorin.com/*
// @include      https://ota-ch.com/*
// @include      https://www.ota-ch.com/*
// @include      https://ponyville.us/*
// @include      https://www.ponyville.us/*
// @include      https://smuglo.li/*
// @include      https://notso.smuglo.li/*
// @include      https://smugloli.net/*
// @include      https://smug.nepu.moe/*
// @include      https://sportschan.org/*
// @include      https://www.sportschan.org/*
// @include      https://sushigirl.us/*
// @include      https://www.sushigirl.us/*
// @include      https://tvch.moe/*
// @exclude      https://www.4chan.org/advertise
// @exclude      https://www.4chan.org/advertise?*
// @exclude      https://www.4chan.org/donate
// @exclude      https://www.4chan.org/donate?*
// @exclude      https://www.4chan.org/
// @connect      4chan.org
// @connect      4channel.org
// @connect      4cdn.org
// @connect      4chenz.github.io
// @connect      archive.4plebs.org
// @connect      warosu.org
// @connect      desuarchive.org
// @connect      boards.fireden.net
// @connect      arch.b4k.co
// @connect      archived.moe
// @connect      thebarchive.com
// @connect      archiveofsins.com
// @connect      archive.palanq.win
// @connect      eientei.xyz
// @connect      api.clyp.it
// @connect      api.dailymotion.com
// @connect      api.github.com
// @connect      soundcloud.com
// @connect      api.streamable.com
// @connect      vimeo.com
// @connect      www.youtube.com
// @connect      *
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_deleteValue
// @grant        GM_listValues
// @grant        GM_addValueChangeListener
// @grant        GM_openInTab
// @grant        GM_xmlhttpRequest
// @grant        GM.getValue
// @grant        GM.setValue
// @grant        GM.deleteValue
// @grant        GM.listValues
// @grant        GM.openInTab
// @grant        GM.xmlHttpRequest
// @run-at       document-start
// @updateURL    https://github.com/TuxedoTako/4chan-xt/releases/latest/download/4chan-XT.min.meta.js
// @downloadURL  https://github.com/TuxedoTako/4chan-xt/releases/latest/download/4chan-XT.min.user.js
// @icon         data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAACVBMVEUAAGcAAABmzDNZt9VtAAAAAXRSTlMAQObYZgAAAF5JREFUeNrtkTESABAQxPD/R6tsE2dUGYUtFJvLDKf93KevHJAjpBorAQWSBIKqFASC4G0pCAkm4GfaEvgYXl0T6HBaE97f0vmnfYHbZOMLZCx9ISdKWwjOWZSC8GYm4SUGwfYgqI4AAAAASUVORK5CYII=
// @license      MIT
// ==/UserScript==
/*
* 4chan XT
*
* Licensed under the MIT license.
* https://github.com/TuxedoTako/4chan-xt/blob/project-XT/LICENSE
*
* 4chan X Copyright © 2009-2023 ccd0
* https://github.com/ccd0/4chan-x
* Appchan X Copyright © 2013-2016 Zixaphir <zixaphirmoxphar@gmail.com>
* http://zixaphir.github.io/appchan-x/ 
* 4chan x Copyright © 2009-2011 James Campos <james.r.campos@gmail.com>
* https://github.com/aeosynth/4chan-x
* 4chan x Copyright © 2012-2014 Nicolas Stepien <stepien.nicolas@gmail.com>
* https://4chan-x.just-believe.in/
* 4chan x Copyright © 2013-2014 Jordan Bates <saudrapsmann@gmail.com>
* http://seaweedchan.github.io/4chan-x/
* 4chan x Copyright © 2012-2013 ihavenoface
* http://ihavenoface.github.io/4chan-x/
* 4chan SS Copyright © 2011-2013 Ahodesuka
* https://github.com/ahodesuka/4chan-Style-Script/ 
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*
* Contributors:
* aeosynth
* mayhemydg
* noface
* !K.WeEabo0o
* blaise
* that4chanwolf
* desuwa
* seaweed
* e000
* ahodesuka
* Shou
* ferongr
* xat
* Ongpot
* thisisanon
* Anonymous
* Seiba
* herpaderpderp
* WakiMiko
* btmcsweeney
* AppleBloom
* detharonil
* TuxedoTako
*
* All the people who've taken the time to write bug reports.
*
* Thank you.
*/
/*
* Contains data from external sources:
*
* src/Monitoring/ThreadUpdater/beep.wav from http://freesound.org/people/pierrecartoons1979/sounds/90112/
*   cc-by-nc-3.0
*
* Font Awesome (https://fontawesome.com)
*   license: CC BY 4.0 (https://fontawesome.com/license/free#icons)
*
* Icons used to identify various websites are property of the respective websites.
*/
!function(){"use strict";var e="2.20.0",t="2025-01-04T18:12:00Z",o={name:"4chan XT",path:"4chan-XT",fork:"TuxedoTako",page:"https://github.com/TuxedoTako/4chan-xt",downloads:"https://github.com/TuxedoTako/4chan-xt/releases",oldVersions:"https://raw.githubusercontent.com/ccd0/4chan-x/",faq:"https://github.com/TuxedoTako/4chan-xt/wiki/Frequently-Asked-Questions",upstreamFaq:"https://github.com/ccd0/4chan-x/wiki/Frequently-Asked-Questions",captchaFAQ:"https://github.com/ccd0/4chan-x/wiki/Captcha-FAQ",cssGuide:"https://github.com/ccd0/4chan-x/wiki/Styling-Guide",license:"https://github.com/TuxedoTako/4chan-xt/blob/project-XT/LICENSE",changelog:"https://github.com/TuxedoTako/4chan-xt/blob/project-XT/CHANGELOG.md",issues:"https://github.com/TuxedoTako/4chan-xt/issues",newIssue:"https://github.com/TuxedoTako/4chan-xt/issues",newIssueMaxLength:8181,alternatives:"https://www.4chan-x.net/4chan_alternatives.html",appid:"lacclbnghgdicfifcamcmcnilckjamag",appidGecko:"4chan-x@4chan-x.net",
recaptchaKey:"6Ldp2bsSAAAAAAJ5uyx_lx34lJeEpTLVkP5k04qc",min:{chrome:"90",firefox:"74",greasemonkey:"1.14"}};const a=Object.create(null),i={VERSION:e,VERSION_DATE:new Date(t),NAMESPACE:o.name,sites:Object.create(null),boards:Object.create(null)},s=function(){const e={"&":"&amp;","'":"&#039;",'"':"&quot;","<":"&lt;",">":"&gt;"},t=/[&"'<>]/g,o=function(t){return e[t]},a=function(e){return e.toString().replace(t,o)};return a.cat=function(e){let t="";for(let o=0;o<e.length;o++)t+=e[o].innerHTML;return t},a}(),n=document,r=n.documentElement,l=console,d=function(){return r};class c{static initClass(){this.Post=new c("Post"),this.Thread=new c("Thread"),this.CatalogThread=new c("Catalog Thread"),this.CatalogThreadNative=new c("Catalog Thread")}constructor(e){this.type=e,this.keys=[]}push({name:e,cb:t}){return this[e]||this.keys.push(e),this[e]=t}execute(e,t=this.keys,o=!1){let a;if(!e.callbacksExecuted||o){for(var i of(e.callbacksExecuted=!0,t))try{this[i]?.call(e)}catch(t){a||(a=[]),a.push({
message:['"',i,'" crashed on node ',this.type," No.",e.ID," (",e.board,")."].join(""),error:t,html:e.nodes?.root?.outerHTML})}return a?Pt.handleErrors(a):void 0}}}c.initClass();const h={main:{Miscellaneous:{"JSON Index":[!0,"Replace the original board index with one supporting searching, sorting, infinite scrolling, and a catalog mode."],[`Use ${o.name} Catalog`]:[!0,`Link to ${o.name}'s catalog instead of the native 4chan one.`,1],"Index Refresh Notifications":[!1,"Show a notice at the top of the page when the index is refreshed.",1],"Follow Cursor":[!0,"Image Hover and Quote Preview move with the mouse cursor."],"Open Threads in New Tab":[!1,`Make links to threads in the index / ${o.name} catalog open in a new tab.`],"External Catalog":[!1,"Link to external catalog instead of the internal one."],"Catalog Links":[!1,"Add toggle link in header menu to turn Navigation links into links to each board's catalog."],"Announcement Hiding":[!0,"Add button to hide 4chan announcements."],
"Desktop Notifications":[!0,`Enables desktop notifications across various ${o.name} features.`],"404 Redirect":[!0,"Redirect dead threads and images to the archives."],"Archive Report":[!0,"Enable reporting posts to supported archives."],"Exempt Archives from Encryption":[!1,"Permit loading content from, and warningless redirects to, HTTP-only archives from HTTPS pages."],Keybinds:[!0,"Bind actions to keyboard shortcuts."],"Time Formatting":[!0,'Localize and format timestamps. Has more options on the "Advanced" tab.'],"Comment Expansion":[!0,"Expand comments that are too long to display on the index. Not applicable with JSON Index."],"File Info Formatting":[!0,"Reformat the file information."],"Thread Expansion":[!0,"Add buttons to expand threads."],"Index Navigation":[!1,"Add buttons to navigate between threads."],"Reply Navigation":[!1,"Add buttons to navigate to top / bottom of thread."],
"Unique ID and Capcode Navigation":[!1,"Add buttons to navigate to posts having the same unique ID or capcode."],"Custom Board Titles":[!0,"Allow editing of the board title and subtitle by ctrl/⌘+clicking them."],"Persistent Custom Board Titles":[!1,"Force custom board titles to be persistent, even if the board titles are updated.",1],"Show Updated Notifications":[!0,`Show notifications when ${o.name} is successfully updated.`],"Color User IDs":[!0,"Assign unique colors to user IDs on boards that use them"],"Count Posts by ID":[!0,"Display number of posts in the thread when hovering over an ID."],"Remove Spoilers":[!1,"Remove all spoilers in text."],"Reveal Spoilers":[!1,"Indicate spoilers if Remove Spoilers is enabled, or make the text appear hovered if Remove Spoiler is disabled."],"Normalize URL":[!0,"Rewrite the URL of the current page, removing slugs and excess slashes, and changing /res/ to /thread/."],
"Disable Autoplaying Sounds":[!1,"Prevent sounds on the page from autoplaying."],"Disable Native Extension":[!0,`${o.name} is NOT designed to work with the native extension.`],"Enable Native Flash Embedding":[!0,"Activate the native extension's Flash embedding if the native extension is disabled."],"Export History":[!0,"Export last read, your posts, etc. when exporting the setting"],"Ask to Export History":[!0,"Ask if history should be exported when settings are exported."]},Linkification:{Linkify:[!0,"Convert text into links where applicable."],"Link Title":[!0,"Replace the link of a supported site with its actual title.",1],"Link Title in the catalog":[!1,"Replace the link of a supported site with its actual title in the catalog too. Speed up performance for boards that have many embeds (e.g /vt/) if turned off",2],"Cover Preview":[!0,"Show preview of supported links on hover.",1],Embedding:[!0,"Embed supported services. Note: Some services don't work on HTTPS.",1],
"Auto-embed":[!1,"Auto-embed Linkify Embeds.",2],"Floating Embeds":[!1,"Embed content in a frame that remains in place when the page is scrolled.",2]},Filtering:{Anonymize:[!1,"Make everyone Anonymous."],Filter:[!0,"Self-moderation placebo."],"Filtered Backlinks":[!1,"When enabled, shows backlinks to filtered posts with a line-through decoration. Otherwise, hides the backlinks.",1],"Filter in Native Catalog":[!0,"Apply 4chan X filters in native catalog.",1],"MD5 Quick Filter Notifications":[!0,"Show notification when quick filtering MD5s using the button or keybind.",1],"MD5 Quick Filter in the Catalog":[!0,"Quick filter by MD5 when clicking a thumbnail in the catalog and holding Shift. Disabling falls back on just hiding the thread.",1],"MD5 Quick Filter in Threads":[!0,"Quick filter by MD5 when clicking a thumbnail in a thread while holding shift.",1],"Recursive Hiding":[!0,"Hide replies of hidden posts, recursively."],
"Thread Hiding Buttons":[!0,"Add buttons to hide entire threads."],"Reply Hiding Buttons":[!0,"Add buttons to hide single replies."],Stubs:[!0,"Show stubs of hidden threads / replies."],"Filter Reason":[!0,"Show the reason the post was hidden in the stub. If disabled, you can hover over the stub to see the reason."]},"Images and Videos":{"Image Expansion":[!0,"Expand images / videos."],"Image Hover":[!0,"Show full image / video on mouseover."],"Image Hover in Catalog":[!0,`Show full image / video on mouseover in ${o.name} catalog.`],Gallery:[!0,"Adds a simple and cute image gallery. Has more options in the gallery menu."],"Fullscreen Gallery":[!1,"Open gallery in fullscreen mode.",1],"PDF in Gallery":[!1,"Show PDF files in gallery.",1],Sauce:[!0,"Add sauce links to images."],"WEBM Metadata":[!0,"Add link to fetch title metadata from webm videos."],"Reveal Spoiler Thumbnails":[!1,"Replace spoiler thumbnails with the original image."],
"Replace GIF":[!1,"Replace gif thumbnails with the actual image."],"Replace JPG":[!1,"Replace jpg thumbnails with the actual image."],"Replace PNG":[!1,"Replace png thumbnails with the actual image."],"Replace WEBM":[!1,"Replace webm, mp4, and ogv thumbnails with the actual video. Probably will degrade browser performance ;)"],"Image Prefetching":[!0,"Add a shortcut icon to the header to turn on image preloading."],"Fappe Tyme":[!0,"Hide posts without images when header menu item is checked. *hint* *hint*"],"Werk Tyme":[!0,"Hide all post images when header menu item is checked."],Autoplay:[!0,"Videos begin playing immediately when opened."],"Restart when Opened":[!1,"Restart GIFs and WebMs when you hover over or expand them."],"Show Controls":[!0,"Show controls on videos expanded inline."],"Click Passthrough":[!1,"Clicks on videos trigger your browser's default behavior. Videos can be contracted with button / dragging to the left.",1],
"Allow Sound":[!0,"Open videos with the sound unmuted."],"Mouse Wheel Volume":[!0,"Adjust volume of videos with the mouse wheel over the thumbnail/filename/gallery."],"Loop in New Tab":[!0,"Loop videos opened in their own tabs."],"Volume in New Tab":[!0,`Apply ${o.name} mute and volume settings to videos opened in their own tabs.`],"Enable sound posts":[!0,"Enable loading audio from [sound=] file names. This audio is fetched from third parties."]},Menu:{Menu:[!0,"Add a drop-down menu to posts."],"Report Link":[!0,"Add a report link to the menu.",1],"Copy Text Link":[!0,"Add a link to copy the post's text.",1],"Thread Hiding Link":[!0,"Add a link to hide entire threads.",1],"Reply Hiding Link":[!0,"Add a link to hide single replies.",1],"Delete Link":[!0,"Add post and image deletion links to the menu.",1],"Archive Link":[!0,"Add an archive link to the menu.",1],"Edit Link":[!0,"Add a link to edit the image in Tegaki, /i/'s painting program. Requires Quick Reply.",1],
"Download Link":[!1,"Add a download with original filename link to the menu.",1]},Monitoring:{"Thread Updater":[!0,'Fetch and insert new replies. Has more options in the header menu and the "Advanced" tab.'],"Unread Count":[!0,"Show the unread posts count in the tab title."],"Quoted Title":[!1,"Change the page title to reflect you've been quoted.",1],"Hide Unread Count at (0)":[!1,"Hide the unread posts count in the tab title when it reaches 0.",1],"Unread Favicon":[!0,"Show a different favicon when there are unread posts."],"Unread Line":[!0,"Show a line to distinguish read posts from unread ones."],"Remember Last Read Post":[!0,"Remember how far you've read after you close the thread."],"Scroll to Last Read Post":[!0,"Scroll back to the last read post when reopening a thread.",1],"Unread Line in Index":[!1,"Show a line between read and unread posts in threads in the index.",1],"Remove Thread Excerpt":[!1,"Replace the excerpt of the thread in the tab title with the board title."],
"Thread Stats":[!0,"Display reply and image count."],"IP Count in Stats":[!0,"Display the unique IP count in the thread stats.",1],"Page Count in Stats":[!0,"Display the page count in the thread stats.",1],"Purge Position":[!1,"Update stats more often and add purge position when a thread is close to getting purged, for anons who manage general threads.",2],"Updater and Stats in Header":[!0,"Places the thread updater and thread stats in the header instead of floating them."],"Thread Watcher":[!0,"Bookmark threads. Has more options in the thread watcher menu."],"Fixed Thread Watcher":[!0,"Makes the thread watcher scroll with the page.",1],"Persistent Thread Watcher":[!1,"The thread watcher will be visible when the page is loaded.",1],"Mark New IPs":[!1,"Label each post from a new IP with the thread's current IP count."],"Reply Pruning":[!0,"Add option in header menu to hide old replies in long threads. Activated by default in stickies."],
"Prune All Threads":[!1,"Activate Reply Pruning by default in all threads.",1]},"Posting and Captchas":{"Quick Reply":[!0,"All-in-one form to reply, create threads, automate dumping and more."],"Persistent QR":[!1,"The Quick reply won't disappear after posting.",1],"Auto Hide QR":[!0,"Automatically hide the quick reply when posting.",2],"Open Post in New Tab":[!0,"Open new threads in a new tab, and open replies in a new tab if you're not already in the thread.",1],"Remember QR Size":[!1,"Remember the size of the Quick reply.",1],"Remember Spoiler":[!1,"Remember the spoiler state, instead of resetting after posting.",1],"Randomize Filename":[!1,"Set the filename to a random timestamp within the past year. Disabled on /f/.",1],"Show New Thread Option in Threads":[!0,"Show the option to post a new / different thread from inside a thread.",1],"Show Upload Progress":[!0,"Track progress of file uploads as percentage in submit button.",1],
Cooldown:[!0,"Indicate the remaining time before posting again.",1],"Posting Success Notifications":[!0,"Show notifications on successful post creation or file uploading.",1],"Auto-load captcha":[!1,"Automatically load the captcha in the QR even if your post is empty.",1],"Post on Captcha Completion":[!1,"Submit the post immediately when the captcha is completed.",1],"Force Noscript Captcha":[!1,"Use the non-Javascript fallback captcha even if Javascript is enabled."],"Pass Link":[!1,"Add a 4chan Pass login link to the bottom of the page."]},"Quote Links":{"Quote Backlinks":[!0,"Add quote backlinks."],"OP Backlinks":[!0,"Add backlinks to the OP.",1],"Bottom Backlinks":[!1,"Place backlinks at the bottom of posts.",1],"Quote Inlining":[!0,"Inline quoted post on click."],"Inline Cross-thread Quotes Only":[!1,"Don't inline quote links when the posts are visible in the thread.",1],"Quote Hash Navigation":[!1,"Include an extra link after quotes for autoscrolling to quoted posts.",1],
"Forward Hiding":[!0,"Hide original posts of inlined backlinks.",1],"Quote Previewing":[!0,"Show quoted post on hover."],"Quote Highlighting":[!0,"Highlight the previewed post.",1],"Resurrect Quotes":[!0,"Link dead quotes to the archives, and support inlining/previewing of archive links like quote links."],"Remember Your Posts":[!0,"Remember your posting history."],"Mark Quotes of You":[!0,"Add '(You)' to quotes linking to your posts.",1],"Highlight Posts Quoting You":[!0,"Highlights any posts that contain a quote to your post.",1],"Highlight Own Posts":[!0,"Highlights own posts.",1],"Mark OP Quotes":[!0,"Add '(OP)' to OP quotes."],"Mark Cross-thread Quotes":[!0,"Add '(Cross-thread)' to cross-threads quotes."],"Quote Threading":[!0,"Add option in header menu to thread conversations."]}},imageExpansion:{"Fit width":[!0,""],"Fit height":[!1,""],"Scroll into view":[!0,"Scroll down when expanding images to bring the full image into view."],
"Expand spoilers":[!0,"Expand all images along with spoilers."],"Expand videos":[!0,"Expand all images also expands videos."],"Expand from here":[!1,"Expand all images only from current position to thread end."],"Expand thread only":[!1,"In index, expand all images only within the current thread."],"Advance on contract":[!1,"Advance to next post when contracting an expanded image."]},gallery:{"Hide Thumbnails":[!1],"Fit Width":[!0],"Fit Height":[!0],"Stretch to Fit":[!1],"Scroll to Post":[!0],"Slide Delay":[6]},"Default Volume":1,threadWatcher:{"Current Board":[!1,"Only show watched threads from the current board."],"Auto Update Thread Watcher":[!0,"Periodically check status of watched threads."],"Auto Watch":[!0,"Automatically watch threads you start."],"Auto Watch Reply":[!0,"Automatically watch threads you reply to."],"Auto Prune":[!1,"Automatically remove dead threads."],"Show Page":[!0,"Show what page watched threads are on."],
"Show Unread Count":[!0,"Show number of unread posts in watched threads."],"Show Site Prefix":[!0,"When multiple sites are shown in the thread watcher, add a prefix to board names to distinguish them."],"Require OP Quote Link":[!1,"For purposes of thread watcher highlighting, only consider posts with a quote link to the OP as replies to the OP."]},filter:{general:"",postID:"# Highlight dubs on [s4s]:\n#/(\\d)\\1$/;highlight;top:no;boards:s4s",name:"# Filter any namefags:\n#/^(?!Anonymous$)/",uniqueID:"# Filter a specific ID:\n#/Txhvk1Tl/",tripcode:"# Filter any tripfag\n#/^!/",capcode:"# Set a custom class for mods:\n#/Mod$/;highlight:mod;op:yes\n# Set a custom class for admins:\n#/Admin$/;highlight:admin;op:yes",pass:"# Filter anyone using since4pass:\n#/./",email:"",subject:"# Filter Generals on /v/:\n#/general/i;boards:v;op:only",
comment:"# Filter Stallman copypasta on /g/:\n#/what you're refer+ing to as linux/i;boards:g\n# Filter posts with 20 or more quote links:\n#/(?:>>\\d(?:(?!>>\\d)[^])*){20}/\n# Filter posts like T H I S / H / I / S:\n#/^>?\\s?\\w\\s?(\\w)\\s?(\\w)\\s?(\\w).*$[\\s>]+\\1[\\s>]+\\2[\\s>]+\\3/im",flag:"",filename:"",dimensions:"# Highlight potential wallpapers:\n#/1920x1080/;op:yes;highlight;top:no;boards:w,wg",filesize:"",MD5:""},
sauces:'# Known filename formats:\nhttps://www.pixiv.net/member_illust.php?mode=medium&illust_id=%$1;regexp:/^(\\d+)_p\\d+/\njavascript:void(open("https://www.deviantart.com/"+%$1.replace(/_/g,"-")+"/art/"+parseInt(%$2,36)));regexp:/^\\w+_by_(\\w+)[_-]d([\\da-z]{6})\\b/\nhttps://imgur.com/%$1;regexp:/^(?![a-zA-Z][a-z]{6})(?![A-Z]{7})(?!\\d{7})([\\da-zA-Z]{7})(?: \\(\\d+\\))?\\.\\w+$/\nhttps://flickr.com/photo.gne?id=%$1;regexp:/^(\\d+)_[\\da-f]{10}(?:_\\w)*\\b/\nhttps://www.facebook.com/photo.php?fbid=%$1;regexp:/^\\d+_(\\d+)_\\d+_[no]\\b/\n\n# Reverse image search:\nhttps://www.google.com/searchbyimage?sbisrc=4chanx&image_url=%IMG&safe=off\nhttps://yandex.com/images/search?rpt=imageview&url=%IMG\n#//tineye.com/search?url=%IMG\n#//www.bing.com/images/search?q=imgurl:%IMG&view=detailv2&iss=sbi#enterInsights\n#https://lens.google.com/uploadbyurl?url=%IMG;text:lens\n\n# Specialized reverse image search:\n//iqdb.org/?url=%IMG\nhttps://trace.moe/?auto&url=%IMG;text:wait\n#//3d.iqdb.org/?url=%IMG\n#//saucenao.com/search.php?url=%IMG\n\n# "View Same" in archives:\nhttp://eye.swfchan.com/search/?q=%name;types:swf\n#https://desuarchive.org/_/search/image/%sMD5/\n#https://archive.4plebs.org/_/search/image/%sMD5/\n#https://boards.fireden.net/_/search/image/%sMD5/\n#https://foolz.fireden.net/_/search/image/%sMD5/\n\n# Other tools:\n#http://exif.regex.info/exif.cgi?imgurl=%URL\n#//imgops.com/start?url=%URL;types:gif,jpg,png\n#//www.gif-explode.com/%URL;types:gif',
FappeT:{werk:!1},"Custom CSS":!0,Index:{"Index Mode":"paged","Previous Index Mode":"paged","Index Size":"small","Show Replies":[!0,'Show replies in the index, and also in the catalog if "Catalog hover expand" is checked.'],"Catalog Hover Expand":[!1,"Expand the comment and show more details when you hover over a thread in the catalog."],"Catalog Hover Toggle":[!0,'Turn "Catalog hover expand" on and off by clicking in the catalog.'],"Pin Watched Threads":[!1,"Move watched threads to the start of the index."],"Anchor Hidden Threads":[!0,"Move hidden threads to the end of the index."],"Refreshed Navigation":[!1,"Refresh index when navigating through pages."]},Header:{"Fixed Header":!0,"Header auto-hide":!1,"Header auto-hide on scroll":!1,"Bottom Header":!1,"Centered links":!1,"Header catalog links":!1,"Bottom Board List":!0,"Shortcut Icons":!0,"Custom Board Navigation":!0},archives:{archiveLists:"https://4chenz.github.io/archives.json/archives.json",lastarchivecheck:0,archiveAutoUpdate:!0
},externalCatalogURLs:"//catalog.neet.tv/%board/;boards:4chan.org:3,a,adv,an,asp,biz,c,cgl,ck,cm,co,diy,f,fa,fit,g,gd,his,i,int,jp,k,lgbt,lit,m,mlp,mu,n,news,o,out,p,po,pol,s4s,sci,sp,tg,toy,trv,tv,v,vg,vip,vp,vr,w,wg,wsg,wsr,x",boardnav:`[ toggle-all ]\n[current-index-text:"Index"\ncurrent-catalog-text:"Catalog"\ncurrent-expired-text:"Expired"\ncurrent-archive-text:"Archive"]\n[external-text:"FAQ","${o.faq}"]`,QR:{"QR.personas":'#options:"sage";boards:jp;always',sjisPreview:!1},jsWhitelist:"",captchaLanguage:"",time:"%m/%d/%y(%a)%H:%M:%S",timeLocale:"",RelativeTime:"Hover",backlink:">>%id",pastedname:"file",fileInfo:"%l %d (%p%s, %r%g)",favicon:"ferongr",
usercss:"div.boardTitle{font-weight:400 !important}:root.yotsuba div.boardTitle{font-family:sans-serif !important;text-shadow:1px 1px 1px rgba(100,0,0,0.6)}:root.yotsuba-b div.boardTitle{font-family:sans-serif !important;text-shadow:1px 1px 1px rgba(105,10,15,0.6)}:root.photon div.boardTitle{font-family:sans-serif !important;text-shadow:1px 1px 1px rgba(0,74,153,0.6)}:root.tomorrow div.boardTitle{font-family:sans-serif !important;text-shadow:1px 1px 1px rgba(167,170,168,0.6)}",hotkeys:{"Toggle board list":["Ctrl+b","Toggle the full board list."],"Toggle header":["Shift+h","Toggle the auto-hide option of the header."],"Open empty QR":["q","Open QR without post number inserted."],"Open QR":["Shift+q","Open QR with post number inserted."],"Open settings":["Alt+o","Open Settings."],Close:["Esc","Close dialogs or notifications."],"Spoiler tags":["Ctrl+s","Insert spoiler tags."],"Code tags":["Alt+c","Insert code tags."],"Eqn tags":["Alt+e","Insert eqn tags."],
"Math tags":["Alt+m","Insert math tags."],"SJIS tags":["Alt+a","Insert SJIS tags."],"Toggle sage":["Alt+s","Toggle sage in options field."],"Toggle Cooldown":["Alt+Comma","Toggle custom cooldown timer."],"Post from URL":["Alt+l","Post from URL."],"Add new post":["Alt+n","Add new post to the QR dump list."],"Submit QR":["Ctrl+Enter","Submit post."],Watch:["w","Watch thread."],Update:["r","Update the thread / refresh the index."],"Update thread watcher":["Shift+r","Manually refresh thread watcher."],"Toggle thread watcher":["t","Toggle visibility of thread watcher."],"Toggle threading":["Shift+t","Toggle threading."],"Mark thread read":["Ctrl+0",'Mark thread read from index (requires "Unread Line in Index").'],"Expand image":["Shift+e","Expand selected image."],"Expand images":["e","Expand all images."],"Open Gallery":["g","Opens the gallery."],"Next Gallery Image":["Right","Go to the next image in gallery mode."],
"Previous Gallery Image":["Left","Go to the previous image in gallery mode."],"Advance Gallery":["Enter","Go to next image or, if Autoplay is off, play video."],Pause:["p","Pause/play videos in the gallery."],Slideshow:["Ctrl+Right","Toggle the gallery slideshow mode."],"Rotate image clockwise":["Shift+Right","Rotate image clockwise in gallery."],"Rotate image anticlockwise":["Shift+Left","Rotate image anticlockwise in gallery."],"Download Gallery Image":["Shift+j","Download current image in gallery."],fappeTyme:["f","Toggle Fappe Tyme."],werkTyme:["Shift+w","Toggle Werk Tyme."],"Front page":["1","Jump to front page."],"Open front page":["Shift+1","Open front page in a new tab."],"Next page":["Ctrl+Right","Jump to the next page."],"Previous page":["Ctrl+Left","Jump to the previous page."],"Paged mode":["Alt+1","Open the index in paged mode."],"Infinite scrolling mode":["Alt+2","Open the index in infinite scrolling mode."],
"All pages mode":["Alt+3","Open the index in all threads mode."],"Open catalog":["Shift+c","Open the catalog of the current board."],"Search form":["Ctrl+Alt+s","Focus the search field on the board index."],"Cycle sort type":["Alt+x","Cycle through index sort types."],"Next thread":["Ctrl+Down","See next thread."],"Previous thread":["Ctrl+Up","See previous thread."],"Expand thread":["Ctrl+e","Expand thread."],"Open thread":["o","Open thread in current tab."],"Open thread tab":["Shift+o","Open thread in new tab."],"Next reply":["j","Select next reply."],"Previous reply":["k","Select previous reply."],"Deselect reply":["Shift+d","Deselect reply."],Hide:["x","Hide thread."],"Quick Filter MD5":["5","Add the MD5 of the selected image to the filter list."],"Previous Post Quoting You":["Alt+Up","Scroll to the previous post that quotes you."],"Next Post Quoting You":["Alt+Down","Scroll to the next post that quotes you."]},updater:{checkbox:{
Beep:[!1,"Beep on new post to completely read thread."],"Beep Quoting You":[!1,"Beep on new post quoting you."],"Auto Scroll":[!1,"Scroll updated posts into view. Only enabled at bottom of page."],"Bottom Scroll":[!1,"Always scroll to the bottom, not the first new post. Useful for event threads."],"Scroll BG":[!1,"Auto-scroll background tabs."],"Auto Update":[!0,"Automatically fetch new posts."],"Optional Increase":[!1,"Increase the intervals between updates on threads without new posts."]},Interval:5},customCooldown:0,customCooldownEnabled:!0,"Thread Quotes":!1,"Max Replies":1e3,"Autohiding Scrollbar":!1,position:{"embedding.position":"top: 50px; right: 0px;","thread-stats.position":"bottom: 0px; right: 0px;","updater.position":"bottom: 0px; left: 0px;","thread-watcher.position":"top: 50px; left: 0px;","qr.position":"top: 50px; right: 0px;"},fourchanImageHost:"i.4cdn.org",hiddenPSAList:[{}],
knownBanners:["0.jpg","1.jpg","2.jpg","4.jpg","6.jpg","7.jpg","8.jpg","9.jpg","10.jpg","11.jpg","12.jpg","13.jpg","14.jpg","16.jpg","17.jpg","18.jpg","19.jpg","20.jpg","21.jpg","22.jpg","24.jpg","25.jpg","26.jpg","28.jpg","29.jpg","33.jpg","38.jpg","39.jpg","43.jpg","44.jpg","45.jpg","46.jpg","47.jpg","52.jpg","54.jpg","57.jpg","59.jpg","60.jpg","61.jpg","64.jpg","66.jpg","67.jpg","69.jpg","71.jpg","72.jpg","76.jpg","77.jpg","81.jpg","82.jpg","83.jpg","84.jpg","88.jpg","90.jpg","91.jpg","96.jpg","98.jpg","99.jpg","100.jpg","104.jpg","106.jpg","116.jpg","119.jpg","137.jpg","140.jpg","148.jpg","149.jpg","150.jpg","154.jpg","156.jpg","157.jpg","158.jpg","159.jpg","161.jpg","162.jpg","164.jpg","165.jpg","166.jpg","167.jpg","168.jpg","169.jpg","170.jpg","171.jpg","172.jpg","173.jpg","174.jpg","175.jpg","176.jpg","178.jpg","179.jpg","180.jpg","181.jpg","182.jpg","183.jpg","186.jpg","189.jpg","190.jpg","192.jpg","193.jpg","194.jpg","197.jpg","198.jpg","200.jpg","201.jpg","202.jpg","203.jpg","205.jpg","206.jpg","207.jpg","208.jpg","210.jpg","213.jpg","214.jpg","215.jpg","216.jpg","218.jpg","219.jpg","220.jpg","221.jpg","222.jpg","223.jpg","224.jpg","227.jpg","0.png","1.png","2.png","3.png","5.png","6.png","9.png","10.png","11.png","12.png","14.png","16.png","19.png","20.png","21.png","22.png","23.png","24.png","26.png","27.png","28.png","29.png","30.png","31.png","32.png","33.png","34.png","37.png","39.png","40.png","41.png","42.png","43.png","44.png","45.png","48.png","49.png","50.png","51.png","52.png","53.png","57.png","58.png","59.png","64.png","66.png","67.png","68.png","69.png","70.png","71.png","72.png","76.png","78.png","79.png","81.png","82.png","85.png","86.png","87.png","89.png","95.png","98.png","100.png","101.png","102.png","105.png","106.png","107.png","109.png","110.png","111.png","112.png","113.png","114.png","115.png","116.png","118.png","119.png","120.png","121.png","122.png","123.png","126.png","128.png","130.png","134.png","136.png","138.png","139.png","140.png","142.png","145.png","146.png","149.png","150.png","151.png","152.png","153.png","154.png","155.png","156.png","157.png","158.png","159.png","160.png","163.png","164.png","165.png","166.png","167.png","168.png","169.png","170.png","171.png","172.png","173.png","174.png","178.png","179.png","180.png","181.png","182.png","184.png","186.png","188.png","190.png","192.png","193.png","194.png","195.png","196.png","197.png","198.png","200.png","202.png","203.png","205.png","206.png","207.png","209.png","212.png","213.png","214.png","216.png","217.png","218.png","219.png","220.png","221.png","222.png","223.png","224.png","225.png","226.png","229.png","231.png","232.png","233.png","234.png","235.png","237.png","238.png","239.png","240.png","241.png","242.png","244.png","245.png","246.png","247.png","248.png","249.png","250.png","253.png","254.png","255.png","256.png","257.png","258.png","259.png","260.png","262.png","268.png","0.gif","1.gif","2.gif","3.gif","4.gif","5.gif","6.gif","7.gif","8.gif","9.gif","10.gif","12.gif","13.gif","14.gif","15.gif","16.gif","18.gif","19.gif","20.gif","21.gif","22.gif","23.gif","24.gif","28.gif","29.gif","30.gif","33.gif","34.gif","35.gif","36.gif","37.gif","39.gif","40.gif","42.gif","44.gif","45.gif","46.gif","48.gif","50.gif","52.gif","54.gif","55.gif","57.gif","58.gif","59.gif","60.gif","61.gif","63.gif","64.gif","66.gif","67.gif","68.gif","69.gif","70.gif","72.gif","73.gif","75.gif","76.gif","77.gif","78.gif","80.gif","81.gif","82.gif","83.gif","86.gif","87.gif","88.gif","92.gif","93.gif","94.gif","95.gif","96.gif","97.gif","98.gif","99.gif","100.gif","101.gif","102.gif","103.gif","104.gif","105.gif","106.gif","108.gif","109.gif","110.gif","111.gif","112.gif","113.gif","115.gif","116.gif","117.gif","118.gif","119.gif","120.gif","122.gif","123.gif","124.gif","127.gif","129.gif","130.gif","131.gif","134.gif","135.gif","136.gif","138.gif","139.gif","141.gif","144.gif","146.gif","148.gif","149.gif","153.gif","154.gif","155.gif","157.gif","158.gif","159.gif","160.gif","161.gif","162.gif","164.gif","166.gif","167.gif","168.gif","169.gif","170.gif","171.gif","172.gif","173.gif","174.gif","175.gif","176.gif","177.gif","178.gif","181.gif","182.gif","183.gif","185.gif","186.gif","187.gif","188.gif","189.gif","190.gif","191.gif","192.gif","193.gif","195.gif","196.gif","197.gif","200.gif","201.gif","202.gif","203.gif","204.gif","205.gif","206.gif","207.gif","208.gif","209.gif","210.gif","211.gif","212.gif","213.gif","214.gif","215.gif","216.gif","217.gif","219.gif","220.gif","221.gif","222.gif","224.gif","225.gif","226.gif","227.gif","228.gif","230.gif","232.gif","233.gif","234.gif","235.gif","238.gif","240.gif","241.gif","243.gif","244.gif","245.gif","246.gif","247.gif","249.gif","250.gif","251.gif","253.gif"].join(","),
passMessageClosed:!1,PSAseen:[[]],XEmbedder:"fxt",fxtLang:"",fxtUrl:"https://api.fxtwitter.com",fxtMaxReplies:5,beepSource:"",beepVolume:1},u=(e,t)=>{let o=0,a=null,i=null,s=null;const n=function(){return o=Date.now(),t.apply(i,s)};return function(){return s=arguments,i=this,o<Date.now()-e?n():(clearTimeout(a),a=setTimeout(n,e))}},p=()=>Object.create(null);p.clone=function(e){if("object"!=typeof e||null===e)return e;if(e instanceof Array){const t=[];for(let o=0,a=e.length;o<a;o++)t.push(p.clone(e[o]));return t}{const a=Object.create(null);for(var t in e){var o=e[t];a[t]=p.clone(o)}return a}},p.json=e=>p.clone(JSON.parse(e));const g=1e3,f=6e4,m=36e5,b=24*m,v=window.GM_xmlhttpRequest?"userscript":"crx",A={stubCloneTopNav:()=>{window.cloneTopNav=function(){}},disableNativeExtension:()=>{try{const e=JSON.parse(localStorage.getItem("4chan-settings"))||{};if(e.disableAll)return;e.disableAll=!0,localStorage.setItem("4chan-settings",JSON.stringify(e))}catch(e){
Object.defineProperty(window,"Config",{value:{disableAll:!0}})}},disableNativeExtensionNoStorage:()=>{Object.defineProperty(window,"Config",{value:{disableAll:!0}})},prettyPrint:({id:e})=>{
// @ts-ignore
window.prettyPrint?.((function(){}),document.getElementById(e).parentNode)},exposeVersion:({buildDate:e,version:t})=>{const o=+e;Object.defineProperty(window,"fourchanXT",{value:Object.freeze({version:t,get buildDate(){return new Date(o)}}),writable:!1})},initMain:()=>{document.documentElement.classList.add("js-enabled"),window.FCX={}},initFlash:()=>{JSON.parse(localStorage["4chan-settings"]||"{}").disableAll&&window.SWFEmbed.init()},initFlashNoStorage:()=>{window.SWFEmbed.init()},setThreadId:()=>{window.Main.tid=location.pathname.split(/\/+/)[3]},fourChanPrettyPrintListener:()=>{window.addEventListener("prettyprint",(e=>window.dispatchEvent(new CustomEvent("prettyprint:cb",{detail:{ID:e.detail.ID,i:e.detail.i,html:window.prettyPrintOne(e.detail.html)}}))),!1)},fourChanMathjaxListener:()=>{window.addEventListener("mathjax",(function(e){
window.MathJax?window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,e.target]):(document.querySelector('script[src^="//cdn.mathjax.org/"]')||(window.loadMathJax(),window.loadMathJax=function(){}),e.target.classList.contains("postMessage")||document.querySelector('script[src^="//cdn.mathjax.org/"]').addEventListener("load",(()=>window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,e.target])),!1))}),!1)},disable4chanIdHl:()=>{for(var e of(window.clickable_ids=!1,document.querySelectorAll(".posteruid, .capcode")))e.removeEventListener("click",window.idClick,!1)},initTinyBoard:({boardID:e,threadID:t})=>{t=+t;const o=document.querySelector('form[name="post"]');window.$(document).ajaxComplete((function(i,s,n){let r;if(n.url!==o.action)return;if(!(r=+s.responseJSON?.id))return;const l={boardID:e,threadID:t,postID:r};try{const{redirect:e,noko:t}=s.responseJSON;!e||null==a||a||t||(l.redirect=e)}catch(e){}i=new CustomEvent("QRPostSuccessful",{bubbles:!0,detail:l}),document.dispatchEvent(i)
}));var a=window.tb_settings?.ajax?.always_noko_replies;let i;((i=window.tb_settings||(window.tb_settings={})).ajax||(i.ajax={})).always_noko_replies=!0},setupCaptcha:({recaptchaKey:e})=>{const t=function(){const{classList:t}=document.documentElement,o=document.querySelector("#qr .captcha-container");o.dataset.widgetID=window.grecaptcha.render(o,{sitekey:e,theme:t.contains("tomorrow")||t.contains("spooky")||t.contains("dark-captcha")?"dark":"light",callback(e){window.dispatchEvent(new CustomEvent("captcha:success",{detail:e}))}})};if(window.grecaptcha)t();else{const e=window.onRecaptchaLoaded;if(window.onRecaptchaLoaded=function(){t(),e()},!document.head.querySelector('script[src^="https://www.google.com/recaptcha/api.js"]')){const e=document.createElement("script");e.src="https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoaded&render=explicit",document.head.appendChild(e)}}},resetCaptcha:()=>{
window.grecaptcha.reset(document.querySelector("#qr .captcha-container").dataset.widgetID)},setupTCaptcha:({boardID:e,threadID:t,autoLoad:o})=>{const{TCaptcha:a}=window;a.init(document.querySelector("#qr .captcha-container"),e,+t),a.setErrorCb((e=>window.dispatchEvent(new CustomEvent("CreateNotification",{detail:{type:"warning",content:""+e}})))),"1"===o&&a.load(e,t)},destroyTCaptcha:()=>{window.TCaptcha.destroy()},TCaptchaClearChallenge:()=>{window.TCaptcha.clearChallenge()},setupQR:()=>{window.FCX.oekakiCB=()=>window.Tegaki.flatten().toBlob((function(e){const t=`oekaki-${Date.now()}`;window.FCX.oekakiLatest=t,document.dispatchEvent(new CustomEvent("QRSetFile",{bubbles:!0,detail:{file:e,name:window.FCX.oekakiName,source:t}}))})),window.Tegaki&&(document.querySelector("#qr .oekaki").hidden=!1)},qrTegakiDraw:()=>{const{Tegaki:e,FCX:t}=window;e.bg&&e.destroy(),t.oekakiName="tegaki.png",e.open({onDone:t.oekakiCB,onCancel(){e.bgColor="#ffffff"},
width:+document.querySelector("#qr [name=oekaki-width]").value,height:+document.querySelector("#qr [name=oekaki-height]").value,bgColor:document.querySelector("#qr [name=oekaki-bg]").checked?document.querySelector("#qr [name=oekaki-bgcolor]").value:"transparent"})},qrTegakiLoad:()=>{const{Tegaki:e,FCX:t}=window,o=document.getElementById("qr-filename").value.replace(/\.\w+$/,"")+".png",{source:a}=document.getElementById("file-n-submit").dataset,i=e=>document.dispatchEvent(new CustomEvent("CreateNotification",{bubbles:!0,detail:{type:"warning",content:e,lifetime:20}}));var s=function(a){a&&this.removeEventListener("QRMetadata",s,!1);const n=document.getElementById("selected");if(!n?.dataset.type)return i("No file to edit.");if(!/^(image|video)\//.test(n.dataset.type))return i("Not an image.");if(!n.dataset.height)return i("Metadata not available.");if("loading"===n.dataset.height)return void n.addEventListener("QRMetadata",s,!1);e.bg&&e.destroy(),t.oekakiName=o,e.open({onDone:t.oekakiCB,
onCancel(){e.bgColor="#ffffff"},width:+n.dataset.width,height:+n.dataset.height,bgColor:"transparent"});const r=document.createElement("canvas");r.width=r.naturalWidth=+n.dataset.width,r.height=r.naturalHeight=+n.dataset.height,r.hidden=!0,document.body.appendChild(r),r.addEventListener("QRImageDrawn",(function(){this.remove(),e.onOpenImageLoaded.call(this)}),!1),r.dispatchEvent(new CustomEvent("QRDrawFile",{bubbles:!0}))};e.bg&&e.onDoneCb===t.oekakiCB&&a===t.oekakiLatest?(t.oekakiName=o,e.resume()):s()},testNativeExtension:(e={})=>(window.Parser?.postMenuIcon&&(e.enabled="true"),e)},x=(e,t=document.body)=>t.querySelector(e);x.id=e=>n.getElementById(e),x.ready=function(e){if("loading"===n.readyState){var t=function(){x.off(n,"DOMContentLoaded",t),e()};x.on(n,"DOMContentLoaded",t)}else x.queueTask(e)},x.formData=function(e){if(e instanceof HTMLFormElement)return new FormData(e);const t=new FormData;for(var o in e){var a=e[o]
;a&&("object"==typeof a&&"newName"in a?t.append(o,a,a.newName):t.append(o,a))}return t},x.extend=function(e,t){for(var o in t){var a=t[o];e[o]=a}},x.hasOwn=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),x.getOwn=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0},x.ajax=function(){let e=XMLHttpRequest;if(window.wrappedJSObject&&!XMLHttpRequest.wrappedJSObject)try{e=XPCNativeWrapper(window.wrappedJSObject.XMLHttpRequest)}catch(e){}return function(t,a={}){null==a.responseType&&(a.responseType="json"),a.type||(a.type=a.form?"post":"get"),t=t.replace(/^((?:https?:)?\/\/(?:\w+\.)?(?:4chan|4channel|4cdn)\.org)\/adv\//,"$1//adv/");const{onloadend:i,timeout:s,responseType:n,withCredentials:r,type:d,onprogress:c,form:h,headers:u}=a,p=new e;try{p.open(d,t,!0);const e=u||{};for(var g in e){var f=e[g];p.setRequestHeader(g,f)}x.extend(p,{onloadend:i,timeout:s,responseType:n,withCredentials:r}),x.extend(p.upload,{onprogress:c}),x.on(p,"error",(function(){
p.status||l.warn(`${o.name} failed to load: ${t}`)})),p.send(h)}catch(e){if(2153644038!==e.result)throw e;p.onloadend=i,x.queueTask(x.event,"error",null,p),x.queueTask(x.event,"loadend",null,p)}return p}}(),x.lastModified=p(),x.whenModified=function(e,t,o,a={}){let i;const{timeout:s,ajax:n}=a,r=p();null!=(i=x.lastModified[t]?.[e])&&(r["If-Modified-Since"]=i);return(n||x.ajax)(e,{onloadend(){return(x.lastModified[t]||(x.lastModified[t]=p()))[e]=this.getResponseHeader("Last-Modified"),o.call(this)},timeout:s,headers:r})},function(){const e=p();x.cache=function(t,o,a={}){let i;const{ajax:s}=a;if(i=e[t])return i.callbacks?i.callbacks.push(o):x.queueTask((()=>o.call(i,{isCached:!0}))),i;return i=(s||x.ajax)(t,{onloadend:function(){for(o of(this.status||delete e[t],this.callbacks))(e=>{x.queueTask((()=>e.call(this,{isCached:!1})))})(o);return delete this.callbacks}}),i.callbacks=[o],e[t]=i},x.cleanCache=function(t){for(var o in e)t(o)&&delete e[o]}}(),x.cb={checked(){
if(x.hasOwn(a,this.name))return x.set(this.name,this.checked),a[this.name]=this.checked},value(){if(x.hasOwn(a,this.name))return x.set(this.name,this.value.trim()),a[this.name]=this.value}},x.asap=function(e,t){return e()?t():setTimeout(x.asap,25,e,t)},x.onExists=function(e,t,o){let a;if(a=x(t,e))o(a);else{var i=new MutationObserver((function(){(a=x(t,e))&&(i.disconnect(),o(a))}));i.observe(e,{childList:!0,subtree:!0})}},x.addStyle=function(e,t,o="head"){const a=x.el("style",{textContent:e});return null!=t&&(a.id=t),x.onExists(r,o,(()=>x.add(n.head,a))),a},x.addCSP=function(e){const t=x.el("meta",{httpEquiv:"Content-Security-Policy",content:e});if(n.head)return x.add(n.head,t),x.rm(t);{const e=x.add(r||n,x.el("head"));return x.add(e,t),x.rm(e)}},x.x=function(e,t){return t||(t=n.body),n.evaluate(e,t,null,8,null).singleNodeValue},x.X=function(e,t){return t||(t=n.body),n.evaluate(e,t,null,7,null)},x.addClass=function(e,...t){e.classList.add(...t)},x.rmClass=function(e,...t){
e.classList.remove(...t)},x.toggleClass=(e,t)=>e.classList.toggle(t),x.hasClass=(e,t)=>e.classList.contains(t),x.rm=e=>e?.remove(),x.rmAll=e=>e.textContent=null,x.tn=e=>n.createTextNode(e),x.frag=()=>n.createDocumentFragment(),x.nodes=function(e){if(!(e instanceof Array))return e;const t=x.frag();for(var o of e)t.appendChild(o);return t},x.add=(e,t)=>e.appendChild(x.nodes(t)),x.prepend=(e,t)=>e.insertBefore(x.nodes(t),e.firstChild),x.after=(e,t)=>e.parentNode.insertBefore(x.nodes(t),e.nextSibling),x.before=(e,t)=>e.parentNode.insertBefore(x.nodes(t),e),x.replace=(e,t)=>e.parentNode.replaceChild(x.nodes(t),e),x.el=function(e,t,o){const a=n.createElement(e);return t&&x.extend(a,t),o&&x.extend(a,o),a},x.on=function(e,t,o){for(var a of t.split(" "))e.addEventListener(a,o,!1)},x.off=function(e,t,o){for(var a of t.split(" "))e.removeEventListener(a,o,!1)},x.one=function(e,t,o){var a=function(i){return x.off(e,t,a),o.call(this,i)};return x.on(e,t,a)},x.event=function(e,t,o=n){
return globalThis.chrome?.extension||null!=t&&"function"==typeof cloneInto&&(t=cloneInto(t,n.defaultView)),o.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:t}))},function(){if(/PaleMoon\//.test(navigator.userAgent)&&!(+GM_info?.version?.split(".")[0]<2)&&"undefined"==typeof cloneInto)try{return new CustomEvent("x",{detail:{}})}catch(t){const o={Object:unsafeWindow.Object,Array:unsafeWindow.Array};var e=function(t){let a;if(null!=t&&"object"==typeof t&&(a=o[t.constructor.name])){const o=new a;for(var i in t){var s=t[i];o[i]=e(s)}return o}return t};return x.event=(t,o,a=n)=>a.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:e(o)}))}}(),x.modifiedClick=e=>e.shiftKey||e.altKey||e.ctrlKey||e.metaKey||0!==e.button,x.open=globalThis.chrome?.extension?e=>window.open(e,"_blank"):null!=GM?.openInTab?GM.openInTab:"undefined"!=typeof GM_openInTab&&null!==GM_openInTab?GM_openInTab:e=>window.open(e,"_blank"),x.debounce=function(e,t){let o=0,a=null,i=null,s=null
;const n=function(){return o=Date.now(),t.apply(i,s)};return function(){return s=arguments,i=this,o<Date.now()-e?n():(clearTimeout(a),a=setTimeout(n,e))}},x.queueTask=function(){const e=[],t=function(){const[t,...o]=e.shift();t(...o)};return function(){e.push(arguments),Promise.resolve().then(t)}}(),x.global=async function(e,t){if("crx"===v&&3===chrome.runtime.getManifest().manifest_version)return x.eventPageRequest({type:"runInPageContext",fn:e,data:t});if(r){const o=x.el("script",{textContent:`(${A[e]})(document.currentScript.dataset);`});return t&&x.extend(o.dataset,t),x.add(n.head||r,o),x.rm(o),o.dataset}try{A[e](t)}catch(e){console.error(e)}return t},x.bytesToString=function(e){let t=0;for(;e>=1024;)e/=1024,t++;return`${e=t>1?Math.round(100*e)/100:Math.round(e)} ${["B","KB","MB","GB"][t]}`},x.minmax=(e,t,o)=>e<t?t:e>o?o:e,x.hasAudio=e=>e.mozHasAudio||!!e.webkitAudioDecodedByteCount||"AUDIO"===e.nextElementSibling?.tagName,x.luma=e=>.299*e[0]+.587*e[1]+.114*e[2],
x.unescape=function(e){return null==e?e:e.replace(/<[^>]*>/g,"").replace(/&(amp|#039|quot|lt|gt|#44);/g,(e=>({"&amp;":"&","&#039;":"'","&quot;":'"',"&lt;":"<","&gt;":">","&#44;":","}[e])))},x.isImage=e=>/\.(jpe?g|jfif|png|gif|bmp|webp|avif|jxl)$/i.test(e),x.isVideo=e=>/\.(webm|mp4|ogv)$/i.test(e),x.engine=/Edge\//.test(navigator.userAgent)?"edge":/Chrome\//.test(navigator.userAgent)?"blink":/WebKit\//.test(navigator.userAgent)?"webkit":/Gecko\/|Goanna/.test(navigator.userAgent)?"gecko":void 0,x.hasStorage=function(){try{return"true"===localStorage.getItem(i.NAMESPACE+"hasStorage")||(localStorage.setItem(i.NAMESPACE+"hasStorage","true"),"true"===localStorage.getItem(i.NAMESPACE+"hasStorage"))}catch(e){return!1}}(),x.item=function(e,t){const o=p();return o[e]=t,o},x.oneItemSugar=e=>function(t,o,a){return"string"==typeof t?e(x.item(t,o),a):e(t,o)},x.syncing=p(),x.securityCheck=function(e){if("https:"!==location.protocol)return delete e["Redirect to HTTPS"]},
null==GM?.deleteValue||!window.BroadcastChannel||"undefined"!=typeof GM_addValueChangeListener&&null!==GM_addValueChangeListener?("undefined"!=typeof GM_deleteValue&&null!==GM_deleteValue?(x.getValue=GM_getValue,x.listValues=()=>GM_listValues()):x.hasStorage?(x.getValue=e=>localStorage.getItem(e),x.listValues=()=>(()=>{const e=[];for(var t in localStorage)t.slice(0,i.NAMESPACE.length)===i.NAMESPACE&&e.push(t);return e})()):(x.getValue=function(){},x.listValues=()=>[]),"undefined"!=typeof GM_addValueChangeListener&&null!==GM_addValueChangeListener?(x.setValue=GM_setValue,x.deleteValue=GM_deleteValue):"undefined"!=typeof GM_deleteValue&&null!==GM_deleteValue?(x.oldValue=p(),x.setValue=function(e,t){if(GM_setValue(e,t),e in x.syncing&&(x.oldValue[e]=t,x.hasStorage))return localStorage.setItem(e,t)},x.deleteValue=function(e){if(GM_deleteValue(e),e in x.syncing&&(delete x.oldValue[e],x.hasStorage))return localStorage.removeItem(e)},
x.hasStorage||(x.cantSync=!0)):x.hasStorage?(x.oldValue=p(),x.setValue=function(e,t){return e in x.syncing&&(x.oldValue[e]=t),localStorage.setItem(e,t)},x.deleteValue=function(e){return e in x.syncing&&delete x.oldValue[e],localStorage.removeItem(e)}):(x.setValue=function(){},x.deleteValue=function(){},x.cantSync=x.cantSet=!0),"undefined"!=typeof GM_addValueChangeListener&&null!==GM_addValueChangeListener?(x.sync=(e,t)=>x.syncing[e]=GM_addValueChangeListener(i.NAMESPACE+e,(function(o,a,i,s){if(s)return void 0!==i&&(i=p.json(i)),t(i,e)})),x.forceSync=function(){}):"undefined"!=typeof GM_deleteValue&&null!==GM_deleteValue||x.hasStorage?(x.sync=function(e,t){return e=i.NAMESPACE+e,x.syncing[e]=t,x.oldValue[e]=x.getValue(e)},function(){const e=function({key:e,newValue:t}){let o;if(o=x.syncing[e]){if(null!=t){if(t===x.oldValue[e])return;return x.oldValue[e]=t,o(p.json(t),e.slice(i.NAMESPACE.length))}if(null!=x.oldValue[e])return delete x.oldValue[e],o(void 0,e.slice(i.NAMESPACE.length))}}
;x.on(window,"storage",e),x.forceSync=function(t){return t=i.NAMESPACE+t,e({key:t,newValue:x.getValue(t)})}}()):(x.sync=function(){},x.forceSync=function(){}),x.delete=function(e){for(var t of(e instanceof Array||(e=[e]),e))x.deleteValue(i.NAMESPACE+t)},x.get=x.oneItemSugar(((e,t)=>x.queueTask(x.getSync,e,t))),x.getSync=function(e,t){for(var o in e){var a;if(a=x.getValue(i.NAMESPACE+o))try{e[o]=p.json(a)}catch(e){if(!/^(?:undefined)*$/.test(a))throw e}}return t(e)},x.set=x.oneItemSugar((function(e,t){return x.securityCheck(e),x.queueTask((function(){for(var o in e){var a=e[o];x.setValue(i.NAMESPACE+o,JSON.stringify(a))}return t?.()}))})),x.clear=function(e){x.delete(Object.keys(a)),x.delete(["previousversion","QR Size","QR.persona"]);try{x.delete(x.listValues().map((e=>e.replace(i.NAMESPACE,""))))}catch(e){}return e?.()}):(x.syncChannel=new BroadcastChannel(i.NAMESPACE+"sync"),x.on(x.syncChannel,"message",(e=>(()=>{const t=[];for(var o in e.data){var a,i=e.data[o]
;(a=x.syncing[o])&&t.push(a(p.json(JSON.stringify(i)),o))}return t})())),x.sync=(e,t)=>x.syncing[e]=t,x.forceSync=function(){},x.delete=function(e,t){let o;e instanceof Array||(e=[e]),Promise.all(e.map((e=>GM.deleteValue(i.NAMESPACE+e)))).then((function(){const a=p();for(o of e)a[o]=void 0;x.syncChannel.postMessage(a),t?.()}))},x.get=x.oneItemSugar((function(e,t){const o=Object.keys(e);return Promise.all(o.map((e=>GM.getValue(i.NAMESPACE+e)))).then((function(a){for(let t=0;t<a.length;t++){var i=a[t];i&&(e[o[t]]=p.json(i))}return t(e)}))})),x.set=x.oneItemSugar((function(e,t){return x.securityCheck(e),Promise.all((()=>{const t=[];for(var o in e){var a=e[o];t.push(GM.setValue(i.NAMESPACE+o,JSON.stringify(a)))}return t})()).then((function(){return x.syncChannel.postMessage(e),t?.()}))})),x.clear=e=>GM.listValues().then((t=>x.delete(t.map((e=>e.replace(i.NAMESPACE,""))),e))).catch((()=>x.delete(Object.keys(a).concat(["previousversion","QR Size","QR.persona"]),e))));var w={url(e,t,...o){
let a,s;return(s=i.sites[t.siteID])&&(a=x.getOwn(s.urls,e))?a(t,...o):void 0},threadExcerpt(e){const{OP:t}=e,o=`/${decodeURIComponent(e.board.ID)}/ - `+(t.info.subject?.trim()||t.commentDisplay().replace(/\n+/g," // ")||t.file?.name||`No.${t}`);return o.length>73?`${o.slice(0,70)}...`:o},threadFromRoot(e){if(null==e)return null;const{board:t}=e.dataset;return i.threads.get(`${t?encodeURIComponent(t):i.BOARD.ID}.${e.id.match(/\d*$/)[0]}`)},threadFromNode:e=>w.threadFromRoot(x.x(`ancestor-or-self::${i.SITE.xpath.thread}`,e)),postFromRoot(e){if(null==e)return null;const t=i.posts.get(e.dataset.fullID),o=e.dataset.clone;return o?t.clones[+o]:t},postFromNode:e=>w.postFromRoot(x.x(`ancestor-or-self::${i.SITE.xpath.postContainer}[1]`,e)),postDataFromLink(e){let t,o,a;if(e.dataset.postID)({boardID:t,threadID:a,postID:o}=e.dataset),a||(a=0);else{const s=e.href.match(i.SITE.regexp.quotelink);[t,a,o]=s.slice(1),o||(o=a)}return{boardID:t,threadID:+a,postID:+o}},allQuotelinksLinkingTo(e){
const t=[],{posts:o}=i,{fullID:s}=e,n=function(e,o){for(var a of(t.push(...e.nodes[o]||[]),e.clones))t.push(...a.nodes[o]||[])};if(o.forEach((function(e){if(e.quotes.includes(s))return n(e,"quotelinks")})),a["Quote Backlinks"])for(var r of e.quotes){var l;(l=o.get(r))&&n(l,"backlinks")}return t.filter((function(t){const{boardID:o,postID:a}=w.postDataFromLink(t);return o===e.board.ID&&a===e.ID}))}};const y=Symbol("isEscaped"),k=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr"]),I=Symbol("hFragment");function C(e,t,...o){let a=e===I?"":`<${e}`;if(t)for(const[e,o]of Object.entries(t))(o||0===o)&&(a+=` ${e}`,!0!==o&&(a+=`="${s(o.toString())}"`));e!==I&&(a+=">");const i=e!==I&&k.has(e);if(i){if(o.length)throw new TypeError(`${e} is a void html element and can't have child elements`)}else for(const e of o)null!=e&&""!==e&&(e instanceof Object&&"innerHTML"in e&&e[y]?a+=e.innerHTML:a+=s(e.toString()));return i||e===I||(a+=`</${e}>`),{
innerHTML:a,[y]:!0}}const D=" | ",E=C("div",{id:"fourchanx-settings",class:"dialog"},C("nav",null,C("div",{class:"sections-list"}),C("p",{class:"imp-exp-result warning"}),C("div",{class:"credits"},C("a",{class:"export"},"Export"),D,C("a",{class:"import"},"Import"),D,C("a",{class:"reset"},"Reset Settings"),D,C("input",{type:"file",hidden:!0,accept:".json,application/json"}),C("a",{href:o.page,target:"_blank"},o.name),D,C("a",{href:o.changelog,target:"_blank"},i.VERSION),D,C("a",{href:o.issues,target:"_blank"},"Issues"),D,C("a",{href:"javascript:;",class:"close",title:"Close"},"✕"))),C("div",{class:"section-container"},C("section",null)));const S=(e,t=n.body)=>Array.from(t.querySelectorAll(e));var T={init(){if((this.useFaster=/\S/.test(a.fourchanImageHost))&&"yotsuba"===i.SITE.software&&["index","thread"].includes(i.VIEW))return c.Post.push({name:"Image Host Rewriting",cb:this.node})},suggestions:["i.4cdn.org","is2.4chan.org"],host:()=>a.fourchanImageHost.trim()||"i.4cdn.org",
flashHost:()=>"i.4cdn.org",thumbHost:()=>"i.4cdn.org",test:e=>"i.4cdn.org"===e||T.regex.test(e),regex:/^is\d*\.4chan(?:nel)?\.org$/,node(){if(this.isClone)return;const e=T.host();return this.file&&T.test(this.file.url.split("/")[2])&&!/\.swf$/.test(this.file.url)&&(this.file.link.hostname=e,this.file.thumbLink&&(this.file.thumbLink.hostname=e),this.file.url=this.file.link.href),T.fixLinks(S("a",this.nodes.comment))},fixLinks(e){for(var t of e)if(T.test(t.hostname)&&!/\.swf$/.test(t.pathname)){var o=T.host();t.hostname!==o&&(t.hostname=o)}}};const R={
boards:'.dialog{border:1px solid;display:block;background-color:inherit}.dialog:not(#qr):not(#thread-watcher):not(#header-bar){box-shadow:0 1px 2px rgba(0, 0, 0, .15)}#qr,#thread-watcher{box-shadow:-1px 2px 2px rgba(0, 0, 0, 0.25)}.field{background-color:#FFF;border:1px solid #CCC;box-sizing:border-box;color:#333;font:13px sans-serif;outline:none;transition:color .25s, border-color .25s}.field::placeholder{color:#AAA;opacity:1}.field:hover{border-color:#999}.field:hover, .field:focus, .field.focus{color:#000}.field[disabled]{background-color:#F2F2F2;color:#888}.move{cursor:move;overflow:hidden}label{cursor:pointer}a[href="javascript:;"]{text-decoration:none}.warning{color:red}:root.sw-yotsuba #boardNavDesktop, :root.sw-yotsuba #boardNavMobile{display:none !important}:root.hide-bottom-board-list $site$boardListBottom{display:none}body.hasDropDownNav{margin-top:5px}.painted{border-radius:3px;padding:0px 2px}[hidden]{display:none !important}:root.sw-yotsuba .opContainer, :root.sw-yotsuba .op{display:block;overflow:visible}:root.sw-yotsuba .reply>.file>.fileText{margin:0 20px}:root.sw-yotsuba #arc-list span.quote{color:#789922}:root.sw-yotsuba .fileText a{unicode-bidi:isolate}:root.sw-yotsuba #g-recaptcha{min-height:78px;height:auto}:root.sw-yotsuba:not(.js-enabled) #postForm{display:table}:root.sw-yotsuba #captchaContainerAlt td:nth-child(2){display:table-cell !important}:root.sw-yotsuba canvas#tegaki-canvas{background:none}:root.sw-yotsuba>body>div:last-of-type{transition:none !important}:root.sw-yotsuba>body>div[style*=" top: -10000px;"]{visibility:hidden !important}:root.sw-yotsuba .post>.file{word-break:break-word}:root.sw-yotsuba:not(.ua-webkit):not(.ua-blink) .fileText{word-wrap:break-word;max-width:calc(100vw - 90px)}:root.sw-yotsuba>body.is_catalog .thread>a>img{display:inline-block}:root.sw-yotsuba .nwsb{display:inline}:root.sw-yotsuba .fileText{max-width:auto;white-space:normal}:root.sw-yotsuba .ad-cnt>*, :root.sw-yotsuba .adg-rects>*, :root.sw-yotsuba .bsa-cnt{height:auto !important}:root.sw-yotsuba:not(.ads-loaded) hr.abovePostForm,:root.sw-yotsuba:not(.ads-loaded) .adg-rects>hr,:root.sw-yotsuba #adg-ol+hr,:root.sw-yotsuba .danbo-slot:empty{display:none}:root.sw-yotsuba .adg-rects{margin:0;font-size:0}:root.sw-yotsuba div.center[style]{display:none !important}#menu>.hide-thread-link{width:auto;height:auto;overflow:visible;background-image:none}#menu label.entry{display:block}#fourchanx-settings label{display:inline}.intro a[href="javascript:;"],#menu a{margin:0}.gal-buttons.gal-buttons a{font-size:inherit}:root.sw-tinyboard.fixed.top-header:not(.autohide) .boardlist,:root.sw-tinyboard.fixed.top-header:not(.autohide) .bar.top{position:static}:root.sw-tinyboard.fixed.top-header:not(.autohide) div.pages.top{top:auto;bottom:0}:root.sw-tinyboard.fixed.top-header.autohide .boardlist,:root.sw-tinyboard.fixed.top-header.autohide .bar.top{z-index:3}:root[data-host="fufufu.moe"].fixed.top-header:not(.autohide) div.pages.top{top:26px;bottom:auto}:root[data-host="merorin.com"].fixed.top-header:not(.autohide) span.settings{top:26px}:root[data-host="fufufu.moe"]:not(.fixed) #header-bar{margin-top:38px}:root[data-host="lainchan.org"]:not(.fixed) #header-bar{margin-top:17px}:root[data-host="smuglo.li"]:not(.fixed) #header-bar{margin-top:8px}audio.controls-added{display:block;margin:auto;white-space:normal}:root.anti-autoplay div.embed{position:static;width:auto;height:auto;text-align:center}:root.anti-autoplay .autoplay-removed{visibility:visible !important;min-width:640px;min-height:360px}#overlay,#qp, #ihover,#navlinks, .fixed #header-bar,:root.float #updater,:root.float #thread-stats,#qr,#export-dialog{position:fixed}#overlay{z-index:999}#qp, #ihover{z-index:60}#menu, .gal-buttons{z-index:50}#updater, #thread-stats{z-index:40}:root.fixed #header-bar, #notifications{z-index:35}#a-gallery{z-index:30}#navlinks{z-index:25}#qr{z-index:20}#embedding{z-index:11}#export-dialog{z-index:1001}:root.fixed-watcher #thread-watcher{z-index:10}:root.fixed:not(.gallery-open) #header-bar:not(:hover){z-index:8}#thread-watcher{z-index:5}.fixed.top-header body{padding-top:2em}.fixed.bottom-header body{padding-bottom:2em}.fixed #header-bar{right:0;left:0;padding:3px 4px 4px;font-size:12px}.fixed.top-header #header-bar{top:0}.fixed.bottom-header #header-bar{bottom:0}#header-bar{border-width:0;transition:all .1s .05s ease-in-out}:root.fixed #header-bar{box-shadow:-5px 1px 10px rgba(0, 0, 0, 0.20)}:root.centered-links #shortcuts{width:300px;text-align:right;justify-content:right}:root.centered-links #header-bar{text-align:center}#custom-board-list{font-size:13px;vertical-align:middle}#full-board-list{vertical-align:middle}:root.centered-links #custom-board-list{position:relative;left:150px}.fixed.top-header #header-bar{border-bottom-width:1px}.fixed.bottom-header #header-bar{box-shadow:0 -1px 2px rgba(0, 0, 0, .15);border-top-width:1px}.fixed.bottom-header #header-bar .menu-button i{border-top:none;border-bottom:6px solid}.fixed #header-bar.autohide:not(:hover){box-shadow:none;transition:all .8s .6s cubic-bezier(.55, .055, .675, .19)}.fixed.top-header #header-bar.autohide:not(:hover){margin-bottom:-1em;transform:translateY(-100%)}.fixed.bottom-header #header-bar.autohide:not(:hover){transform:translateY(100%)}#scroll-marker{left:0;right:0;height:10px;position:absolute}#header-bar:not(.autohide) #scroll-marker{pointer-events:none}#header-bar #scroll-marker{display:none}.fixed #header-bar #scroll-marker{display:block}.fixed.top-header #header-bar #scroll-marker{top:100%}.fixed.bottom-header #header-bar #scroll-marker{bottom:100%}#board-list a, #shortcuts a:not(.entry){text-decoration:none;padding:1px}#shortcuts:empty{display:none}.dead-thread,.disabled:not(.replies-quoting-you){opacity:.45}#shortcuts{float:right;display:flex}:root.autohiding-scrollbar #shortcuts{margin-right:12px}.shortcut{margin-left:3px;vertical-align:middle}:root.shortcut-icons .native-settings{font-size:0;color:transparent;display:inline-block;vertical-align:top;height:12px;width:14px;background:url(\'//s.4cdn.org/image/favicon.ico\') 0px -1px no-repeat}#navbotright,#navtopright{display:none}#toggleMsgBtn{display:none !important}.current,:root.sw-yotsuba div#boardNavDesktopFoot a.current{font-weight:bold}:root.shortcut-icons #header-bar .icon-shortcut{font-size:0}:root.shortcut-icons #header-bar .icon-shortcut a::before{content:var(--icon);font-size:16px;line-height:12px}.brackets-wrap::before{content:"["}.brackets-wrap::after{content:"]"}#notifications{position:fixed;top:0;height:0;text-align:center;right:0;left:0;visibility:visible}#notifications:empty{display:none}:root.fixed.top-header:not(.gallery-open) #header-bar #notifications,:root.fixed.top-header #header-bar.autohide #notifications{position:absolute;top:100%}.notification{color:#FFF;font-weight:700;text-shadow:0 1px 2px rgba(0, 0, 0, .5);box-shadow:0 1px 2px rgba(0, 0, 0, .15);border-radius:2px;margin:1px auto;width:550px;max-width:100%;position:relative;transition:all .25s ease-in-out}.notification.error{background-color:hsla(0, 100%, 38%, .9)}.notification.warning{background-color:hsla(36, 100%, 38%, .9)}.notification.info{background-color:hsla(200, 100%, 38%, .9)}.notification.success{background-color:hsla(104, 100%, 38%, .9)}.notification a{color:white}.notification>.close{font-size:11px;padding:7px;top:0px;right:5px;position:absolute}.message{box-sizing:border-box;padding:6px 20px;max-height:200px;width:100%;overflow:auto;white-space:pre-line}.message a{text-decoration:underline}:root.tainted .report-error{display:none}:root.fourchan-x body{box-sizing:border-box}#overlay{background-color:rgba(0, 0, 0, .5);display:flex;top:0;left:0;height:100%;width:100%}#fourchanx-settings{box-sizing:border-box;box-shadow:0 0 15px rgba(0, 0, 0, .15);height:600px;max-height:100%;width:900px;max-width:100%;margin:auto;padding:5px;display:flex;flex-direction:column}#fourchanx-settings>nav{padding:2px 2px 8px;display:flex}#fourchanx-settings>nav a{text-decoration:underline}#fourchanx-settings>nav a.close{text-decoration:none;padding:0 2px;margin:0}.section-container{flex:1;position:relative;overflow:auto;padding-right:5px;overscroll-behavior:contain}.sections-list{flex:1}.export, .import, .reset{cursor:pointer;text-decoration:none !important}.tab-selected{font-weight:700}.section-sauce ul,.section-advanced ul{list-style:none;margin:0}.section-sauce ul{padding:8px}.section-advanced ul{padding:0px}.section-sauce li,.section-advanced li{padding-left:4px}.section-main ul{margin:0;padding:0 0 0 16px}.section-main li{white-space:pre-line;list-style:disc}.section-main li:not(:first-of-type){margin-top:4px}.section-main label{text-decoration:underline}div[data-checked="false"]>.suboption-list{display:none}.suboption-list{position:relative}.suboption-list::before{content:"";display:inline-block;position:absolute;left:.7em;width:0;height:100%;border-left:1px solid}.suboption-list>div{position:relative;padding-left:1.4em}.suboption-list>div::before{content:"";display:inline-block;position:absolute;left:.7em;width:.7em;height:.6em;border-left:1px solid;border-bottom:1px solid}#fourchanx-settings .section-main p{margin:.5em 0 0}.section-filter ul{padding:0}.section-filter li{margin:10px 40px;list-style:disc}.section-filter textarea{height:500px}.section-main a, .section-filter a, .section-advanced a{text-decoration:underline}#sauce-doc-expand:not(:checked)~#sauce-doc{max-height:130px;overflow:auto}#sauce-doc>label{float:right;margin:0 5px}#sauce-doc-expand+.riceCheck{display:none}.section-sauce textarea{height:430px}.section-advanced .field.wide{width:100%}.section-advanced textarea{height:150px}.section-advanced textarea[name="archiveLists"],.section-advanced textarea[name="externalCatalogURLs"],.section-advanced textarea[name="knownBanners"]{height:75px}.section-advanced .archive-cell{min-width:160px;text-align:center}.section-advanced #archive-board-select{position:absolute}.section-advanced .note{font-size:0.8em;font-style:italic;margin-left:10px}.section-advanced .note code{font-style:normal;font-size:11px}.favicon-preview>img{vertical-align:middle}.favicon-preview>img:nth-of-type(3n+1){margin-left:4px}.section-keybinds .field{font-family:monospace}#fourchanx-settings fieldset{border:1px solid;border-radius:3px;padding:0.35em 0.625em 0.75em;margin:0px 2px}#fourchanx-settings legend{font-weight:700;color:inherit}#fourchanx-settings textarea{font-family:monospace;width:100%;resize:vertical}#fourchanx-settings code{color:#000;background-color:#FFF;padding:0 2px}#fourchanx-settings th{text-align:center;font-weight:bold}#fourchanx-settings p{margin:1em 0px}#fourchanx-settings table{margin:auto}:root.index-loading .navLinks:not(.json-index),:root.index-loading .board:not(.json-index),:root.index-loading .pagelist:not(.json-index),:root.infinite-mode .pagelist,:root.all-pages-mode .pagelist,:root.catalog-mode .pagelist,:root:not(.catalog-mode) .indexlink,:root.catalog-mode .cataloglink,:root:not(.catalog-mode) #hidden-label,:root:not(.catalog-mode) #index-size{display:none}#index-search{padding-right:1.5em;width:100px;transition:color .25s, border-color .25s, width .25s}#index-search:focus,#index-search[data-searching]{width:200px}#index-search-clear{color:gray;display:inline-block;position:relative;left:-1em;width:0}#index-search::-webkit-search-cancel-button{display:none}#index-search:not([data-searching])+#index-search-clear{display:none}#index-options{float:right}#lastlong-options{display:inline-block;vertical-align:middle;height:28px;margin:-14px 0}#lastlong-options>input{padding:0;border:0 !important;text-align:center;background:transparent;display:block;font-size:12px;height:12px;width:30px;margin:1px 0}.summary{text-decoration:none}:root.catalog-mode .board{text-align:center}.catalog-thread{display:inline-block;box-sizing:border-box;border:1px solid transparent;word-wrap:break-word;vertical-align:top;position:relative}.catalog-thread.catalog-thread{margin:2px}.catalog-small>.catalog-thread{width:165px;height:320px}.catalog-large>.catalog-thread{width:270px;height:410px}:root.catalog-hover-expand .catalog-thread:hover{z-index:1}.catalog-container{position:absolute;top:-4px;left:0;right:0;bottom:0}.catalog-container:not(:hover),:root:not(.catalog-hover-expand) .catalog-container{overflow:hidden}.catalog-post{position:absolute;top:4px;left:0;right:0;border:1px solid transparent;padding-top:20px}:root:not(.catalog-hover-expand) .catalog-post{left:0 !important;right:0 !important}.catalog-post.catalog-post{margin:-21px -1px -1px;overflow:visible}.catalog-thread.noFile>*>.catalog-post{margin-top:-7px;padding-top:6px}:root.catalog-hover-expand .catalog-container:hover>.catalog-post{margin-left:-61px;margin-right:-61px}:root.catalog-hover-expand .catalog-container:hover>*>:not(.catalog-replies){padding-left:2px;padding-right:2px}.catalog-link{display:block;position:relative}.catalog-thumb{border-radius:2px;box-shadow:0 0 5px rgba(0, 0, 0, .25);vertical-align:top}.catalog-thumb.spoiler-file{width:100px;height:100px}.catalog-thumb.deleted-file{width:127px;height:13px;padding:20px 11px}.catalog-thumb.no-file{width:77px;height:13px;padding:20px 36px}.catalog-icons>img,.catalog-stats>.menu-button{width:1em;height:1em;margin:0;vertical-align:text-top;padding-left:2px}.catalog-stats>.menu-button>svg.icon{height:10px}.catalog-stats{font-size:10px;font-weight:700;padding-top:2px}.catalog-stats>[title]{cursor:help}.catalog-post>.postMessage{margin:0;padding-bottom:.3em}.catalog-container:not(:hover)>*>.file,.catalog-container:not(:hover)>*>.postInfo>:not(.subject),.catalog-container:not(:hover)>*>.catalog-replies,.catalog-container:not(:hover) .extra-linebreak,.catalog-container:not(:hover) .abbr,:root:not(.catalog-hover-expand) .catalog-container>*>.file,:root:not(.catalog-hover-expand) .catalog-container>*>.postInfo>:not(.subject),:root:not(.catalog-hover-expand) .catalog-container>*>.catalog-replies,:root:not(.catalog-hover-expand) .catalog-container .extra-linebreak,:root:not(.catalog-hover-expand) .catalog-container .abbr,.catalog-thread>.catalog-container>:not(.catalog-post),.preview-summary,.catalog-post>.file>:not(.fileText),.catalog-post>*>.fileText>:not(:first-child),.catalog-post>.postInfo>:not(.subject):not(.nameBlock):not(.dateTime),.catalog-post>.postInfo>.nameBlock>.contact-links,.catalog-post>*>*>.posteruid,.catalog-post>*>*>.postJumper,:root.bottom-backlinks .catalog-post>.container,.post:not(.catalog-post)>.catalog-link,.post:not(.catalog-post)>.catalog-stats,.post:not(.catalog-post)>.catalog-replies{display:none}.catalog-post>.file{position:absolute;left:0;right:0;top:0;min-height:20px;background-color:inherit}.catalog-post>*>.fileText{position:relative;padding:2px;background-color:inherit}.catalog-small .catalog-post>* .fileText{font-size:10px}.catalog-post>*>.fileText:not(:hover){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.catalog-post>*>.fileText:hover{z-index:1}.catalog-post>.postInfo.postInfo{width:auto}.catalog-post>*>.subject{display:block}.catalog-post>*>.dateTime{display:inline-block;font-style:italic}:root.catalog-hover-expand .catalog-container:hover>*>*>.nameBlock,:root.catalog-hover-expand .catalog-container:hover>*>*>.dateTime,:root.catalog-hover-expand .catalog-container:hover>*>.postMessage:not(:empty){padding-top:.3em}.catalog-post .extra-linebreak{content:\'\'; display:block;margin-top:.3em}.catalog-reply{text-align:left;white-space:nowrap;border-top:1px solid transparent;display:flex;flex-direction:row;align-items:stretch}.catalog-reply>*{padding:3px;overflow:hidden;flex:none}.catalog-reply>span{font-style:italic;font-weight:bold}.catalog-reply-excerpt{flex:1 1 auto}.catalog-post .prettyprinted{max-width:100%;box-sizing:border-box}.catalog-post .MathJax_Display{text-align:center !important}.catalog-container:not(:hover) .exif,:root:not(.catalog-hover-expand) .catalog-container .exif{display:none !important}.catalog-post>*>.exif{border-collapse:collapse}:root.catalog-hover-expand .catalog-container:hover .exif[style*="display: block;"]{display:inline-block !important}.catalog-post>*>.exif,.catalog-post>*>.exif>tbody{background-color:inherit}.catalog-post>*>.exif,.catalog-post>*>.exif td{min-width:0}.catalog-post>*>.exif td{padding-top:1px}:root.hats-enabled .catalog-thread::after{content:\'\';pointer-events:none;position:absolute;background-size:contain}:root.hats-enabled .catalog-small>.catalog-thread::after{left:-8px;top:-59px;width:96px;height:96px}:root.hats-enabled:not(.werkTyme) .catalog-small>.catalog-thread:not(.noFile)::after{left:calc(67px - .3px * var(--tn-w))}:root.hats-enabled .catalog-large>.catalog-thread::after{left:-15px;top:-98px;width:160px;height:160px}:root.hats-enabled:not(.werkTyme) .catalog-large>.catalog-thread:not(.noFile)::after{left:calc(110px - .5px * var(--tn-w))}textarea.copy-text-element{height:0;width:0;position:absolute;top:-10000px}:root.hide-announcement $site$psa{display:none}.hide-announcement-button{opacity:0.4;float:left}.unread-line{margin:0}.unread-line+br{display:none}.unread-mark-read{float:right;clear:both;width:100%;text-align:right}:not(.unread-thread)>.unread-mark-read{display:none}#updater{background:none;border:none;box-shadow:none}#updater>.move{position:absolute;top:-5px;bottom:-5px;left:-5px;right:-5px;z-index:-1}#updater>div:last-child{text-align:center}#updater input[type="number"]{width:4em}:root.float #updater{padding:0px 3px}:root:not(.float).shortcut-icons #updater{display:inline-block;min-width:12pt;text-align:right}.new{color:limegreen}#update-status:not(.empty)+#update-timer:not(.empty):not(.loading){margin-left:5px}#update-timer{cursor:pointer}#thread-watcher{position:absolute}#thread-watcher{padding-bottom:3px;padding-left:3px;white-space:nowrap;min-width:146px}#watched-threads{overflow-x:hidden;overflow-y:auto}#thread-watcher .refresh{padding:0px 3px}:root.fixed-watcher #thread-watcher{position:fixed}:root.fixed-watcher #watched-threads{max-height:calc(100vh - 75px)}:root:not(.fixed-watcher) #watched-threads:not(:hover){max-height:210px;overflow-y:hidden}#thread-watcher>.move{padding-top:3px}#watched-threads>div{padding-left:3px;padding-right:3px}#watched-threads .watcher-link{max-width:250px;display:inline-flex;flex-direction:row}#watched-threads .watcher-page,#watched-threads .watcher-unread{flex:0 0 auto;margin-right:2px}#watched-threads .watcher-title{overflow:hidden;text-overflow:ellipsis;flex:0 1 auto}#watched-threads .watcher-title:not(:first-child){margin-left:2px}.replies-quoting-you>a, #watcher-link.replies-quoting-you, .last-page>a>.watcher-page{color:#F00}#thread-watcher a{text-decoration:none}#thread-watcher .move>.close{position:absolute;right:0px;top:0px;padding:0px 4px}.watch-thread-link{width:18px;height:18px;background:none;border:none;padding:2px;opacity:0.2;filter:none;cursor:pointer;color:var(--xt-watcher, #000)}.watch-thread-link.watched{opacity:1}:root.oneechan .watch-thread-link>svg{display:none}#thread-stats{background:none;border:none;box-shadow:none}:root.float #thread-stats>.move>:not(#page-count){pointer-events:none}:root.float #thread-stats{padding:0px 3px}#page-count{cursor:pointer}.hashlink::before{content:\' \';visibility:hidden}.inline+.hashlink{display:none !important}:root.resurrect-quotes .deadlink{text-decoration:none !important}.catalog-post .qmark-ct{display:none}.backlink.deadlink:not(.forwardlink),.quotelink.deadlink:not(.forwardlink){text-decoration:underline !important}:root:not(.catalog-mode) .inlined{opacity:.5}#qp input, .forwarded{display:none}.quotelink.forwardlink,.backlink.forwardlink{text-decoration:none;border-bottom:1px dashed}.filtered{text-decoration:underline line-through}:root.hide-backlinks .backlink.filtered,:root.hide-backlinks .backlink.filtered+.hashlink.filtered{display:none}.postNum+.container::before{content:" "}:root.bottom-backlinks .container{display:block;clear:both;margin:0 4px}:root.bottom-backlinks .backlink{font-size:90%}.inline{border:1px solid;display:table;margin:2px 0}.container~.inline{margin-left:20px}:root.catalog-mode .inline{display:none}.inline .post{border:0 !important;background-color:transparent !important;display:table !important;margin:0 !important;padding:1px 2px !important}#qp>.opContainer::after{content:\'\';clear:both;display:table}#qp .post{border:none;margin:0;padding:2px 2px 5px}#qp img{max-height:80vh;max-width:50vw}#qp .preview-summary{display:block}.threadContainer{margin-left:20px;border-left:1px solid rgba(128,128,128,.3)}.threadOP{clear:both}.expanded-image>.post>.file>.fileThumb{display:flex;flex-direction:column}.fileText-original,.fnswitch:hover>.fntrunc,.fnswitch:not(:hover)>.fnfull,.expanded-image>.post>.file>.fileThumb>video[data-md5],.expanded-image>.post>.file>.fileThumb>img[data-md5]{display:none}.full-image[data-file-i-d]{display:none;cursor:pointer}.expanded-image>.post>.file>.fileThumb>.full-image{display:inline}.expanded-image>.post>.file>.fileThumb>audio{height:30px;width:100%;min-width:300px}.expanded-image{clear:left}.expanding{opacity:.5}:root.fit-height .full-image{max-height:100vh}:root.fit-height.fixed .full-image{max-height:calc(100vh - 35px)}:root.fit-width .full-image{max-width:100%}:root.ua-gecko.fit-width .full-image{width:100%}.fileThumb>.warning{clear:both}#ihover{pointer-events:none;max-height:calc(100vh - 25px);max-width:100vw}.webm-title>a::before{content:"title";text-decoration:underline}.webm-title.loading>a::after{content:"..."}.webm-title.error>a:hover::before,.webm-title.error>a:focus::before{content:"error";text-decoration:none}.webm-title>span{cursor:text}.webm-title.not-found>span::before{content:"not found"}.webm-title:not(:hover):not(:focus)>span,.webm-title:hover>span+a,.webm-title:focus>span+a{display:none}input[name="Default Volume"]{width:4em;height:1ex;vertical-align:middle;margin:0px}:root.fappeTyme $site$replyOriginal.noFile,:root.fappeTyme $site$replyOriginal.noFile+br{display:none}:root.werkTyme $site$thumbLink,:root.werkTyme $site$file$thumb,:root.werkTyme .catalog-thumb:not(.deleted-file):not(.no-file),:root:not(.werkTyme) .werkTyme-filename{display:none}.werkTyme-filename{font-weight:bold;font-size:110%}:root.werkTyme .catalog-link{box-shadow:0 0 5px rgba(0, 0, 0, .25);padding:8px;text-align:center}:root.werkTyme .catalog-thumb{box-shadow:none;padding:0;vertical-align:middle}.indicator{background:rgba(255,0,0,0.8);font-weight:bold;display:inline-block;min-width:9px;padding:0px 2px;margin:0 1px;text-align:center;color:white;border-radius:2px;cursor:pointer}:root:not(.fappeTyme) #shortcut-fappe,:root:not(.werkTyme) #shortcut-werk{display:none !important}#navlinks{font-size:16px;top:25px;right:10px}:root.catalog-mode #navlinks{display:none}:root.highlight-own .yourPost$site$highlightable$op::after,:root.highlight-you .quotesYou$site$highlightable$op::after,.filter-highlight$site$highlightable$op::after{content:"";display:block;clear:both}:root.reveal-spoilers $site$spoiler,:root.reveal-spoilers $site$spoiler>a{color:white !important}:root.reveal-spoilers .removed-spoiler::before{content:"[spoiler]"}:root.reveal-spoilers .removed-spoiler::after{content:"[/spoiler]"}.hide-thread-button,.hide-reply-button{float:left;margin-right:4px;padding:2px}$site$infoRoot a.hide-reply-button{margin-right:6px;padding:0}.replacedSideArrows{float:left}.hide-thread-button:not(:hover),.hide-reply-button:not(:hover){opacity:0.4}.threadContainer .hide-reply-button{margin-left:2px !important;position:relative;left:1px}.hide-thread-button{margin-top:-1px;width:11px}.stub~:not(.threadDivider){display:none !important}.stub input{display:inline-block}.stub .stub-icon,.stub-subject{margin-right:1ch}.stub-replies{margin-left:1ch}.stub-reasons::before{ content: \' (\'; }.stub-reasons::after{ content: \')\'; }.stub-reason:not(:last-of-type)::after{ content: \' & \'; }$site$thread[hidden]+hr{display:none}:root.reply-hide $site$sideArrows{display:none}:root.sw-yotsuba.thread-hide .party-hat{left:19px}:root.anonymize $site$info$name,:root.sw-yotsuba.anonymize .post-author:not([class*=capcode]){font-size:0}:root.anonymize $site$info$tripcode,:root.sw-yotsuba.anonymize .n-pu{display:none}:root.anonymize $site$info$name::before,:root.sw-yotsuba.anonymize .post-author:not([class*=capcode])::before{content:"Anonymous";font-size:10pt}:root.sw-yotsuba.anonymize .flashListing .name::before,:root.sw-yotsuba.anonymize .post-last>.post-author:not([class*=capcode])::before{font-size:9pt}:root.hide-original-post-form #togglePostFormLink,#qr.autohide:not(.focus):not(:hover):not(:active)>form,:root.thread-view #qr:not(.show-new-thread-option) select[data-name="thread"],#file-n-submit:not(.has-file) #qr-filerm{display:none}:root.hide-original-post-form #postForm{display:none !important}#qr select,#qr-filename-container>a,.remove{cursor:pointer}#qr{position:fixed;padding:1px;border:1px solid transparent;min-width:300px;border-radius:3px 3px 0 0}#qr>form{max-height:calc(100vh - 75px);overflow-y:auto;overflow-x:hidden}#qrtab{border-radius:3px 3px 0 0}#qrtab{margin-bottom:1px}#qr .close{float:right;padding:0 3px}.qr-link-container{text-align:center;margin:16px 0}.qr-link-container-bottom{width:200px;position:absolute;left:-100px;margin-left:50%;text-align:center}.qr-link{border-radius:3px;padding:6px 10px 5px;font-weight:bold;vertical-align:middle;border-style:solid;border-width:1px;font-size:10pt}.qr-link-container+#togglePostFormLink{font-size:10pt;font-weight:normal;margin:-8px 0 3.5px}.persona{width:100%;display:flex;flex-direction:row}.persona .field{flex:1;width:0}#qr.forced-anon input[data-name="name"]:not(.force-show),#qr.forced-anon input[data-name="sub"]:not(.force-show),#qr.reply-to-thread input[data-name="sub"]:not(.force-show),body:not(.board_f) #qr select[name="filetag"],#qr.reply-to-thread select[name="filetag"],#qr:not(.has-sjis) #sjis-toggle,#qr:not(.has-math) #tex-preview-button,#qr.tex-preview .textarea>:not(#tex-preview),#qr:not(.tex-preview) #tex-preview{display:none}.persona button{flex:0 0 23px;align-self:stretch;border:1px solid #BBB;padding:0;background:linear-gradient(to bottom, #F8F8F8, #DCDCDC) no-repeat;color:#000}#qr.sjis-preview #sjis-toggle, #qr.tex-preview #tex-preview-button{background:#DCDCDC}#sjis-toggle, #qr.sjis-preview textarea.field{font-family:"IPAMonaPGothic","Mona","MS PGothic",monospace;font-size:16px;line-height:17px}#tex-preview-button{font-size:10px}#tex-preview{white-space:pre-line}#qr textarea.field{height:14.8em;min-height:9em}#qr.has-captcha textarea.field{height:9em}input.field.tripped:not(:hover):not(:focus){color:transparent !important;text-shadow:none !important}#qr textarea{min-width:300px;resize:both}.field{box-sizing:border-box;margin:0px;padding:2px 4px 3px}#qr label input[type="checkbox"]{position:relative;top:2px}#qr .captcha-root{position:relative}#qr .captcha-container>div{margin:auto;width:304px}:root.ua-blink #qr .captcha-container>div,:root.ua-edge #qr .captcha-container>div{overflow:hidden}:root.ua-blink #qr .captcha-container>div>div:first-of-type,:root.ua-edge #qr .captcha-container>div>div:first-of-type{overflow-y:scroll;overflow-x:hidden;padding-right:30px;height:99%;width:100%}#qr .captcha-counter{display:block;width:100%;text-align:center;pointer-events:none}#qr.captcha-open .captcha-counter{position:absolute;bottom:3px}#qr .captcha-counter>a{pointer-events:auto;display:inline-block; }#qr:not(.captcha-open) .captcha-counter>a{display:block;width:100%}#qr.captcha-v2 #qr-captcha-iframe{width:302px;height:423px;border:0;display:block;margin:auto}.goog-bubble-content{max-width:100vw;max-height:100vh;overflow:auto}.goog-bubble-content iframe{position:static !important}#overlay.media-preview{display:flex;overflow:auto;align-items:center}#overlay.media-preview video, #overlay.media-preview img{margin:auto}#overlay.media-preview video{max-height:100%;max-width:100%}#file-n-submit, #qr .oekaki{display:flex;align-items:stretch;margin-top:1px}#file-n-submit>input, #qr-draw-button{background:linear-gradient(to bottom, #F8F8F8, #DCDCDC) no-repeat;border:1px solid #BBB;border-radius:2px;height:100%}#qr-file-button, #qr-draw-button{width:15%}#file-n-submit input[type="submit"]{width:25%}#qr-filename-container{flex:1 1 auto;width:0;display:flex;align-items:center;position:relative;padding:1px}input#qr-filename{border:none !important;background:none !important;outline:none}#qr-filename,.has-file #qr-no-file{display:none}#qr-no-file,.has-file #qr-filename{flex:1 1 auto;width:0px; display:inline-block;padding:0;padding-left:3px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#qr-no-file{color:#AAA}#qr .oekaki.has-file{height:25px}#qr .oekaki.has-file{display:none}#qr .oekaki>label{flex:1 1 auto;width:0;display:flex;align-items:center;height:100%}#qr .oekaki>label>span{margin:0 3px}#qr .oekaki>label>input{flex:1 1 auto;width:0;height:100%}#qr .oekaki-bg{position:relative;display:inline-block;height:100%;width:10%;margin-left:3px}#qr .oekaki-bg>*{position:absolute;top:0;left:0;margin:0}#qr .oekaki-bg>:not([name="oekaki-bgcolor"]){z-index:1}#qr [name="oekaki-bgcolor"]{height:100%;width:100%;border:none;padding:0}#qr [name="oekaki-bg"]:not(:checked)~[name="oekaki-bgcolor"]{visibility:hidden}#qr input[type="file"]{visibility:hidden;position:absolute}#qr-filename-container>label, #qr-filename-container>a{flex:none;margin:0;margin-right:3px}#qr:not(.has-spoiler) #qr-spoiler-label,#file-n-submit:not(.has-file) #qr-spoiler-label,#file-n-submit:not(.has-file) #qr-randomize,#file-n-submit:not(.has-image) #qr-jpg,#file-n-submit:not(.has-image):not(.has-video) #qr-view,#file-n-submit:not(.has-file) #qr-restore-name,.has-file #paste-area,.has-file #url-button,#file-n-submit:not(.custom-cooldown) #custom-cooldown-button{display:none}#qr-filename-container>label{position:relative}#qr-filename-container input[type="checkbox"]{margin:0}.checkbox-letter{font-size:13px;font-weight:bold}#qr-filename-container label:not(:hover)>input[type="checkbox"]:not(:focus):not(:checked),#qr-filename-container label:not(:hover)>input[type="checkbox"]:not(:focus):not(:checked)~:not(.checkbox-letter),#qr-filename-container label:hover>.checkbox-letter,input[type="checkbox"]:focus~.checkbox-letter,input[type="checkbox"]:checked~.checkbox-letter{position:absolute;opacity:0;pointer-events:none}.checkbox-letter, #paste-area, #url-button, #custom-cooldown-button, #dump-button, #split-post{opacity:0.6}#paste-area{font-size:0}#paste-area:focus{opacity:1}#custom-cooldown-button.disabled{opacity:0.27}#qr select{background:white;border:1px solid #CCC}#qr select[data-name="thread"]{float:right}#qr>form>select{margin-top:1px}.dump #dump-list-container{display:block}#dump-list-container{display:none;position:relative;overflow-y:hidden;margin-top:1px}#dump-list{overflow-x:auto;overflow-y:auto;white-space:nowrap;width:248px;max-height:248px;min-height:90px;max-width:100%;min-width:100%;display:flex;flex-wrap:wrap}#dump-list:hover{overflow-x:auto}.qr-preview{box-sizing:border-box;counter-increment:thumbnails;cursor:move;display:inline-block;height:90px;width:90px;padding:2px;opacity:.5;overflow:hidden;position:relative;text-shadow:0 0 2px #000;transition:opacity .25s ease-in-out, transform .25s ease-in-out;vertical-align:top;background-size:cover;flex:none}.qr-preview:hover,.qr-preview:focus{opacity:.9}.qr-preview::before{content:counter(thumbnails);color:#fff;position:absolute;top:3px;right:3px;text-shadow:0 0 3px #000, 0 0 8px #000}.qr-preview#selected{opacity:1}.qr-preview.drag{box-shadow:0 0 10px rgba(0,0,0,.5);transform:scale(.8)}.qr-preview.over{border-color:#fff;transform:scale(1.1);opacity:0.9;z-index:10}.qr-preview>span{color:#fff}.remove{background:none;color:#e00;padding:1px}a:only-of-type>.remove{display:none}.remove:hover::after{content:" Remove"}.qr-preview:not(.has-file) label,#qr:not(.has-spoiler) .qr-preview-spoiler{display:none}.qr-preview>label{background:rgba(0,0,0,.5);color:#fff;right:0;bottom:0;left:0;position:absolute;text-align:center}.qr-preview>label>input{margin:0}#add-post{cursor:pointer;font-size:2em;position:absolute;bottom:20px;right:10px;transform:translateY(-50%)}.textarea{position:relative;display:flex}#char-count{color:#000;background:hsla(0, 0%, 100%, .5);font-size:8pt;position:absolute;bottom:1px;right:1px;pointer-events:none}#char-count.warning{color:red}#file-n-submit{display:flex;flex-direction:column}#file-n-submit .row{display:flex;flex-direction:row}#file-n-submit .row.space{justify-content:space-between}#file-n-submit a{display:flex;flex-direction:column;justify-content:center;padding:1px 3px 0 3px}.menu-button{display:inline-block;position:relative;cursor:pointer}#header-bar .menu-button i{border-top:6px solid;border-right:4px solid transparent;border-left:4px solid transparent;display:inline-block;margin:2px;vertical-align:middle}.postInfo>.menu-button{margin:0 5px}#menu{position:fixed;outline:none;font-weight:normal}#menu, .submenu{border-radius:3px;padding-top:1px;padding-bottom:3px}.entry{cursor:pointer;display:block;outline:none;padding:2px 10px;position:relative;text-decoration:none;white-space:nowrap;min-width:70px;text-align:left;text-shadow:none;font-size:10pt}.left>.entry.has-submenu{padding-right:17px !important}.entry input[type="checkbox"],.entry input[type="radio"]{margin:0px;position:relative;top:2px}.entry input[type="number"]{width:4.5em}.entry.has-shortcut-text{display:flex;justify-content:space-between;align-items:center}.entry .shortcut-text{opacity:0.5;font-size:70%;margin-left:5px}.has-submenu::after{content:"";border-left:.5em solid;border-top:.3em solid transparent;border-bottom:.3em solid transparent;display:inline-block;margin:.3em;position:absolute;right:3px}.left .has-submenu::after{border-left:0;border-right:.5em solid}.submenu{display:none;position:absolute;left:100%;top:-1px;margin-left:0px;margin-top:-2px}.focused>.submenu{display:block}.imp-exp-result{position:absolute;text-align:center;margin:auto;right:0px;left:0px;width:200px}.boardTitle, .boardSubtitle{white-space:pre-line}.boardTitle[contenteditable="true"],.boardSubtitle[contenteditable="true"]{cursor:text !important}.embedder:not(.embedded)>span{display:none}#embedding{padding:1px 4px 1px 4px;position:fixed}#embedding.empty{display:none}#embedding>div:first-child{display:flex}#embedding .move{flex:1}#embedding .jump{margin:-1px 4px;text-decoration:none}#a-gallery{position:fixed;top:0;bottom:0;left:0;right:0;display:flex;flex-direction:row;background:rgba(0,0,0,0.7)}.gal-viewport{display:flex;align-items:stretch;flex-direction:row;flex:1 1 auto;overflow:hidden}.gal-thumbnails{flex:0 0 150px;overflow-y:auto;display:flex;flex-direction:column;align-items:stretch;text-align:center;background:rgba(0,0,0,.5);border-left:1px solid #222}.gal-hide-thumbnails .gal-thumbnails{display:none}.gal-thumb img,.gal-thumb video{max-width:125px;max-height:125px;height:auto;width:auto}.gal-thumb{flex:0 0 auto;padding:3px;line-height:0;transition:background .2s linear}.gal-highlight{background:rgba(0, 190, 255,.8)}.gal-prev{border-right:1px solid #222}.gal-next{border-left:1px solid #222}.gal-prev,.gal-next{flex:0 0 20px;position:relative;cursor:pointer;opacity:0.7;background-color:rgba(0, 0, 0, 0.3)}.gal-prev:hover,.gal-next:hover{opacity:1}.gal-prev::after,.gal-next::after{position:absolute;top:48.6%;transform:translateY(-50%);display:inline-block;border-top:11px solid transparent;border-bottom:11px solid transparent;content:""}.gal-prev::after{border-right:12px solid #fff;right:5px}.gal-next::after{border-left:12px solid #fff;right:3px}.gal-image{flex:1 0 auto;display:flex;align-items:flex-start;justify-content:space-around;overflow:hidden;width:1%}:root:not(.gal-fit-height):not(.gal-pdf) .gal-image{overflow-y:scroll !important}:root:not(.gal-fit-width):not(.gal-pdf) .gal-image{overflow-x:scroll !important}.gal-image a{display:flex;align-items:flex-start;margin:auto;line-height:0;max-width:100%}:root.gal-pdf .gal-image a{width:100%;height:100%}.gal-image img,.gal-image video{flex:none}.gal-fit-width .gal-image img,.gal-fit-width .gal-image video{max-width:100%}.gal-fit-height .gal-image img,.gal-fit-height .gal-image video{max-height:calc(100vh - 25px)}.gal-image iframe{width:100%;height:100%}.gal-buttons{font-size:2em;margin-right:3px;padding-left:7px;padding-right:7px;top:5px}:root.gal-pdf .gal-buttons{top:40px;background:rgba(0,0,0,0.6) !important;border-radius:3px}.gal-buttons a{color:#ffffff;text-shadow:0px 0px 1px #000000}.gal-buttons i{display:inline-block;margin:2px;position:relative}.gal-start i{border-left:10px solid;border-top:6px solid transparent;border-bottom:6px solid transparent;bottom:1px}.gal-stop i{border:5px solid;bottom:2px}.gal-buttons.gal-playing>.gal-start,.gal-buttons:not(.gal-playing)>.gal-stop{display:none}.gal-buttons .menu-button i{border-top:10px solid;border-right:6px solid transparent;border-left:6px solid transparent;bottom:2px;vertical-align:baseline}.gal-labels{position:fixed;bottom:6px;display:flex;flex-direction:column;align-items:flex-end}:root:not(.show-sauce) .gal-sauce{display:none}.gal-name,.gal-count,.gal-sauce{background:rgba(0,0,0,0.6) !important;border-radius:3px;padding:1px 5px 2px 5px;margin-top:3px;color:#ffffff !important;text-decoration:none !important}.gal-sauce a{color:#ffffff !important}.gal-name:hover,.gal-buttons a:hover,.gal-sauce a:hover{color:rgb(95, 95, 101) !important}:root.gal-pdf .gal-buttons a:hover{color:rgb(204, 204, 204) !important}.gal-buttons,.gal-labels{position:fixed;right:195px}.gal-hide-thumbnails .gal-buttons,.gal-hide-thumbnails .gal-labels{right:44px}:root:not(.gal-fit-width):not(.gal-pdf) .gal-labels{bottom:23px !important}:root.gal-fit-height:not(.gal-pdf):not(.gal-hide-thumbnails) .gal-buttons,:root.gal-fit-height:not(.gal-pdf):not(.gal-hide-thumbnails) .gal-labels{right:178px !important}:root.gal-hide-thumbnails.gal-fit-height:not(.gal-pdf) .gal-buttons,:root.gal-hide-thumbnails.gal-fit-height:not(.gal-pdf) .gal-labels{right:28px !important}:root.gallery-open.fixed #header-bar:not(.autohide){visibility:hidden}.contact-links{margin-left:2px}.move-note>a{text-decoration:underline}.invisible{font-size:0}.postJumper>.prev,.postJumper>.next{font-size:120%}.fcx-announcement{text-align:center}.fcx-announcement a{text-decoration:underline}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(359deg)}}.spin>.icon{animation:spin 2s infinite linear}div.post{overflow:auto;scroll-margin-top:30px}.file svg.icon{height:12px}.dialog{background-color:var(--xt-background);border-color:var(--xt-border)}.field:focus,.field.focus{border-color:var(--xt-border-field-focus)}:root:not(.oneechan).highlight-you .quotesYou$site$highlightable$reply{border-left:3px solid var(--xt-border-highlight) !important}:root:not(.oneechan).highlight-own .yourPost$site$highlightable$reply{border-left:3px dashed var(--xt-border-highlight) !important}#header-bar.dialog{background-color:var(--xt-header-dialog-bg)}:root:not(.fixed) #header-bar, #notifications{font-size:var(--xt-notification-size, 9pt)}#header-bar, #notifications{color:var(--xt-header-dialog-fg)}#board-list a, #shortcuts a{color:var(--xt-header-link, unset)}#fourchanx-settings fieldset, .section-main div::before{border-color:var(--xt-border)}.suboption-list>div:last-of-type{background-color:var(--xt-background)}:root.catalog-hover-expand .catalog-container:hover>.post{background-color:var(--xt-background)}:root.werkTyme .catalog-thread:not(:hover),:root.werkTyme:not(.catalog-hover-expand) .catalog-thread,:root.catalog-hover-expand .catalog-container:hover>.post,:root.catalog-hover-expand .catalog-container:hover .catalog-reply{border-color:var(--xt-border)}.backlink.deadlink{color:var(--xt-dead-link) !important}.inline{border-color:var(--xt-border);background-color:var(--xt-inline, rgba(255, 255, 255, .14))}.indicator{color:var(--xt-background)}#dump-list::-webkit-scrollbar-thumb{background-color:var(--xt-background);border-color:var(--xt-border)}.qr-preview{background-color:var(--xt-qr-preview-bg, rgba(0, 0, 0, .15))}.qr-link{border-color:var(--xt-qr-link-border);background:var(--xt-qr-bg)}.qr-link:hover{background:var(--xt-link-hover-bg, var(--xt-background))}#menu{color:var(--xt-menu-fg, var(--xt-header-link))}.entry{font-size:var(--xt-entry-size, 10pt)}.focused.entry{background:var(--xt-entry-focus-bg)}.unread-mark-read{background-color:var(--xt-unread)}.replies-quoting-you>a, #watcher-link.replies-quoting-you, .last-page>a>.watcher-page{color:var(--xt-watcher-quoting-you, #F00) !important}.qphl{outline:2px solid var(--xt-qphl, rgba(216, 94, 49, .8))}:root.highlight-you .quotesYou$site$highlightable$op,:root.highlight-you .quotesYou$site$highlightable$reply{border-left:3px solid var(--xt-border-highlight)}:root.highlight-own .yourPost$site$highlightable$op,:root.highlight-own .yourPost$site$highlightable$reply{border-left:3px dashed var(--xt-border-highlight) }.filter-highlight$site$highlightable$op,.filter-highlight$site$highlightable$reply{box-shadow:inset 5px 0 var(--xt-filter-highlight, rgba(221, 0, 0, .5))}:root.highlight-own .yourPost>$site$sideArrows,:root.highlight-you .quotesYou>$site$sideArrows,.filter-highlight>$site$sideArrows{color:var(--xt-highlight-side-arrow, rgba(221, 0, 0, .8))}:root:not(.werkTyme) .catalog-thread.filter-highlight .catalog-thumb,:root.werkTyme .catalog-thread.filter-highlight:not(:hover),:root.werkTyme:not(.catalog-hover-expand) .catalog-thread.filter-highlight,:root.werkTyme.catalog-hover-expand .catalog-thread.filter-highlight>.catalog-container:hover>.catalog-post,:root.catalog $site$catalog$thread.filter-highlight$site$highlightable$catalog{box-shadow:0 0 3px 3px var(--xt-highlight-shadow, rgba(255, 0, 0, .5))}:root:not(.werkTyme) .catalog-thread.watched .catalog-thumb,:root:root.werkTyme .catalog-thread.watched:not(:hover),:root:root.werkTyme:not(.catalog-hover-expand) .catalog-thread.watched,:root.werkTyme.catalog-hover-expand .catalog-thread.watched>.catalog-container:hover>.catalog-post{border:2px solid var(--xt-watched-border, rgba(255, 0, 0, .75))}.unread-line{border-color:var(--xt-unread-line, rgb(255,0,0))}:root.tomorrow,:root.spooky{color-scheme:dark}:root.tomorrow #file-n-submit>input,:root.tomorrow #qr-draw-buton,:root.spooky #file-n-submit>input,:root.spooky #qr-draw-buton{background-image:none}:root.tomorrow .field,:root.spooly .field{background-color:unset;color:unset;border-color:unset}:root.yotsuba{--xt-background:#F0E0D6;--xt-border:#D9BFB7;--xt-border-field-focus:#EA8;--xt-border-highlight:rgba(221, 0, 0, .8);--xt-header-dialog-bg:rgba(240,224,214,0.98);--xt-header-dialog-fg:#B86;--xt-header-link:#800000;--xt-dead-link:#00E;--xt-qr-link-border:rgb(225, 209, 199) rgb(225, 209, 199) rgb(210, 194, 184);--xt-qr-bg:linear-gradient(#FFEFE5, #F0E0D6) repeat scroll 0% 0% transparent;--xt-entry-focus-bg:rgba(255, 255, 255, .33);--xt-unread:rgba(240, 224, 214, 0.5);--xt-watcher:#800000;--xt-fxt-fg:#800000}:root.yotsuba-b{--xt-background:#D6DAF0;--xt-link-hover-bg:#D9DDF3;--xt-border:#B7C5D9;--xt-border-field-focus:#98E;--xt-border-highlight:rgba(221, 0, 0, .8);--xt-header-dialog-bg:rgba(214,218,240,0.98);--xt-header-dialog-fg:#89A;--xt-header-link:#34345C;--xt-dead-link:#34345C;--xt-qr-link-border:rgb(199, 203, 225) rgb(199, 203, 225) rgb(184, 188, 210);--xt-qr-bg:linear-gradient(#E5E9FF, #D6DAF0) repeat scroll 0% 0% transparent;--xt-menu-fg:#000;--xt-entry-focus-bg:rgba(255, 255, 255, .33);--xt-unread:rgba(214, 218, 240, 0.5)}:root.futaba{--xt-background:#F0E0D6;--xt-border:#D9BFB7;--xt-border-field-focus:#EA8;--xt-border-highlight:rgba(240, 224, 214, 0.98);--xt-notification-size:11pt;--xt-header-dialog-fg:#B86;--xt-dead-link:#00E;--xt-header-dialog-bg:rgba(240,224,214,0.98);--xt-header-link:#800000;--xt-qr-link-border:rgb(225, 209, 199) rgb(225, 209, 199) rgb(210, 194, 184);--xt-qr-bg:linear-gradient(#FFEFE5, #F0E0D6) repeat scroll 0% 0% transparent;--xt-entry-size:12pt;--xt-entry-focus-bg:rgba(255, 255, 255, .33);--xt-unread:rgba(240, 224, 214, 0.5);--xt-watcher:#800000;--xt-fxt-fg:#800000}:root.futaba.anonymize $site$info$name::before{font-size:12pt}:root.burichan{--xt-background:#D6DAF0;--xt-border:#B7C5D9;--xt-border-field-focus:#98E;--xt-border-highlight:3px dashed rgba(221, 0, 0, .8);--xt-header-dialog-bg:rgba(214, 218, 240, 0.98);--xt-notification-size:11pt;--xt-header-dialog-fg:#89A;--xt-header-link:#34345C;--xt-dead-link:#34345C;--xt-qr-link-border:rgb(199, 203, 225) rgb(199, 203, 225) rgb(184, 188, 210);--xt-qr-bg:linear-gradient(#E5E9FF, #D6DAF0) repeat scroll 0% 0% transparent;--xt-menu-fg:#000;--xt-entry-size:12pt;--xt-entry-focus-bg:rgba(255, 255, 255, .33);--xt-link-hover-bg:#D9DDF3;--xt-unread:rgba(214, 218, 240, 0.5)}:root.burichan.anonymize $site$info$name::before{font-size:12pt}:root.tomorrow{--xt-background:#282A2E;--xt-border:#111;--xt-border-field-focus:rgb(129, 162, 190);--xt-border-highlight:rgba(145, 182, 214, .8);--xt-header-dialog-bg:rgba(40,42,46,0.9);--xt-header-dialog-fg:#C5C8C6;--xt-header-link:#81A2BE;--xt-dead-link:#81A2BE;--xt-inline:rgba(0, 0, 0, .14);--xt-qr-preview-bg:rgba(255, 255, 255, .15);--xt-qr-link-border:rgb(25, 27, 31) rgb(25, 27, 31) rgb(10, 12, 16);--xt-qr-bg:linear-gradient(#37393D, #282A2E) repeat scroll 0% 0% transparent;--xt-menu-fg:#C5C8C6;--xt-entry-focus-bg:rgba(0, 0, 0, .33);--xt-unread:rgba(40, 42, 46, 0.5);--xt-watcher:#c5c8c6;--xt-unread-line:rgb(197, 200, 198);--xt-filter-highlight:rgba(145, 182, 214, .5);--xt-highlight-shadow:rgba(64, 192, 255, .7);--xt-watched-border:rgb(64, 192, 255);--xt-qphl:rgba(145, 182, 214, .8);--xt-highlight-side-arrow:rgb(155, 185, 210);--xt-fxt-fg:#c5c8c6}:root.tomorrow #arc-list span.quote{color:#B5BD68}:root.tomorrow #header-bar a, :root.tomorrow #notifications a{color:#81A2BE}:root.tomorrow.shortcut-icons .native-settings{background-image:url(\'//s.4cdn.org/image/favicon-ws.ico\')}:root.tomorrow #qr .field{background-color:rgb(26, 27, 29);color:rgb(197,200,198);border-color:rgb(40, 41, 42)}:root.tomorrow #qr .field:focus,:root.tomorrow #qr .field.focus{border-color:var(--xt-border-field-focus) !important;background-color:rgb(30,32,36)}:root.tomorrow .persona button{background:linear-gradient(to bottom, #2E3035, #222427) no-repeat;color:rgb(197,200,198);border-color:rgb(40, 41, 42);outline:none}:root.tomorrow .persona button::-moz-focus-inner{border:none}:root.tomorrow .persona button:focus{border-color:rgb(129, 162, 190)}:root.tomorrow #qr.sjis-preview #sjis-toggle,:root.tomorrow #qr.tex-preview #tex-preview-button{background:rgb(26, 27, 29)}:root.tomorrow #qr select,:root.tomorrow #file-n-submit>input,:root.tomorrow #qr-draw-button{border-color:rgb(40, 41, 42);background:unset}:root.tomorrow #qr select>option{background-color:var(--xt-background)}:root.tomorrow #qr-filename{color:rgb(197,200,198)}:root.photon{--xt-background:#DDD;--xt-border:#CCC;--xt-border-field-focus:#EA8;--xt-border-highlight:rgba(221, 0, 0, .8);--xt-header-dialog-bg:rgba(221, 221, 221, 0.98);--xt-header-dialog-fg:#333;--xt-dead-link:#F60;--xt-qr-link-border:rgb(206, 206, 206) rgb(206, 206, 206) rgb(191, 191, 191);--xt-qr-bg:linear-gradient(#ECECEC, #DDD) repeat scroll 0% 0% transparent;--xt-menu-fg:#333;--xt-entry-focus-bg:rgba(255, 255, 255, .33);--xt-unread:rgba(221, 221, 221, 0.5);--xt-watcher-quoting-you:#00F;--xt-watcher:#333;--xt-fxt-fg:#333}:root.photon #arc-list tr:nth-of-type(odd) span.quote{color:#C0E17A}:root.spooky{--xt-background:#171526;--xt-link-hover-bg:#1A1829;--xt-border:#707070;--xt-border-field-focus:#98E;--xt-border-highlight:rgba(145, 182, 214, .8);--xt-header-dialog-bg:rgba(23, 21, 38, 0.98);--xt-header-dialog-fg:#C49756;--xt-header-link:#FE9600;--xt-dead-link:#FE9600;--xt-qr-link-border:rgb(8, 6, 23) rgb(8, 6, 23) rgb(0, 0, 8);--xt-qr-bg:linear-gradient(#262435, #171526) repeat scroll 0% 0% transparent;--xt-entry-focus-bg:rgba(255, 255, 255, .33);--xt-unread:rgba(23, 21, 38, 0.5);--xt-watcher:#fe9600;--xt-unread-line:rgb(197, 200, 198);--xt-filter-highlight:rgba(145, 182, 214, .5);--xt-qphl:rgba(145, 182, 214, .8);--xt-highlight-side-arrow:rgb(155, 185, 210);--xt-fxt-fg:#f0f8ffd1}:root.spooky #arc-list span.quote{color:#634C2C}:root.spooky.shortcut-icons .native-settings{background-image:url(\'//s.4cdn.org/image/favicon-ws.ico\')}:root.spooky #qr .field{background-color:rgb(26, 27, 29);color:rgb(197,200,198);border-color:rgb(40, 41, 42)}:root.spooky #qr .field:focus,:root.spooky #qr .field.focus{border-color:rgb(254, 150, 0) !important;background-color:rgb(30,32,36)}:root.spooky .persona button{background:linear-gradient(to bottom, #2E3035, #222427) no-repeat;color:rgb(197,200,198);border-color:rgb(40, 41, 42);outline:none}:root.spooky .persona button::-moz-focus-inner{border:none}:root.spooky .persona button:focus{border-color:rgb(254, 150, 0)}:root.spooky #qr.sjis-preview #sjis-toggle,:root.spooky #qr.tex-preview #tex-preview-button{background:rgb(26, 27, 29)}:root.spooky #qr select,:root.spooky #file-n-submit>input,:root.spooky #qr-draw-button{border-color:rgb(40, 41, 42);background:unset}:root.spooky #qr-filename{color:rgb(197,200,198)}:root.spooky .unread-line{visibility:visible;opacity:1}svg.icon{height:14px;position:static;width:auto}:root.shortcut-icons #shortcuts .shortcut{padding-top:0;padding-bottom:0;display:flex;height:14px;min-width:16px}:root.shortcut-icons #shortcuts .icon--alt-text,:root:not(.shortcut-icons) .shortcut svg{display:none}:root.shortcut-icons .shortcut.brackets-wrap::before,:root.shortcut-icons .shortcut.brackets-wrap::after{display:none}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(359deg)}}:root{--xt-fxt-bg:var(--xt-background);--xt-fxt-border:var(--xt-border)}.fxt-card{color:var(--xt-fxt-fg, #000);background-color:var(--xt-fxt-bg, #000);padding:16px;border:1px solid var(--xt-fxt-border);border-radius:12px;width:400px;display:flex;flex-direction:column;gap:8px;white-space:pre-line;word-break:break-word}.fxt-meta{display:flex;flex-direction:row;gap:8px}.fxt-meta_profile{display:flex;flex-direction:row;gap:8px}.fxt-meta_profile img{height:48px;width:48px;aspect-ratio:1;border-radius:100%;overflow:hidden}.fxt-meta_author{display:flex;flex-direction:column}.fxt-meta_author_username{font-weight:bold}.fxt-stats_meta{padding-top:8px;display:flex;flex-direction:row;justify-content:space-evenly;gap:8px}.fxt-stats_meta span{display:inline-flex;align-items:center;gap:4px}.fxt-poll{display:flex;flex-direction:column;gap:4px}.fxt-choice{position:relative;display:flex;align-items:center;justify-content:space-between;font-size:75%;height:24px}.fxt-choice.highlight{font-weight:bold}.fxt-choice_label{margin-left:6px;z-index:1}.fxt-choice_percentage{margin-right:6px;z-index:1}.fxt-choice .bar{position:absolute;top:0;left:0;height:24px;border-radius:4px;background-color:currentColor;opacity:.3;z-index:0}.fxt-total-votes{font-size:75%;opacity:.5}.fxt-media{width:100%;height:100%;border-radius:4px;overflow:hidden}.fxt-media :is(img, video){display:block;max-width:100%;height:100%;object-fit:contain;object-position:center}.fxt-media_container{display:grid;gap:0;grid-template-columns:1fr}.fxt-media_container.fxt-media-multiple{gap:4px;grid-template-columns:1fr 1fr}.fxt-quote{border:1px solid var(--xt-fxt-border);border-radius:12px;overflow:hidden}.fxt-quote .fxt-meta_profile img{height:24px;width:24px}.fxt-quote .fxt-meta{display:flex;flex-direction:row;align-items:center;gap:8px;padding:4px}'+(B=[{
name:"audio",data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAMBQTFRFAAAAAEmSADyHADN6CEOPKmWmADiKNV6lZoO5E2asU3u8B02hXYTAFXK8BEakS3i7MGS0E1mwZYzHSHjCYIrLIGDICFPDHXrIFWnBEGDDdZzWB1G2UYHMH4DPBU60EYrSSX7PGofXfajkeaPgQHzVSoHSDmHLF3vRjLbtea3sa6rsXJ3oSaHrYZXhW5blIKzwPZrqVozbKp7sRonfHpjoJ4vhRHrQLn/eNXnaJ33fNnHMJGvUFG3ZI2THBlPGAU2+9r1cgwAAACh0Uk5TAAcRGSIrO0RQUF9qdnl5hISEiaSoqqqxssnPz9DY2ery+vv7/P39/p/dKS0AAACXSURBVHjaXdDZEoIwDAXQVMuiIFrcd1FQWSqiouD6/38ltVNkel+SnMnkIfAPwrrZBB5Ft3uzlZs9Bnyuewml9HzLnwISP4hSZz4clxujVkNBAETAVeVNpy9BW8BdhpcMbw6oPPphoE027g80u8s21HUQ5gzMvX9gYGXH+EIK8MLotMUAeLpbElTAIo0dC1hqwIth4MoTvt45DOQxQMWhAAAAAElFTkSuQmCC"},{name:"bitchute",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAMBQTFRFAAAAgICAzDMzzDMz0i0tzjEx0i0t0S4u0C8v1Csr1Ssr1Csr1Csr0ykp1Ckp0yws1Soq1Soq0i0t1Soq1Csr1Csr1Ckp1ikp1Skp1ikp1ikp1ikp1ygo1ygo1ygo1igo1ygo1ygo1ygo2Ccn2Ccn+enp9+Pj9t7e9NHR9MzM8bu78LS076ys65ub65WV6YqK6ImJ54KC5XR05G5u4V9f4FRU3UhI3UVF3UFB3Dw82jU12S8v2Soq2Ccn2CYm2CQklRbHSwAAACV0Uk5TAAIFChEaIicxO0JNWWNqb3R4iZmboaettLzF1t3j6evt8/f7/Ut/7/wAAAC+SURBVHjaTcfRVoJAFIXhPaGZJqQVGIgWDFYWUZnkqOw57/9Wji4Xy++/OGfDUddBGMdh0FM46Yymmo6ejjtwulHBs2LSBbxHXgg9DDOKtZZ0RyT3EZNmv91Z7uttbWyCZzGfdbkWWS/Kt7LJkMvva7VYiZj3748vq5HK3/JnuRJrqk31L3OEbHYuko2LE/RntK6z+QDqLmMrHynAe2r3y9gDcJOSLEg9iwYKQD+hTh+Gvn/bu8LRfRIF7m0dAEgnJl0bT2c0AAAAAElFTkSuQmCC"},{name:"clyp",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAAXNSR0IArs4c6QAAAC1QTFRF////8vn9zOX2v9/0s9jxptLvmsztjcXrgL/pdLjmZ7LkWqviTaXgQZ7dNJjb3UEC1wAAAFpJREFUeNpjeAcFDMiMV+egjKd5EMbzBs06MOOQgpIOiPFGSUFJ9dw7hjfKQIaS6DuGV0IgBhNQ6gaQodIHZLxrUlDSegdiPE5QswMz3l3WewdhvNgHYmDYDgDke1tpAZA/swAAAABJRU5ErkJggg=="},{name:"dailymotion",data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAXNSR0IArs4c6QAAAMxJREFUeNqFkdENhSAMRRu/bUz4dBMGYA1GYQs/+XQFB3AFV3AO+q634SU+TR4NxdjT20IFa7hciFqnc25zm06tIQoj3Q1axbqpzU1NKyOOjLtasuyGsBAZd/EFFuHDNltoOKkDq6x9ZWT8XhkugBd8u0qIyFeKLtQoVuAzUSJV0DPlBFkbcxNObKZNp3iYKsQKEOgAzdT4AgJLpg7QO8AS3uZh61uJ3mQh8NJkiF4gscn1eU3pGtjQeDxUf2oi8vPUt2FxRPdhMfp33B/2Tf349B8MPAAAAABJRU5ErkJggg=="},{name:"gfycat",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAjVBMVEWn3gCo3gSr3w2t4BSu4Bav4Ri35C+45DK45DO55DXA50rA50vB50zC6E/D6FTF6VjG6VvL62vN7G/P7XbQ7XfW74vY8JDa8ZTe8qDe8qLf86Pi9Kzj9K7k9LHp9sDp98Lq98Ps+Mr0++L5/O75/fD6/fH6/fL6/fP7/fT7/fb8/ff8/vj8/vn+/v7///91X4cfAAAAcklEQVR42o3M2xKBUACF4aVQckrIuRJK6H//x2sme4/MuPDfre9i6c/Cc3U5Dj87BuAxsXvGu6JvIIXEHRWwNHCHQNrCzkAFkbSBg4EM8i+Yw7PXBa3zRfuxVyf/Bis7nKwGKAcWxgC8prI5Sc315OlnDfzpDar2S9/oAAAAAElFTkSuQmCC"},{name:"gist",data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAAXNSR0IArs4c6QAAACpQTFRFAAAAaWlpubm5zc3PycrL7u7uCxAX/v7/2NnasbK1gYSIWFxhLTI4GR4lkI5WFQAAAAd0Uk5TADicvur2/XGJAcwAAACHSURBVHjaY2BgEPKcosgABEyzz97ZqQBkWOWeOXNtMVBg2Z67d09nKTBI5lRM8Ww/NpFB+054eXn52U0MPrfKgWDtEYa5N0GMuTcRDJ/bIMbeIwzaZ5aXl1fd3cQgefLs9MqzQO1MuyPDK+5kKzAwWO8Kr7i2GWTpmvaKkwoMQCAUXqrIwAAAoI46gu0lGAYAAAAASUVORK5CYII="},{name:"image",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAoJJREFUeNqlk8trU1sYxX/7cc7JSWqb1Da59iEpXr0ovdxcQcSJFnxMxaGOHDv1D1H/AsWhOlJwogPRsVAFJ+KjSqpto/akycnZ57W3AVEQOnPB4oPF+taafB9/CnH55qtOd7hT/yksz9TXrl88vMYuuHLnVef15u9erZS6dmRvc8U5R54Zzi656Gq3u/rbpnOA49maWfGKJo4fUrOWPtEWxzAesh5P4ck6j7p/1R+vixUtobAwVXUcWpS0W7BnARpmg/WtPnZUkAYlMjM5cRzTmp6nNTtPP1NsG8kglwzH9KqKoRLIMaNCICb38c9Sk370lSzP0aIYcubfWcI5zdQE1BR8+OLIckd/JAkCmJ8ALCxOQlHCqJjm5KEa35ISfenA4MaxE8dWXg4sA5OOG0P+bwu2YkFZOhACTwEK6j6cqDEOgKqewFq3quOdnWhj8yO3795DKcPpcxdY3L9MWBVoIZj0ILFgHRRALKARQlpaHPQ1QJYmfN56S1EYHjy8xUx9ieOd4xw+eJRu5LA4NDn7WyGBFGggcRaERPfkTGdhlPL5/UekckS9HltzPd51X6KrAb7vUwmaVMO91EJNZ+lvOu02zgrWBxn6edw6v/ZiA+kfQSiNVIJ0EGCLKmEeoKsV8tRRFB5ah3za3GZnkPBtMI/nBae0RfC1nMFvHEBpHz8MCXyfiYoaTw9PSXxPMr0nZLoWEkpFNhq3R4K5RoF2pcM52LdwEF/lnFluoaVACoGSDhx4WhJ4iszC0zcJoyRnlCbMjgO1SQ0mHpE5iE0J2ZD/FmrgHO7XJZdAxv03ll4sMSYnMUOkDBDbyXbbRKYNAFCpVKJGo7HKLtjN+8fv/B2VaRzENkpWcwAAAABJRU5ErkJggg=="},{name:"installgentoo",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAMBQTFRFAAAAAAAAAAAAAAAAAAAAAAAAd3KIAAAAEQ4RAwULzs7oAAcM2NbmlIfG5+P4vbPyAAAAAAAAAgkQ7Or4DA8YAAAAERASAwsSubXX3tn07+/3AwwUDCY15OD2XV1nS1BaEzJEZ3iOECs9IFBtaGx7RGmCJVl50Mr48fD4bmuk9vb7xM/jWYGf/f77+fj75+H839v719P2x737uKv2harYe6HSSJfLaoS/RZLDQo28Poe1O4CsLWeKSlpzJ1p+FzxSneqjOwAAAC10Uk5TAAYNEBkbL0tZXmNrcHmJjI2aoqqqrLS6u87m6Onr7e7w8vX5+vr6+/39/v7+2FamfQAAALBJREFUeNpljesaQkAYhHdRLKWSjjqIQrRyKFlK939X2bX1p+/P+80888wAAERJgi1+j2hYFqKPwJ+xW1c2gq32qnojAyAtngU5LEemWxZvTegSEQ7T/FHVNEE79hivVD8/8zJR6k/Dte5n+ZCtUKs3wHGS+SoVbG8X4DBJjwhyfQpwHEQXYnfOxL0l160+bwriyNSYNeT+UihKR2EJz/YcmYN1mMjQIEe3CkX4xf99ABzOEyTh/fKEAAAAAElFTkSuQmCC"},{name:"liveleak",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAALRQTFRFcDk5Wx0doj09mSIi/Pv77/Dw6ezs29ra1tLSwrq6wGVlpF1di1ZWjSkpfhER9fT04ubm68zM19LSw7S02aqqzqamvqurwaGhsJOTunR0s3FxqW5uo2xsmm9vtGJimWNjkVxcuUpKtEZGsDU1pSoqeTk5rBIScCkprQsLlxAQpAEBnQICaxUVlAICiAEBYg8PewQEgAEBdQICbAICWwICtpycyHl5p4eHqAAAYQkJXQoKVgAAewTIdwAAADV0Uk5TmZ+or/39/f39/f39/f39/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v5oWOIfAAAAuElEQVR42kXKwS4DYRhA0fPPfKrtpM0sOpsmiCDdef9H8ABWhE0RDWo61dEIHcTC3Z3kRn5W+q++il83xp46pOo0ygaa7d0A7W4vmvfFMR4Hs+s1VR2pWmdgmUMefzJZUUCYpwTtot8yLyOlLP+SvyDpksiTLu8gI7mP7meRSNMaSWT5ZwIMIZIVJlWt3Nl2h9Eb9TB+83rE7VDo9/HxHM1NqxsJ++BkOcPDtImL88Km2BQFHGwuvwGKmzk9p5YkgwAAAABJRU5ErkJggg=="},{name:"pastebin",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAF1QTFRFAAAAMzMzLi5GZGx0BQUFXmhxJScqOz1DXWNoa3F3a290k5melJaara+xlpeY8PHx4eLi29zc1dbWz8/Px8fHv7+/t7e4rq+vpqepnZ6ejo6OhISEfX5+d3d3YGBgwIwa3gAAAA90Uk5TAAULITE2YX6anqrW3vD+JUDspAAAAK5JREFUeNpNz0luwzAMBVA5ieMOiQbOouTc/5il2kXzueLDBwimlC77f66xb99WpVrTZpBtT+naSTKxeXHs/hmgnSd1PdvJw78CWitQsFBlEFyAowzM7hadX2i5ZNap2ZvDApCqTao0RaUFNHDwhKEes4BHl+5MJ0/JC2SKo4NVo6xHgJ06OCiOw+MWMPUlL+pdS33et7eGw/O4pHg2I0KtpdjjHntk//jLcdtSSj+AHw++3ZKWJwAAAABJRU5ErkJggg=="},{name:"peertube",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAMBQTFRFAAAA/wAA/1UA/2YAxlUcdHR0Lhcu62IUKioqcHBwFBQUdnZ2GxIb8WoH82cGc3l5c3NzEhge82gGHBwc9GcFHhkZcXFxJBwZc3Nz8WcFeXNuGxsb8mkFdHR08GkFVi0TlnBZ7mgIHhwecHBwHBoadHR0c3NzGhga8WgFGxkZc3Nz8WcFc3Nz8WgFc3NzGRga8WgFc3N08WkFGxka8WgFdHR0GxkadHR0GxoadHR0GhgZ8WkE8WgE8WgFdHR0GxkaZ7hqxgAAAD10Uk5TAAEDBQkLCw0YGRkcHCQqKiorLC4vMzRbXV5fYGFjZnZ5hYmLkpadnZ+hoqPU1dXV1tjZ2dzi4uPj8/P09Vap/bMAAACRSURBVHjaVc/XEoIwEAXQjYqKGrFXLNg7ILGb5P//ys1IhmQfz869swtQWXUJmFO7h+OiBU/53raJBVIm/YIN4SzomJF9k7KzX9KQYCll/HOsEwXlBTYq4Dzy8wju0tNwHeYQqo944ij47lq4USBeG4+yaIqlKQgRzwNcG3Aa/Q/TkUMDIIPbZeCAMe66Z77/A+q6ElNsGDWuAAAAAElFTkSuQmCC"},{name:"soundcloud",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAMBQTFRF/2cA/2YA/2YA/2YA/2YA/2YA/2YA/////vby/eXW/N3K/NvJ/NnD/NjI/c+6+8uq/MKr+sKi+r6g+rme/LWY+qZ6+aNv/5Ux/48v/4ss/oos/Yos/4ol/Ikr+IFU/oMp/IIo94Iz9n88+XlK+IAo/n0l/Hwk9X0s93ot+Xok/XUh+nMg9m889HEg92k2+msc+2Qa/2YA/mYA/WUA+WAY91wj+lQU+00O+E0O/0kD/UcK+0cK+UYK/kEH/EAH/jwEfj1KkQAAAAd0Uk5TSFrk5+rt9gISbbcAAACaSURBVHjaTcE5igJRFIbR779v6K4OTaTNxFAQdP+LEMElOOEQiGBJvUHRoDxHClN6605h2NELe813fPv3CCEDoFTwRBAegESVVxSONm5yHDRkPEHky+0n1fY4LiY3ku1PKi5B6awxQ9ssIYDrLmD4h+wVgAKGRYCPxvBoUs+Dw/AO2F9Fi18B4q3Sepzo1WrLpC9pKdyM3io/AdrDMCk60CjnAAAAAElFTkSuQmCC"},{name:"streamable",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAGBQTFRFAAAAAID/CI/4gsr/BpH5CJH5BpL5arz7BZL6Z7r8BpP7BZH6BpH6JZ76B5L6BpH6BZD6/v//9Pr/5fP+2O7+wOL+veH9rtr9p9f9a7z8Y7j8T7D8O6f7JJ37GJj7BZH6dIRsvAAAABF0Uk5TAAYiKyyAiJCTlK6+0dfy+fzQvCOfAAAAmUlEQVR42l2PbQ+CMAyEC8KciBsbUxl7uf//L21HoobnQ5Neer2WhH6cjZlVTwfdaLGAsapr/YQvkygj/lDstwAKmFyB5SIDOTifKpcduNIMrGHf6muNwRc8yCC7DCQuxe0wTUhAeANVhGZZ49OXWDZf2aKA5Hlpds5H4NZiqySWVFqsjPzQp9PvxzPKorFo6YVBy/t6ICL6AH4DE9XqS58KAAAAAElFTkSuQmCC"},{name:"twitchtv",data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAAXNSR0IArs4c6QAAABVQTFRF////Zz6lZEGlY0KlZUKkZEGlZEGltJNrJQAAAAZ0Uk5TASVPXWV9PfYTqwAAAD5JREFUeNpjYEiDAAZmGIMtjQEEUBksCW74GBi6WGGMsEQgIy0BiAXAjLS0RAYQIw0kwABiJjEwQBgKDAwMAD4aF9kc7HdHAAAAAElFTkSuQmCC"},{name:"twitter",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAAXNSR0IArs4c6QAAALNJREFUeNpjQAKMUFpQSIoJwudlB1NzLy47yMXEwMRgdFASrEJmJ0/vTAYWBpXThlCd8QsYTngx8B8IYwBrZWBiWBKqeEZ2SzoDM8x0keOS8a9LwPJQJT5rGXaDNUABC8OWMpGLEowIFfYHLyuHrYApYWTQPKFsdphhSQZMhOekDwNDcwfTKQ2w6xk5d8YzMDOxnbC33szMCNLQ2sPAxMDEYHh5wfMYsCZBqDd5pfl4sXgeAOR+JWx65NE5AAAAAElFTkSuQmCC"},{name:"video",data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAXNSR0IArs4c6QAAACxJREFUeNpj+M+AHzIQVEBYxX98JFEKSHPlf8IK/hNW8J+AAlLdMCgCihAEAJBiCAfi8KAsAAAAAElFTkSuQmCC"},{name:"vidlii",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAL1QTFRFAAAAAFX/AAAqAFv/ABxVAEr/ACeFAFf/AB1NAFb/ADCbAFD/A1v/AFT/AD68ADqzAEniAln/AD69AEPEBVj6AD7BAkjSD2L/CVHeD2L/GWj8EVvnMXb/GmbzKnH8KHH8U4n/Qn/6GGb9NHf8WIz4Zpf+Zpf2b576//7+//78+/r59Pb97PH/7e/34Or/5On22OP/2eP2ytj6wdL5ssn/tMf4qMH/nbr8mLb4kbP6g639daP/dqL3SIP+KnL+KsPlKgAAACh0Uk5TAAYGDhIfLjU1PkBDVFhfYWl2d36Rk6CmsLjFx9nZ3unu8PL5+/39/kamH9cAAADJSURBVHjaHcjLUoNAEAXQ248hQ0gCxIVW8f8f5d4yVlyICwTm0W0lZ3mItMFWDwNjXgFAh05p/jlf+sP7MzhO3bUNMiyOEAiQyGS2xVM+5lPHOzSny9405H6ffpvCldei1Mfg8vaVYQa23CC1avT5ilAdWtJ3myfMPO3gCjC2rNVuxjC/l0ekorSLM6rkZ1g+UBkfQW4EgUuJ1UsrK9dwbBTYSlg3yK0r516jABRfEvFSi49CHwTgOqpbWlxAtimAPyHPayKAzf4BWmNnf7ZivjUAAAAASUVORK5CYII="},{name:"vimeo",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAYFBMVEUAAAAIdZUKh6sLlLkLmr4LmsAMp88NrdYVW3MZj7Acstkrt9s1e5E7vN5EfI9JvdtKwuBijp5kpbl30eiDt8aG1uqRr7qTyNehxM+k4PCy3enB3OTg6Ovv9PXw+fz////L9U5WAAAAAXRSTlMAQObYZgAAAIFJREFUeNplz90OwiAMBWAQpAoyxclkP3je/y0H2AQXz0WT8100rRD6kNI9/cRroemQL3hXhoujZYj4OHoAmBvYGcBISwbWBvfXCrytnIDUQMkbsBpagMA7zhtQdyTFQAmIG7IkYniiZuh3XGsPqoOZkMOJOpAcLqUzNFGGu/57fwc1hgtp0mVSyQAAAABJRU5ErkJggg=="},{name:"vine",data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAF1QTFRFAAAAAKqqAMaOAL+VALyUALmNAMGTALySAL6RAL2OALyNAMCPAL+PALyPAL2PAL+QALyQAL2QAL6PAL+PAL+QAL6PAL+QAL+PAL6PAL6PAL6QAL6PAL6PAL6PAL6PbycyeQAAAB50Uk5TAAMJDBMdISozNkFJUFttd36ImKqvtL/Iz9zn7/b6+V1hqgAAAKZJREFUeNotyEF2gzAMQMFvyZZJ0sf9zwkpNRhJ3TDLKTzeP8b1PagFEuirwVLmrB/jGPCyOPRly6zyKfdAlHszU0U8UChCZEIiM6hKOCpaMlCsMZzWxQf3EZrWy7wIq5VxRirS1QdBa315cyrZa7mciQlcZ+Uevb2uRCT3P0chu8q8l1XPbSYKLl2Jtd/bCSjgtdXFcv/lifDWNL978gTuWo49APgHoehXKFGk4JYAAAAASUVORK5CYII="},{name:"vocaroo",
data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAYBQTFRFAAAAAAAAAFUAJ04UFDsAKFENTnosIU4LO1gUM1URN2ccRm4dOmodaZI2P2seK2ULeZ9MO24VYIgtXIorPXMUI1oIYY0vS40kg65KhaJuZIg+epxVm8ZZYIswNXUPSXIhQ4AaPYQSPYIQpNRlUIAlg6xJTHMyjLpJeKRFmcZbcqA3ksJQPIUNcKA8osCClcRZZ5Mzcp4/m8RjpdRljrtgXp4sRpUSXKcpYqMwk8JVrdtpaKsxga1GjbtVVqcfjbtNocxngrpEt+Zyab02vu53pdFkXqwqotJilcZUzPKTrNV2tb1mq9hnqdlZUKMX7u7uzf6CzP2By/yAzfeOyPd+xfR8wfB6v+52uuhzweJ1tuVvx8fHtOFvsuBrwddyt9iEseJesNtvrdxkpNJhv8JsnNdboNFfotFYpcxposJxm8dco7aFm8BjvatpiMtOkMJOmbFyiMFKlbNlvZ1ghb1Afb5BjqxffJJbe4doUagXxWFTzEVR1zZP4i9QW2hGWmFP8o8FIgAAAE90Uk5TAAIGDQ0TFxcaHiUsNT1FR0pKWmRkZmdpa2trb3V1eH2IjZOVlpqdnp+ipqqtsrO7ws3O2dra2tzd4OHj5ujo7e/x8/P1+Pj6+/z8/P39/a8ykJsAAADdSURBVHjaY4AARg4VXU1tMUYGMGDnFzByjYmISvLlYwADUTWvsAAgiErQYgILSHoGgEFgvp8OWJMeiBdaHh+QVmkGUsJkkliRGZATXR8QXiICUsCTV+RfFxCaXRYQmC4IEmA1DSvICI8NBeqzYQfxuZitgDYkhQQ5aXIC+dK2Fiy8xj7uqaUG8mBncPI4KzFyaBiWFvpkeYCNYBB3UzDPCQ5KiUu2dhMGCTA5OCpK5VbXVkWo61uCncrNxcDtXVNbHGRvJ8cABUxWkcWhLoYesgwwIKEsI8DGpCrEAABv9i67kptWHQAAAABJRU5ErkJggg=="
},{name:"youtube",data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAAXNSR0IArs4c6QAAADBQTFRFAAAA/wAA/wAA/wAA/wAA/wAA/wAA/wAA/////+Dg/8DA/7Cw/1BQ/0BA/xsb/wAABceraAAAAAh0Uk5TABAwQFBgcIDN7a/fAAAAS0lEQVR42mPAAoTNy8uLDRkYWP+DQQCDPoTxicEfwvjKUP///8/7//9/BzF+dL+HMrqgjJ/n////DlL8D6QYrh1hIIOwGcgKLHYDAI8wSVRb1KCAAAAAAElFTkSuQmCC"}],"/* Link Title Favicons */\n"+B.map((({name:e,data:t})=>`.linkify.${e}::before {\n  content: "";\n  background: transparent url('data:image/png;base64,${t}') center left no-repeat!important;\n  padding-left: 18px;\n}\n`)).join("")+"@supports (text-decoration-style: dashed) or (-moz-text-decoration-style: dashed){.quotelink.forwardlink,.backlink.forwardlink{text-decoration:underline;-moz-text-decoration-style:dashed;text-decoration-style:dashed;border-bottom:none}}"),
report:"#g-recaptcha,:root:not(.js-enabled) #captchaContainerAlt{height:auto}#captchaContainerAlt td:nth-child(2){display:table-cell !important}#archive-report{padding:3px}#archive-report-enabled{vertical-align:middle}#archive-report>label{display:block}#archive-report-reason{display:block;width:98%}.archive-report-success{color:green}.archive-report-error{color:red}",www:"#captcha-cnt{height:auto}:root:not(.js-enabled) #form{display:block}#bd>div[style], #bd>div[style]>*{height:auto !important;margin:0 !important;font-size:0}",sub:function(e){var t={site:i.SITE.selectors};return e.replace(/\$[\w\$]+/g,(function(e){for(var o=e.slice(1).split("$"),a=t,i=0;i<o.length;i++){if("object"!=typeof a)return":not(*)";a=x.getOwn(a,o[i])}return"string"!=typeof a?":not(*)":a}))}};var B;const N={init(){if(a["Custom CSS"])return this.addStyle()},addStyle(){return this.style=x.addStyle(R.sub(a.usercss),"custom-css","#fourchanx-css")},rmStyle(){if(this.style)return x.rm(this.style),delete this.style},
update(){return this.style?this.style.textContent=R.sub(a.usercss):this.addStyle()}};const L=(e,t,o)=>`<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 ${t} ${o}"><path d="${e}" fill="currentColor" /></svg>`,P={image:L("M448 80c8.8 0 16 7.2 16 16V415.8l-5-6.5-136-176c-4.5-5.9-11.6-9.3-19-9.3s-14.4 3.4-19 9.3L202 340.7l-30.5-42.7C167 291.7 159.8 288 152 288s-15 3.7-19.5 10.1l-80 112L48 416.3l0-.3V96c0-8.8 7.2-16 16-16H448zM64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm80 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z",512,512),
eye:L("M288 80c-65.2 0-118.8 29.6-159.9 67.7C89.6 183.5 63 226 49.4 256c13.6 30 40.2 72.5 78.6 108.3C169.2 402.4 222.8 432 288 432s118.8-29.6 159.9-67.7C486.4 328.5 513 286 526.6 256c-13.6-30-40.2-72.5-78.6-108.3C406.8 109.6 353.2 80 288 80zM95.4 112.6C142.5 68.8 207.2 32 288 32s145.5 36.8 192.6 80.6c46.8 43.5 78.1 95.4 93 131.1c3.3 7.9 3.3 16.7 0 24.6c-14.9 35.7-46.2 87.7-93 131.1C433.5 443.2 368.8 480 288 480s-145.5-36.8-192.6-80.6C48.6 356 17.3 304 2.5 268.3c-3.3-7.9-3.3-16.7 0-24.6C17.3 208 48.6 156 95.4 112.6zM288 336c44.2 0 80-35.8 80-80s-35.8-80-80-80c-.7 0-1.3 0-2 0c1.3 5.1 2 10.5 2 16c0 35.3-28.7 64-64 64c-5.5 0-10.9-.7-16-2c0 .7 0 1.3 0 2c0 44.2 35.8 80 80 80zm0-208a128 128 0 1 1 0 256 128 128 0 1 1 0-256z",576,512),
expand:L("M344 0H488c13.3 0 24 10.7 24 24V168c0 9.7-5.8 18.5-14.8 22.2s-19.3 1.7-26.2-5.2l-39-39-87 87c-9.4 9.4-24.6 9.4-33.9 0l-32-32c-9.4-9.4-9.4-24.6 0-33.9l87-87L327 41c-6.9-6.9-8.9-17.2-5.2-26.2S334.3 0 344 0zM168 512H24c-13.3 0-24-10.7-24-24V344c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2l39 39 87-87c9.4-9.4 24.6-9.4 33.9 0l32 32c9.4 9.4 9.4 24.6 0 33.9l-87 87 39 39c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8z",512,512),
comment:L("M123.6 391.3c12.9-9.4 29.6-11.8 44.6-6.4c26.5 9.6 56.2 15.1 87.8 15.1c124.7 0 208-80.5 208-160s-83.3-160-208-160S48 160.5 48 240c0 32 12.4 62.8 35.7 89.2c8.6 9.7 12.8 22.5 11.8 35.5c-1.4 18.1-5.7 34.7-11.3 49.4c17-7.9 31.1-16.7 39.4-22.7zM21.2 431.9c1.8-2.7 3.5-5.4 5.1-8.1c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208s-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6c-15.1 6.6-32.3 12.6-50.1 16.1c-.8 .2-1.6 .3-2.4 .5c-4.4 .8-8.7 1.5-13.2 1.9c-.2 0-.5 .1-.7 .1c-5.1 .5-10.2 .8-15.3 .8c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4c4.1-4.2 7.8-8.7 11.3-13.5c1.7-2.3 3.3-4.6 4.8-6.9c.1-.2 .2-.3 .3-.5z",512,512),
refresh:L("M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z",512,512),
wrench:L("M352 320c88.4 0 160-71.6 160-160c0-15.3-2.2-30.1-6.2-44.2c-3.1-10.8-16.4-13.2-24.3-5.3l-76.8 76.8c-3 3-7.1 4.7-11.3 4.7H336c-8.8 0-16-7.2-16-16V118.6c0-4.2 1.7-8.3 4.7-11.3l76.8-76.8c7.9-7.9 5.4-21.2-5.3-24.3C382.1 2.2 367.3 0 352 0C263.6 0 192 71.6 192 160c0 19.1 3.4 37.5 9.5 54.5L19.9 396.1C7.2 408.8 0 426.1 0 444.1C0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9L297.5 310.5c17 6.2 35.4 9.5 54.5 9.5zM80 408a24 24 0 1 1 0 48 24 24 0 1 1 0-48z",512,512),bolt:L("M349.4 44.6c5.9-13.7 1.5-29.7-10.6-38.5s-28.6-8-39.9 1.8l-256 224c-10 8.8-13.6 22.9-8.9 35.3S50.7 288 64 288H175.5L98.6 467.4c-5.9 13.7-1.5 29.7 10.6 38.5s28.6 8 39.9-1.8l256-224c10-8.8 13.6-22.9 8.9-35.3s-16.6-20.7-30-20.7H272.5L349.4 44.6z",448,512),
link:L("M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z",640,512),
pencil:L("M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z",512,512),clipboard:L("M192 0c-41.8 0-77.4 26.7-90.5 64H64C28.7 64 0 92.7 0 128V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V128c0-35.3-28.7-64-64-64H282.5C269.4 26.7 233.8 0 192 0zm0 64a32 32 0 1 1 0 64 32 32 0 1 1 0-64zM112 192H272c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16z",384,512),
clock:L("M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z",512,512),
shuffle:L("M403.8 34.4c12-5 25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V160H352c-10.1 0-19.6 4.7-25.6 12.8L284 229.3 244 176l31.2-41.6C293.3 110.2 321.8 96 352 96h32V64c0-12.9 7.8-24.6 19.8-29.6zM164 282.7L204 336l-31.2 41.6C154.7 401.8 126.2 416 96 416H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c10.1 0 19.6-4.7 25.6-12.8L164 282.7zm274.6 188c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V416H352c-30.2 0-58.7-14.2-76.8-38.4L121.6 172.8c-6-8.1-15.5-12.8-25.6-12.8H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c30.2 0 58.7 14.2 76.8 38.4L326.4 339.2c6 8.1 15.5 12.8 25.6 12.8h32V320c0-12.9 7.8-24.6 19.8-29.6s25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64z",512,512),
undo:L("M48.5 224H40c-13.3 0-24-10.7-24-24V72c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2L98.6 96.6c87.6-86.5 228.7-86.2 315.8 1c87.5 87.5 87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3c-62.2-62.2-162.7-62.5-225.3-1L185 183c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8H48.5z",512,512),download:L("M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V274.7l-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7V32zM64 352c-35.3 0-64 28.7-64 64v32c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V416c0-35.3-28.7-64-64-64H346.5l-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352H64zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z",512,512),
bookOpen:L("M249.6 471.5c10.8 3.8 22.4-4.1 22.4-15.5V78.6c0-4.2-1.6-8.4-5-11C247.4 52 202.4 32 144 32C93.5 32 46.3 45.3 18.1 56.1C6.8 60.5 0 71.7 0 83.8V454.1c0 11.9 12.8 20.2 24.1 16.5C55.6 460.1 105.5 448 144 448c33.9 0 79 14 105.6 23.5zm76.8 0C353 462 398.1 448 432 448c38.5 0 88.4 12.1 119.9 22.6c11.3 3.8 24.1-4.6 24.1-16.5V83.8c0-12.1-6.8-23.3-18.1-27.6C529.7 45.3 482.5 32 432 32c-58.4 0-103.4 20-123 35.6c-3.3 2.6-5 6.8-5 11V456c0 11.4 11.7 19.3 22.4 15.5z",576,512),shrink:L("M439 7c9.4-9.4 24.6-9.4 33.9 0l32 32c9.4 9.4 9.4 24.6 0 33.9l-87 87 39 39c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8H296c-13.3 0-24-10.7-24-24V72c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2l39 39L439 7zM72 272H216c13.3 0 24 10.7 24 24V440c0 9.7-5.8 18.5-14.8 22.2s-19.3 1.7-26.2-5.2l-39-39L73 505c-9.4 9.4-24.6 9.4-33.9 0L7 473c-9.4-9.4-9.4-24.6 0-33.9l87-87L55 313c-6.9-6.9-8.9-17.2-5.2-26.2s12.5-14.8 22.2-14.8z",512,512),
heart:L("M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z",512,512),caretDown:L("M137.4 374.6c12.5 12.5 32.8 12.5 45.3 0l128-128c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8L32 192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l128 128z",320,512),
scissors:L("M256 192l-39.5-39.5c4.9-12.6 7.5-26.2 7.5-40.5C224 50.1 173.9 0 112 0S0 50.1 0 112s50.1 112 112 112c14.3 0 27.9-2.7 40.5-7.5L192 256l-39.5 39.5c-12.6-4.9-26.2-7.5-40.5-7.5C50.1 288 0 338.1 0 400s50.1 112 112 112s112-50.1 112-112c0-14.3-2.7-27.9-7.5-40.5L499.2 76.8c7.1-7.1 7.1-18.5 0-25.6c-28.3-28.3-74.1-28.3-102.4 0L256 192zm22.6 150.6L396.8 460.8c28.3 28.3 74.1 28.3 102.4 0c7.1-7.1 7.1-18.5 0-25.6L342.6 278.6l-64 64zM64 112a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm48 240a48 48 0 1 1 0 96 48 48 0 1 1 0-96z",512,512)};var M={set(e,t,o){const a=P[t];if(!a)throw new Error(`Icon "${t}" not found.`);e.innerHTML=o?`<span class="icon--alt-text">${s(o)}</span>${a}`:a},get:e=>P[e],raw:e=>({innerHTML:P[e],[y]:!0})},F={init:()=>x.asap((()=>n.head&&(F.el=x('link[rel="shortcut icon"]',n.head))),F.initAsap),set(e){if(F.status=e,F.el)return F.el.href=F[e],x.add(n.head,F.el)},initAsap(){F.el.type="image/x-icon";const{href:e}=F.el;if(F.isSFW=/ws\.ico$/.test(e),F.default=e,F.switch(),
F.status)return F.set(F.status)},switch(){let e={
ferongr:["iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAFVBMVEX///9zBQC/AADpDAP/gID/q6voCwJJTwpOAAAAAXRSTlMAQObYZgAAAGJJREFUeF5Fi7ENg0AQBCfa/AFdDh2gdwPIogMK2E2+/xLslwOvdqRJhv+GQQPUCtJM7svankLrq/I+TY5e6Ueh1jyBMX7AFJi9vwfyVO4CbbO6jNYpp9GyVPbdkFhVgAQ2H0NOE5jk9DT8AAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAxUlEQVR42q1TOwrCQBB9s0FRtJI0WoqFtSLYegoP4gVSeJsUHsHSI3iFeIqRXXgwrhlXwYHHhLwPTB7B36abBCV+0pA4DUBQUNZYQptGtW3jtoKyxgoe0yrBCoyZfL/5ioQ3URZOXW9I341l3oo+NXEZiW4CEuIzvPECopED4OaZ3RNmeAm4u+a8Jr5f17VyVoL8fr8qcltzwlyyj2iqcgPOQ9ExkHAITgD75bYBe0A5S4H/P9htuWMF3QXoQpwaKeT+lnsC6JE5I6aq6fEAAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAFVBMVEX///8AcH4AtswA2PJ55fKi6fIA1/FtpPADAAAAAXRSTlMAQObYZgAAAGJJREFUeF5Fi7ENg0AQBCfa/AFdDh2gdwPIogMK2E2+/xLslwOvdqRJhv+GQQPUCtJM7svankLrq/I+TY5e6Ueh1jyBMX7AFJi9vwfyVO4CbbO6jNYpp9GyVPbdkFhVgAQ2H0NOE5jk9DT8AAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAxElEQVQ4y2NgoBq4/vE/HJOsBiRQUIfA2AzBqQYqUfn00/9FLz+BaQxDCKqBmX7jExijKEDSDJPHrnnbGQhGV4RmOFwdVkNwhQMheYwQxhaIi7b9Z9A3gWAQm2BUoQOgRhgA8o7j1ozLC4LCyAZcx6kZI5qg4kLKqggDFFWxJySsUQVzlb4pwgAJaTRvokcVNgOqOv8zcHBCsL07DgNg8YsczzA5MxtUL+DMD8g0slxI/H8GQ/P/DJKyeKIRpglXZsIiBwBhP5O+VbI/JgAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAFVBMVEX///8oeQBJ3ABV/wHM/7Lu/+ZU/gAqUP3dAAAAAXRSTlMAQObYZgAAAGJJREFUeF5Fi7ENg0AQBCfa/AFdDh2gdwPIogMK2E2+/xLslwOvdqRJhv+GQQPUCtJM7svankLrq/I+TY5e6Ueh1jyBMX7AFJi9vwfyVO4CbbO6jNYpp9GyVPbdkFhVgAQ2H0NOE5jk9DT8AAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAx0lEQVQ4y2NgoBYI+cfwH4ZJVgMS0KhEYGyG4FQDkzjzf9P/d/+fgWl0QwiqgSkI/c8IxsgKkDXD5LFq9rwDweiK0A2HqcNqCK5wICSPEcLYAtH+AMN/IXMIBrEJRie6OEgjDAC5x3FqxuUFNiEUA67j1IweTTBxBQ1puAG86jgSEraogskJWSBcwCGF5k30qMJmgMFEhv/MXBAs5oLDAFj8IsczTE7UEeECbhU8+QGZRpaTi2b4L2zF8J9TGk80wjThykzY5AAW/2O1C2mIbgAAAABJRU5ErkJggg=="],
"xat-":["iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAG1BMVEX+AACLkZFub2yfaF3zZGIAAAD/AAD/iYr/zs8IPcF6AAAABXRSTlMAeprJ7xzg6IEAAABZSURBVAjXY2DABKGBSkqioQwMrGmpxsZhaQEMDGFpIa5pqSCRtPDSNJBIaGh5eShQDYOye0V7iREKAyQFYoiCFAcyILQDGcGmEEZYkGoqiMHKysAQEICwGwAAjBmBqhYlagAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAPFBMVEUAAACEgoBva2ilamDxcG7IaWYgFBNOSEf//f0PDQwBAAA7LCwAAAD/AAD+hIX+m5z+zc5HAADPAAAGAADl032uAAAADHRSTlMAzNv0/vz+6v3+7ALrmfyXAAAAaUlEQVQY042PyxKAIAhFAc1eV7T6/3/N8VXOtAgWwBm4ANEPA8AswpySXHvvYZLlpBNrh9pDtcSqAQ1BUTVIjNUQY5icmwfglmXNgE0d6QBF9GigrU0A9LoM53U1kFzk6SBQuWfD/vHqDUCpBmVKTTM4AAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAIVBMVEUAAACRjop4dXVpZ2tdcI9dfKdisfMAAAAumMN9xv+s2/+PADT2AAAAB3RSTlMAepGdv83v3HIc4QAAAFxJREFUCNdjYMAE5YXKRuLlDAzsHe2uIRUdBQwMFR1l6R3tIJGOyukdIJHy8lkry4FqGEwzV62aFozMUAFJOQEZ4iDFhQwI7UBGaTiEUVFs3g5isLMzMBQUIOwGAJRlIu9hk08QAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAMFBMVEUAAACAgYVlc4ljsu4AAAAAAAAAAAAumMODyP6b1P6e1f/g8v89msgSIiwNFxwbPU3tQYj5AAAABnRSTlMAxej+9VTmD9ciAAAAZElEQVQI12NgwARpiUKKYmkMDGzlZUpK6eUJDAzp5clm5WUgkfKMtnKQSFpa54o0oBoGJYvZO88+gjJu7wMyhIBS2SCGGFDxaxADpP32NjAjSe0bSFd6epIaWISNjYEhJRVhNwAGlyJpYtcvcAAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAHlBMVEUfJSCRi5Frbm9dn19082KR/30AAABmzDOq/5vZ/9Gt/vt2AAAABnRSTlMAe5rJ7/4vxEp4AAAAWUlEQVQI12NgwARpiUpKYmkMDGzlZcbG6eUJDAzp5Slu5WUgkfLUsHKQSFpaRGsaUA2DsmvnjBAjFAZICsQQAylOZEBoBzKSzSCM9CS1MhCDjY2BISEBYTcAtgAcKSK2vuIAAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAM1BMVEUAAACBj39tfm1qj2RepFlu2VQAAQAAAAAAAABmyzOX/oSr/pus/pzk/98PGgtatC4CBAI1ENblAAAACHRSTlMA09/p9v77ig0SBcQAAABnSURBVBjTjY9LDsAgCEQRsR2xWu9/2hK/adJFYQG8wABEPwyAYzNnSatjjPAiviWLhPCqI1R7HBrQdCmGBrEETTmnUAq/QMm5dODHyAQOXXR1zLUGsIEI7lonMGfeHQTq9xw4P159AIxSBSC53km7AAAAAElFTkSuQmCC"],
Mayhem:["iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABFklEQVR4AZ2R4WqEMBCEFy1yiJQQ14gcIhIuFBFR+qPQ93+v66QMksrlTwMfkZ2ZZbMKTgVqYIDl3YAbeCM31lJP/Zul4MAEPJjBQGNDLGsz8PQ6aqLAP5PTdd1WlmU09mSKtdTDRgrkzspJPKq6RxMahfj9yhOzQEZwZAwfzrk1ox3MXibIN8hO4MAjeV72CemJGWblnRsOYOdoGw0jebB20BPAwKzUQPlrFhrXFw1Wagu9yuzZwINzVAZCURRL+gRr7Wd8Vtqg4Th/lsUmewyk9WQ/A7NiwJz5VV/GmO+MNjMrFvh/NPDMigHTaeJN09a27ZHRJmalBg54CgfvAGYSLpoHjlmpuAwFdzDy7oGS/qIpM9UPFGg1b1kUlssAAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABR0lEQVR4AYWSQWq0QBCFCw0SRIK0PQ4hiIhEZBhEySLyewUPEMgqR/JIXiDhzz7kKKYePIZajEzDRxfV9dWU3SO6IiVWUsVxT5R75Y4gTmwNnUh4kCulUiuV8sjChDjmKtaUcHgmHsnNrMPh0IVhiMIjKZGzNXDoyhMzF7C89z2KtFGD+FoNXEUKZdgpaPM8P++cDXTtBDca7EyQK8+bXTufYBccuvLAG26UnqN1LCgI4g/lm7zTgSux4vk0J8rnKw3+m1//pBPbBrVyGZVNmiAITviEtm3t+D+2QcJx7GUxlN4594K4ZY75Xzh0JVWqnad6TdP0H+LRNBjHcYNDV5xS32qwaC4my7Lwn6guu5QoomgbdFmWDYhnM8E8zxscuhLzPWtKA/dGqUizrityX9M0YX+DQ1ciXobnP6vgfmTOM7Znnk70B58pPaEvx+epAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/ElEQVR4AZ3RUWqEMBSF4ftQZAhSREQJIiIXpQwi+tSldkFdWPsLhyEE0ocKH2Fyzg1mNJ4KAQ1arTUeeJMH6qwTUJmCHjMcC6KKtbSIylzdXpl18J/k4fdTpUFmPLOOa9bGe+P4+n5RYYfLXuiMsAlXofBxK2QXpvwN/jqg+AY91vR+pStk+apZe0fEhhMXDhUmWXEoO9WNmrWAzvRPq7jnB2jvUGfWTEgPcJzZFTbZk/0Tnh5QI+af6lVGvq/Do2atwVL4VJ+3QrZo1lr4Pw5wzVqDWaV7SUvHrZDNmrWAHq7g0rphkS3LXDMBVqFGhxGT1gGdDFnWaab6BRmXRvbxDmYiAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABQElEQVR4AY2SQUrEQBBFS9CMNFEkhAQdYmiCIUgcZlYGc4VsBcGVF/AuWXme4F7RtXiVWF9+Y9MYtOHRTdX/NZWaEj2RYpQTJeEdK4fKPuA7DjSGXiQkU0qlUqxySmFMEsYsNSU8zEmK4OwdEbmkKCclYoGmolfWCGyenh1O0EJE2gXNWpFC2S0IGrCQ29EbdPCPAmEHmXIxByf8hDAPD71yzAnXypatbSgoAN8Pyju5h4deMUrqJk1z+0uBN+/XX+gxfoFK2QafUJO2aRq//Q+/QIx2wr+Kwq0rusrP/QKf9MTCtbQLf9U1wNvYnz3qug45S68kSvVXgbPbx3nvYPXNOI7cRPWySukK+DcGCvA+urqZ3RmGAbmSXjFK5rpwW8nhWVJP04TYa9/3uO/goVciDiPlZhW8c8ZAHuRSeqIv32FK/GYGL8YAAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/ElEQVR4AZ3RUWqEMBSF4ftQZAihDCKKiAQJShERQx+6o662e2p/4TCEQF468BEm95yLovFr4PBEq9PjgTd5wBcZp6559AiIWDAq6KXV3aJMUMfDOsTf7Mf/XaFBAvYiE9W16b74/vl8UeBAlKOSmWAzUiXwcavMkrrFE9QXVJ+gx5q9XvUVivmqrr1jxIYLCacCs6y6S8psGNU1hw4Bu4JHuUB3pzJBHZcviLiKV9jkyO4vxHyBx1h+qlcY5b2Wj+raE0vlU33dKrNFXWsR/7EgqmtPBIXuIw+dt8osqGsOPaIGSeeGRbZiFtVxsAYeHSbMOgd0MhSzTp3mD4RaQX4aW3NMAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABP0lEQVR4AYWS0UqFQBCGhziImNRBRImDmUgiIaF0kWSP4AMEXXXTE/QiPpL3UdR19Crb/PAvLEtyFj5mmfn/cdxd0RUokbJXEsZYCZUd4D72NBG8wkKmlEqtVMoFhTFJmKuoKelBTVIkjbNE5IainJTIeZqaXjkg8fp+Z7GCjiLQbWgOihTKsCFowUZtoNef4HgDf4JMuTbe8n/Br8NDr5zxhBul52i3FBQE+xflmzzTA69ESmpPmubunwZfztc/6IncBrXSe7/QkK5tW3f8H7dBjHH8q6Kwt033V6Hb4JeeWPgsq42rugfYZ92psWscRwMPvZIo9bEGD2+F2YUnBizLwpeoXnYpbQM34kAB9peP58aueZ4NPPRKxPusaRoYG6UizbquyH1O04T4RA+8EvAwUr6sgjFnDuReLaUn+ANygUa7+9SCWgAAAABJRU5ErkJggg=="],
"4chanJS":["iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAD1BMVEUBAAAAAAD/AABnZ2f///8nFk05AAAAAXRSTlMAQObYZgAAAEFJREFUeNqNjgEKACAMAjvX/98cAkkxgmSgO8Bt/Ai4ApJ6KKhzF3OiEMDASrGB/QWgPEHsUpN+Ng9xAETMYhDrWmeHAMcmvycWAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAAAAAD/AABmZmYA/wBD99DBAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAE9JREFUCNdljcsRACEIQ5MOiNKAdGAJ9N/Uiu7nsMzABHgB4B8ygFoZA2hhVWavhhGeURPJU9q45+17hGbfGxa82Ndex3hEM44SJGD2/b4AzDgGlHbl388AAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAD1BMVEUBAAAAAAAul8NnZ2f////82iC9AAAAAXRSTlMAQObYZgAAAEFJREFUeNqNjgEKACAMAjvX/98cAkkxgmSgO8Bt/Ai4ApJ6KKhzF3OiEMDASrGB/QWgPEHsUpN+Ng9xAETMYhDrWmeHAMcmvycWAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAAAAAAul8NnZ2f/AAD7B+mqAAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEgAACxIB0t1+/AAAAE9JREFUCNdljcsRACEIQ5MOiNKAdGAJ9N/Uiu7nsMzABHgB4B8ygFoZA2hhVWavhhGeURPJU9q45+17hGbfGxa82Ndex3hEM44SJGD2/b4AzDgGlHbl388AAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAElBMVEUBAAAAAABmzDNlyjJnZ2f///+6o7dfAAAAAXRSTlMAQObYZgAAAERJREFUeF6NjkEKADEIA51o///lJZfQxUsHITogWi8AvwZJuxmYa25xDooBLEwOWFTYAsYVhdorLZt9Ng9xCUTCUCQ2H3F4ANrZ2WNiAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAAAAABmzDNmZmb/AAC8/wCMAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAE9JREFUCNdljcsRACEIQ5MOiNKAdGAJ9N/Uiu7nsMzABHgB4B8ygFoZA2hhVWavhhGeURPJU9q45+17hGbfGxa82Ndex3hEM44SJGD2/b4AzDgGlHbl388AAAAASUVORK5CYII="],
Original:["iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAADFBMVEX/////AAD///8AAABBZmS3AAAAAXRSTlMAQObYZgAAAExJREFUeF4tyrENgDAMAMFXKuQswQLBG3mOlBnFS1gwDfIYLpEivvjq2MlqjmYvYg5jWEzCwtDSQlwcXKCVLrpFbvLvvSf9uZJ2HusDtJAY7Tkn1oYAAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAhElEQVR42q1RwQnAMAjMu5M4guAKXa4j5dUROo5tipSDcrFChUONd0di2m/hEGVOHDyIPufgwAFASDkpoSzmBrkJ2UMyR9LsJ3rvrqo3Rt1YMIMhhNnOxLMnoMFBxHyJAr2IOBFzA8U+6pLBdmEJTA0aMVjpDd6Loks0s5HZNwYx8tfZCZ0kll7ORffZAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAADFBMVEX///8ul8P///8AAACaqgkzAAAAAXRSTlMAQObYZgAAAExJREFUeF4tyrENgDAMAMFXKuQswQLBG3mOlBnFS1gwDfIYLpEivvjq2MlqjmYvYg5jWEzCwtDSQlwcXKCVLrpFbvLvvSf9uZJ2HusDtJAY7Tkn1oYAAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAALVBMVEUAAAAAAAAAAAAAAAABBQcHFx4KISoNLToaVW4oKCgul8M4ODg7OzvBwcH///8uS/CdAAAAA3RSTlMAx9dmesIgAAAAV0lEQVR42m2NWw6AIBAD1eILZO5/XI0UAgm7H9tOsu0yGWAQSOoFijHOxOANGqm/LczpOaXs4gISrPZ+gc2+hO5w2xdwgOjBFUIF+sEJrhUl9JFr+badFwR+BfqlmGUJAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAADFBMVEX///9mzDP///8AAACT0n1lAAAAAXRSTlMAQObYZgAAAExJREFUeF4tyrENgDAMAMFXKuQswQLBG3mOlBnFS1gwDfIYLpEivvjq2MlqjmYvYg5jWEzCwtDSQlwcXKCVLrpFbvLvvSf9uZJ2HusDtJAY7Tkn1oYAAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAALVBMVEUAAAAAAAAAAAAAAAAECAIQIAgWLAsePA8oKCg4ODg6dB07OztmzDPBwcH///+rsf3XAAAAA3RSTlMAx9dmesIgAAAAV0lEQVR42m2NWw6AIBAD1eIDhbn/cTVSCCTsfmw7ybbLZIBBIKkXKKU0E4M3aKT+tjCn5xiziwuIsNr7BTb7ErrDZV/AAaIHdwgV6AcnuFaU0Eeu5dt2XiUyBjCQ2bIrAAAAAElFTkSuQmCC"],
Metro:["iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAAC/AABrZQDiAAAAAXRSTlMAQObYZgAAABJJREFUCB1jZGBgrMNAQEEc4gCSfAX5bRw/NQAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAAAAAAAAAC/AAD///8dAAApAABsAAAHAAA4AACQAAAsAABMCpCvAAAAA3RSTlMAPse+s4iwAAAAMklEQVQI12NggAFmY2MDECaNAQZCilAzVJyg5oS4GqAxUtygjIp2KGOKJ5SxepcB3BUAcdYRqxAtgFoAAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAAAA1/GhpCidAAAAAXRSTlMAQObYZgAAABJJREFUCB1jZGBgrMNAQEEc4gCSfAX5bRw/NQAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAAAAAAAAAAA1/H///8AISUALzQAeokACAkAQEcAorYAMTcE9WFNAAAAA3RSTlMAPse+s4iwAAAAMklEQVQI12NggAFmY2MDECaNAQZCilAzVJyg5oS4GqAxUtygjIp2KGOKJ5SxepcB3BUAcdYRqxAtgFoAAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAABV/wErM5hwAAAAAXRSTlMAQObYZgAAABJJREFUCB1jZGBgrMNAQEEc4gCSfAX5bRw/NQAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAAAAAAAAABV/wH///8NKAASOAAwkQADCgAZTABAwQATOwC5e3VGAAAAA3RSTlMAPse+s4iwAAAAMklEQVQI12NggAFmY2MDECaNAQZCilAzVJyg5oS4GqAxUtygjIp2KGOKJ5SxepcB3BUAcdYRqxAtgFoAAAAASUVORK5CYII="]
};e=x.getOwn(e,a.favicon);const t=F;let o=0;for(;e[o];)e[o]="data:image/png;base64,"+e[o++];return[t.unreadDead,t.unreadDeadY,t.unreadSFW,t.unreadSFWY,t.unreadNSFW,t.unreadNSFWY]=e,t.update()},update(){return this.isSFW?(this.unread=this.unreadSFW,this.unreadY=this.unreadSFWY):(this.unread=this.unreadNSFW,this.unreadY=this.unreadNSFWY)},SFW:"//s.4cdn.org/image/favicon-ws.ico",NSFW:"//s.4cdn.org/image/favicon.ico",dead:"data:image/gif;base64,R0lGODlhEAAQAKECAAAAAP8AAP///////yH5BAEKAAIALAAAAAAQABAAAAIvlI+pq+D9DAgUoFkPDlbs7lFZKIJOJJ3MyraoB14jFpOcVMpzrnF3OKlZYsMWowAAOw==",logo:"data:image/png;base64,R0lGODlhEAAQAJEAAAAAAP///9vb2////yH5BAEAAAMALAAAAAAQABAAAAIvnI+pq+D9DBAUoFkPFnbs7lFZKIJOJJ3MyraoB14jFpOcVMpzrnF3OKlZYsMWowAAOw=="};const $={init(){
"yotsuba"!==i.SITE.software||n.cookie.indexOf("pass_enabled=1")>=0||(a["Force Noscript Captcha"]&&Pt.jsEnabled?x.ready(this.noscript):a.captchaLanguage.trim()&&(["boards.4chan.org","boards.4channel.org"].includes(location.hostname)?x.onExists(r,"#captchaFormPart",(e=>x.onExists(e,'iframe[src^="https://www.google.com/recaptcha/"]',this.iframe))):x.onExists(r,'iframe[src^="https://www.google.com/recaptcha/"]',this.iframe)))},noscript(){let e,t,o;if(!(t=x("#g-recaptcha"))||!(e=x("noscript",t.parentNode)))return;const a=x.el("span",{id:"captcha-forced-noscript"});x.replace(e,a),x.rm(t);const i=function(){a.innerHTML=e.textContent,this.iframe(x('iframe[src^="https://www.google.com/recaptcha/"]',a))};(o=x("#togglePostFormLink a, #form-link"))?x.on(o,"click",i):i()},iframe(e){let t;if(t=a.captchaLanguage.trim()){const o=/[?&]hl=/.test(e.src)?e.src.replace(/([?&]hl=)[^&]*/,"$1"+encodeURIComponent(t)):e.src+`&hl=${encodeURIComponent(t)}`;e.src!==o&&(e.src=o)}}},O={init(){
if(n.cookie.indexOf("pass_enabled=1")>=0)return;if(!(this.isEnabled=!!x("#t-root")||!x.id("postForm")))return;const e=x.el("div",{className:"captcha-root"});this.nodes={root:e},x.addClass(Me.nodes.el,"has-captcha","captcha-t"),x.after(Me.nodes.com.parentNode,e)},moreNeeded(){},getThread:()=>({boardID:i.BOARD.ID,threadID:"new"===Me.posts[0].thread?"0":""+Me.posts[0].thread}),setup(e){this.isEnabled&&(this.nodes.container||(this.nodes.container=x.el("div",{className:"captcha-container"}),x.prepend(this.nodes.root,this.nodes.container),O.currentThread=O.getThread(),O.currentThread.autoLoad=a["Auto-load captcha"]?"1":"0",x.global("setupTCaptcha",O.currentThread)),e&&x("#t-resp").focus())},destroy(){this.isEnabled&&this.nodes.container&&(x.global("destroyTCaptcha"),x.rm(this.nodes.container),delete this.nodes.container)},updateThread(){if(!this.isEnabled)return;const{boardID:e,threadID:t}=O.currentThread||{},o=O.getThread();o.boardID===e&&o.threadID===t||(O.destroy(),O.setup())},getOne(){
let e,t={};if(this.nodes.container)for(var o of["t-response","t-challenge"])t[o]=x(`[name='${o}']`,this.nodes.container).value;return t["t-response"]||(e=x("#t-msg"))&&/Verification not required/i.test(e.textContent)||(t=null),t},setUsed(){this.isEnabled&&this.nodes.container&&x.global("TCaptchaClearChallenge")},occupied(){return!!this.nodes.container}};class q{constructor(e,t,o=!1){if(this.changes=[],this.onSync=this.onSync.bind(this),this.key=e,this.initData(a[this.key]),x.sync(this.key,this.onSync),o||this.clean(),t){var i=()=>{x.off(n,"4chanXInitFinished",i),this.sync=t};x.on(n,"4chanXInitFinished",i)}}initData(e){let t;if(this.data=e,this.data.boards){let e;({boards:t,lastChecked:e}=this.data),this.data["4chan.org"]={boards:t,lastChecked:e},delete this.data.boards,delete this.data.lastChecked}return this.data[i.SITE.ID]||(this.data[i.SITE.ID]={boards:p()})}save(e,t){return e(),this.changes.push(e),x.get(this.key,{boards:p()},(o=>{if(!this.changes.length)return
;const a=(o[this.key].version||0)>(this.data.version||0);if(a)for(e of(this.initData(o[this.key]),this.changes))e();return this.changes=[],this.data.version=(this.data.version||0)+1,x.set(this.key,this.data,(()=>(a&&this.sync?.(),t?.())))}))}forceSync(e){return x.get(this.key,{boards:p()},(t=>{if((t[this.key].version||0)>(this.data.version||0)){for(var o of(this.initData(t[this.key]),this.changes))o();this.sync?.()}return e?.()}))}delete({siteID:e,boardID:t,threadID:o,postID:a},s){e||(e=i.SITE.ID),this.data[e]&&this.save((()=>{if(a){if(!this.data[e].boards[t]?.[o])return;delete this.data[e].boards[t][o][a],this.deleteIfEmpty({siteID:e,boardID:t,threadID:o})}else if(o){if(!this.data[e].boards[t])return;delete this.data[e].boards[t][o],this.deleteIfEmpty({siteID:e,boardID:t})}else delete this.data[e].boards[t]}),s)}deleteIfEmpty({siteID:e,boardID:t,threadID:o}){this.data[e]&&(o?Object.keys(this.data[e].boards[t][o]).length||(delete this.data[e].boards[t][o],this.deleteIfEmpty({siteID:e,
boardID:t})):Object.keys(this.data[e].boards[t]).length||delete this.data[e].boards[t])}set(e,t){this.save((()=>{this.setUnsafe(e)}),t)}setUnsafe({siteID:e,boardID:t,threadID:o,postID:a,val:s}){e||(e=i.SITE.ID),this.data[e]||(this.data[e]={boards:p()});const n=this.data[e].boards;if(void 0!==a){let e;((e=n[t]||(n[t]=p()))[o]||(e[o]=p()))[a]=s}else void 0!==o?(n[t]||(n[t]=p()))[o]=s:n[t]=s}extend({siteID:e,boardID:t,threadID:o,postID:a,val:i},s){this.save((()=>{const s=this.get({siteID:e,boardID:t,threadID:o,postID:a,defaultValue:p()});for(var n in i){var r=i[n];void 0===r?delete s[n]:s[n]=r}this.setUnsafe({siteID:e,boardID:t,threadID:o,postID:a,val:s})}),s)}setLastChecked(e="lastChecked"){this.save((()=>{this.data[e]=Date.now()}))}get({siteID:e,boardID:t,threadID:o,postID:a,defaultValue:s}){let n,r;if(e||(e=i.SITE.ID),n=this.data[e]?.boards[t]){let e;if(null==o)if(null!=a){for(e=0;e<n.length;e++)if(a in e){r=e[a];break}}else r=n;else(e=n[o])&&(r=null!=a?e[a]:e)}return r||s}clean(){
let e,t;const o=i.SITE.ID;for(e in this.data[o].boards)this.deleteIfEmpty({siteID:o,boardID:e});const a=Date.now();if(a-2*m>=(t=this.data[o].lastChecked||0)||t>a)for(e in this.data[o].lastChecked=a,this.data[o].boards)this.ajaxClean(e)}ajaxClean(e){const t=this,o=i.SITE.ID,a=i.SITE.urls.threadsListJSON?.({siteID:o,boardID:e});a&&x.cache(a,(function(){if(200!==this.status)return;const a=i.SITE.urls.archiveListJSON?.({siteID:o,boardID:e});if(!a)return t.ajaxCleanParse(e,this.response);const s=this.response;x.cache(a,(function(){(200===this.status||!i.SITE.archivedBoardsKnown&&404===this.status)&&t.ajaxCleanParse(e,s,this.response)}))}))}ajaxCleanParse(e,t,o){let a,s;const n=i.SITE.ID;if(!(a=this.data[n].boards[e]))return;const r=p();if(t)for(var l of t)for(var d of l.threads)s=d.no,s in a&&(r[s]=a[s]);if(o)for(s of o)s in a&&(r[s]=a[s]);this.data[n].boards[e]=r,this.deleteIfEmpty({siteID:n,boardID:e}),x.set(this.key,this.data)}onSync(e){
(e.version||0)<=(this.data.version||0)||(this.initData(e),this.sync?.())}}q.keys=["hiddenThreads","hiddenPosts","hiddenPosterIds","lastReadPosts","yourPosts","watchedThreads","watcherLastModified","customTitles"];class H{constructor(){this.keys=[]}push(e,t){this[e=`${e}`]||this.keys.push(e),this[e]=t}insert(e,t,o=(e,t)=>+e<+t){const a=e.toString();if(a in this)return this[a]=t,this.keys.indexOf(a);const i=this.keys.length;if(!i||o(this.lastKey(),e))return this.push(e,t),i;let s=this.keys.findIndex((t=>!o(t,e)));return-1===s?this.push(e,t):(this[a]=t,this.keys.splice(s,0,a)),s}insertAt(e,t,o){this[e]=o,this.keys.splice(t,0,e)}rm(e){let t;e=`${e}`,-1!==(t=this.keys.indexOf(e))&&(this.keys.splice(t,1),delete this[e])}forEach(e){for(var t of this.keys)e(this[t])}get(e){return"keys"===e?void 0:x.getOwn(this,e)}lastKey(){return this.keys[this.keys.length-1]}last(){return this.keys.length?this[this.keys.length-1]:void 0}}class j{toString(){return this.ID}constructor(e,t){this.board=t,
this.ID=+e,this.threadID=this.ID,this.boardID=this.board.ID,this.siteID=i.SITE.ID,this.fullID=`${this.board}.${this.ID}`,this.posts=new H,this.isDead=!1,this.isHidden=!1,this.isSticky=!1,this.isClosed=!1,this.isArchived=!1,this.postLimit=!1,this.fileLimit=!1,this.lastPost=0,this.ipCount=void 0,this.json=null,this.OP=null,this.catalogView=null,this.nodes={root:null},this.board.threads.push(this.ID,this),i.threads.push(this.fullID,this)}setPage(e){let t;const{info:o,reply:a}=this.OP.nodes;if((t=x(".page-num",o))||(t=x.el("span",{className:"page-num"}),x.replace(a.parentNode.previousSibling,[x.tn(" "),t,x.tn(" ")])),t.title=`This thread is on page ${e} in the original index.`,t.textContent=`[${e}]`,this.catalogView)return this.catalogView.nodes.pageCount.textContent=e}setCount(e,t,o){if(!this.catalogView)return;const a=this.catalogView.nodes[`${e}Count`];return a.textContent=t,(o?x.addClass:x.rmClass)(a,"warning")}setStatus(e,t){const o=`is${e}`;if(this[o]!==t&&(this[o]=t,
this.OP))return this.setIcon("Sticky",this.isSticky),this.setIcon("Closed",this.isClosed&&!this.isArchived),this.setIcon("Archived",this.isArchived)}setIcon(e,t){const o=e.toLowerCase();let a=x(`.${o}Icon`,this.OP.nodes.info);if(!!a===t)return;if(!t)return x.rm(a.previousSibling),x.rm(a),void(this.catalogView&&x.rm(x(`.${o}Icon`,this.catalogView.nodes.icons)));a=x.el("img",{src:`${i.SITE.Build.staticPath}${o}${i.SITE.Build.gifIcon}`,alt:e,title:e,className:`${o}Icon retina`}),"f"===i.BOARD.ID&&(a.style.cssText="height: 18px; width: 18px;");const s="Sticky"!==e&&this.isSticky?x(".stickyIcon",this.OP.nodes.info):x(".page-num",this.OP.nodes.info)||this.OP.nodes.quote;return x.after(s,[x.tn(" "),a]),this.catalogView?("Sticky"===e&&this.isClosed?x.prepend:x.add)(this.catalogView.nodes.icons,a.cloneNode()):void 0}kill(){return this.isDead=!0}collect(){let e=0;if(this.posts.forEach((function(t){return t.clones.length?e++:t.collect()})),!e)return i.threads.rm(this.fullID),
this.board.threads.rm(this)}}class U{toString(){return this.ID}constructor(e,t){this.thread=t,this.ID=this.thread.ID,this.board=this.thread.board;const{post:o}=this.thread.OP.nodes;this.nodes={root:e,thumb:x(".catalog-thumb",o),icons:x(".catalog-icons",o),postCount:x(".post-count",o),fileCount:x(".file-count",o),pageCount:x(".page-count",o),replies:null},this.thread.catalogView=this}}var V=function(){let e,t;return V=class{static initClass(){e=null,t=null}constructor(e){this.setPosition=this.setPosition.bind(this),this.close=this.close.bind(this),this.keybinds=this.keybinds.bind(this),this.onFocus=this.onFocus.bind(this),this.addEntry=this.addEntry.bind(this),this.type=e,x.on(n,"AddMenuEntry",(({detail:e})=>{if(e.type===this.type)return delete e.open,this.addEntry(e)})),this.entries=[]}makeMenu(){const e=x.el("div",{className:"dialog",id:"menu",tabIndex:0});return e.dataset.type=this.type,x.on(e,"click",(e=>e.stopPropagation())),x.on(e,"keydown",this.keybinds),e}toggle(o,a,i){
if(o.preventDefault(),o.stopPropagation(),e){const o=t;if(e.close(),o===a)return}if(this.entries.length)return this.open(a,i)}open(o,a){let i;const s=this.menu=this.makeMenu();for(i of(e=this,t=o,this.entries.sort(((e,t)=>e.order-t.order)),this.entries))this.insertEntry(i,s,a);return x.addClass(t,"active"),x.on(n,"click CloseMenu",this.close),x.on(n,"scroll",this.setPosition),x.on(window,"resize",this.setPosition),x.after(o,s),this.setPosition(),i=x(".entry",s),this.focus(i),s.focus()}setPosition(){const e=this.menu.getBoundingClientRect(),o=t.getBoundingClientRect(),a=r.clientHeight,i=r.clientWidth,[s,n]=o.top+o.height+e.height<a?[`${o.bottom}px`,""]:["",a-o.top+"px"],[l,d]=o.left+e.width<i?[`${o.left}px`,""]:["",i-o.right+"px"];return x.extend(this.menu.style,{top:s,right:d,bottom:n,left:l}),this.menu.classList.toggle("left",d)}insertEntry(e,t,o){let a;if("function"==typeof e.open)try{if(!e.open(o))return}catch(e){return void Pt.handleErrors({
message:`Error in building the ${this.type} menu.`,error:e})}if(x.add(t,e.el),e.subEntries){for(var i of((a=x(".submenu",e.el))&&x.rm(a),a=x.el("div",{className:"dialog submenu"}),e.subEntries))this.insertEntry(i,a,o);x.add(e.el,a)}}close(){return x.rm(this.menu),delete this.menu,x.rmClass(t,"active"),e=null,t=null,x.off(n,"click scroll CloseMenu",this.close),x.off(n,"scroll",this.setPosition),x.off(window,"resize",this.setPosition)}findNextEntry(e,t){const o=[...e.parentNode.children];return o.sort(((e,t)=>e.style.order-t.style.order)),o[o.indexOf(e)+t]}keybinds(e){let o,a,i,s=x(".focused",this.menu);for(;o=x(".focused",s);)s=o;switch(e.keyCode){case 27:t.focus(),this.close();break;case 13:case 32:s.click();break;case 38:(a=this.findNextEntry(s,-1))&&this.focus(a);break;case 40:(a=this.findNextEntry(s,1))&&this.focus(a);break;case 39:if((i=x(".submenu",s))&&(a=i.firstElementChild)){let e;for(;e=this.findNextEntry(a,-1);)a=e;this.focus(a)}break;case 37:
(a=x.x('parent::*[contains(@class,"submenu")]/parent::*',s))&&this.focus(a);break;default:return}return e.preventDefault(),e.stopPropagation()}onFocus(e){return e.stopPropagation(),this.focus(e.target)}focus(e){let t,o;for(;t=x.x('parent::*/child::*[contains(@class,"focused")]',e);)x.rmClass(t,"focused");for(t of S(".focused",e))x.rmClass(t,"focused");if(x.addClass(e,"focused"),!(o=x(".submenu",e)))return;const a=o.getBoundingClientRect(),i=e.getBoundingClientRect(),s=r.clientHeight,n=r.clientWidth,[l,d]=i.top+a.height<s?["0px","auto"]:["auto","0px"],[c,h]=i.right+a.width<n-150?["100%","auto"]:["auto","100%"],{style:u}=o;return u.top=l,u.bottom=d,u.left=c,u.right=h}addEntry(e){return this.parseEntry(e),this.entries.push(e)}parseEntry(e){const{el:t,subEntries:o}=e;if(x.addClass(t,"entry"),x.on(t,"focus mouseover",this.onFocus),t.style.order=e.order||100,o)for(var a of(x.addClass(t,"has-submenu"),o))this.parseEntry(a)}},V.initClass(),V}(),Q=function(e){let t
;if("mousedown"===e.type&&0!==e.button)return;e.preventDefault(),(t="touchstart"===e.type)&&(e=e.changedTouches[e.changedTouches.length-1]);const o=x.x('ancestor::div[contains(@class,"dialog")][1]',this),i=o.getBoundingClientRect(),s=r.clientHeight,l=r.clientWidth,d={id:o.id,style:o.style,dx:e.clientX-i.left,dy:e.clientY-i.top,height:s-i.height,width:l-i.width,screenHeight:s,screenWidth:l,isTouching:t};return[d.topBorder,d.bottomBorder]=a["Header auto-hide"]||!a["Fixed Header"]?[0,0]:a["Bottom Header"]?[0,Ye.bar.getBoundingClientRect().height]:[Ye.bar.getBoundingClientRect().height,0],t?(d.identifier=e.identifier,d.move=z.bind(d),d.up=J.bind(d),x.on(n,"touchmove",d.move),x.on(n,"touchend touchcancel",d.up)):(d.move=W.bind(d),d.up=G.bind(d),x.on(n,"mousemove",d.move),x.on(n,"mouseup",d.up))},z=function(e){for(var t of e.changedTouches)if(t.identifier===this.identifier)return void W.call(this,t)},W=function(e){const{clientX:t,clientY:o}=e;let a=t-this.dx
;a=a<10?0:this.width-a<10?"":a/this.screenWidth*100+"%";let i=o-this.dy;i=i<10+this.topBorder?this.topBorder+"px":this.height-i<10+this.bottomBorder?"":i/this.screenHeight*100+"%";const s=""===a?0:"",n=""===i?this.bottomBorder+"px":"",{style:r}=this;r.left=a,r.right=s,r.top=i,r.bottom=n},J=function(e){for(var t of e.changedTouches)if(t.identifier===this.identifier)return void G.call(this)},G=function(){if(this.isTouching?(x.off(n,"touchmove",this.move),x.off(n,"touchend touchcancel",this.up)):(x.off(n,"mousemove",this.move),x.off(n,"mouseup",this.up)),2===this.style.length)x.set(`${this.id}.position`,this.style.cssText);else{const{left:e,right:t,top:o,bottom:a}=this.style;let i="";e&&(i+=`left:${e};`),t&&(i+=`right:${t};`),o&&(i+=`top:${o};`),a&&(i+=`bottom:${a};`),x.set(`${this.id}.position`,i)}};const _=function({root:e,el:t,latestEvent:o,endEvents:a,height:i,width:s,cb:l,noRemove:d}){const c=e.getBoundingClientRect(),h={root:e,el:t,style:t.style,
isImage:["IMG","VIDEO"].includes(t.nodeName),cb:l,endEvents:a,latestEvent:o,clientHeight:r.clientHeight,clientWidth:r.clientWidth,height:i,width:s,noRemove:d,clientX:(c.left+c.right)/2,clientY:(c.top+c.bottom)/2};return h.hover=Y.bind(h),h.hoverend=K.bind(h),h.hover(h.latestEvent),new MutationObserver((function(){if(t.parentNode)return h.hover(h.latestEvent)})).observe(t,{childList:!0}),x.on(e,a,h.hoverend),x.x('ancestor::div[contains(@class,"inline")][1]',e)&&x.on(n,"keydown",h.hoverend),x.on(e,"mousemove",h.hover),h.workaround=function(t){if(!e.contains(t.target))return h.hoverend(t)},x.on(r,"mousemove",h.workaround)};_.padding=25;var Y=function(e){this.latestEvent=e;const t=(this.height||this.el.offsetHeight)+_.padding,o=this.width||this.el.offsetWidth,{clientX:i,clientY:s}=a["Follow Cursor"]?e:this,n=this.isImage?Math.max(0,s*(this.clientHeight-t)/this.clientHeight):Math.max(0,Math.min(this.clientHeight-t,s-120));let r=this.clientWidth/2
;this.isImage||(r=Math.max(r,this.clientWidth-400));let l=(i<=r?i:this.clientWidth-i)+45;this.isImage&&(l=Math.min(l,this.clientWidth-o)),l+="px";const[d,c]=i<=r?[l,""]:["",l],{style:h}=this;return h.top=n+"px",h.left=d,h.right=c},K=function(e){if(("keydown"!==e.type||13===e.keyCode)&&"TEXTAREA"!==e.target.nodeName)return this.noRemove||x.rm(this.el),x.off(this.root,this.endEvents,this.hoverend),x.off(n,"keydown",this.hoverend),x.off(this.root,"mousemove",this.hover),x.off(r,"mousemove",this.workaround),this.cb?this.cb.call(this):void 0};const X={dialog:function(e,t){const o=x.el("div",{className:"dialog",id:e});x.extend(o,t),o.style.cssText=a[`${e}.position`];const i=x(".move",o);for(var s of(x.on(i,"touchstart mousedown",Q),i.children))s.tagName&&x.on(s,"touchstart mousedown",(e=>e.stopPropagation()));return o},Menu:V,hover:_,checkbox:function(e,t,o){null==o&&(o=a[e]);const i=x.el("label"),s=x.el("input",{type:"checkbox",name:e,checked:o});return x.add(i,[s,x.tn(` ${t}`)]),i}}
;var Z={init(){switch(i.VIEW){case"index":if(!a["Index Navigation"])return;break;case"thread":if(!a["Reply Navigation"])return;break;default:return}const e=x.el("span",{id:"navlinks"}),t=x.el("a",{textContent:"▲",href:"javascript:;"}),o=x.el("a",{textContent:"▼",href:"javascript:;"});x.on(t,"click",this.prev),x.on(o,"click",this.next),x.add(e,[t,x.tn(" "),o]);var s=function(){return x.off(n,"4chanXInitFinished",s),x.add(n.body,e)};return x.on(n,"4chanXInitFinished",s)},prev:()=>"thread"===i.VIEW?window.scrollTo(0,0):Z.scroll(-1),next:()=>"thread"===i.VIEW?window.scrollTo(0,n.body.scrollHeight):Z.scroll(1),getThread(){if("thread"===i.VIEW)return i.threads.get(`${i.BOARD}.${i.THREADID}`).nodes.root;if(!x.hasClass(r,"catalog-mode"))for(var e of S(i.SITE.selectors.thread)){var t=w.threadFromRoot(e);if((!t.isHidden||t.stub)&&Ye.getTopOf(e)>=-e.getBoundingClientRect().height)return e}},scroll(e){let t;n.activeElement?.blur();let o=Z.getThread();if(!o)return
;if(t=x.x(`${1===e?"following":"preceding"}-sibling::${i.SITE.xpath.thread}[not(@hidden)][1]`,o)){const a=Ye.getTopOf(o);(1===e&&a<5||-1===e&&a>-5)&&(o=t)}const a=Ye.getTopOf(o)+r.clientHeight-n.body.getBoundingClientRect().bottom;return a>0&&(n.body.style.marginBottom=`${a}px`),Ye.scrollTo(o),a>0&&!Z.haveExtra?(Z.haveExtra=!0,x.on(n,"scroll",Z.removeExtra)):void 0},removeExtra(){const e=r.clientHeight-n.body.getBoundingClientRect().bottom;return e>0?n.body.style.marginBottom=`${e}px`:(n.body.style.marginBottom="",delete Z.haveExtra,x.off(n,"scroll",Z.removeExtra))}},ee={init(){if(!["index","thread"].includes(i.VIEW)||!a["Image Expansion"]&&!a["Image Hover"]&&!a["Image Hover in Catalog"]&&!a.Gallery)return;if(x.sync("Allow Sound",(function(e){a["Allow Sound"]=e,ee.inputs&&(ee.inputs.unmute.checked=e)})),x.sync("Default Volume",(function(e){a["Default Volume"]=e,ee.inputs&&(ee.inputs.volume.value=e)})),a["Mouse Wheel Volume"]&&c.Post.push({name:"Mouse Wheel Volume",cb:this.node}),
i.SITE.noAudio?.(i.BOARD))return;a["Mouse Wheel Volume"]&&c.CatalogThread.push({name:"Mouse Wheel Volume",cb:this.catalogNode});const e=X.checkbox("Allow Sound","Allow Sound");e.title=h.main["Images and Videos"]["Allow Sound"][1];const t=x.el("label",{title:"Default volume for videos."});return x.extend(t,{innerHTML:'<input name="Default Volume" type="range" min="0" max="1" step="0.01" value="'+s(a["Default Volume"])+'"> Volume'}),this.inputs={unmute:e.firstElementChild,volume:t.firstElementChild},x.on(this.inputs.unmute,"change",x.cb.checked),x.on(this.inputs.volume,"change",x.cb.value),Ye.menu.addEntry({el:e,order:200}),Ye.menu.addEntry({el:t,order:201})},setup:e=>(e.muted=!a["Allow Sound"],e.volume=a["Default Volume"],x.on(e,"volumechange",ee.change)),change(){const{muted:e,volume:t}=this,o={"Allow Sound":!e,"Default Volume":t};for(var i in o){var s=o[i];a[i]===s&&delete o[i]}if(x.set(o),x.extend(a,o),ee.inputs)return ee.inputs.unmute.checked=!e,ee.inputs.volume.value=t},node(){
if(!i.SITE.noAudio?.(this.board))for(var e of this.files)e.isVideo&&(e.thumb&&x.on(e.thumb,"wheel",ee.wheel.bind(Ye.hover)),x.on(x(".file-info",e.text)||e.link,"wheel",ee.wheel.bind(e.thumbLink)))},catalogNode(){const e=this.thread.OP.files[0];if(e?.isVideo)return x.on(this.nodes.thumb,"wheel",ee.wheel.bind(Ye.hover))},wheel(e){let t;if(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey)return;if(!(t=x("video:not([data-md5])",this)))return;if(t.muted||!x.hasAudio(t))return;let o=t.volume+.1;return e.deltaY<0&&(o*=1.1),e.deltaY>0&&(o/=1.1),t.volume=x.minmax(o-.1,0,1),e.preventDefault()}};const te={setupSync(e,t){t.addEventListener("playing",(()=>{e.currentTime=t.currentTime%e.duration,e.play()})),t.addEventListener("play",(()=>{e.currentTime=t.currentTime%e.duration,e.play()})),t.addEventListener("pause",(()=>{e.pause()})),t.addEventListener("seeked",(()=>{e.currentTime=t.currentTime%e.duration})),t.addEventListener("ratechange",(()=>{e.currentTime=t.currentTime,e.playbackRate=t.playbackRate
})),t.addEventListener("waiting",(()=>{e.currentTime=t.currentTime%e.duration,e.pause()})),t.addEventListener("canplay",(()=>{t.currentTime<.1&&(e.currentTime=0)}),{once:!0})}};var oe={init(){if(this.enabled=a["Image Expansion"]&&["index","thread"].includes(i.VIEW))return this.EAI=x.el("a",{className:"expand-all-shortcut",title:"Expand All Images",href:"javascript:;"}),M.set(this.EAI,"expand","Expand All Images"),x.on(this.EAI,"click",this.cb.toggleAll),Ye.addShortcut("expand-all",this.EAI,520),x.on(n,"scroll visibilitychange",this.cb.playVideos),this.videoControls=x.el("span",{className:"video-controls"}),x.extend(this.videoControls,{innerHTML:' <a href="javascript:;" title="You can also contract the video by dragging it to the left.">contract</a>'}),c.Post.push({name:"Image Expansion",cb:this.node})},node(){if(this.file&&(this.file.isImage||this.file.isVideo))if(x.on(this.file.thumbLink,"click",oe.cb.toggle),this.isClone){if(this.file.isExpanding)return oe.contract(this),
oe.expand(this);if(this.file.isExpanded&&this.file.isVideo)return ee.setup(this.file.fullImage),oe.setupVideoCB(this),oe.setupVideo(this,!this.origin.file.fullImage?.paused||this.origin.file.wasPlaying,this.file.fullImage.controls)}else if(oe.on&&!this.isHidden&&!this.isFetchedQuote&&(a["Expand spoilers"]||!this.file.isSpoiler)&&(a["Expand videos"]||!this.file.isVideo))return oe.expand(this)},cb:{toggle(e){if(x.modifiedClick(e))return;const t=w.postFromNode(this),{file:o}=t;return o.isExpanded&&$e.onControls(e)?void 0:(e.preventDefault(),!a.Autoplay&&o.fullImage?.paused?o.fullImage.play():oe.toggle(t))},toggleAll(){let e;x.event("CloseMenu");const t=Z.getThread(),o=function(o){const{file:s}=o;if(s&&(s.isImage||s.isVideo)&&r.contains(o.nodes.root)&&(!oe.on||!(!a["Expand spoilers"]&&s.isSpoiler||!a["Expand videos"]&&s.isVideo||a["Expand from here"]&&Ye.getTopOf(s.thumb)<0||a["Expand thread only"]&&"index"===i.VIEW&&!t?.contains(s.thumb))))return x.queueTask(e,o)}
;return(oe.on=x.hasClass(oe.EAI,"expand-all-shortcut"))?(oe.EAI.className="contract-all-shortcut",oe.EAI.title="Contract All Images",M.set(oe.EAI,"shrink","Contract All Images"),e=oe.expand):(oe.EAI.className="expand-all-shortcut",oe.EAI.title="Expand All Images",M.set(oe.EAI,"expand","Expand All Images"),e=oe.contract),i.posts.forEach((function(e){for(e of[e,...e.clones])o(e)}))},playVideos:()=>i.posts.forEach((function(e){for(e of[e,...e.clones]){var{file:t}=e;if(t&&t.isVideo&&t.isExpanded){var o=t.fullImage,a=x.hasAudio(o)&&!o.muted||Ye.isNodeVisible(o);a&&t.wasPlaying?(delete t.wasPlaying,o.play()):a||o.paused||(t.wasPlaying=!0,o.pause())}}})),setFitness(){return x[this.checked?"addClass":"rmClass"](r,this.name.toLowerCase().replace(/\s+/g,"-"))}},toggle(e){if(!e.file.isExpanding&&!e.file.isExpanded)return e.file.scrollIntoView=a["Scroll into view"],void oe.expand(e);if(oe.contract(e),a["Advance on contract"]){let t=e.nodes.root
;for(;(t=x.x("following::div[contains(@class,'postContainer')][1]",t))&&(x(".stub",t)||0===t.offsetHeight););if(t)return Ye.scrollTo(t)}},contract(e){let t,o,i,s;const{file:l}=e;if(o=l.fullImage){t=Ye.getTopOf(o)+o.getBoundingClientRect().height,i=n.body.clientHeight,({scrollY:s}=window)}for(var d of(x.rmClass(e.nodes.root,"expanded-image"),x.rmClass(l.thumb,"expanding"),x.rm(l.videoControls),l.thumbLink.href=l.url,l.thumbLink.target="_blank",["isExpanding","isExpanded","videoControls","wasPlaying","scrollIntoView"]))delete l[d];if(o){if(r.contains(o)&&(t<=0?window.scrollBy(0,s-window.scrollY+n.body.clientHeight-i):Ye.scrollToIfNeeded(e.nodes.root),window.scrollX>0&&window.scrollBy(-window.scrollX,0)),x.off(o,"error",oe.error),$e.pushCache(o),l.isVideo)for(var c in $e.pause(o),oe.videoCB){var h=oe.videoCB[c];x.off(o,c,h)}a["Restart when Opened"]&&$e.rewind(l.thumb),delete l.fullImage,x.queueTask((function(){if(!l.isExpanding&&!l.isExpanded&&(x.rmClass(o,"full-image"),
!o.id))return x.rm(o)})),l.audio&&(l.audio.remove(),delete l.audio,l.audioSlider&&(l.audioSlider.remove(),delete l.audioSlider))}},expand(e,t){const{file:o}=e,{thumb:i,thumbLink:s,isVideo:n}=o;if(e.isHidden||o.isExpanding||o.isExpanded)return;let r;if(x.addClass(i,"expanding"),o.isExpanding=!0,o.fullImage?r=o.fullImage:$e.cache?.dataset.fileID===`${e.fullID}.${o.index}`?(r=o.fullImage=$e.popCache(),x.on(r,"error",oe.error),a["Restart when Opened"]&&"ihover"!==r.id&&$e.rewind(r),r.removeAttribute("id")):(r=o.fullImage=x.el(n?"video":"img"),r.dataset.fileID=`${e.fullID}.${o.index}`,x.on(r,"error",oe.error),r.src=t||o.url),r.className="full-image",x.after(i,r),n&&(o.videoControls||(o.videoControls=oe.videoControls.cloneNode(!0),x.add(o.text,o.videoControls)),s.removeAttribute("href"),s.removeAttribute("target"),r.loop=!0,ee.setup(r),oe.setupVideoCB(e)),
n?r.readyState>=r.HAVE_METADATA?oe.completeExpand(e):x.on(r,"loadedmetadata",(()=>oe.completeExpand(e))):x.asap((()=>r.naturalHeight),(()=>oe.completeExpand(e))),a["Enable sound posts"]&&a["Allow Sound"]){const e=o.name.match(/\[sound=([^\]]+)]/i);if(e){let t=decodeURIComponent(e[1]);t.startsWith("http")||(t=`https://${t}`);const i=x.el("audio",{src:t});ee.setup(i),n&&(te.setupSync(r,i),r.controls=!1),i.loop=!0,i.controls=a["Show Controls"],i.autoplay=a.Autoplay,x.after(r,i),o.audio=i}}},completeExpand(e){const{file:t}=e;if(!t.isExpanding)return;const o=Ye.getTopOf(t.thumb)+t.thumb.getBoundingClientRect().height,i=n.body.clientHeight,{scrollY:s}=window;if(x.addClass(e.nodes.root,"expanded-image"),x.rmClass(t.thumb,"expanding"),t.isExpanded=!0,delete t.isExpanding,r.contains(e.nodes.root)&&o<=0&&window.scrollBy(0,s-window.scrollY+n.body.clientHeight-i),t.scrollIntoView){delete t.scrollIntoView
;const e=Math.min(r.clientHeight-t.fullImage.getBoundingClientRect().bottom-25,Ye.getBottomOf(t.fullImage));e<0&&window.scrollBy(0,Math.min(-e,Ye.getTopOf(t.fullImage)))}return t.isVideo?oe.setupVideo(e,a.Autoplay,a["Show Controls"]):void 0},setupVideo(e,t,o){const{audio:a}=e.file,i=e.file.fullImage;t||a?(i.controls=!1,x.asap((()=>r.contains(i)),(function(){!n.hidden&&Ye.isNodeVisible(i)?i.play():e.file.wasPlaying=!0})),i.controls=o&&!a):i.controls=o},videoCB:function(){let e=!1;return{mouseover:()=>e=!1,mousedown(t){if(0===t.button)return e=!0},mouseup(t){if(0===t.button)return e=!1},mouseout(t){if((1&t.buttons||e)&&t.clientX<=this.getBoundingClientRect().left)return oe.toggle(w.postFromNode(this))}}}(),setupVideoCB(e){for(var t in oe.videoCB){var o=oe.videoCB[t];x.on(e.file.fullImage,t,o)}if(e.file.videoControls)return x.on(e.file.videoControls.firstElementChild,"click",(()=>oe.toggle(e)))},error(){const e=w.postFromNode(this);if(x.rm(this),delete e.file.fullImage,
e.file.isExpanding||e.file.isExpanded)return $e.decodeError(this,e.file)||$e.isFromArchive(this)?oe.contract(e):$e.error(this,e,e.file,1e4,(function(t){if((e.file.isExpanding||e.file.isExpanded)&&(oe.contract(e),t))return oe.expand(e,t)}))},menu:{init(){if(!oe.enabled)return;const e=x.el("span",{textContent:"Image Expansion",className:"image-expansion-link"}),{createSubEntry:t}=oe.menu,o=[];for(var a in h.imageExpansion){var i=h.imageExpansion[a];o.push(t(a,i[1]))}return Ye.menu.addEntry({el:e,order:105,subEntries:o})},createSubEntry(e,t){const o=X.checkbox(e,e);o.title=t;const a=o.firstElementChild;return["Fit width","Fit height"].includes(e)&&x.on(a,"change",oe.cb.setFitness),x.event("change",null,a),x.on(a,"change",x.cb.checked),{el:o}}}};class ae{toString(){return this.ID}constructor(e,t,o,s={}){if(void 0===e&&void 0===t&&void 0===o)return;if(this.root=e,this.thread=t,this.board=o,x.extend(this,s),this.ID=+e.id.match(/\d*$/)[0],this.postID=this.ID,this.threadID=this.thread.ID,
this.boardID=this.board.ID,this.siteID=i.SITE.ID,this.fullID=`${this.board}.${this.ID}`,this.context=this,this.isReply=this.ID!==this.threadID,e.dataset.fullID=this.fullID,this.nodes=this.parseNodes(e),!this.isReply){for(var n of(this.thread.OP=this,["isSticky","isClosed","isArchived"])){var r;(r=i.SITE.selectors.icons[n])&&(this.thread[n]=!!x(r,this.nodes.info))}this.thread.isArchived&&(this.thread.isClosed=!0,this.thread.kill())}const l=this.nodes.name?.textContent,d=this.nodes.tripcode?.textContent;if(this.info={subject:this.nodes.subject?.textContent||void 0,name:l,email:this.nodes.email?decodeURIComponent(this.nodes.email.href.replace(/^mailto:/,"")):void 0,tripcode:d,uniqueID:this.nodes.uniqueID?.textContent,capcode:this.nodes.capcode?.textContent.replace("## ",""),pass:this.nodes.pass?.title.match(/\d*$/)[0],flagCode:this.nodes.flag?.className.match(/flag-(\w+)/)?.[1].toUpperCase(),flagCodeTroll:this.nodes.flag?.className.match(/bfl-(\w+)/)?.[1].toUpperCase(),
flag:this.nodes.flag?.title,date:this.nodes.date?i.SITE.parseDate(this.nodes.date):void 0,nameBlock:a.Anonymize?"Anonymous":`${l||""} ${d||""}`.trim()},this.info.capcode&&(this.info.nameBlock+=` ## ${this.info.capcode}`),this.info.uniqueID&&(this.info.nameBlock+=` (ID: ${this.info.uniqueID})`),this.parseComment(),this.parseQuotes(),this.parseFiles(),this.isDead=!1,this.isHidden=!1,this.clones=[],i.posts.get(this.fullID))for(var c of(this.isRebuilt=!0,this.clones=i.posts.get(this.fullID).clones,this.clones))c.origin=this;!this.isFetchedQuote&&this.ID>this.thread.lastPost&&(this.thread.lastPost=this.ID),this.ID<this.thread.lastPost&&"thread"===i.VIEW?(this.board.posts.insert(this.ID,this),this.thread.posts.insert(this.ID,this),i.posts.insert(this.fullID,this,(e=>+e.split(".")[1]<this.ID))):(this.board.posts.push(this.ID,this),this.thread.posts.push(this.ID,this),i.posts.push(this.fullID,this))}parseNodes(e){const t=i.SITE.selectors,o=x(t.post,e)||e,a=x(t.infoRoot,o),s={root:e,
bottom:this.isReply||!i.SITE.isOPContainerThread?e:x(t.opBottom,e),post:o,info:a,comment:x(t.comment,o),quotelinks:[],archivelinks:[],embedlinks:[],backlinks:o.getElementsByClassName("backlink"),uniqueIDRoot:void 0,uniqueID:void 0};for(var n in t.info){var r=t.info[n];s[n]=x(r,a)}return i.SITE.parseNodes?.(this,s),s.uniqueIDRoot||(s.uniqueIDRoot=s.uniqueID),s}parseComment(){let e;return this.nodes.comment.normalize(),this.nodes.commentClean=e=this.nodes.comment.cloneNode(!0),i.SITE.cleanComment?.(e),this.info.comment=this.nodesToText(e)}commentDisplay(){const e=this.nodes.commentClean.cloneNode(!0);return a["Remove Spoilers"]||a["Reveal Spoilers"]||this.cleanSpoilers(e),i.SITE.cleanCommentDisplay?.(e),this.nodesToText(e).trim().replace(/\s+$/gm,"")}commentOrig(){const e=this.nodes.commentClean.cloneNode(!0);return i.SITE.insertTags?.(e),this.nodesToText(e)}nodesToText(e){let t,o="";const a=x.X(".//br|.//text()",e);let i=0;for(;t=a.snapshotItem(i++);)o+=t.data||"\n";return o}
cleanSpoilers(e){const t=S(i.SITE.selectors.spoiler,e);for(var o of t)x.replace(o,x.tn("[spoiler]"))}parseQuotes(){for(var e of(this.quotes=[],S(i.SITE.selectors.quotelink,this.nodes.comment)))this.parseQuote(e)}parseQuote(e){const t=e.href.match(i.SITE.regexp.quotelink);if(!(t||this.isClone&&e.dataset.postID))return;if(this.nodes.quotelinks.push(e),this.isClone)return;const o=`${t[1]}.${t[3]}`;this.quotes.includes(o)||this.quotes.push(o)}parseFiles(){let e;this.files=[];const t=this.fileRoots();let o=0;for(let i=0;i<t.length;i++){var a=t[i];(e=this.parseFile(a))&&(e.index=o++,e.docIndex=i,this.files.push(e))}if(this.files.length)return this.file=this.files[0]}fileRoots(){if(i.SITE.selectors.multifile){const e=S(i.SITE.selectors.multifile,this.nodes.root);if(e.length)return e}return[this.nodes.root]}parseFile(e){const t={isDead:!1};for(var o in i.SITE.selectors.file){var a=i.SITE.selectors.file[o];t[o]=x(a,e)}if(t.thumbLink=t.thumb?.parentNode,!t.text||!t.link)return
;if(!i.SITE.parseFile(this,t))return;x.extend(t,{url:t.link.href,isImage:x.isImage(t.link.href),isVideo:x.isVideo(t.link.href)});let s=+t.size.match(/[\d.]+/)[0],n=["B","KB","MB","GB"].indexOf(t.size.match(/\w+$/)[0]);for(;n-- >0;)s*=1024;return t.sizeInBytes=s,t}kill(e=!1,t=0){let o;if(e){if(this.isDead||this.files[t].isDead)return;this.files[t].isDead=!0,x.addClass(this.nodes.root,"deleted-file")}else{if(this.isDead)return;this.isDead=!0,x.rmClass(this.nodes.root,"deleted-file"),x.addClass(this.nodes.root,"deleted-post")}if((o=x("strong.warning",this.nodes.info))||(o=x.el("strong",{className:"warning"}),x.after(x("input",this.nodes.info),o)),o.textContent=e?"[File deleted]":"[Deleted]",!this.isClone){for(var a of this.clones)a.kill(e,t);if(!e)for(var i of w.allQuotelinksLinkingTo(this))x.hasClass(i,"deadlink")||(x.add(i,ae.deadMark.cloneNode(!0)),x.addClass(i,"deadlink"))}}markAsFromArchive(){let e=x("strong.warning",this.nodes.info);if(e||(e=x.el("strong",{className:"warning"}),
x.after(x("input",this.nodes.info),e)),e.textContent="[Deleted, restored from external archive]",x.addClass(this.nodes.root,"from-archive"),!this.isClone){for(var t of this.clones)t.markAsFromArchive();for(var o of w.allQuotelinksLinkingTo(this))x.addClass(o,"from-archive-link")}}resurrect(){this.isDead=!1,x.rmClass(this.nodes.root,"deleted-post","from-archive");const e=x("strong.warning",this.nodes.info);if(this.files.some((e=>e.isDead))?(x.addClass(this.nodes.root,"deleted-file"),e.textContent="[File deleted]"):x.rm(e),!this.isClone){for(var t of this.clones)t.resurrect();for(var o of w.allQuotelinksLinkingTo(this))x.hasClass(o,"deadlink")&&x.rm(x(".qmark-dead",o)),x.rmClass(o,"deadlink","from-archive-link")}}collect(){i.posts.rm(this.fullID),this.thread.posts.rm(this),this.board.posts.rm(this)}addClone(e,t){return c.Post.execute(this),new ie(this,e,t)}rmClone(e){for(var t of(this.clones.splice(e,1),this.clones.slice(e)))t.nodes.root.dataset.clone=e++}setCatalogOP(e){
this.nodes.root.classList.toggle("catalog-container",e),this.nodes.root.classList.toggle("opContainer",!e),this.nodes.post.classList.toggle("catalog-post",e),this.nodes.post.classList.toggle("op",!e),this.nodes.post.style.left=this.nodes.post.style.right=null}}ae.deadMark=(()=>{const e=document.createElement("span");return e.textContent=" (Dead)",e.className="qmark-dead",e})();class ie extends ae{constructor(e,t,o){let a,s,n;for(n of(super(),this.isClone=!0,this.origin=e,this.context=t,["ID","postID","threadID","boardID","siteID","fullID","board","thread","info","quotes","isReply"]))this[n]=this.origin[n];const{nodes:r}=this.origin,l=o?this.cloneWithoutVideo(r.root):r.root.cloneNode(!0);for(var d of[l,...S("[id]",l)])d.id+=`_${ie.suffix}`;for(var c of(ie.suffix++,S(".inline",l)))x.rm(c);for(var h of S(".inlined",l))x.rmClass(h,"inlined");for(var u of(this.nodes=this.parseNodes(l),l.hidden=!1,x.rmClass(l,"forwarded"),x.rmClass(this.nodes.post,"highlight"),
this.isReply||(this.setCatalogOP(!1),x.rm(x(".catalog-link",this.nodes.post)),x.rm(x(".catalog-stats",this.nodes.post)),x.rm(x(".catalog-replies",this.nodes.post))),this.parseQuotes(),this.quotes=[...this.origin.quotes],this.files=[],this.origin.files.length&&(s=this.fileRoots()),this.origin.files)){a={...u};var p=s[a.docIndex];for(n in i.SITE.selectors.file){var g=i.SITE.selectors.file[n];a[n]=x(g,p)}a.thumbLink=a.thumb?.parentNode,a.thumbLink&&(a.fullImage=x(".full-image",a.thumbLink)),a.videoControls=x(".video-controls",a.text),a.videoThumb&&(a.thumb.muted=!0),this.files.push(a)}return this.files.length&&(this.file=this.files[0],this.file.thumb&&o&&oe.contract(this)),this.origin.isDead&&(this.isDead=!0),l.dataset.clone=this.origin.clones.push(this)-1,this}cloneWithoutVideo(e){if("VIDEO"!==e.tagName||e.dataset.md5){if(e.nodeType===Node.ELEMENT_NODE&&x("video",e)){const o=e.cloneNode(!1);for(var t of e.childNodes)x.add(o,this.cloneWithoutVideo(t));return o}return e.cloneNode(!0)}
return[]}}ie.suffix=0;var se={cbs:[],init(){let e;if("yotsuba"!==i.SITE.software)return;const t=Date.now();if(t-2*m>=(e=a.boardConfig.lastChecked||0)||e>t)return x.ajax(`${location.protocol}//a.4cdn.org/boards.json`,{onloadend:this.load});{const{boards:e}=a.boardConfig;return this.set(e)}},load(){let e;if(200===this.status&&this.response&&this.response.boards){for(var t of(e=p(),this.response.boards))e[t.board]=t;x.set("boardConfig",{boards:e,lastChecked:Date.now()})}else{({boards:e}=a.boardConfig);const t=(()=>{switch(this.status){case 0:return"Connection Error";case 200:return"Invalid Data";default:return`Error ${this.statusText} (${this.status})`}})();new Ke("warning",`Failed to load board configuration. ${t}`,20)}return se.set(e)},set(e){for(var t in this.boards=e,i.boards){i.boards[t].config=this.boards[t]||{}}for(var o of this.cbs)x.queueTask(o)},ready(e){return this.boards?e():this.cbs.push(e)},sfwBoards(e){return(()=>{const t=[],o=this.boards||a.boardConfig.boards
;for(var i in o){!!o[i].ws_board===e&&t.push(i)}return t})()},isSFW(e){return!!(this.boards||a.boardConfig.boards)[e]?.ws_board},domain:e=>"boards.4chan.org",isArchived(e){const t=(this.boards||a.boardConfig.boards)[e];return!t||t.is_archived},noAudio(e){if("yotsuba"!==i.SITE.software)return!1;const t=this.boards||a.boardConfig.boards;return t&&t[e]&&!t[e].webm_audio},title(e){return(this.boards||a.boardConfig.boards)?.[e]?.title||""}},ne={init(){if(["index","thread"].includes(i.VIEW)&&a.Menu)return this.button=x.el("a",{className:"menu-button",href:"javascript:;"}),M.set(this.button,"caretDown"),this.menu=new X.Menu("post"),c.Post.push({name:"Menu",cb:this.node}),c.CatalogThread.push({name:"Menu",cb:this.catalogNode})},node(){if(this.isClone){const e=x(".menu-button",this.nodes.info);return x.rmClass(e,"active"),x.rm(x(".dialog",this.nodes.info)),void ne.makeButton(this,e)}return x.add(this.nodes.info,ne.makeButton(this))},catalogNode(){
return x.after(this.nodes.icons,ne.makeButton(this.thread.OP))},makeButton:(e,t)=>(t||(t=ne.button.cloneNode(!0)),x.on(t,"click",(function(t){return ne.menu.toggle(t,this,e)})),t)},re={recursives:new Map,init(){["index","thread"].includes(i.VIEW)&&c.Post.push({name:"Recursive",cb:this.node})},node(){if(!this.isClone&&!this.isFetchedQuote)for(var e of this.quotes){const o=re.recursives.get(e);if(o)for(var t=0;t<o.recursives.length;t++)o.recursives[t](this,...o.args[t])}},add(e,t,...o){let a=re.recursives.get(t.fullID);a||(a={recursives:[],args:[]},re.recursives.set(t.fullID,a)),a.recursives.push(e),a.args.push(o)},rm(e,t){const o=re.recursives.get(t.fullID);if(o)for(let t=o.recursives.length-1;t>=0;--t)o.recursives[t]===e&&(o.recursives.splice(t,1),o.args.splice(t,1))},apply(e,t,...o){const{fullID:a}=t;i.posts.forEach((function(t){t.quotes.includes(a)&&e(t,...o)}))},applyAndAdd(e,t,...o){re.apply(e,t,...o),this.add(e,t,...o)}},le={db:void 0,posterIdDb:void 0,init(){
["index","thread"].includes(i.VIEW)&&(a["Reply Hiding Buttons"]||a.Menu&&a["Reply Hiding Link"])&&(a["Reply Hiding Buttons"]&&x.addClass(r,"reply-hide"),this.db=new q("hiddenPosts"),this.posterIdDb=new q("hiddenPosterIds"),c.Post.push({name:"Reply Hiding",cb:this.node}))},isHidden:(e,t,o)=>!(!le.db||!le.db.get({boardID:e,threadID:t,postID:o})),node(){if(!this.isReply||this.isClone||this.isFetchedQuote)return;let e=le.db.get({boardID:this.board.ID,threadID:this.thread.ID,postID:this.ID});if(!e&&this.info.uniqueID){const t=le.posterIdDb.get({boardID:this.board.ID,threadID:this.thread.ID});t&&this.info.uniqueID in t&&(e=t[this.info.uniqueID],e.thisPost=!0)}if(e&&(e.thisPost?le.hide(this,e.makeStub,e.hideRecursively,"Hidden manually"):le.hideRecursive(this,e.makeStub)),!a["Reply Hiding Buttons"])return;const t=le.makeButton(this,"hide"),o=i.SITE.selectors.sideArrows;if(o){const e=x(o,this.nodes.root);x.replace(e.firstChild,t),e.className="replacedSideArrows"
}else x.prepend(this.nodes.info,t)},menu:{post:void 0,async init(){if(!["index","thread"].includes(i.VIEW)||!a.Menu||!a["Reply Hiding Link"])return;await new Promise((e=>se.ready(e)));let e=x.el("a",{textContent:"Apply",href:"javascript:;"});x.on(e,"click",le.menu.hide);const t=[{el:e},{el:X.checkbox("thisPost","This post",!0)},{el:X.checkbox("replies","Hide replies",a["Recursive Hiding"])},{el:X.checkbox("makeStub","Make stub",a.Stubs)}];i.BOARD.config.user_ids&&t.push({el:X.checkbox("byId","By poster id",!1)}),ne.menu.addEntry({el:x.el("div",{className:"hide-reply-link",textContent:"Hide"}),order:20,open:e=>!(!e.isReply||e.isClone||e.isHidden)&&(le.menu.post=e,!0),subEntries:t});const o=x.el("a",{textContent:"Apply",href:"javascript:;"});x.on(o,"click",le.menu.show);const s=X.checkbox("thisPost","This post",!1),n=X.checkbox("replies","Show replies",!1),r=x.el("a",{textContent:"Hide stub",href:"javascript:;"});x.on(r,"click",le.menu.hideStub);const l=[{el:o},{el:s},{el:n}];let d
;i.BOARD.config.user_ids&&(d=X.checkbox("byId","By poster id",!1),l.push({el:d})),ne.menu.addEntry({el:x.el("div",{className:"show-reply-link",textContent:"Show"}),order:20,open(e){if(!e.isReply||e.isClone||!e.isHidden)return!1;const t=le.db.get({boardID:e.board.ID,threadID:e.thread.ID,postID:e.ID});return!!t&&(le.menu.post=e,s.firstChild.checked=e.isHidden,n.firstChild.checked=t.hideRecursively??a["Recursive Hiding"],d&&(d.firstChild.checked=t.byId),!0)},subEntries:l}),ne.menu.addEntry({el:r,order:15,open:e=>!(!e.isReply||e.isClone||!e.isHidden)&&(!!le.db.get({boardID:e.board.ID,threadID:e.thread.ID,postID:e.ID})&&(le.menu.post=e))})},hide(){const e=this.parentNode,t=x("input[name=thisPost]",e).checked,o=x("input[name=replies]",e).checked,a=x("input[name=makeStub]",e).checked,s=x("input[name=byId]",e)?.checked,{post:n}=le.menu;if(t||o||s){if(t?le.hide(n,a,o,"Hidden manually"):o&&le.hideRecursive(n,a),s){const e=`Hidden because of poster ID ${n.info.uniqueID}`;i.posts.forEach((i=>{
i.info.uniqueID===n.info.uniqueID&&i!==n&&(le.hide(i,a,o,e),le.saveHiddenState(i,!0,t,a,o,s))}));const r=le.posterIdDb.get({boardID:n.boardID,threadID:n.threadID,defaultValue:p()});n.info.uniqueID in r||(r[n.info.uniqueID]={makeStub:a,hideRecursively:o},le.posterIdDb.set({boardID:n.boardID,threadID:n.threadID,val:r}))}le.saveHiddenState(n,!0,t,a,o,s),x.event("CloseMenu")}},show(){const e=this.parentNode,t=x("input[name=thisPost]",e).checked,o=x("input[name=replies]",e).checked,a=x("input[name=byId]",e)?.checked,{post:s}=le.menu,{boardID:n,threadID:r,postID:l}=s;if(!t&&!o&&!a)return;if(t?le.show(s,o):o&&(re.apply(le.show,s,!0),re.rm(le.hide,s)),a){i.posts.forEach((e=>{if(e.info.uniqueID===s.info.uniqueID&&e!==s){le.show(e,o);const i=le.db.get({boardID:n,threadID:r,postID:l});i&&le.saveHiddenState(s,!(t&&o),!t,i.makeStub,!o,a)}}));const e=le.posterIdDb.get({boardID:n,threadID:r});e&&s.info.uniqueID in e&&(delete e[s.info.uniqueID],le.posterIdDb.set({boardID:n,threadID:r,val:e}))}
const d=le.db.get({boardID:n,threadID:r,postID:l});d&&le.saveHiddenState(s,!(t&&o),!t,d.makeStub,!o,a),x.event("CloseMenu")},hideStub(){let e;const{post:t}=le.menu;(e=le.db.get({boardID:t.board.ID,threadID:t.thread.ID,postID:t.ID}))&&(le.show(t,e.hideRecursively),le.hide(t,!1,e.hideRecursively),le.saveHiddenState(t,!0,!0,!1,e.hideRecursively,e.byId)),x.event("CloseMenu")}},makeButton(e,t){const o=x.el("span",{className:"stub-icon",textContent:"hide"===t?"➖︎":"➕︎"}),a=x.el("a",{className:`${t}-reply-button`,href:"javascript:;"});return x.add(a,o),x.on(a,"click",le.toggle),a},saveHiddenState(e,t,o,a,i,s){const n={boardID:e.board.ID,threadID:e.thread.ID,postID:e.ID};t?(n.val={thisPost:!1!==o,makeStub:a,hideRecursively:i,byId:s},le.db.set(n)):le.db.delete(n)},toggle(){const e=w.postFromNode(this);e.isHidden?le.show(e):le.hide(e,void 0,void 0,"Hidden manually"),le.saveHiddenState(e,e.isHidden)},hide(e,t=a.Stubs,o=a["Recursive Hiding"],i){if(e.isHidden)return;for(var s of(e.isHidden=!0,
o&&le.hideRecursive(e,t),w.allQuotelinksLinkingTo(e)))x.addClass(s,"filtered");if(!t)return void(e.nodes.root.hidden=!0);e.nodes.stub=x.el("div",{className:"stub"});const n=le.makeButton(e,"show");x.add(n,x.el("span",{className:"stub-name",textContent:e.info.nameBlock}));let r=e.filterResults?.reasons||[];if(i&&(r=[...r,i]),a["Filter Reason"]&&r.length){const e=x.el("span",{className:"stub-reasons"});x.add(e,r.map((e=>x.el("span",{className:"stub-reason",textContent:e})))),n.appendChild(e)}x.add(e.nodes.stub,n),!a["Filter Reason"]&&r&&(e.nodes.stub.title=r.join(" & ")),a.Menu&&x.add(e.nodes.stub,ne.makeButton(e)),x.prepend(e.nodes.root,e.nodes.stub)},hideRecursive(e,t){re.applyAndAdd(le.hide,e,t,!0,`Hidden recursively from ${e.ID}`)},show(e,t=a["Recursive Hiding"]){for(var o of(e.nodes.stub?(x.rm(e.nodes.stub),delete e.nodes.stub):e.nodes.root.hidden=!1,e.isHidden=!1,t&&(re.apply(le.show,e,!0),re.rm(le.hide,e)),w.allQuotelinksLinkingTo(e)))x.rmClass(o,"filtered")}},de={INTERVAL:3e4,
init(){if((["index","thread","archive"].includes(i.VIEW)&&["Show","Both","BothRelativeFirst"].includes(a.RelativeTime)||Ie.enabled)&&(this.flush(),x.on(n,"visibilitychange PostsInserted",this.flush)),"No"!==a.RelativeTime)return c.Post.push({name:"Relative Post Dates",cb:this.node})},node(){if(!this.info.date)return;const e=this.nodes.date;if("Hover"!==a.RelativeTime){if(!this.isClone)return"Show"===a.RelativeTime&&(e.dataset.fullTime=e.textContent,e.title=e.textContent),de.update(this)}else x.on(e,"mouseover",(()=>de.hover(this)))},relative(e,t,o,a){let i,s;if((i=e/b)>=1){const e=t.getFullYear()-o.getFullYear();let a=t.getMonth()-o.getMonth();const n=t.getDate()-o.getDate();e>1?(i=e-(a<0||0===a&&n<0),s="year"):1===e&&(a>0||0===a&&n>=0)?(i=e,s="year"):(a+=12*e)>1?(i=a-(n<0),s="month"):1===a&&n>=0?(i=a,s="month"):s="day"}else(i=e/m)>=1?s="hour":(i=e/f)>=1?s="minute":(i=Math.max(0,e)/g,s="second");const n=Math.round(i);return a?s="month"===s?"mo":s[0]:1!==n&&(s+="s"),
a?`${n}${s}`:`${n} ${s} ago`},stale:[],timeout:void 0,flush(){if(n.hidden)return;const e=new Date;for(var t of de.stale)de.update(t,e);de.stale=[],clearTimeout(de.timeout),de.timeout=setTimeout(de.flush,de.INTERVAL)},hover(e){const{date:t}=e.info,o=new Date,a=o-t;e.nodes.date.title=de.relative(a,o,t)},update(e,t=new Date){let o,i;const s=e instanceof ae;s?(({date:i}=e.info),o=!1):(i=new Date(+e.dataset.utc),o=!!e.dataset.abbrev);const n=t-i,r=de.relative(n,t,i,o);if(s)for(var l of[e].concat(e.clones)){const e=l.nodes.date;if("Show"===a.RelativeTime)e.textContent=r;else{let t=e.dataset.fullTime;t||(t=e.textContent,e.dataset.fullTime=t),e.textContent="Both"===a.RelativeTime?`${t}, ${r}`:`${r}, ${t}`}}else e.firstChild.textContent=r;de.setOwnTimeout(n,e)},setOwnTimeout(e,t){const o=e<f?g-(e+500)%g:e<m?f-(e+3e4)%f:e<b?m-(e+m/2)%m:b-(e+b/2)%b;setTimeout(de.markStale,o,t)},markStale(e){
de.stale.includes(e)||e instanceof ae&&!i.posts.get(e.fullID)||e instanceof Element&&!r.contains(e)||de.stale.push(e)}};class ce{toString(){return this.ID}constructor(e){this.ID=e,this.boardID=this.ID,this.siteID=i.SITE.ID,this.threads=new H,this.posts=new H,this.config=se.boards?.[this.ID]||{},i.boards[this]=this}cooldowns(){const e=(this.config||{}).cooldowns||{},t={thread:e.threads||0,reply:e.replies||0,image:e.images||0,thread_global:300};if(n.cookie.indexOf("pass_enabled=1")>=0)for(var o of["reply","image"])t[o]=Math.ceil(t[o]/2);return t}}const he={init(){return x.on(n,"QRPostSuccessful",(e=>{if(e.detail.redirect)return this.event=e,this.delays=0,x.queueTask((()=>{if(e===this.event&&0===this.delays)return location.href=e.detail.redirect}))}))},delays:0,delay(){if(!this.event)return null;const e=this.event;return this.delays++,()=>{if(e===this.event)return this.delays--,0===this.delays?location.href=e.detail.redirect:void 0}}};var ue={init(){
if("index"===i.VIEW&&a["Comment Expansion"]&&!a["JSON Index"])return c.Post.push({name:"Comment Expansion",cb:this.node})},node(){let e;if(e=x(".abbr > a:not([onclick])",this.nodes.comment))return x.on(e,"click",ue.cb)},callbacks:[],cb(e){return e.preventDefault(),ue.expand(w.postFromNode(this))},expand(e){let t;return e.nodes.longComment&&!e.nodes.longComment.parentNode?(x.replace(e.nodes.shortComment,e.nodes.longComment),void(e.nodes.comment=e.nodes.longComment)):(t=x(".abbr > a",e.nodes.comment))?(t.textContent=`Post No.${e} Loading...`,x.cache(i.SITE.urls.threadJSON({boardID:e.boardID,threadID:e.threadID}),(function(){return ue.parse(this,t,e)}))):void 0},contract(e){if(!e.nodes.shortComment)return;return x(".abbr > a",e.nodes.shortComment).textContent="here",x.replace(e.nodes.longComment,e.nodes.shortComment),e.nodes.comment=e.nodes.shortComment},parse(e,t,o){let a,s;const{status:n}=e
;if(![200,304].includes(n))return void(t.textContent=n?`Error ${e.statusText} (${n})`:"Connection Error");const{posts:r}=e.response;for(a of((s=r[0].custom_spoiler)&&(i.SITE.Build.spoilerRange[i.BOARD]=s),r))if(a.no===o.ID)break;if(a.no!==o.ID)return void(t.textContent=`Post No.${o} not found.`);const{comment:l}=o.nodes,d=l.cloneNode(!1);for(var c of(d.innerHTML=a.com,S(".quotelink",d))){var h=c.getAttribute("href");"/"!==h[0]&&("#"===h[0]?c.href=`${t.pathname.split(/\/+/).splice(0,4).join("/")}${h}`:c.href=`${t.pathname.split(/\/+/).splice(0,3).join("/")}/${h}`)}for(var u of(o.nodes.shortComment=l,x.replace(l,d),o.nodes.comment=o.nodes.longComment=d,o.parseComment(),o.parseQuotes(),ue.callbacks))u.call(o)}},pe={init(){if(a["Remember Your Posts"]&&(this.db=new q("yourPosts"),x.sync("Remember Your Posts",(e=>a["Remember Your Posts"]=e)),x.on(n,"QRPostSuccessful",(function(e){const t=he.delay();return x.get("Remember Your Posts",a["Remember Your Posts"],(function(o){
if(!o["Remember Your Posts"])return;const{boardID:a,threadID:i,postID:s}=e.detail;return pe.db.set({boardID:a,threadID:i,postID:s,val:!0},t)}))})),["index","thread","archive"].includes(i.VIEW)))return a["Highlight Own Posts"]&&x.addClass(r,"highlight-own"),a["Highlight Posts Quoting You"]&&x.addClass(r,"highlight-you"),a["Comment Expansion"]&&ue.callbacks.push(this.node),this.mark=x.el("span",{textContent:" (You)",className:"qmark-you"}),c.Post.push({name:"Mark Quotes of You",cb:this.node}),pe.menu.init()},isYou:e=>!!pe.db?.get({boardID:e.boardID,threadID:e.threadID,postID:e.ID}),node(){if(!this.isClone&&(pe.isYou(this)&&x.addClass(this.nodes.root,"yourPost"),this.quotes.length))for(var e of this.nodes.quotelinks)pe.db.get(w.postDataFromLink(e))&&(a["Mark Quotes of You"]&&x.add(e,pe.mark.cloneNode(!0)),x.addClass(e,"you"),x.addClass(this.nodes.root,"quotesYou"))},menu:{init(){const e=x.el("label",{className:"toggle-you"},{innerHTML:'<input type="checkbox"> You'}),t=x("input",e)
;return x.on(t,"change",pe.menu.toggle),ne.menu?.addEntry({el:e,order:80,open:e=>(pe.menu.post=e.origin||e,t.checked=pe.isYou(e),!0)})},toggle(){const{post:e}=pe.menu,t={boardID:e.board.ID,threadID:e.thread.ID,postID:e.ID,val:!0};for(var o of(this.checked?pe.db.set(t):pe.db.delete(t),[e].concat(e.clones)))o.nodes.root.classList.toggle("yourPost",this.checked);for(var i of w.allQuotelinksLinkingTo(e))if(this.checked?a["Mark Quotes of You"]&&x.add(i,pe.mark.cloneNode(!0)):x.rm(x(".qmark-you",i)),i.classList.toggle("you",this.checked),x.hasClass(i,"quotelink")){var s=w.postFromNode(i).nodes.root;s.classList.toggle("quotesYou",!!x(".quotelink.you",s))}}},cb:{seek(e){let t,o,a;const{highlight:s}=i.SITE.classes;if((t=x(`.${s}`))&&x.rmClass(t,s),pe.lastRead&&r.contains(pe.lastRead)&&x.hasClass(pe.lastRead,"quotesYou"))o=pe.lastRead;else{if(!(o=pe.lastRead=x(".quotesYou")))return void new Ke("warning","No posts are currently quoting you, loser.",20);if(pe.cb.scroll(o))return}
const n=`${e}::div[contains(@class,'quotesYou')]`;for(;o=(a=x.X(n,o)).snapshotItem("preceding"===e?a.snapshotLength-1:0);)if(pe.cb.scroll(o))return;const l=S(".quotesYou");return pe.cb.scroll(l["following"===e?0:l.length-1])},scroll(e){const t=w.postFromRoot(e);if(t.nodes.post.getBoundingClientRect().height){if(pe.lastRead=e,location.href=w.url("post",t),Ye.scrollTo(t.nodes.post),t.isReply){const e=`${i.SITE.selectors.postContainer}${i.SITE.selectors.highlightable.reply}`;let o=t.nodes.root;o.matches(e)||(o=x(e,o)),x.addClass(o,i.SITE.classes.highlight)}return!0}return!1}}};class ge{constructor(e){if(this.length=0,e)for(var t of e)this.push(t)}push(e){let t,{ID:o}=e;if(o||(o=e.id),this[o])return;const{last:a}=this;return this[o]=t={prev:a,next:null,data:e,ID:o},t.prev=a,this.last=a?a.next=t:this.first=t,this.length++}before(e,t){if(t.next===e||t===e)return;this.rmi(t);const{prev:o}=e;return e.prev=t,t.next=e,t.prev=o,o?o.next=t:this.first=t}after(e,t){if(t.prev===e||t===e)return
;this.rmi(t);const{next:o}=e;return e.next=t,t.prev=e,t.next=o,o?o.prev=t:this.last=t}prepend(e){const{first:t}=this;if(e!==t&&this[e.ID])return this.rmi(e),e.next=t,t?t.prev=e:this.last=e,this.first=e,delete e.prev}shift(){return this.rm(this.first.ID)}order(){let e;const t=[e=this.first];for(;e=e.next;)t.push(e);return t}rm(e){const t=this[e];if(t)return delete this[e],this.length--,this.rmi(t),delete t.next,delete t.prev}rmi(e){const{prev:t,next:o}=e;return t?t.next=o:this.first=o,o?o.prev=t:this.last=t}}var fe={init(){if("thread"===i.VIEW&&(a["Unread Count"]||a["Unread Favicon"]||a["Unread Line"]||a["Remember Last Read Post"]||a["Desktop Notifications"]||a["Quote Threading"]))return a["Remember Last Read Post"]&&(x.sync("Remember Last Read Post",(e=>a["Remember Last Read Post"]=e)),this.db=new q("lastReadPosts",this.sync)),this.hr=x.el("hr",{id:"unread-line",className:"unread-line"}),this.posts=new Set,this.postsQuotingYou=new Set,this.order=new ge,this.position=null,
c.Thread.push({name:"Unread",cb:this.node}),c.Post.push({name:"Unread",cb:this.addPost})},node(){for(var e of(fe.thread=this,fe.title=n.title,fe.lastReadPost=fe.db?.get({boardID:this.board.ID,threadID:this.ID})||0,fe.readCount=0,this.posts.keys))+e<=fe.lastReadPost&&fe.readCount++;x.one(n,"4chanXInitFinished",fe.ready),x.on(n,"PostsInserted",fe.onUpdate),x.on(n,"ThreadUpdate",(function(e){if(e.detail[404])return fe.update()}));const t=x.el("a",{href:"javascript:;",className:"unread-reset",textContent:"Mark all unread"});return x.on(t,"click",fe.reset),Ye.menu.addEntry({el:t,order:70})},ready(){if(a["Remember Last Read Post"]&&a["Scroll to Last Read Post"]&&fe.scroll(),fe.setLine(!0),fe.read(),fe.update(),x.on(n,"scroll visibilitychange",fe.read),a["Unread Line"])return x.on(n,"visibilitychange",fe.setLine)},positionPrev:()=>fe.position?fe.position.prev:fe.order.last,scroll(){let e;if((e=location.hash.match(/\d+/))&&e[0]in fe.thread.posts)return;let t=fe.positionPrev();for(;t;){
var{bottom:o}=t.data.nodes;if(o.getBoundingClientRect().height){Ye.scrollToIfNeeded(o,!0);break}t=t.prev}},reset(){if(null!=fe.lastReadPost)return fe.posts=new Set,fe.postsQuotingYou=new Set,fe.order=new ge,fe.position=null,fe.lastReadPost=0,fe.readCount=0,fe.thread.posts.forEach((e=>fe.addPost.call(e))),x.forceSync("Remember Last Read Post"),!a["Remember Last Read Post"]||fe.thread.isDead&&!fe.thread.isArchived||fe.db.set({boardID:fe.thread.board.ID,threadID:fe.thread.ID,val:0}),fe.updatePosition(),fe.setLine(),fe.update()},sync(){if(null==fe.lastReadPost)return;const e=fe.db.get({boardID:fe.thread.board.ID,threadID:fe.thread.ID,defaultValue:0});if(fe.lastReadPost>=e)return;fe.lastReadPost=e;const t=fe.thread.posts.keys;for(let e=fe.readCount,a=t.length;e<a;e++){var o=+t[e];if(!fe.thread.posts.get(o).isFetchedQuote){if(o>fe.lastReadPost)break;fe.posts.delete(o),fe.postsQuotingYou.delete(o)}fe.readCount++}return fe.updatePosition(),fe.setLine(),fe.update()},addPost(){
if(!(this.isFetchedQuote||this.isClone||(fe.order.push(this),this.ID<=fe.lastReadPost||this.isHidden||pe.isYou(this))))return fe.posts.add(fe.posts.last=this.ID),fe.addPostQuotingYou(this),null!=fe.position?fe.position:fe.position=fe.order[this.ID]},addPostQuotingYou(e){for(var t of e.nodes.quotelinks)if(pe.db?.get(w.postDataFromLink(t)))return fe.postsQuotingYou.add(fe.postsQuotingYou.last=e.ID),void fe.openNotification(e)},openNotification(e,t=" replied to you"){if(!Ye.areNotificationsEnabled)return;const o=new Notification(`${e.info.nameBlock}${t}`,{body:e.commentDisplay(),icon:F.logo});return o.onclick=function(){return Ye.scrollToIfNeeded(e.nodes.bottom,!0),window.focus()},o.onshow=()=>setTimeout((()=>o.close()),7e3)},onUpdate:()=>x.queueTask((function(){return fe.setLine(),fe.read(),fe.update()})),readSinglePost(e){const{ID:t}=e;if(fe.posts.has(t))return fe.posts.delete(t),fe.postsQuotingYou.delete(t),fe.updatePosition(),fe.saveLastReadPost(),fe.update()},read:u(100,(function(e){
if(fe.posts.size||fe.readCount===fe.thread.posts.keys.length||fe.saveLastReadPost(),n.hidden||!fe.posts.size)return;let t=0;for(;fe.position;){var{ID:o,data:a}=fe.position,{bottom:i}=a.nodes;if(i.getBoundingClientRect().height&&Ye.getBottomOf(i)<=-1)break;t++,fe.posts.delete(o),fe.postsQuotingYou.delete(o),fe.position=fe.position.next}return t?(fe.updatePosition(),fe.saveLastReadPost(),e?fe.update():void 0):void 0})),updatePosition(){for(;fe.position&&!fe.posts.has(fe.position.ID);)fe.position=fe.position.next},saveLastReadPost:u(2e3,(function(){let e;if(x.forceSync("Remember Last Read Post"),!a["Remember Last Read Post"]||!fe.db)return;const t=fe.thread.posts.keys;for(let o=fe.readCount,a=t.length;o<a;o++){if(e=+t[o],!fe.thread.posts.get(e).isFetchedQuote){if(fe.posts.has(e))break;fe.lastReadPost=e}fe.readCount++}return!fe.thread.isDead||fe.thread.isArchived?fe.db.set({boardID:fe.thread.board.ID,threadID:fe.thread.ID,val:fe.lastReadPost}):void 0})),setLine(e){if(a["Unread Line"]){
if(fe.hr.hidden||n.hidden||!0===e){const e=fe.linePosition;if(fe.linePosition=fe.positionPrev()){if(fe.linePosition!==e){let e=fe.linePosition.data.nodes.bottom;"BR"===e.nextSibling?.tagName&&(e=e.nextSibling),x.after(e,fe.hr)}}else x.rm(fe.hr)}return fe.hr.hidden=fe.linePosition===fe.order.last}},update(){const e=fe.posts.size,t=fe.postsQuotingYou.size;if(a["Unread Count"]){const o=a["Quoted Title"]&&t?"(!) ":"",i=e||!a["Hide Unread Count at (0)"]?`(${e}) `:"",s=fe.thread.isDead?fe.title.replace("-",fe.thread.isArchived?"- Archived -":"- 404 -"):fe.title;n.title=`${o}${i}${s}`}if(fe.saveThreadWatcherCount(),a["Unread Favicon"]&&"yotsuba"===i.SITE.software){const{isDead:o}=fe.thread;return F.set(t?o?"unreadDeadY":"unreadY":e?o?"unreadDead":"unread":o?"dead":"default")}},saveThreadWatcherCount:u(2e3,(function(){if(x.forceSync("Remember Last Read Post"),a["Remember Last Read Post"]&&(!fe.thread.isDead||fe.thread.isArchived)){let e
;const t=!a["Require OP Quote Link"]&&pe.isYou(fe.thread.OP)?fe.posts:fe.postsQuotingYou;if(t.size){if(!t.has(t.last)){t.last=0,e=fe.thread.posts.keys;for(let o=e.length-1;o>=0;o--)if(t.has(+e[o])){t.last=e[o];break}}}else t.last=0;return ve.update(i.SITE.ID,fe.thread.board.ID,fe.thread.ID,{last:fe.thread.lastPost,isDead:fe.thread.isDead,isArchived:fe.thread.isArchived,unread:fe.posts.size,quotingYou:t.last||0})}}))},me={statuses:p(),init(){"index"===i.VIEW&&a["Thread Expansion"]&&(a["JSON Index"]?x.on(n,"IndexRefreshInternal",this.onIndexRefresh):c.Thread.push({name:"Expand Thread",cb(){me.setButton(this)}}))},setButton(e){if(!e.nodes.root)return;const t=x("a.summary",e.nodes.root);t&&(t.textContent=i.SITE.Build.summaryText("+",...t.textContent.match(/\d+/g)),t.style.cursor="pointer",x.on(t,"click",me.cbToggle))},disconnect(e){if("thread"!==i.VIEW&&a["Thread Expansion"]){for(var t in me.statuses){var o,s=me.statuses[t];(o=s.req)&&(delete s.req,o.abort()),delete me.statuses[t]}
e||x.off(n,"IndexRefreshInternal",this.onIndexRefresh)}},onIndexRefresh(){me.disconnect(!0),i.BOARD.threads.forEach((e=>me.setButton(e)))},cbToggle(e){x.modifiedClick(e)||(e.preventDefault(),me.toggle(w.threadFromNode(this)))},cbToggleBottom(e){if(x.modifiedClick(e))return;e.preventDefault();const t=w.threadFromNode(this);x.rm(this);const{bottom:o}=t.nodes.root.getBoundingClientRect();return me.toggle(t),window.scrollBy(0,t.nodes.root.getBoundingClientRect().bottom-o)},toggle(e){if(!e.nodes.root)return;const t=x("a.summary",e.nodes.root);t&&(e.ID in me.statuses?me.contract(e,t,e.nodes.root):me.expand(e,t))},expand(e,t){let o;me.statuses[e]=o={},t.textContent=i.SITE.Build.summaryText("...",...t.textContent.match(/\d+/g)),o.req=x.cache(i.SITE.urls.threadJSON({boardID:e.board.ID,threadID:e.ID}),(function(){this===o.req&&(delete o.req,me.parse(this,e,t))})),o.numReplies=S(i.SITE.selectors.replyOriginal,e.nodes.root).length},contract(e,t,o){let s;const n=me.statuses[e]
;if(delete me.statuses[e],s=n.req)return delete n.req,s.abort(),void(t&&(t.textContent=i.SITE.Build.summaryText("+",...t.textContent.match(/\d+/g))));let r=S(".thread > .replyContainer",o);n.numReplies&&(r=r.slice(0,-n.numReplies));let l=0,d=0;for(var c of r){if(a["Quote Inlining"])for(var h;h=x(".inlined",c);)h.click();l++,"file"in w.postFromRoot(c)&&d++,x.rm(c)}Ie.enabled&&x.event("PostsRemoved",null,t.parentNode),t.textContent=i.SITE.Build.summaryText("+",l,d),x.rm(x(".summary-bottom",o))},parse(e,t,o){let a;if(![200,304].includes(e.status))return void(o.textContent=e.status?`Error ${e.statusText} (${e.status})`:"Connection Error");i.SITE.Build.spoilerRange[t.board]=e.response.posts[0].custom_spoiler;const s=[],n=[];let r=0;for(var l of e.response.posts){var d;l.no!==t.ID&&(!(d=t.posts.get(l.no))||d.isFetchedQuote?(a=i.SITE.Build.postFromObject(l,t.board.ID),"file"in(d=new ae(a,t,t.board))&&r++,s.push(d),n.push(a)):("file"in d&&r++,({root:a}=d.nodes),n.push(a)))}
Pt.callbackNodes("Post",s),x.after(o,n),x.event("PostsInserted",null,o.parentNode);const c=n.length;if(o.textContent=i.SITE.Build.summaryText("-",c,r),a){const e=o.cloneNode(!0);e.classList.add("summary-bottom"),x.on(e,"click",me.cbToggleBottom),x.after(a,e)}}},be={lastReadPost:p(),hr:p(),markReadLink:p(),init(){if("index"===i.VIEW&&a["Remember Last Read Post"]&&a["Unread Line in Index"])return this.enabled=!0,this.db=new q("lastReadPosts",this.sync),c.Thread.push({name:"Unread Line in Index",cb:this.node}),x.on(n,"IndexRefreshInternal",this.onIndexRefresh),x.on(n,"PostsInserted PostsRemoved",this.onPostsInserted)},node(){if(be.lastReadPost[this.fullID]=be.db.get({boardID:this.board.ID,threadID:this.ID})||0,!Ie.enabled)return be.update(this)},onIndexRefresh(e){if(!e.detail.isCatalog)return(()=>{const t=[];for(var o of e.detail.threadIDs){var a=i.threads.get(o);t.push(be.update(a))}return t})()},onPostsInserted(e){if(e.target===Ie.root)return;const t=w.threadFromNode(e.target)
;if(!t||t.nodes.root!==e.target)return;const o=!!be.hr[t.fullID]?.parentNode;return be.update(t),a["Scroll to Last Read Post"]&&"PostsInserted"===e.type&&!o&&be.hr[t.fullID]?.parentNode?Ye.scrollToIfNeeded(be.hr[t.fullID],!0):void 0},sync:()=>i.threads.forEach((function(e){const t=be.db.get({boardID:e.board.ID,threadID:e.ID})||0;if(t!==be.lastReadPost[e.fullID]&&(be.lastReadPost[e.fullID]=t,e.nodes.root?.parentNode))return be.update(e)})),update(e){let t;const o=be.lastReadPost[e.fullID];let a=0,s=0,n=null;e.posts.forEach((function(t){if(t.isReply&&e.nodes.root.contains(t.nodes.root)){if(a++,t.ID<=o)return s++;if((!n||t.ID<n.ID)&&!t.isHidden&&!pe.isYou(t))return n=t}}));let r=be.hr[e.fullID];n&&(s||o===e.OP.ID&&(!x(i.SITE.selectors.summary,e.nodes.root)||e.ID in me.statuses))?(r||(r=be.hr[e.fullID]=x.el("hr",{className:"unread-line"})),x.before(n.nodes.root,r)):x.rm(r);const l=a?n||!s:Ie.enabled?e.lastPost>o:e.OP.ID>o;e.nodes.root.classList.toggle("unread-thread",l)
;let d=be.markReadLink[e.fullID];return d||(d=be.markReadLink[e.fullID]=x.el("a",{className:"unread-mark-read brackets-wrap",href:"javascript:;",textContent:"Mark Read"}),x.on(d,"click",be.markRead)),(t=x(i.SITE.selectors.threadDivider,e.nodes.root))?x.before(t,d):x.add(e.nodes.root,d)},markRead(){const e=w.threadFromNode(this);return be.lastReadPost[e.fullID]=e.lastPost,be.db.set({boardID:e.board.ID,threadID:e.ID,val:e.lastPost}),x.rm(be.hr[e.fullID]),e.nodes.root.classList.remove("unread-thread"),ve.update(i.SITE.ID,e.board.ID,e.ID,{last:e.lastPost,unread:0,quotingYou:0})}},ve={init(){let e;if(this.enabled=a["Thread Watcher"]){switch(this.shortcut=e=x.el("a",{id:"watcher-link",title:"Thread Watcher",href:"javascript:;"}),M.set(this.shortcut,"eye","Watcher"),this.db=new q("watchedThreads",this.refresh,!0),this.dbLM=new q("watcherLastModified",null,!0),this.dialog=X.dialog("thread-watcher",{
innerHTML:'<div class="move"> Thread Watcher <a class="refresh" title="Check threads" href="javascript:;" title="refresh"></a> <span id="watcher-status"></span> <a class="menu-button" href="javascript:;"></a> <a class="close" href="javascript:;">×</a> </div> <div id="watched-threads"></div>'}),this.status=x("#watcher-status",this.dialog),this.list=this.dialog.lastElementChild,this.refreshButton=x(".refresh",this.dialog),this.menuButton=x(".menu-button",this.dialog),this.closeButton=x(".move > .close",this.dialog),this.unreaddb=fe.db||be.db||new q("lastReadPosts"),this.unreadEnabled=a["Remember Last Read Post"],M.set(this.refreshButton,"refresh"),M.set(this.menuButton,"caretDown"),x.on(n,"QRPostSuccessful",this.cb.post),x.on(e,"click",this.toggleWatcher),x.on(this.refreshButton,"click",this.buttonFetchAll),x.on(this.closeButton,"click",this.toggleWatcher),this.menu.addHeaderMenuEntry(),x.onExists(r,"body",this.addDialog),i.VIEW){case"index":x.on(n,"IndexUpdate",this.cb.onIndexUpdate)
;break;case"thread":x.on(n,"ThreadUpdate",this.cb.onThreadRefresh)}if(a["Fixed Thread Watcher"]&&x.addClass(r,"fixed-watcher"),a["Persistent Thread Watcher"]||(x.addClass(ve.shortcut,"disabled"),this.dialog.hidden=!0),Ye.addShortcut("watcher",e,510),ve.initLastModified(),ve.fetchAuto(),x.on(window,"visibilitychange focus",(()=>x.queueTask(ve.fetchAuto))),a.Menu&&Ie.enabled&&ne.menu.addEntry({el:x.el("a",{href:"javascript:;",className:"has-shortcut-text"},{innerHTML:'<span></span><span class="shortcut-text">Alt+click</span>'}),order:6,open({thread:e}){return"catalog"===a["Index Mode"]&&(this.el.firstElementChild.textContent=ve.isWatched(e)?"Unwatch":"Watch",this.cb&&x.off(this.el,"click",this.cb),this.cb=function(){return x.event("CloseMenu"),ve.toggle(e,!0)},x.on(this.el,"click",this.cb),!0)}}),["index","thread"].includes(i.VIEW))return c.Post.push({name:"Thread Watcher",cb:this.node}),c.CatalogThread.push({name:"Thread Watcher",cb:this.catalogNode})}},isWatched:e=>!!ve.db?.get({
boardID:e.board.ID,threadID:e.ID}),isWatchedRaw:(e,t)=>!!ve.db?.get({boardID:e,threadID:t}),setToggler:(e,t)=>(e.classList.toggle("watched",t),e.title=(t?"Unwatch":"Watch")+" Thread"),node(){let e;if(this.isReply)return;this.isClone?e=x(".watch-thread-link",this.nodes.info):(e=x.el("button",{type:"button",className:"watch-thread-link"}),M.set(e,"heart"),x.before(x("input",this.nodes.info),e));const t=i.SITE.ID,o=this.board.ID,a=this.thread.ID,s=ve.db.get({siteID:t,boardID:o,threadID:a});return ve.setToggler(e,!!s),x.on(e,"click",ve.cb.toggle),s&&null==s.excerpt?x.queueTask((()=>ve.update(t,o,a,{excerpt:w.threadExcerpt(this.thread)}))):void 0},catalogNode(){return ve.isWatched(this.thread)&&x.addClass(this.nodes.root,"watched"),x.on(this.nodes.root,"mousedown click",(e=>{if(0===e.button&&e.altKey)return"click"===e.type&&ve.toggle(this.thread,!0),e.preventDefault()}))},addDialog(){if(Pt.isThisPageLegit())return ve.build(),x.prepend(n.body,ve.dialog)},
toggleWatcher:()=>(x.toggleClass(ve.shortcut,"disabled"),ve.dialog.hidden=!ve.dialog.hidden),cb:{openAll(){if(!x.hasClass(this,"disabled")){for(var e of S("a.watcher-link",ve.list))x.open(e.href);x.event("CloseMenu")}},openUnread(){if(!x.hasClass(this,"disabled")){for(var e of S(".replies-unread > a.watcher-link",ve.list))x.open(e.href);x.event("CloseMenu")}},openDeads(){if(!x.hasClass(this,"disabled")){for(var e of S(".dead-thread.replies-unread > a.watcher-link",ve.list))x.open(e.href);x.event("CloseMenu")}},clear(){if(!confirm("Delete ALL threads from watcher?"))return;const e=ve.getAll();for(let t=0,o=e.length;t<o;t++){const{siteID:o,boardID:a,threadID:i}=e[t];ve.db.delete({siteID:o,boardID:a,threadID:i})}ve.refresh(!0),x.event("CloseMenu")},pruneDeads(){if(!x.hasClass(this,"disabled")){for(var{siteID:e,boardID:t,threadID:o,data:a}of ve.getAll())a.isDead&&ve.db.delete({siteID:e,boardID:t,threadID:o});ve.refresh(!0),x.event("CloseMenu")}},pruneReadDeads(){
if(!x.hasClass(this,"disabled")){for(var{siteID:e,boardID:t,threadID:o,data:a}of ve.getAll())a.isDead&&!a.unread&&ve.db.delete({siteID:e,boardID:t,threadID:o});ve.refresh(!0),x.event("CloseMenu")}},dismiss(){for(var{siteID:e,boardID:t,threadID:o,data:a}of ve.getAll())a.quotingYou&&ve.update(e,t,o,{dismiss:a.quotingYou||0});x.event("CloseMenu")},toggle(){const{thread:e}=w.postFromNode(this);ve.toggle(e,!0)},rm(){const{siteID:e}=this.parentNode.dataset,[t,o]=this.parentNode.dataset.fullID.split(".");ve.rm(e,t,+o,void 0,!0)},post(e){const{boardID:t,threadID:o,postID:s}=e.detail,n=he.delay();s===o?a["Auto Watch"]&&ve.addRaw(t,o,{},n,!0):a["Auto Watch Reply"]&&ve.add(i.threads.get(t+"."+o)||new j(o,i.boards[t]||new ce(t)),n,!0)},onIndexUpdate(e){const{db:t}=ve,o=i.SITE.ID,s=i.BOARD.ID;let n=0;for(var r in t.data[o].boards[s]){var l=t.data[o].boards[s][r];if(!l?.isDead&&!e.detail.threads.includes(`${s}.${r}`)){if(!e.detail.threads.some((e=>+e.split(".")[1]>r)))continue
;a["Auto Prune"]||!l||"object"!=typeof l?(t.delete({boardID:s,threadID:r}),n++):ve.fetchStatus({siteID:o,boardID:s,threadID:r,data:l})}}if(n)return ve.refresh()},onThreadRefresh(e){const t=i.threads.get(e.detail.threadID);if(e.detail[404]&&ve.isWatched(t))return ve.add(t)}},requests:[],fetched:0,fetch(e,{siteID:t,force:o},a,s){0===ve.requests.length&&(ve.status.textContent="...",x.addClass(ve.refreshButton,"spin"));const n=t===i.SITE.ID?x.ajax:Fe.ajax;o&&delete x.lastModified.ThreadWatcher?.[e];const r=x.whenModified(e,"ThreadWatcher",(function(){if(!this.finished)return this.finished=!0,ve.fetched++,ve.fetched===ve.requests.length?ve.clearRequests():ve.status.textContent=`${Math.round(ve.fetched/ve.requests.length*100)}%`,s.apply(this,a)}),{timeout:f,ajax:n});return ve.requests.push(r)},clearRequests:()=>(ve.requests=[],ve.fetched=0,ve.status.textContent="",x.rmClass(ve.refreshButton,"spin")),abort(){for(var e of(delete ve.syncing,ve.requests))e.finished||(e.finished=!0,e.abort())
;return ve.clearRequests()},initLastModified(){const e=x.lastModified.ThreadWatcher||(x.lastModified.ThreadWatcher=p());for(var t in ve.dbLM.data){var o=ve.dbLM.data[t];for(var a in o.boards){var i=o.boards[a];if(ve.db.get({siteID:t,boardID:a}))for(var s in i){var n=i[s];e[s]=n}else ve.dbLM.delete({siteID:t,boardID:a})}}},fetchAuto(){let e;if(clearTimeout(ve.timeout),!a["Auto Update Thread Watcher"])return;const{db:t}=ve,o=a["Show Page"]||ve.unreadEnabled&&a["Show Unread Count"]?3e5:2*m,i=Date.now();return(i-o>=(e=t.data.lastChecked||0)||e>i)&&!n.hidden&&n.hasFocus()&&ve.fetchAllStatus(o),ve.timeout=setTimeout(ve.fetchAuto,o)},buttonFetchAll:()=>ve.syncing||ve.requests.length?ve.abort():ve.fetchAllStatus(),fetchAllStatus(e=0){ve.status.textContent="...",x.addClass(ve.refreshButton,"spin"),ve.syncing=!0;const t=[ve.db,ve.unreaddb,pe.db].filter((e=>e));let o=0;return t.map((a=>a.forceSync((function(){if(++o===t.length){let t;if(!ve.syncing)return;if(delete ve.syncing,
0>(t=Date.now()-(ve.db.data.lastChecked||0))||t>=e){let e;const{db:t}=ve,o=Date.now(),i=!(o-2*m<(e=t.data.lastChecked2||0)&&e<=o),s=ve.getAll(!0);for(var a of s)ve.fetchBoard(a,i);t.setLastChecked(),i&&t.setLastChecked("lastChecked2")}if(ve.fetched===ve.requests.length)return ve.clearRequests()}}))))},fetchBoard(e,t){if(!e.some((e=>!e.data.isDead)))return;let o=!1;for(var s of e){var{data:n}=s;n.isDead||-1===n.last||(a["Show Page"]&&null==n.page&&(o=!0),null==n.modified&&(o=s.force=!0))}const{siteID:r,boardID:l}=e[0],d=i.sites[r];if(!d)return;const c=t&&d.threadModTimeIgnoresSage?"catalogJSON":"threadsListJSON",h=d.urls[c]?.({siteID:r,boardID:l});return h?ve.fetch(h,{siteID:r,force:o},[e,h],ve.parseBoard):void 0},parseBoard(e,t){let o,s;if(200!==this.status)return;const{siteID:n,boardID:r}=e[0],l=this.getResponseHeader("Last-Modified");ve.dbLM.extend({siteID:n,boardID:r,val:x.item(t,l)});const d=p();let c=0,h=0,u=null;try{c=this.response[0]?.threads.length||0
;for(let e=0;e<this.response.length;e++)for(var g of(o=this.response[e],o.threads))d[g.no]={page:e+1,index:h,modified:g.last_modified,replies:g.replies},h++,(null==u||g.no<u)&&(u=g.no)}catch(t){for(s of e)ve.fetchStatus(s)}for(s of e){var{threadID:f,data:m}=s;if(d[f]){var b,v,A;if(({page:o,index:b,modified:v,replies:A}=d[f]),a["Show Page"]){var w=i.sites[n].isPrunedByAge?.({siteID:n,boardID:r})?f===u:b>=h-c;ve.update(n,r,f,{page:o,lastPage:w})}ve.unreadEnabled&&a["Show Unread Count"]&&(v!==m.modified||null!=A&&A!==m.replies)&&((s.newData||(s.newData={})).modified=v,ve.fetchStatus(s))}else ve.fetchStatus(s)}},fetchStatus(e){const{siteID:t,boardID:o,threadID:a,data:s,force:n}=e,r=i.sites[t]?.urls.threadJSON?.({siteID:t,boardID:o,threadID:a});if(r&&(!s.isDead||n)&&-1!==s.last)return ve.fetch(r,{siteID:t,force:n},[e],ve.parseStatus)},parseStatus(e,t){let o,s,{siteID:n,boardID:r,threadID:l,data:d,newData:c,force:h}=e;const u=i.sites[n];if(200===this.status&&this.response){let e
;s=this.response.posts[this.response.posts.length-1].no;const i=this.response.posts.length-1;if(o=e=!(!this.response.posts[0].archived&&!t),o&&a["Auto Prune"])return void ve.rm(n,r,l);if(s===d.last&&o===d.isDead&&e===d.isArchived)return;const h=ve.unreaddb.get({siteID:n,boardID:r,threadID:l,defaultValue:0});let b=d.unread||0,v=d.quotingYou||0;const A=!!pe.db?.get({siteID:n,boardID:r,threadID:l,postID:l});for(var p of this.response.posts)if(!(p.no<=(d.last||0)||p.no<=h||pe.db?.get({siteID:n,boardID:r,threadID:l,postID:p.no}))){var g=!1;if(!a["Require OP Quote Link"]&&A)g=!0;else if(pe.db&&p.com){var f,m=u.regexp.quotelinkHTML;for(m.lastIndex=0;f=m.exec(p.com);)if(pe.db.get({siteID:n,boardID:f[1]?encodeURIComponent(f[1]):r,threadID:f[2]||l,postID:f[3]||f[2]||l})){g=!0;break}}(!b||!v&&g)&&Je.isHidden(u.Build.parseJSON(p,{siteID:n,boardID:r}))||(b++,g&&(v=p.no))}return c||(c={}),x.extend(c,{last:s,replies:i,isDead:o,isArchived:e,unread:b,quotingYou:v}),ve.update(n,r,l,c)}
if(404===this.status){const o=i.sites[n]?.urls.archivedThreadJSON?.({siteID:n,boardID:r,threadID:l});return!t&&o?ve.fetch(o,{siteID:n,force:h},[e,!0],ve.parseStatus):u.mayLackJSON&&null==d.last?ve.update(n,r,l,{last:-1}):ve.update(n,r,l,{isDead:!0})}},getAll(e){const t=[];for(var o in ve.db.data){var s=ve.db.data[o];for(var n in s.boards){var r,l=s.boards[n];if(!a["Current Board"]||o===i.SITE.ID&&n===i.BOARD.ID)for(var d in e&&t.push(r=[]),l){var c=l[d];c&&"object"==typeof c&&(e?r:t).push({siteID:o,boardID:n,threadID:d,data:c})}}}return t},makeLine(e,t,o,s){let n;const r=x.el("a",{textContent:"✕",href:"javascript:;"});x.on(r,"click",ve.cb.rm);let{excerpt:l,isArchived:d}=s;l||(l=`/${t}/ - No.${o}`),a["Show Site Prefix"]&&(l=ve.prefixes[e]+l);const c=x.el("a",{href:i.sites[e]?.urls.thread({siteID:e,boardID:t,threadID:o},d)||"",title:l,className:"watcher-link"});if(a["Show Page"]&&null!=s.page&&(n=x.el("span",{textContent:`[${s.page}]`,className:"watcher-page"}),x.add(c,n)),
ve.unreadEnabled&&a["Show Unread Count"]&&null!=s.unread){const e=x.el("span",{textContent:`(${s.unread})`,className:"watcher-unread"});x.add(c,e)}const h=x.el("span",{textContent:l,className:"watcher-title"});x.add(c,h);const u=x.el("div"),p=`${t}.${o}`;return u.dataset.fullID=p,u.dataset.siteID=e,"thread"===i.VIEW&&p===`${i.BOARD}.${i.THREADID}`&&x.addClass(u,"current"),s.isDead&&x.addClass(u,"dead-thread"),a["Show Page"]&&(s.lastPage&&x.addClass(u,"last-page"),null!=s.page&&(u.dataset.page=s.page)),ve.unreadEnabled&&a["Show Unread Count"]&&(0===s.unread&&x.addClass(u,"replies-read"),s.unread&&x.addClass(u,"replies-unread"),(s.quotingYou||0)>(s.dismiss||0)&&x.addClass(u,"replies-quoting-you")),x.add(u,[r,x.tn(" "),c]),u},setPrefixes(e){const t=p();for(var{siteID:o}of e)if(!(o in t)){for(var a=0,i="",s=Object.keys(t);s.length>0;){a++,i=o.slice(0,a);var n=[];for(var r of s)r.slice(0,a)===i?n.push(r):t[r].length<a&&(t[r]=r.slice(0,a));s=n}t[o]=i}return ve.prefixes=t},build(){
const e=[],t=ve.getAll();for(var{siteID:o,boardID:a,threadID:s,data:n}of(ve.setPrefixes(t),t)){var r;null==n.excerpt&&o===i.SITE.ID&&(r=i.threads.get(`${a}.${s}`))&&r.OP&&ve.db.extend({boardID:a,threadID:s,val:{excerpt:w.threadExcerpt(r)}}),e.push(ve.makeLine(o,a,s,n))}const{list:l}=ve;return x.rmAll(l),x.add(l,e),ve.refreshIcon()},refresh(e){if(ve.build(),i.threads.forEach((function(e){const t=ve.isWatched(e);if(e.OP)for(var o of[e.OP,...e.OP.clones]){var a;(a=x(".watch-thread-link",o.nodes.info))&&ve.setToggler(a,t)}if(e.catalogView)return e.catalogView.nodes.root.classList.toggle("watched",t)})),a["Pin Watched Threads"])return x.event("SortIndex",{deferred:!(e&&"catalog"===a["Index Mode"])})},refreshIcon(){for(var e of["replies-unread","replies-quoting-you"])ve.shortcut.classList.toggle(e,!!x(`.${e}`,ve.dialog))},update(e,t,o,i){let s,n,r,l;if(!(s=ve.db?.get({siteID:e,boardID:t,threadID:o})))return;if(i.isDead&&a["Auto Prune"])return void ve.rm(e,t,o)
;if(i.isDead||-1===i.last)for(n of["isArchived","page","lastPage","unread","quotingyou"])n in i||(i[n]=void 0);null!=i.last&&i.last<s.last&&(i.modified=void 0);let d=0;for(n in i)l=i[n],s[n]!==l&&d++;if(d){if(ve.db.extend({siteID:e,boardID:t,threadID:o,val:i}),r=x(`#watched-threads > [data-site-i-d='${e}'][data-full-i-d='${t}.${o}']`,ve.dialog)){const a=ve.makeLine(e,t,o,s);return x.replace(r,a),ve.refreshIcon()}return ve.refresh()}},set404(e,t,o){let i;return(i=ve.db?.get({boardID:e,threadID:t}))?a["Auto Prune"]?(ve.db.delete({boardID:e,threadID:t}),o()):i.isDead&&null==i.isArchived&&null==i.page&&null==i.lastPage&&null==i.unread&&null==i.quotingYou?o():ve.db.extend({boardID:e,threadID:t,val:{isDead:!0,isArchived:void 0,page:void 0,lastPage:void 0,unread:void 0,quotingYou:void 0}},o):o()},toggle(e,t){const o=i.SITE.ID,a=e.board.ID,s=e.ID;return ve.db.get({boardID:a,threadID:s})?ve.rm(o,a,s,void 0,t):ve.add(e,void 0,t)},add(e,t,o){const s={},n=i.SITE.ID,r=e.board.ID,l=e.ID
;if(e.isDead){if(a["Auto Prune"]&&ve.db.get({boardID:r,threadID:l}))return void ve.rm(n,r,l,t);s.isDead=!0}return e.OP&&(s.excerpt=w.threadExcerpt(e)),ve.addRaw(r,l,s,t,o)},addRaw(e,t,o,s,n){const r=ve.db.get({boardID:e,threadID:t,defaultValue:p()});delete r.last,delete r.modified,x.extend(r,o),ve.db.set({boardID:e,threadID:t,val:r},s),ve.refresh(n);const l={siteID:i.SITE.ID,boardID:e,threadID:t,data:o,force:!0};return a["Show Page"]&&!o.isDead?ve.fetchBoard([l]):ve.unreadEnabled&&a["Show Unread Count"]?ve.fetchStatus(l):void 0},rm:(e,t,o,a,i)=>(ve.db.delete({siteID:e,boardID:t,threadID:o},a),ve.refresh(i)),menu:{init(){if(!a["Thread Watcher"])return;const e=this.menu=new X.Menu("thread watcher");return x.on(x(".menu-button",ve.dialog),"click",(function(t){return e.toggle(t,this,ve)})),this.addMenuEntries()},addHeaderMenuEntry(){if("thread"!==i.VIEW)return;const e=x.el("a",{href:"javascript:;"});return Ye.menu.addEntry({el:e,order:60,open(){const[t,o,a]=ve.db.get({boardID:i.BOARD.ID,
threadID:i.THREADID})?["unwatch-thread","watch-thread","Unwatch thread"]:["watch-thread","unwatch-thread","Watch thread"];return x.addClass(e,t),x.rmClass(e,o),e.textContent=a,!0}}),x.on(e,"click",(()=>ve.toggle(i.threads.get(`${i.BOARD}.${i.THREADID}`),!0)))},addMenuEntries(){const e=function(){return this.el.classList.toggle("disabled",!x(".dead-thread",ve.list)),!0},t=[{text:"Open all threads",cb:ve.cb.openAll,open(){return this.el.classList.toggle("disabled",!ve.list.firstElementChild),!0}},{text:"Clear all threads",cb:ve.cb.clear,open(){return this.el.classList.toggle("disabled",!ve.list.firstElementChild),!0}},{text:"Open unread threads",cb:ve.cb.openUnread,open(){return this.el.classList.toggle("disabled",!x(".replies-unread",ve.list)),!0}},{text:"Open unread dead threads",cb:ve.cb.openDeads,open:e},{text:"Prune all dead threads",cb:ve.cb.pruneDeads,open:e},{text:"Prune read dead threads",cb:ve.cb.pruneReadDeads,open:e},{text:"Dismiss posts quoting you",
title:"Unhighlight the thread watcher icon and threads until there are new replies quoting you.",cb:ve.cb.dismiss,open(){return this.el.classList.toggle("disabled",!x.hasClass(ve.shortcut,"replies-quoting-you")),!0}}];for(var{text:o,title:a,cb:i,open:s}of t){var n={el:x.el("a",{textContent:o,href:"javascript:;"})};a&&(n.el.title=a),x.on(n.el,"click",i),n.open=s.bind(n),this.menu.addEntry(n)}for(var r in h.threadWatcher){var l=h.threadWatcher[r];this.addCheckbox(r,l[1])}},addCheckbox(e,t){const o={type:"thread watcher",el:X.checkbox(e,e.replace(" Thread Watcher",""))};o.el.title=t;const a=o.el.firstElementChild;return"Show Unread Count"!==e||ve.unreadEnabled||(a.disabled=!0,x.addClass(o.el,"disabled"),o.el.title+="\n[Remember Last Read Post is disabled.]"),x.on(a,"change",x.cb.checked),["Current Board","Show Page","Show Unread Count","Show Site Prefix"].includes(e)&&x.on(a,"change",(()=>ve.refresh())),
["Show Page","Show Unread Count","Auto Update Thread Watcher"].includes(e)&&x.on(a,"change",ve.fetchAuto),this.menu.addEntry(o)}}};var Ae={init(){if("thread"!==i.VIEW||!a["Reply Pruning"])return;this.container=x.frag(),this.summary=x.el("span",{hidden:!0,className:"summary"}),this.summary.style.cursor="pointer",x.on(this.summary,"click",(()=>(this.inputs.enabled.checked=!this.inputs.enabled.checked,x.event("change",null,this.inputs.enabled))));const e=X.checkbox("Prune Replies","Show Last",a["Prune All Threads"]),t=x.el("span",{title:"Maximum number of replies to show."},{innerHTML:' <input type="number" name="Max Replies" min="0" step="1" value="'+s(a["Max Replies"])+'" class="field">'});return x.prepend(t,e),this.inputs={enabled:e.firstElementChild,replies:t.lastElementChild},this.setEnabled.call(this.inputs.enabled),x.on(this.inputs.enabled,"change",this.setEnabled),x.on(this.inputs.replies,"change",x.cb.value),Ye.menu.addEntry({el:t,order:190}),c.Thread.push({name:"Reply Pruning",
cb:this.node})},position:0,hidden:0,hiddenFiles:0,total:0,totalFiles:0,setEnabled(){const e=xe.input;return this.checked&&e?.checked&&(e.checked=!1,x.event("change",null,e)),Ae.active=this.checked},showIfHidden(e){if(Ae.container&&x(`#${e}`,Ae.container))return Ae.inputs.enabled.checked=!1,x.event("change",null,Ae.inputs.enabled)},node(){let e;return Ae.thread=this,this.isSticky&&(Ae.active=Ae.inputs.enabled.checked=!0,xe.input&&(a["Thread Quotes"]=xe.input.checked=!1)),this.posts.forEach((function(e){if(e.isReply&&(Ae.total++,e.file))return Ae.totalFiles++})),Ae.active&&/^#p\d+$/.test(location.hash)&&1<=(e=this.posts.keys.indexOf(location.hash.slice(2)))&&e<1+Math.max(Ae.total-+a["Max Replies"],0)&&(Ae.active=Ae.inputs.enabled.checked=!1),x.after(this.OP.nodes.root,Ae.summary),x.on(Ae.inputs.enabled,"change",Ae.update),x.on(Ae.inputs.replies,"change",Ae.update),x.on(n,"ThreadUpdate",Ae.updateCount),x.on(n,"ThreadUpdate",Ae.update),Ae.update()},updateCount(e){
if(!e.detail[404])for(var t of e.detail.newPosts)Ae.total++,i.posts.get(t).file&&Ae.totalFiles++},update(){let e,t,o;const s=Ae.hidden,r=Ae.active?Math.max(Ae.total-+a["Max Replies"],0):0,l=n.body.clientHeight-window.scrollY,{posts:d}=Ae.thread;if(Ae.hidden<r){for(;Ae.hidden<r&&Ae.position<d.keys.length;)if(o=d.get(d.keys[Ae.position++]),o.isReply&&!o.isFetchedQuote){for(;(t=Ae.summary.nextSibling)&&t!==o.nodes.root;)x.add(Ae.container,t);x.add(Ae.container,o.nodes.root),Ae.hidden++,o.file&&Ae.hiddenFiles++}}else if(Ae.hidden>r){const e=x.frag();for(;Ae.hidden>r&&Ae.position>0;)if(o=d.get(d.keys[--Ae.position]),o.isReply&&!o.isFetchedQuote){for(;(t=Ae.container.lastChild)&&t!==o.nodes.root;)x.prepend(e,t);x.prepend(e,o.nodes.root),Ae.hidden--,o.file&&Ae.hiddenFiles--}x.after(Ae.summary,e),x.event("PostsInserted",null,Ae.summary.parentNode)}if(Ae.summary.textContent=Ae.active?i.SITE.Build.summaryText("+",Ae.hidden,Ae.hiddenFiles):i.SITE.Build.summaryText("-",Ae.total,Ae.totalFiles),
Ae.summary.hidden=Ae.total<=+a["Max Replies"],s!==r&&(e=Ye.getTopOf(x(".board")))<0)return window.scrollBy(0,Math.max(n.body.clientHeight-l,window.scrollY+e)-window.scrollY)}},xe={init(){a["Quote Threading"]&&"thread"===i.VIEW&&(this.controls=x.el("label",{innerHTML:'<input id="threadingControl" name="Thread Quotes" type="checkbox"> Threading'}),this.threadNewLink=x.el("span",{className:"brackets-wrap threadnewlink",hidden:!0}),x.extend(this.threadNewLink,{innerHTML:'<a href="javascript:;">Thread New Posts</a>'}),this.input=x("input",this.controls),this.input.checked=a["Thread Quotes"],x.on(this.input,"change",this.setEnabled),x.on(this.input,"change",this.rethread),x.on(this.threadNewLink.firstElementChild,"click",this.rethread),x.on(n,"4chanXInitFinished",(()=>{this.ready=!0})),Ye.menu.addEntry(this.entry={el:this.controls,order:99}),c.Thread.push({name:"Quote Threading",cb:this.setThread}),c.Post.push({name:"Quote Threading",cb:this.node}))},parent:p(),children:p(),inserted:p(),
toggleThreading(){this.setThreadingState(!a["Thread Quotes"])},setThreadingState(e){this.input.checked=e,this.setEnabled.call(this.input),this.rethread.call(this.input)},setEnabled(){if(this.checked){x.set("Prune All Threads",!1);const e=Ae.inputs?.enabled;e?.checked&&(e.checked=!1,x.event("change",null,e))}x.cb.checked.call(this)},setThread(){xe.thread=this,x.asap((()=>!a["Thread Updater"]||x(".navLinksBot > .updatelink")),(function(){let e;(e=x(".navLinksBot"))&&x.add(e,[x.tn(" "),xe.threadNewLink])}))},node(){let e;if(this.isFetchedQuote||this.isClone||!this.isReply)return;const t=new Set;let o=null;for(var a of this.quotes)(e=i.posts.get(a))&&!e.isFetchedQuote&&e.isReply&&e.ID<this.ID&&(t.add(e.ID),(!o||e.ID>o.ID)&&(o=e));if(!o)return;let s=o;for(;s=xe.parent[s.fullID];)t.delete(s.ID);1===t.size&&(xe.parent[this.fullID]=o)},descendants(e){let t,o=[e];if(t=xe.children[e.fullID])for(var a of t)o=o.concat(xe.descendants(a));return o},insert(e){let t,o
;if(!a["Thread Quotes"]||!(t=xe.parent[e.fullID])||xe.inserted[e.fullID])return!1;const i=xe.descendants(e);if(!fe.posts.has(t.ID)&&function(){for(var e of i)if(fe.posts.has(e.ID))return!0}())return xe.threadNewLink.hidden=!1,!1;const{order:s}=fe,n=xe.children[t.fullID]||(xe.children[t.fullID]=[]),r=t.nodes.threadContainer||x.el("div",{className:"threadContainer"}),l=[e.nodes.root];e.nodes.threadContainer&&l.push(e.nodes.threadContainer);let d=n.length;for(let t=n.length-1;t>=0;t--){n[t].ID>=e.ID&&d--}if(d!==n.length){const t=n[d];for(o of i)s.before(s[t.ID],s[o.ID]);n.splice(d,0,e),x.before(t.nodes.root,l)}else{let a,d=t;for(;(a=xe.children[d.fullID])&&a.length;)d=a[a.length-1];for(let e=i.length-1;e>=0;e--)o=i[e],s.after(s[d.ID],s[o.ID]);n.push(e),x.add(r,l)}return xe.inserted[e.fullID]=!0,t.nodes.threadContainer||(t.nodes.threadContainer=r,x.addClass(t.nodes.root,"threadOP"),x.after(t.nodes.root,r)),!0},rethread(){if(!xe.ready)return;const{thread:e}=xe,{posts:t}=e
;if(xe.threadNewLink.hidden=!0,a["Thread Quotes"])t.forEach(xe.insert);else{const o=[];fe.order=new ge,xe.inserted=p(),t.forEach((function(e){e.isFetchedQuote||(fe.order.push(e),e.isReply&&o.push(e.nodes.root),xe.children[e.fullID]&&(delete xe.children[e.fullID],x.rmClass(e.nodes.root,"threadOP"),x.rm(e.nodes.threadContainer),delete e.nodes.threadContainer))})),x.add(e.nodes.root,o)}fe.position=fe.order.first,fe.updatePosition(),fe.setLine(!0),fe.read(),fe.update()}};const we={restore(){const e=Xe.to("threadJSON",{boardID:i.boardID,threadID:i.threadID});if(!e)return void new Ke("warning","No archive found",3);(e.startsWith("https://")||a["Exempt Archives from Encryption"])&&Fe.ajax(e,{onloadend(){if(this.status<200||this.status>=400){const t=s(new URL(e).origin);return new Ke("error",x.el("div",{
innerHTML:`There was an error while fetching from the archive. See the console for details.<br />Some archive check the browser first before checking content, you might need to open the archive first to get past the browser check: <a href="${t}" target="_blank">${t}</a><br />If that doesn't work, try a different archive under Settings > Advanced > Archives > Thread fetching.`})),void console.error(this)}let t=0;const o=this.response[i.threadID.toString()].posts;for(const[e,a]of Object.entries(o))we.insert(a)[1]&&++t;let a;a=0===t?"No removed posts found":1===t?"1 post restored":`${t} posts restored`,new Ke("info",a,3)}})},init(){if("thread"!==i.VIEW)return;const e=x.el("a",{href:"javascript:;",textContent:"Restore from archive"});x.on(e,"click",(()=>{we.restore(),Ye.menu.close()})),Ye.menu.addEntry({el:e,order:10})},insert(e){const t=`${e.board.shortname}.${e.num}`;if(i.posts.keys.includes(t))return[void 0,!1];let o=!1;const n=(e=>{
let t=(e.comment||"").split(/(\n|\[\/?(?:b|spoiler|code|moot|banned|fortune(?: color="#\w+")?|i|red|green|blue)\])/);t=t.map(((e,t)=>{if(t%2==1){var o=ye.archiveTags[e.replace(/\ .*\]/,"]")];return"function"==typeof o?o(e):o}var a=">"===e[0];return e=e.replace(/(\[\/?[a-z]+):lit(\])/g,"$1$2").split(/(>>(?:>\/[a-z\d]+\/)?\d+)/g).map(((e,t)=>t%2?`<span class="deadlink">${s(e)}</span>`:s(e))).join(""),{innerHTML:a?`<span class="quote">${e}</span>`:e}})),t={innerHTML:s.cat(t),[y]:!0};const o={ID:e.num,threadID:e.thread_num,boardID:e.board.shortname,isReply:e.num!==e.thread_num,fileDeleted:!1,info:{subject:e.title,email:e.email,name:e.name||"",tripcode:e.trip,capcode:(()=>{switch(e.capcode){case"M":return"Mod";case"A":return"Admin";case"D":return"Developer";case"V":return"Verified";case"F":return"Founder";case"G":return"Manager"}})(),uniqueID:e.poster_hash,flagCode:e.poster_country,flagCodeTroll:e.troll_country_code,flag:e.poster_country_name||e.troll_country_name,dateUTC:e.timestamp,
dateText:e.fourchan_date,commentHTML:t},file:null,extra:null};if(o.info.capcode&&delete o.info.uniqueID,e.media&&+e.media.banned)o.fileDeleted=!0;else if(e.media?.media_filename){let{thumb_link:t}=e.media;"/"===t?.[0]&&(t=url.split("/",3).join("/")+t),Xe.securityCheck(t)||(t="");let a=Xe.to("file",{boardID:o.boardID,filename:e.media.media_orig});Xe.securityCheck(a)||(a=""),o.file={name:e.media.media_filename,url:a||("f"===o.boardID?`${location.protocol}//${T.flashHost()}/${o.boardID}/${encodeURIComponent(s(e.media.media_filename))}`:`${location.protocol}//${T.host()}/${o.boardID}/${e.media.media_orig}`),height:e.media.media_h,width:e.media.media_w,MD5:e.media.media_hash,size:x.bytesToString(e.media.media_size),thumbURL:t||`${location.protocol}//${T.thumbHost()}/${o.boardID}/${e.media.preview_orig}`,theight:e.media.preview_h,twidth:e.media.preview_w,isSpoiler:"1"===e.media.spoiler},/\.pdf$/.test(o.file.url)||(o.file.dimensions=`${o.file.width}x${o.file.height}`),
"f"===o.boardID&&e.media.exif&&(o.file.tag=JSON.parse(e.media.exif).Tag)}o.extra=p();const a=i.boards[o.boardID]||new ce(o.boardID),n=i.threads.get(`${o.boardID}.${o.threadID}`)||new j(o.threadID,a),r=new ae(i.SITE.Build.post(o),n,a);return r.resurrect(),r.markAsFromArchive(),r.file&&(r.file.thumbURL=o.file.thumbURL),Pt.callbackNodes("Post",[r]),r})(e);if(n.resurrect(),n.markAsFromArchive(),n.threadID===i.threadID&&"thread"===i.VIEW){const e=i.posts.insert(t,n,(e=>+e.split(".")[1]<n.ID));a["Thread Quotes"]?n.thread.nodes.root.insertAdjacentElement("beforeend",n.root):i.posts.get(i.posts.keys[e-1]).root.insertAdjacentElement("afterend",n.root),xe.insert(n),o=!0;for(const e of w.allQuotelinksLinkingTo(n))e.href=`#p${n.ID}`}return[n,o]}};class ye{constructor(e,t,o,a,s){let n,r;if(this.boardID=e,this.threadID=t,this.postID=o,this.root=a,this.quoter=s,n=i.posts.get(`${this.boardID}.${this.postID}`))this.insert(n);else{
if((n=Ie.replyData?.[`${this.boardID}.${this.postID}`])&&(r=i.threads.get(`${this.boardID}.${this.threadID}`))){const e=i.boards[this.boardID];return n=new ae(i.SITE.Build.postFromObject(n,this.boardID),r,e,{isFetchedQuote:!0}),Pt.callbackNodes("Post",[n]),void this.insert(n)}if(this.root.textContent=`Loading post No.${this.postID}...`,this.threadID){const e=this;x.cache(i.SITE.urls.threadJSON({boardID:this.boardID,threadID:this.threadID}),(function({isCached:t}){return e.fetchedPost(this,t)}))}else this.archivedPost()}}insert(e){if(!this.root.parentNode)return;this.quoter||(this.quoter=e);const t=e.addClone(this.quoter.context,x.hasClass(this.root,"dialog"));Pt.callbackNodes("Post",[t]);const{nodes:o}=t;x.rmAll(o.root),x.add(o.root,o.post);const a=[...t.nodes.quotelinks,...t.nodes.backlinks];for(var i of a){var{boardID:s,postID:r}=w.postDataFromLink(i);r===this.quoter.ID&&s===this.quoter.board.ID&&x.addClass(i,"forwardlink")}
if(t.nodes.flag&&!ye.flagCSS&&!(ye.flagCSS=x('link[href^="//s.4cdn.org/css/flags."]'))){const e=x('link[href^="//s.4cdn.org/css/"]')?.href.match(/\d+(?=\.css$)|$/)[0]||Date.now();ye.flagCSS=x.el("link",{rel:"stylesheet",href:`//s.4cdn.org/css/flags.${e}.css`}),x.add(n.head,ye.flagCSS)}return x.rmAll(this.root),x.add(this.root,o.root),x.event("PostsInserted",null,this.root)}fetchedPost(e,t){let o;if(o=i.posts.get(`${this.boardID}.${this.postID}`))return void this.insert(o);const{status:a}=e;if(200!==a){if(a&&this.archivedPost())return;return x.addClass(this.root,"warning"),void(this.root.textContent=404===a?`Thread No.${this.threadID} 404'd.`:a?`Error ${e.statusText} (${e.status}).`:"Connection Error")}const{posts:s}=e.response;for(o of(i.SITE.Build.spoilerRange[this.boardID]=s[0].custom_spoiler,s))if(o.no===this.postID)break;if(o.no!==this.postID){if(t){const e=i.SITE.urls.threadJSON({boardID:this.boardID,threadID:this.threadID});x.cleanCache((t=>t===e));const t=this
;return void x.cache(e,(function(){return t.fetchedPost(this,!1)}))}if(this.archivedPost())return;return x.addClass(this.root,"warning"),void(this.root.textContent=`Post No.${this.postID} was not found.`)}const n=i.boards[this.boardID]||new ce(this.boardID),r=i.threads.get(`${this.boardID}.${this.threadID}`)||new j(this.threadID,n);return o=new ae(i.SITE.Build.postFromObject(o,this.boardID),r,n,{isFetchedQuote:!0}),Pt.callbackNodes("Post",[o]),this.insert(o)}archivedPost(){let e;if(!a["Resurrect Quotes"])return!1;if(!(e=Xe.to("post",{boardID:this.boardID,postID:this.postID})))return!1;const t=Xe.data.post[this.boardID],o=/^https:\/\//.test(e)||"http:"===location.protocol;if(o||a["Exempt Archives from Encryption"]){const a=this;return Fe.cache(e,(function(){if(!o&&this.response?.media){const{media:e}=this.response;for(var i in e)/_link$/.test(i)&&(x.getOwn(e,i)?.match(/^http:\/\//)||delete e[i])}return a.parseArchivedPost(this.response,e,t)})),!0}return!1}parseArchivedPost(e,t,o){let a
;if(!(a=i.posts.get(`${this.boardID}.${this.postID}`)))return null==e?(x.addClass(this.root,"warning"),void(this.root.textContent=`Error fetching Post No.${this.postID} from ${o.name}.`)):e.error?(x.addClass(this.root,"warning"),void(this.root.textContent=e.error)):this.insert(we.insert(e)[0]);this.insert(a)}}ye.archiveTags={"\n":{innerHTML:"<br>"},"[b]":{innerHTML:"<b>"},"[/b]":{innerHTML:"</b>"},"[spoiler]":{innerHTML:"<s>"},"[/spoiler]":{innerHTML:"</s>"},"[code]":{innerHTML:'<pre class="prettyprint">'},"[/code]":{innerHTML:"</pre>"},"[moot]":{innerHTML:'<div style="padding:5px;margin-left:.5em;border-color:#faa;border:2px dashed rgba(255,0,0,.1);border-radius:2px">'},"[/moot]":{innerHTML:"</div>"},"[banned]":{innerHTML:'<strong style="color: red;">'},"[/banned]":{innerHTML:"</strong>"},"[fortune]":e=>({innerHTML:'<span class="fortune" style="color:'+s(e.match(/#\w+|$/)[0])+'"><b>'}),"[/fortune]":{innerHTML:"</b></span>"},"[i]":{innerHTML:'<span class="mu-i">'},"[/i]":{
innerHTML:"</span>"},"[red]":{innerHTML:'<span class="mu-r">'},"[/red]":{innerHTML:"</span>"},"[green]":{innerHTML:'<span class="mu-g">'},"[/green]":{innerHTML:"</span>"},"[blue]":{innerHTML:'<span class="mu-b">'},"[/blue]":{innerHTML:"</span>"}};var ke={init(){if(a["Quote Previewing"]&&("archive"===i.VIEW&&x.on(n,"mouseover",(function(e){if("A"===e.target.nodeName&&x.hasClass(e.target,"quotelink"))return ke.mouseover.call(e.target,e)})),["index","thread"].includes(i.VIEW)))return a["Comment Expansion"]&&ue.callbacks.push(this.node),c.Post.push({name:"Quote Previewing",cb:this.node})},node(){for(var e of this.nodes.quotelinks.concat([...this.nodes.backlinks],this.nodes.archivelinks))x.on(e,"mouseover",ke.mouseover)},mouseover(e){let t;if(x.hasClass(this,"inlined")&&!x.hasClass(r,"catalog-mode")||!n.contains(this))return;const{boardID:o,threadID:s,postID:l}=w.postDataFromLink(this),d=x.el("div",{id:"qp",className:"dialog"});if(x.add(Ye.hover,d),new ye(o,s,l,d,w.postFromNode(this)),
X.hover({root:this,el:d,latestEvent:e,endEvents:"mouseout click",cb:ke.mouseout}),a["Quote Highlighting"]&&(t=i.posts.get(`${o}.${l}`))){const e=[t].concat(t.clones);for(var c of(e.pop(),e))x.addClass(c.nodes.post,"qphl")}},mouseout(){let e;if(!(e=this.el.firstElementChild))return;x.event("PostsRemoved",null,Ye.hover);let t=w.postFromRoot(e).origin;if(t.rmClone(e.dataset.clone),a["Quote Highlighting"])for(t of[t].concat(t.clones))x.rmClass(t.nodes.post,"qphl")}},Ie={showHiddenThreads:!1,changed:{},enabledOn:({siteID:e,boardID:t})=>a["JSON Index"]&&"yotsuba"===i.sites[e].software&&"f"!==t,init(){let e,t,o;if("index"!==i.VIEW)return;if(x.one(n,"4chanXInitFinished",this.cb.initFinished),x.on(n,"PostsInserted",this.cb.postsInserted),!this.enabledOn(i.BOARD))return;this.enabled=!0,c.Post.push({name:"Index Page Numbers",cb:this.node}),c.CatalogThread.push({name:"Catalog Features",cb:this.catalogNode}),this.search=history.state?.searched||"",
history.state?.mode&&(a["Index Mode"]=history.state?.mode),this.currentSort=history.state?.sort,this.currentSort||(this.currentSort="object"==typeof a["Index Sort"]?a["Index Sort"][i.BOARD.ID]||"bump":a["Index Sort"]),this.currentPage=this.getCurrentPage(),this.processHash(),x.addClass(r,"index-loading",`${a["Index Mode"].replace(/\ /g,"-")}-mode`),x.on(window,"popstate",this.cb.popstate),x.on(n,"scroll",this.scroll),x.on(n,"SortIndex",this.cb.resort),this.button=x.el("a",{title:"Refresh",href:"javascript:;"}),M.set(this.button,"refresh","Refresh"),x.on(this.button,"click",(()=>Ie.update())),Ye.addShortcut("index-refresh",this.button,590);const s=[];for(o in this.inputs=t=p(),h.Index){var l=h.Index[o];if(l instanceof Array){var d=X.checkbox(o,`${o[0]}${o.slice(1).toLowerCase()}`);d.title=l[1],s.push({el:d}),e=d.firstChild,x.on(e,"change",x.cb.checked),t[o]=e}}x.on(t["Show Replies"],"change",this.cb.replies),x.on(t["Catalog Hover Expand"],"change",this.cb.hover),
x.on(t["Pin Watched Threads"],"change",this.cb.resort),x.on(t["Anchor Hidden Threads"],"change",this.cb.resort);const u=function(o){if(e=x.getOwn(t,o.target.name))return e.checked=o.target.checked,x.event("change",null,e)};x.on(n,"OpenSettings",(()=>x.on(x.id("fourchanx-settings"),"change",u)));const g=X.checkbox("Per-Board Sort Type","Per-board sort type","object"==typeof a["Index Sort"]);for(var f of(g.title="Set the sorting order of each board independently.",x.on(g.firstChild,"change",this.cb.perBoardSort),s.splice(3,0,{el:g}),Ye.menu.addEntry({el:x.el("span",{textContent:"Index Navigation"}),order:100,subEntries:s}),this.navLinks=x.el("div",{className:"navLinks json-index"}),x.extend(this.navLinks,{
innerHTML:'<span class="brackets-wrap indexlink"><a href="#index">Index</a></span>  <span class="brackets-wrap cataloglink"><a href="#catalog">Catalog</a></span>  <span class="brackets-wrap archlistlink"><a href="./archive">Archive</a></span>  <span class="brackets-wrap bottomlink"><a href="#bottom">Bottom</a></span>  <span class="brackets-wrap" id="index-last-refresh"><a href="javascript:;"><time title="Last index refresh">...</time></a></span>  <input type="search" id="index-search" class="field" placeholder="Search"> <a id="index-search-clear" href="javascript:;" title="Clear search">×</a> <span id="hidden-label" hidden> &mdash; <span id="hidden-count"></span> <span id="hidden-toggle">[<a href="javascript:;">Show</a>]</span></span> <span id="index-options"> <input type="checkbox" id="index-rev" name="Reverse Sort" title="Reverse sort order"> <span id="lastlong-options" hidden> <input type="text" title="Minimum letter count (without image)"> <input type="text" title="Minimum letter count (with image)"> </span> <select id="index-sort" name="Index Sort"> <option disabled>Index Sort</option> <option value="bump">Bump order</option> <option value="lastreply">Last reply</option> <option value="lastlong">Last long reply</option> <option value="birth">Creation date</option> <option value="replycount">Reply count</option> <option value="filecount">File count</option> <option value="activity">Posts per minute</option> </select> <select id="index-size" name="Index Size"> <option disabled>Image Size</option> <option value="small">Small</option> <option value="large">Large</option> </select> <select id="index-mode" name="Index Mode"> <option disabled>Index Mode</option> <option value="paged">Paged</option> <option value="infinite">Infinite scrolling</option> <option value="all pages">All threads</option> <option value="catalog">Catalog</option> </select> </span>'
}),x(".cataloglink a",this.navLinks).href=_e.catalog(),se.isArchived(i.BOARD.ID)||(x(".archlistlink",this.navLinks).hidden=!0),x.on(x("#index-last-refresh a",this.navLinks),"click",this.cb.refreshFront),this.searchInput=x("#index-search",this.navLinks),this.setupSearch(),x.on(this.searchInput,"input",this.onSearchInput),x.on(x("#index-search-clear",this.navLinks),"click",this.clearSearch),this.hideLabel=x("#hidden-label",this.navLinks),x.on(x("#hidden-toggle a",this.navLinks),"click",this.cb.toggleHiddenThreads),this.selectRev=x("#index-rev",this.navLinks),this.selectMode=x("#index-mode",this.navLinks),this.selectSort=x("#index-sort",this.navLinks),this.selectSize=x("#index-size",this.navLinks),x.on(this.selectRev,"change",this.cb.sort),x.on(this.selectMode,"change",this.cb.mode),x.on(this.selectSort,"change",this.cb.sort),x.on(this.selectSize,"change",x.cb.value),x.on(this.selectSize,"change",this.cb.size),[this.selectMode,this.selectSize]))f.value=a[f.name]
;this.selectRev.checked=/-rev$/.test(Ie.currentSort),this.selectSort.value=Ie.currentSort.replace(/-rev$/,""),this.lastLongOptions=x("#lastlong-options",this.navLinks),this.lastLongInputs=S("input",this.lastLongOptions),this.lastLongThresholds=[0,0],this.lastLongOptions.hidden="lastlong"!==this.selectSort.value;for(let t=0;t<this.lastLongInputs.length;t++){e=this.lastLongInputs[t],x.on(e,"change",this.cb.lastLongThresholds);var m=a[`Last Long Reply Thresholds ${t}`];e.value=this.lastLongThresholds[t]="object"==typeof m?m[i.BOARD.ID]??100:m}return this.root=x.el("div",{className:"board json-index"}),x.on(this.root,"click",this.cb.hoverToggle),this.cb.size(),this.cb.hover(),this.pagelist=x.el("div",{className:"pagelist json-index"}),x.extend(this.pagelist,{
innerHTML:'<div class="prev"> <a> <button disabled>Previous</button> </a> </div> <div class="pages"></div> <div class="next"> <a> <button disabled>Next</button> </a> </div> <div class="pages cataloglink"> <a href="./catalog">Catalog</a> </div>'}),x(".cataloglink a",this.pagelist).href=_e.catalog(),x.on(this.pagelist,"click",this.cb.pageNav),this.update(!0),x.onExists(r,"title + *",(()=>n.title=n.title.replace(/\ -\ Page\ \d+/,""))),x.onExists(r,".board > .thread > .postContainer, .board + *",(function(){let e;i.SITE.Build.hat=x(".board > .thread > img:first-child"),i.SITE.Build.hat&&(i.BOARD.threads.forEach((function(e){if(e.nodes.root)return x.prepend(e.nodes.root,i.SITE.Build.hat.cloneNode(!1))})),x.addClass(r,"hats-enabled"),x.addStyle(`.catalog-thread::after {background-image: url(${i.SITE.Build.hat.src});}`));const t=x(".board");x.replace(t,Ie.root),Ie.loaded&&x.event("PostsInserted",null,Ie.root);try{n.implementation.createDocument(null,null,null).appendChild(t)}catch(e){}
for(e of S(".navLinks"))x.rm(e);x.rm(x.id("ctrl-top"));const o=x.id("delform").previousElementSibling;x.before(o,x.el("hr")),x.before(o,Ie.navLinks);const a=x("#index-last-refresh time",Ie.navLinks);if(a.dataset.utc)return de.update(a)})),Pt.ready((function(){let e;return(e=x(".pagelist"))&&x.replace(e,Ie.pagelist),x.rmClass(r,"index-loading")}))},scroll(){if(Ie.req||!Ie.liveThreadData||"infinite"!==a["Index Mode"]||window.scrollY<=r.scrollHeight-(300+window.innerHeight))return;null==Ie.pageNum&&(Ie.pageNum=Ie.currentPage);const e=++Ie.pageNum;if(e>Ie.pagesNum)return Ie.endNotice();const t=Ie.threadsOnPage(e);return Ie.buildStructure(t)},endNotice:function(){let e=!1;const t=()=>e=!1;return function(){if(!e)return e=!0,new Ke("info","Last page reached.",2),setTimeout(t,3e3)}}(),menu:{init(){if("index"===i.VIEW&&a.Menu&&a["Thread Hiding Link"]&&Ie.enabledOn(i.BOARD))return ne.menu.addEntry({el:x.el("a",{href:"javascript:;",className:"has-shortcut-text"},{
innerHTML:'<span></span><span class="shortcut-text">Shift+click</span>'}),order:20,open({thread:e}){return"catalog"===a["Index Mode"]&&(this.el.firstElementChild.textContent=e.isHidden?"Unhide":"Hide",this.cb&&x.off(this.el,"click",this.cb),this.cb=function(){return x.event("CloseMenu"),Ie.toggleHide(e)},x.on(this.el,"click",this.cb),!0)}})}},node(){if(!this.isReply&&!this.isClone&&null!=Ie.threadPosition[this.ID])return this.thread.setPage(Math.floor(Ie.threadPosition[this.ID]/Ie.threadsNumPerPage)+1)},catalogNode(){return x.on(this.nodes.root,"click",(e=>{0===e.button&&e.shiftKey&&(e.preventDefault(),getSelection().removeAllRanges(),a["MD5 Quick Filter in the Catalog"]&&e.target.classList.contains("catalog-thumb")?Je.quickFilterMD5.call(this.thread.OP):Ie.toggleHide(this.thread))}))},toggleHide(e){if(Ie.showHiddenThreads){if(Ce.show(e),!Ce.db.get({boardID:e.board.ID,threadID:e.ID}))return}else Ce.hide(e);return Ce.saveHiddenState(e)},cycleSortType(){let e
;const t=Ie.selectSort.options.filter((e=>!e.disabled));for(e=0;e<t.length;e++){if(t[e].selected)break}return t[(e+1)%t.length].selected=!0,x.event("change",null,Ie.selectSort)},cb:{initFinished:()=>(Ie.initFinishedFired=!0,x.queueTask((()=>Ie.cb.postsInserted()))),postsInserted(){if(!Ie.initFinishedFired)return;let e=0;return i.posts.forEach((function(t){if(!t.isFetchedQuote&&!t.indexRefreshSeen&&r.contains(t.nodes.root))return t.indexRefreshSeen=!0,e++})),e?x.event("IndexRefresh"):void 0},toggleHiddenThreads:()=>(x("#hidden-toggle a",Ie.navLinks).textContent=(Ie.showHiddenThreads=!Ie.showHiddenThreads)?"Hide":"Show",Ie.sort(),Ie.buildIndex()),mode(){return Ie.pushState({mode:this.value}),Ie.pageLoad(!1)},sort(){const e=Ie.selectRev.checked?Ie.selectSort.value+"-rev":Ie.selectSort.value;return Ie.pushState({sort:e}),Ie.pageLoad(!1)},resort(e){if(Ie.changed.order=!0,!e?.detail?.deferred)return Ie.pageLoad(!1)},perBoardSort(){a["Index Sort"]=this.checked?p():"",Ie.saveSort()
;for(let e=0;e<2;e++)a[`Last Long Reply Thresholds ${e}`]=this.checked?p():"",Ie.saveLastLongThresholds(e)},lastLongThresholds(){const e=[...this.parentNode.children].indexOf(this),t=+this.value;if(Number.isFinite(t))return Ie.lastLongThresholds[e]=t,Ie.saveLastLongThresholds(e),Ie.changed.order=!0,Ie.pageLoad(!1);this.value=Ie.lastLongThresholds[e]},size(e){if("catalog"!==a["Index Mode"]?(x.rmClass(Ie.root,"catalog-small"),x.rmClass(Ie.root,"catalog-large")):"small"===a["Index Size"]?(x.addClass(Ie.root,"catalog-small"),x.rmClass(Ie.root,"catalog-large")):(x.addClass(Ie.root,"catalog-large"),x.rmClass(Ie.root,"catalog-small")),e)return Ie.buildIndex()},replies:()=>Ie.buildIndex(),hover:()=>r.classList.toggle("catalog-hover-expand",a["Catalog Hover Expand"]),hoverToggle(e){if(a["Catalog Hover Toggle"]&&x.hasClass(r,"catalog-mode")&&!x.modifiedClick(e)&&!x.x("ancestor-or-self::a",e.target)){let t;const o=Ie.inputs["Catalog Hover Expand"];if(o.checked=!o.checked,x.event("change",null,o),
t=w.threadFromNode(e.target))return Ie.cb.catalogReplies.call(t),Ie.cb.hoverAdjust.call(t.OP.nodes)}},popstate(e){if(e?.state){const{searched:t,mode:o,sort:a}=e.state,i=Ie.getCurrentPage();return Ie.setState({search:t,mode:o,sort:a,page:i}),Ie.pageLoad(!1)}{const e=Ie.processHash();return a["Refreshed Navigation"]&&e?Ie.update():Ie.pageLoad()}},pageNav(e){let t;if(!x.modifiedClick(e)){switch(e.target.nodeName){case"BUTTON":e.target.blur(),t=e.target.parentNode;break;case"A":t=e.target;break;default:return}if("Catalog"!==t.textContent)return e.preventDefault(),Ie.userPageNav(+t.pathname.split(/\/+/)[2]||1)}},refreshFront:()=>(Ie.pushState({page:1}),Ie.update()),catalogReplies(){if(a["Show Replies"]&&x.hasClass(r,"catalog-hover-expand")&&!this.catalogView.nodes.replies)return Ie.buildCatalogReplies(this)},hoverAdjust(){let e;if(!x.hasClass(r,"catalog-hover-expand"))return;const t=this.post.getBoundingClientRect();if(e=x.minmax(0,-t.left,r.clientWidth-t.right)){const{style:t}=this.post
;return t.left=`${e}px`,t.right=-e+"px",x.one(this.root,"mouseleave",(()=>t.left=t.right=null))}}},scrollToIndex:()=>Ye.scrollToIfNeeded(Ie.navLinks.getBoundingClientRect().height?Ie.navLinks:Ie.root),getCurrentPage:()=>+window.location.pathname.split(/\/+/)[2]||1,userPageNav:e=>(Ie.pushState({page:e}),a["Refreshed Navigation"]?Ie.update():Ie.pageLoad()),hashCommands:{mode:{paged:"paged","infinite-scrolling":"infinite",infinite:"infinite","all-threads":"all pages","all-pages":"all pages",catalog:"catalog"},sort:{"bump-order":"bump","last-reply":"lastreply","last-long-reply":"lastlong","creation-date":"birth","reply-count":"replycount","file-count":"filecount","posts-per-minute":"activity"}},processHash(){let e=location.href.match(/#.*/)?.[0]||"";const t={replace:!0},o=e.slice(1).split("/"),i=[];for(var s of o){var n,r;(n=x.getOwn(Ie.hashCommands.mode,s))?t.mode=n:"index"===s?(t.mode=a["Previous Index Mode"],t.page=1):(r=x.getOwn(Ie.hashCommands.sort,s.replace(/-rev$/,"")))?(t.sort=r,
/-rev$/.test(s)&&(t.sort+="-rev")):/^s=/.test(s)?t.search=decodeURIComponent(s.slice(2)).replace(/\+/g," ").trim():i.push(s)}return e=i.join("/"),e&&(t.hash=`#${e}`),Ie.pushState(t),o.length-i.length},pushState(e){let{search:t,hash:o,replace:s}=e,n=history.state?.oldpage;null!=t&&t!==Ie.search&&(e.page=t?1:n||1,t?Ie.search||(n=Ie.currentPage):n=void 0),Ie.setState(e);const r=1===Ie.currentPage?`/${i.BOARD}/`:`/${i.BOARD}/${Ie.currentPage}`;return o||(o=""),history[s?"replaceState":"pushState"]({mode:a["Index Mode"],sort:Ie.currentSort,searched:Ie.search,oldpage:n},"",`${location.protocol}//${location.host}${r}${o}`)},setState({search:e,mode:t,sort:o,page:i,hash:s}){if(null!=e&&e!==Ie.search&&(Ie.changed.search=!0,Ie.search=e),null!=t&&t!==a["Index Mode"]&&(Ie.changed.mode=!0,a["Index Mode"]=t,x.set("Index Mode",t),"catalog"!==t&&a["Previous Index Mode"]!==t&&(a["Previous Index Mode"]=t,x.set("Previous Index Mode",t))),null!=o&&o!==Ie.currentSort&&(Ie.changed.sort=!0,Ie.currentSort=o,
Ie.saveSort()),["all pages","catalog"].includes(a["Index Mode"])&&(i=1),null!=i&&i!==Ie.currentPage&&(Ie.changed.page=!0,Ie.currentPage=i),null!=s)return Ie.changed.hash=!0},savePerBoard:(e,t)=>("object"==typeof a[e]?a[e][i.BOARD.ID]=t:a[e]=t,x.set(e,a[e])),saveSort:()=>Ie.savePerBoard("Index Sort",Ie.currentSort),saveLastLongThresholds:e=>Ie.savePerBoard(`Last Long Reply Thresholds ${e}`,Ie.lastLongThresholds[e]),pageLoad(e=!0){if(!Ie.liveThreadData)return;let{threads:t,order:o,search:a,mode:i,sort:s,page:n,hash:r}=Ie.changed;return t||(t=a),o||(o=s),(t||o)&&Ie.sort(),t&&Ie.buildPagelist(),a&&Ie.setupSearch(),i&&Ie.setupMode(),s&&Ie.setupSort(),(t||i||n||o)&&Ie.buildIndex(),(t||n)&&Ie.setPage(),e&&!r&&Ie.scrollToIndex(),Ie.changed={}},setupMode(){for(var e of["paged","infinite","all pages","catalog"])x[e===a["Index Mode"]?"addClass":"rmClass"](r,`${e.replace(/\ /g,"-")}-mode`);return Ie.selectMode.value=a["Index Mode"],Ie.cb.size(),Ie.showHiddenThreads=!1,
x("#hidden-toggle a",Ie.navLinks).textContent="Show"},setupSort:()=>(Ie.selectRev.checked=/-rev$/.test(Ie.currentSort),Ie.selectSort.value=Ie.currentSort.replace(/-rev$/,""),Ie.lastLongOptions.hidden="lastlong"!==Ie.selectSort.value),getPagesNum:()=>Ie.search?Math.ceil(Ie.sortedThreadIDs.length/Ie.threadsNumPerPage):Ie.pagesNum,getMaxPageNum:()=>Math.max(1,Ie.getPagesNum()),buildPagelist(){const e=x(".pages",Ie.pagelist),t=Ie.getMaxPageNum();if(e.childElementCount!==t){const a=[];for(let e=1,i=t;e<=i;e++){var o=x.el("a",{textContent:e,href:1===e?"./":e});a.push(x.tn("["),o,x.tn("] "))}return x.rmAll(e),x.add(e,a)}},setPage(){let e,t;const o=Ie.currentPage,a=Ie.getMaxPageNum(),i=x(".pages",Ie.pagelist),s=i.previousElementSibling.firstElementChild,n=i.nextElementSibling.firstElementChild;let r=Math.max(o-1,1);if(s.href=1===r?"./":r,s.firstElementChild.disabled=r===o,r=Math.min(o+1,a),n.href=1===r?"./":r,n.firstElementChild.disabled=r===o,t=x("strong",i)){if(+t.textContent===o)return
;x.replace(t,t.firstChild)}else t=x.el("strong");if(e=i.children[o-1])return x.before(e,t),x.add(t,e)},updateHideLabel(){if(!Ie.hideLabel)return;let e=0;for(var t of Ie.liveThreadIDs)Ie.isHidden(t)&&e++;return e?(Ie.hideLabel.hidden=!1,x("#hidden-count",Ie.navLinks).textContent=1===e?"1 hidden thread":`${e} hidden threads`):(Ie.hideLabel.hidden=!0,void(Ie.showHiddenThreads&&Ie.cb.toggleHiddenThreads()))},update(e){let t;if((t=Ie.req)&&(delete Ie.req,t.abort()),a["Index Refresh Notifications"]?(Ie.notice||(Ie.notice=new Ke("info","Refreshing index...")),Ie.nTimeout||(Ie.nTimeout=setTimeout((()=>{Ie.notice&&(Ie.notice.el.lastElementChild.textContent+=" (disable JSON Index if this takes too long)")}),3e3))):Ie.nTimeout||(Ie.nTimeout=setTimeout((()=>Ie.notice||(Ie.notice=new Ke("info","Refreshing index... (disable JSON Index if this takes too long)"))),3e3)),e||"loading"===n.readyState||x(".board + *"))return Ie.req=x.whenModified(i.SITE.urls.catalogJSON({boardID:i.BOARD.ID
}),"Index",Ie.load),x.addClass(Ie.button,"spin");location.reload()},load(){let e;if(this!==Ie.req)return;x.rmClass(Ie.button,"spin");const{notice:t,nTimeout:o}=Ie;if(o&&clearTimeout(o),delete Ie.nTimeout,delete Ie.req,delete Ie.notice,![200,304].includes(this.status))return e="Index refresh failed. "+(this.status?`Error ${this.statusText} (${this.status})`:"Connection Error"),void(t?(t.setType("warning"),t.el.lastElementChild.textContent=e,setTimeout(t.close,g)):new Ke("warning",e,1));try{200===this.status?Ie.parse(this.response):304===this.status&&Ie.pageLoad()}catch(o){return e=o,l.error(`Index failure: ${e.message}`,e.stack),void(t?(t.setType("error"),t.el.lastElementChild.textContent="Index refresh failed.",setTimeout(t.close,g)):new Ke("error","Index refresh failed.",1))}t&&(a["Index Refresh Notifications"]?(t.setType("success"),t.el.lastElementChild.textContent="Index refreshed!",setTimeout(t.close,g)):t.close());const i=x("#index-last-refresh time",Ie.navLinks)
;return i.dataset.utc=Date.parse(this.getResponseHeader("Last-Modified")),de.update(i)},parse:e=>(x.cleanCache((e=>/^https?:\/\/a\.4cdn\.org\//.test(e))),Ie.parseThreadList(e),Ie.changed.threads=!0,Ie.pageLoad()),parseThreadList(e){Ie.pagesNum=e.length,Ie.threadsNumPerPage=e[0]?.threads.length||1,Ie.liveThreadData=e.reduce(((e,t)=>e.concat(t.threads)),[]),Ie.liveThreadIDs=Ie.liveThreadData.map((e=>e.no)),Ie.liveThreadDict=p(),Ie.threadPosition=p(),Ie.parsedThreads=p(),Ie.replyData=p();for(let e=0;e<Ie.liveThreadData.length;e++){var t,o,a=Ie.liveThreadData[e];if(Ie.liveThreadDict[a.no]=a,Ie.threadPosition[a.no]=e,Ie.parsedThreads[a.no]=t=i.SITE.Build.parseJSON(a,i.BOARD),o=Je.test(t),t.isOnTop=o.top,t.isHidden=o.hide||Ce.isHidden(t.boardID,t.threadID),a.last_replies)for(var s of a.last_replies)Ie.replyData[`${i.BOARD}.${s.no}`]=s}Ie.liveThreadData[0]&&(i.SITE.Build.spoilerRange[i.BOARD.ID]=Ie.liveThreadData[0].custom_spoiler),i.BOARD.threads.forEach((function(e){
if(!Ie.liveThreadIDs.includes(e.ID))return e.collect()})),x.event("IndexUpdate",{threads:Ie.liveThreadIDs.map((e=>`${i.BOARD}.${e}`))})},isHidden(e){let t;return(t=i.BOARD.threads.get(e))&&t.OP&&!t.OP.isFetchedQuote?t.isHidden:Ie.parsedThreads[e].isHidden},isHiddenReply:(e,t)=>le.isHidden(i.BOARD.ID,e,t.no)||Je.isHidden(i.SITE.Build.parseJSON(t,i.BOARD)),buildThreads(e,t,o){let a;const s=[],n=[];let r=[];for(var l of e){var d,c;try{var h,u=Ie.liveThreadDict[l];if(c=i.BOARD.threads.get(l))c.json!==u&&JSON.stringify(c.json)!==JSON.stringify(u)&&(c.setCount("post",u.replies+1,u.bumplimit),c.setCount("file",u.images+!!u.ext,u.imagelimit),c.setStatus("Sticky",!!u.sticky),c.setStatus("Closed",!!u.closed)),c.catalogView&&(x.rm(c.catalogView.nodes.replies),c.catalogView.nodes.replies=null);else c=new j(l,i.BOARD),n.push(c);var p=u.last_replies&&u.last_replies.length?u.last_replies[u.last_replies.length-1].no:l;if(p>c.lastPost&&(c.lastPost=p),c.json=u,s.push(c),
(h=c.OP)&&!h.isFetchedQuote)h.setCatalogOP(t),c.setPage(Math.floor(Ie.threadPosition[l]/Ie.threadsNumPerPage)+1);else{var g=Ie.parsedThreads[l];d=i.SITE.Build.post(g),(h=new ae(d,c,i.BOARD)).filterResults=g.filterResults,r.push(h)}t&&c.nodes.root||i.SITE.Build.thread(c,u,o)}catch(e){a||(a=[]),a.push({message:`Parsing of Thread No.${c} failed. Thread will be skipped.`,error:e,html:d?.outerHTML})}}return a&&Pt.handleErrors(a),o&&(r=r.concat(Ie.buildReplies(s))),Pt.callbackNodes("Thread",n),Pt.callbackNodes("Post",r),Ie.updateHideLabel(),x.event("IndexRefreshInternal",{threadIDs:s.map((e=>e.fullID)),isCatalog:t}),s},buildReplies(e){let t;const o=[];for(var a of e){var s;if(s=Ie.liveThreadDict[a.ID].last_replies){var n=[];for(var r of s){var l,d;if(!(d=a.posts.get(r.no))||d.isFetchedQuote){n.push(l=i.SITE.Build.postFromObject(r,a.board.ID));try{o.push(new ae(l,a,a.board))}catch(e){t||(t=[]),t.push({message:`Parsing of Post No.${r.no} failed. Post will be skipped.`,error:e,html:l?.outerHTML
})}}else n.push(d.nodes.root)}x.add(a.nodes.root,n)}}return t&&Pt.handleErrors(t),o},buildCatalogViews(e){const t=[];for(var o of e)if(!o.catalogView){var{ID:a}=o,s=Math.floor(Ie.threadPosition[a]/Ie.threadsNumPerPage)+1,n=i.SITE.Build.catalogThread(o,Ie.liveThreadDict[a],s);t.push(new U(n,o))}Pt.callbackNodes("CatalogThread",t)},sizeCatalogViews(e){const t="small"===a["Index Size"]?150:250;for(var o of e){var{thumb:i}=o.catalogView.nodes,{width:s,height:n}=i.dataset;if(s){var r=t/Math.max(s,n);i.style.width=s*r+"px",i.style.height=n*r+"px"}}},buildCatalogReplies(e){let t;const{nodes:o}=e.catalogView;if(!(t=Ie.liveThreadDict[e.ID].last_replies))return;const a=[];for(var s of t)if(!Ie.isHiddenReply(e.ID,s)){var n=i.SITE.Build.catalogReply(e,s);de.update(x("time",n)),x.on(x(".catalog-reply-preview",n),"mouseover",ke.mouseover),a.push(n)}o.replies=x.el("div",{className:"catalog-replies"}),x.add(o.replies,a),x.add(e.OP.nodes.post,o.replies)},sort(){let e
;const{liveThreadIDs:t,liveThreadData:o}=Ie;if(!o)return;const s=(new Date).getTime()/1e3,n=Ie.currentSort.replace(/-rev$/,"");return Ie.sortedThreadIDs=(()=>{switch(n){case"lastreply":case"lastlong":var e=o.some((e=>e.last_replies?.length)),a=function(t){if(!e)return t.last_modified;const o=t.last_replies||[];for(let e=o.length-1;e>=0;e--){var a=o[e];if(!Ie.isHiddenReply(t.no,a)){if("lastreply"===n)return a;if((a.com?i.SITE.Build.parseComment(a.com).replace(/[^a-z]/gi,"").length:0)>=Ie.lastLongThresholds[+!!a.ext])return a}}return t.omitted_posts&&t.last_replies?.length?t.last_replies[0]:t},r=p();for(var l of o)r[l.no]=a(l).no;return[...o].sort(((e,t)=>r[t.no]-r[e.no])).map((e=>e.no));case"bump":default:return t;case"birth":return[...t].sort(((e,t)=>t-e));case"replycount":return[...o].sort(((e,t)=>t.replies-e.replies)).map((e=>e.no));case"filecount":return[...o].sort(((e,t)=>t.images-e.images)).map((e=>e.no));case"activity":
return[...o].sort(((e,t)=>(s-e.time)/(e.replies+1)-(s-t.time)/(t.replies+1))).map((e=>e.no))}})(),/-rev$/.test(Ie.currentSort)&&Ie.sortedThreadIDs.reverse(),Ie.search&&(e=Ie.querySearch(Ie.search))&&(Ie.sortedThreadIDs=e),Ie.sortOnTop((e=>e.isSticky)),Ie.sortOnTop((e=>e.isOnTop||a["Pin Watched Threads"]&&ve.isWatchedRaw(e.boardID,e.threadID))),a["Anchor Hidden Threads"]?Ie.sortOnTop((e=>!Ie.isHidden(e.threadID))):void 0},sortOnTop(e){const t=[],o=[];for(var a of Ie.sortedThreadIDs)(e(Ie.parsedThreads[a])?t:o).push(a);return Ie.sortedThreadIDs=t.concat(o)},buildIndex(){let e;if(Ie.liveThreadData){switch(a["Index Mode"]){case"all pages":e=Ie.sortedThreadIDs;break;case"catalog":e=Ie.sortedThreadIDs.filter((e=>!Ie.isHidden(e)!==Ie.showHiddenThreads));break;default:e=Ie.threadsOnPage(Ie.currentPage)}delete Ie.pageNum,x.rmAll(Ie.root),x.rmAll(Ye.hover),Ie.loaded&&Ie.root.parentNode&&x.event("PostsRemoved",null,Ie.root),"catalog"===a["Index Mode"]?Ie.buildCatalog(e):Ie.buildStructure(e)}},
threadsOnPage(e){const t=Ie.threadsNumPerPage,o=t*(e-1);return Ie.sortedThreadIDs.slice(o,o+t)},buildStructure(e){const t=Ie.buildThreads(e,!1,a["Show Replies"]),o=[];for(var i of t)o.push(i.nodes.root,x.el("hr"));x.add(Ie.root,o),Ie.root.parentNode&&x.event("PostsInserted",null,Ie.root),Ie.loaded=!0},buildCatalog(e){let t=0;const o=e.length;let a=null;var i=function(){if(a&&!a.parentNode)return;const s=t>0&&Ie.root.parentNode?o:t+30;return a=Ie.buildCatalogPart(e.slice(t,s))[0],t=s,t<o?x.queueTask(i):(Ie.root.parentNode&&x.event("PostsInserted",null,Ie.root),Ie.loaded=!0)};i()},buildCatalogPart(e){const t=Ie.buildThreads(e,!0);Ie.buildCatalogViews(t),Ie.sizeCatalogViews(t);const o=[];for(var a of t)a.OP.setCatalogOP(!0),x.add(a.catalogView.nodes.root,a.OP.nodes.root),o.push(a.catalogView.nodes.root),x.on(a.catalogView.nodes.root,"mouseenter",Ie.cb.catalogReplies.bind(a)),x.on(a.OP.nodes.root,"mouseenter",Ie.cb.hoverAdjust.bind(a.OP.nodes));return x.add(Ie.root,o),o},
clearSearch:()=>(Ie.searchInput.value="",Ie.onSearchInput(),Ie.searchInput.focus()),setupSearch:()=>(Ie.searchInput.value=Ie.search,Ie.search?Ie.searchInput.dataset.searching=1:Ie.searchInput.removeAttribute("data-searching")),onSearchInput(){const e=Ie.searchInput.value.trim();if(e!==Ie.search)return Ie.pushState({search:e,replace:!!e==!!Ie.search}),Ie.pageLoad(!1)},querySearch(e){let t,o;if(o=e.match(/^([\w+]+):\/(.*)\/(\w*)$/)){let e;try{e=RegExp(o[2],o[3])}catch(e){return[]}return Ie.sortedThreadIDs.filter((t=>e.test(Je.values(o[1],Ie.parsedThreads[t]).join("\n"))))}if(t=e.toLowerCase().match(/\S+/g))return Ie.sortedThreadIDs.filter((e=>Ie.searchMatch(Ie.parsedThreads[e],t)))},searchMatch(e,t){const{info:o,file:a}=e;null==o.comment&&(o.comment=i.SITE.Build.parseComment(o.commentHTML.innerHTML));let s=[];for(var n of["comment","subject","name","tripcode"])n in o&&s.push(o[n]);for(var r of(a&&s.push(a.name),s=s.join(" ").toLowerCase(),t))if(-1===s.indexOf(r))return!1;return!0}},Ce={
init(){if(["index","catalog"].includes(i.VIEW)&&(a["Thread Hiding Buttons"]||a.Menu&&a["Thread Hiding Link"]||a["JSON Index"]))return this.db=new q("hiddenThreads"),"catalog"===i.VIEW?this.catalogWatch():(this.catalogSet(i.BOARD),x.on(n,"IndexRefreshInternal",this.onIndexRefresh),a["Thread Hiding Buttons"]&&x.addClass(r,"thread-hide"),c.Post.push({name:"Thread Hiding",cb:this.node}))},catalogSet(e){if(!x.hasStorage||"yotsuba"!==i.SITE.software)return;const t=Ce.db.get({boardID:e.ID,defaultValue:p()});for(var o in t)t[o]=!0;return localStorage.setItem(`4chan-hide-t-${e}`,JSON.stringify(t))},catalogWatch(){if(x.hasStorage&&"yotsuba"===i.SITE.software)return this.hiddenThreads=JSON.parse(localStorage.getItem(`4chan-hide-t-${i.BOARD}`))||{},Pt.ready((()=>new MutationObserver(Ce.catalogSave).observe(x.id("threads"),{attributes:!0,subtree:!0,attributeFilter:["style"]})))},catalogSave(){let e;const t=JSON.parse(localStorage.getItem(`4chan-hide-t-${i.BOARD}`))||{}
;for(e in t)x.hasOwn(Ce.hiddenThreads,e)||Ce.db.set({boardID:i.BOARD.ID,threadID:e,val:{makeStub:a.Stubs}});for(e in Ce.hiddenThreads)x.hasOwn(t,e)||Ce.db.delete({boardID:i.BOARD.ID,threadID:e});return Ce.hiddenThreads=t},isHidden:(e,t)=>!(!Ce.db||!Ce.db.get({boardID:e,threadID:t})),node(){let e;this.isReply||this.isClone||this.isFetchedQuote||(a["Thread Hiding Buttons"]&&x.prepend(this.nodes.root,Ce.makeButton(this.thread,"hide")),(e=Ce.db.get({boardID:this.board.ID,threadID:this.ID}))&&Ce.hide(this.thread,e.makeStub,"Hidden manually"))},onIndexRefresh:()=>i.BOARD.threads.forEach((function(e){const{root:t}=e.nodes;e.isHidden&&e.stub&&!t.contains(e.stub)&&Ce.makeStub(e,t)})),menu:{init(){if("index"!==i.VIEW||!a.Menu||!a["Thread Hiding Link"])return;let e=x.el("div",{className:"hide-thread-link",textContent:"Hide"});const t=x.el("a",{textContent:"Apply",href:"javascript:;"});x.on(t,"click",Ce.menu.hide);const o=X.checkbox("Stubs","Make stub");ne.menu.addEntry({el:e,order:20,
open:({thread:e,isReply:t})=>!(t||e.isHidden||a["JSON Index"]&&"catalog"===a["Index Mode"])&&(Ce.menu.thread=e,!0),subEntries:[{el:t},{el:o}]}),e=x.el("a",{className:"show-thread-link",textContent:"Show",href:"javascript:;"}),x.on(e,"click",Ce.menu.show),ne.menu.addEntry({el:e,order:20,open:({thread:e,isReply:t})=>!(t||!e.isHidden||a["JSON Index"]&&"catalog"===a["Index Mode"])&&(Ce.menu.thread=e,!0)});const s=x.el("a",{textContent:"Hide stub",href:"javascript:;"});return x.on(s,"click",Ce.menu.hideStub),ne.menu.addEntry({el:s,order:15,open:({thread:e,isReply:t})=>!(t||!e.isHidden||a["JSON Index"]&&"catalog"===a["Index Mode"])&&(Ce.menu.thread=e)})},hide(){const e=x("input",this.parentNode).checked,{thread:t}=Ce.menu;return Ce.hide(t,e,"Hidden manually"),Ce.saveHiddenState(t,e),x.event("CloseMenu")},show(){const{thread:e}=Ce.menu;return Ce.show(e),Ce.saveHiddenState(e),x.event("CloseMenu")},hideStub(){const{thread:e}=Ce.menu;Ce.show(e),Ce.hide(e,!1),Ce.saveHiddenState(e,!1),
x.event("CloseMenu")}},makeButton(e,t){const o=x.el("a",{className:`${t}-thread-button`,href:"javascript:;"});return x.add(o,x.el("span",{className:"stub-icon",textContent:"hide"===t?"➖︎":"➕︎"})),o.dataset.fullID=e.fullID,x.on(o,"click",Ce.toggle),o},makeStub(e,t,o){let s,n,r=S(i.SITE.selectors.replyOriginal,t).length;(s=x(i.SITE.selectors.summary,t))&&(r+=+s.textContent.match(/\d+/));const l=Ce.makeButton(e,"show"),{nameBlock:d,subject:c}=e.OP.info;c&&x.add(l,x.el("span",{className:"stub-subject",textContent:c})),x.add(l,x.el("span",{className:"stub-name",textContent:d})),x.add(l,x.el("span",{className:"stub-replies",textContent:`(${r} repl${1===r?"y":"ies"})`}));let h=e.OP.filterResults?.reasons||[];if(o&&(h=[...h,o]),a["Filter Reason"]&&h.length){const e=x.el("span",{className:"stub-reasons"});x.add(e,h.map((e=>x.el("span",{className:"stub-reason",textContent:e})))),l.appendChild(e)}if(e.stub=x.el("div",{className:"stub"}),
a.Menu?x.add(e.stub,[l,ne.makeButton(e.OP)]):x.add(e.stub,l),!a["Filter Reason"]&&h&&(e.stub.title=h.join(" & ")),x.prepend(t,e.stub),n=x(i.SITE.selectors.threadDivider,t))return x.addClass(n,"threadDivider")},saveHiddenState:(e,t)=>(e.isHidden?Ce.db.set({boardID:e.board.ID,threadID:e.ID,val:{makeStub:t}}):Ce.db.delete({boardID:e.board.ID,threadID:e.ID}),Ce.catalogSet(e.board)),toggle(e){return e instanceof j||(e=i.threads.get(this.dataset.fullID)),e.isHidden?Ce.show(e):Ce.hide(e,void 0,"Hidden manually"),Ce.saveHiddenState(e)},hide(e,t=a.Stubs,o){if(e.isHidden)return;const i=e.nodes.root;if(e.isHidden=!0,Ie.updateHideLabel(),e.catalogView&&!Ie.showHiddenThreads&&(x.rm(e.catalogView.nodes.root),x.event("PostsRemoved",null,Ie.root)),!t)return i.hidden=!0;Ce.makeStub(e,i,o)},show(e){e.stub&&(x.rm(e.stub),delete e.stub);if(e.nodes.root.hidden=e.isHidden=!1,Ie.updateHideLabel(),e.catalogView){const{root:t}=e.catalogView.nodes;if(Ie.showHiddenThreads)x.rm(t),
x.event("PostsRemoved",null,Ie.root);else{let o=Ie.sortedThreadIDs.indexOf(e.ID)-1;for(;;){if(o<0){x(".board").insertAdjacentElement("afterbegin",t);break}const e=n.getElementById(`t${Ie.sortedThreadIDs[o]}`);if(e){e.insertAdjacentElement("afterend",t);break}--o}x.event("PostsInserted",null,Ie.root)}}}},De={init(){if((a["Fappe Tyme"]||a["Werk Tyme"])&&["index","thread","archive"].includes(i.VIEW)){for(var e of(this.nodes={},this.enabled={fappe:!1,werk:a.werk},["Fappe","Werk"]))if(a[`${e} Tyme`]){var t=e.toLowerCase(),o=X.checkbox(t,`${e} Tyme`,!1);o.title=`${e} Tyme`,this.nodes[t]=o.firstElementChild,a[t]&&this.set(t,!0),x.on(this.nodes[t],"change",this.toggle.bind(this,t)),Ye.menu.addEntry({el:o,order:97});var s=x.el("span",{className:"indicator",textContent:e[0],title:`${e} Tyme active`});x.on(s,"click",(function(){const e=x.getOwn(De.nodes,this.parentNode.id.replace("shortcut-",""));return e.checked=!e.checked,x.event("change",null,e)})),Ye.addShortcut(t,s,410)}
return a["Werk Tyme"]&&x.sync("werk",this.set.bind(this,"werk")),c.Post.push({name:"Fappe Tyme",cb:this.node}),c.CatalogThread.push({name:"Werk Tyme",cb:this.catalogNode})}},node(){return this.nodes.root.classList.toggle("noFile",!this.files.length)},catalogNode(){const e=this.thread.OP.files[0];if(!e)return;const t=x.el("div",{textContent:e.name,className:"werkTyme-filename"});return x.add(this.nodes.thumb.parentNode,t)},set(e,t){return this.enabled[e]=this.nodes[e].checked=t,x[(t?"add":"rm")+"Class"](r,`${e}Tyme`)},toggle(e){if(this.set(e,!this.enabled[e]),"werk"===e)return x.cb.checked.call(this.nodes[e])}},Ee={init(){let e;if(!["index","thread"].includes(i.VIEW)||!a.Sauce)return;x.addClass(r,"show-sauce");const t=[];for(e of a.sauces.split("\n")){var o;"#"!==e[0]&&(o=this.parseLink(e))&&t.push(o)}return t.length?(this.links=t,this.link=x.el("a",{target:"_blank",className:"sauce"}),c.Post.push({name:"Sauce",cb:this.node})):void 0},parseLink(e){if(!(e=e.trim()))return null
;const t=p(),o=e.split(/;(?=(?:text|boards|types|regexp|sandbox):?)/);for(let e=0;e<o.length;e++){var a=o[e];if(0===e)t.url=a;else{var i=a.match(/^(\w*):?(.*)$/);t[i[1]]=i[2]}}if(t.text||(t.text=t.url.match(/(\w+)\.\w+\//)?.[1]||"?"),"boards"in t&&(t.boards=Je.parseBoards(t.boards)),"regexp"in t)try{let e;(e=t.regexp.match(/^\/(.*)\/(\w*)$/))?t.regexp=RegExp(e[1],e[2]):t.regexp=RegExp(t.regexp)}catch(t){return new Ke("warning",[x.tn("Invalid regexp for Sauce link:"),x.el("br"),x.tn(e),x.el("br"),x.tn(t.message)],60),null}return t},createSauceLink(e,t,o){let a,s,n;const r=o.url.match(/[^.]*$/)[0],l=p();if(x.extend(l,e),l.boards&&!l.boards[`${t.siteID}/${t.boardID}`]&&!l.boards[`${t.siteID}/*`])return null;if(l.types&&(n=r,!l.types.split(",").includes(n)))return null;if(l.regexp&&!(s=o.name.match(l.regexp)))return null;const d=[];for(var c of["url","text"])l[c]=l[c].replace(/%(T?URL|IMG|[sh]?MD5|board|name|%|semi|\$\d+)/g,(function(e,a){let i;if("$"===a[0]){if(!s)return e
;i=s[a.slice(1)]||""}else if(i=Ee.formatters[a](t,o,r),null==i)return d.push(a),"";return"url"!==c||["%","semi"].includes(a)||(/^javascript:/i.test(l.url)&&(i=JSON.stringify(i)),i=encodeURIComponent(i)),i}));return i.SITE.areMD5sDeferred?.(t.board)&&d.length&&!d.filter((e=>!/^.?MD5$/.test(e))).length?(a=Ee.link.cloneNode(!1),a.dataset.skip="1",a):d.length?null:(a=Ee.link.cloneNode(!1),a.href=l.url,a.textContent=l.text,/^javascript:/i.test(l.url)&&a.removeAttribute("target"),a)},node(){if(!this.isClone)for(var e of this.files)Ee.file(this,e)},file(e,t){let o,a;const i=[],s=[];for(o of Ee.links)(a=Ee.createSauceLink(o,e,t))&&(i.push(x.tn(" "),a),a.dataset.skip&&s.push([o,a]));if(x.add(t.text,i),s.length){var n=new MutationObserver((function(){if(t.text.dataset.md5){for([o,a]of s){var i;(i=Ee.createSauceLink(o,e,t))&&x.replace(a,i)}return n.disconnect()}}));return n.observe(t.text,{attributes:!0})}},formatters:{TURL:(e,t)=>t.thumbURL,URL:(e,t)=>t.url,
IMG:(e,t,o)=>["gif","jpg","jpeg","png"].includes(o)?t.url:t.thumbURL,MD5:(e,t)=>t.MD5,sMD5:(e,t)=>t.MD5?.replace(/[+/=]/g,(e=>({"+":"-","/":"_","=":""}[e]))),hMD5(e,t){if(t.MD5)return Array.from(atob(t.MD5),(e=>e.charCodeAt(0).toString(16).padStart(2,"0"))).join("")},board:e=>e.board.ID,name:(e,t)=>t.name,"%":()=>"%",semi:()=>";"}},Se={init(){if(!(this.enabled=a.Gallery&&["index","thread"].includes(i.VIEW)))return;this.delay=a["Slide Delay"];const e=x.el("a",{href:"javascript:;",title:"Gallery"});return M.set(e,"image","Gallery"),x.on(e,"click",this.cb.toggle),Ye.addShortcut("gallery",e,530),c.Post.push({name:"Gallery",cb:this.node})},node(){return(()=>{const e=[];for(var t of this.files)t.thumb&&(Se.nodes&&(Se.generateThumb(this,t),Se.nodes.total.textContent=Se.images.length),a["Image Expansion"]||"tinyboard"===i.SITE.software&&Pt.jsEnabled?e.push(void 0):e.push(x.on(t.thumbLink,"click",Se.cb.image)));return e})()},build(e){let t,o;const{cb:s}=Se
;a["Fullscreen Gallery"]&&(x.one(n,"fullscreenchange mozfullscreenchange webkitfullscreenchange",(()=>x.on(n,"fullscreenchange mozfullscreenchange webkitfullscreenchange",s.close))),r.mozRequestFullScreen?.(),r.webkitRequestFullScreen?.(Element.ALLOW_KEYBOARD_INPUT)),Se.images=[];const l=Se.nodes={};Se.fileIDs=p(),Se.slideshow=!1,l.el=t=x.el("div",{id:"a-gallery"}),x.extend(t,{
innerHTML:'<div class="gal-viewport"> <span class="gal-buttons"> <a href="javascript:;" class="gal-start" title="Start slideshow"><i></i></a> <a href="javascript:;" class="gal-stop" title="Stop slideshow"><i></i></a> <a href="javascript:;" class="menu-button"><i></i></a> <a href="javascript:;" class="gal-close">×</a> </span> <div class="gal-labels"> <span class="gal-count"> <span class="count"></span> / <span class="total"></span> </span> <a class="gal-name" target="_blank"></a> <span class="gal-sauce"></span> </div> <div class="gal-prev"></div> <div class="gal-image"> <a href="javascript:;"><img></a> </div> <div class="gal-next"></div> </div> <div class="gal-thumbnails"></div>'});const d={buttons:".gal-buttons",frame:".gal-image",name:".gal-name",count:".count",total:".total",sauce:".gal-sauce",thumbs:".gal-thumbnails",next:".gal-image a",current:".gal-image img"};for(var c in d){var h=d[c];l[c]=x(h,t)}const u=x(".menu-button",t);for(var g of(l.menu=new X.Menu("gallery"),
x.on(l.frame,"click",s.blank),a["Mouse Wheel Volume"]&&x.on(l.frame,"wheel",ee.wheel),x.on(l.next,"click",s.click),x.on(l.name,"click",$e.download),x.on(x(".gal-prev",t),"click",s.prev),x.on(x(".gal-next",t),"click",s.next),x.on(x(".gal-start",t),"click",s.start),x.on(x(".gal-stop",t),"click",s.stop),x.on(x(".gal-close",t),"click",s.close),x.on(u,"click",(function(e){return l.menu.toggle(e,this,i)})),Se.menu.createSubEntries()))g.order=0,l.menu.addEntry(g);for(var f of(x.on(n,"keydown",s.keybinds),a.Keybinds&&x.off(n,"keydown",Le.keydown),x.on(window,"resize",Se.cb.setHeight),S(i.SITE.selectors.file.thumb))){var m;if(m=w.postFromNode(f))for(var b of m.files)if(b.thumb&&(Se.generateThumb(m,b),!e&&Se.fileIDs[`${m.fullID}.${b.index}`])){var v=b.thumbLink;Ye.getTopOf(v)+v.getBoundingClientRect().height>=0&&(e=v)}}return x.addClass(r,"gallery-open"),x.add(n.body,t),l.thumbs.scrollTop=0,l.current.parentElement.scrollTop=0,e&&(o=x(`[href='${e.href}']`,l.thumbs)),
o||(o=Se.images[Se.images.length-1]),o&&Se.open(o),r.style.overflow="hidden",l.total.textContent=Se.images.length},generateThumb(e,t){if(e.isClone||e.isHidden)return;if(!t||!t.thumb||!t.isImage&&!t.isVideo&&!a["PDF in Gallery"])return;if(Se.fileIDs[`${e.fullID}.${t.index}`])return;Se.fileIDs[`${e.fullID}.${t.index}`]=!0;const o=x.el("a",{className:"gal-thumb",href:t.url,target:"_blank",title:t.name});o.dataset.id=Se.images.length,o.dataset.post=e.fullID,o.dataset.file=t.index;const i=t.thumb.cloneNode(!1);return i.style.cssText="",x.add(o,i),x.on(o,"click",Se.cb.open),Se.images.push(o),x.add(Se.nodes.thumbs,o)},load(e,t){const o=e.href.match(/\w*$/),a=x.getOwn({webm:"video",mp4:"video",ogv:"video",pdf:"iframe"},o)||"img",i=x.el(a);return x.extend(i.dataset,e.dataset),x.on(i,"error",t),i.src=e.href,i},open(e){let t,o,s;const{nodes:n}=Se,l=+n.current.dataset.id,d=+e.dataset.id;if((t=Se.images[l])&&x.rmClass(t,"gal-highlight"),x.addClass(e,"gal-highlight"),
n.thumbs.scrollTop=e.offsetTop+e.offsetHeight/2-n.thumbs.clientHeight/2,Se.cache?.dataset.id===""+d?(o=Se.cache,x.off(o,"error",Se.cacheError),x.on(o,"error",Se.error)):o=Se.load(e,Se.error),x.off(n.current,"error",Se.error),$e.pause(n.current),x.replace(n.current,o),n.current=o,"VIDEO"===o.nodeName&&(o.loop=!0,ee.setup(o),a.Autoplay&&o.play(),a["Show Controls"]&&(o.controls=!0)),r.classList.toggle("gal-pdf","IFRAME"===o.nodeName),Se.cb.setHeight(),n.count.textContent=+e.dataset.id+1,n.name.download=n.name.textContent=e.title,n.name.href=e.href,n.frame.scrollTop=0,n.next.focus(),x.rmAll(n.sauce),a.Sauce&&Ee.links&&(s=i.posts.get(o.dataset.post))){const e=[];for(var c of Ee.links){var h;(h=Ee.createSauceLink(c,s,s.files[+o.dataset.file]))&&e.push(x.tn(" "),h)}x.add(n.sauce,e)}if(Se.slideshow&&(d>l||l===Se.images.length-1&&0===d)?Se.setupTimer():Se.cb.stop(),a["Scroll to Post"]&&(s=i.posts.get(o.dataset.post))&&Ye.scrollTo(s.nodes.root),
isNaN(l)||d===(l+1)%Se.images.length)return Se.cache=Se.load(Se.images[(d+1)%Se.images.length],Se.cacheError)},error(){if(this.error?.code===MediaError.MEDIA_ERR_DECODE)return new Ke("error","Corrupt or unplayable video",30);if($e.isFromArchive(this))return;const e=i.posts.get(this.dataset.post),t=e.files[+this.dataset.file];return $e.error(this,e,t,null,(e=>{if(e)return Se.images[+this.dataset.id].href=e,Se.nodes.current===this?this.src=e:void 0}))},cacheError:()=>delete Se.cache,cleanupTimer(){clearTimeout(Se.timeoutID);const{current:e}=Se.nodes;return x.off(e,"canplaythrough load",Se.startTimer),x.off(e,"ended",Se.cb.next)},startTimer:()=>Se.timeoutID=setTimeout(Se.checkTimer,Se.delay*g),setupTimer(){Se.cleanupTimer();const{current:e}=Se.nodes,t="VIDEO"===e.nodeName;return t&&e.play(),(t?e.readyState>=4:e.complete)||"IFRAME"===e.nodeName?Se.startTimer():x.on(e,t?"canplaythrough":"load",Se.startTimer)},checkTimer(){const{current:e}=Se.nodes
;return"VIDEO"!==e.nodeName||e.paused?Se.cb.next():(x.on(e,"ended",Se.cb.next),e.loop=!1)},cb:{keybinds(e){let t;if(!(t=Le.keyCode(e)))return;const o=(()=>{switch(t){case a.Close:case a["Open Gallery"]:return Se.cb.close;case a["Next Gallery Image"]:return Se.cb.next;case a["Advance Gallery"]:return Se.cb.advance;case a["Previous Gallery Image"]:return Se.cb.prev;case a.Pause:return Se.cb.pause;case a.Slideshow:return Se.cb.toggleSlideshow;case a["Rotate image anticlockwise"]:return Se.cb.rotateLeft;case a["Rotate image clockwise"]:return Se.cb.rotateRight;case a["Download Gallery Image"]:return Se.cb.download}})();return o?(e.stopPropagation(),e.preventDefault(),o()):void 0},open(e){if(e&&e.preventDefault(),this)return Se.open(this)},image(e){return e.preventDefault(),e.stopPropagation(),Se.build(this)},prev:()=>Se.cb.open.call(Se.images[+Se.nodes.current.dataset.id-1]||Se.images[Se.images.length-1]),next:()=>Se.cb.open.call(Se.images[+Se.nodes.current.dataset.id+1]||Se.images[0]),
click(e){if(!$e.onControls(e))return e.preventDefault(),Se.cb.advance()},advance:()=>!a.Autoplay&&Se.nodes.current.paused?Se.nodes.current.play():Se.cb.next(),toggle:()=>(Se.nodes?Se.cb.close:Se.build)(),blank(e){if(e.target===this)return Se.cb.close()},toggleSlideshow:()=>Se.cb[Se.slideshow?"stop":"start"](),download:()=>x(".gal-name").click(),pause(){Se.cb.stop();const{current:e}=Se.nodes;if("VIDEO"===e.nodeName)return e[e.paused?"play":"pause"]()},start:()=>(x.addClass(Se.nodes.buttons,"gal-playing"),Se.slideshow=!0,Se.setupTimer()),stop(){if(!Se.slideshow)return;Se.cleanupTimer();const{current:e}=Se.nodes;return"VIDEO"===e.nodeName&&(e.loop=!0),x.rmClass(Se.nodes.buttons,"gal-playing"),Se.slideshow=!1},rotateLeft:()=>Se.cb.rotate(270),rotateRight:()=>Se.cb.rotate(90),rotate:u(100,(function(e){const{current:t}=Se.nodes;if("IFRAME"!==t.nodeName)return t.dataRotate=((t.dataRotate||0)+e)%360,t.style.transform=`rotate(${t.dataRotate}deg)`,Se.cb.setHeight()})),
close:()=>(x.off(Se.nodes.current,"error",Se.error),$e.pause(Se.nodes.current),x.rm(Se.nodes.el),x.rmClass(r,"gallery-open"),a["Fullscreen Gallery"]&&(x.off(n,"fullscreenchange mozfullscreenchange webkitfullscreenchange",Se.cb.close),n.mozCancelFullScreen?.(),n.webkitExitFullscreen?.()),delete Se.nodes,delete Se.fileIDs,r.style.overflow="",x.off(n,"keydown",Se.cb.keybinds),a.Keybinds&&x.on(n,"keydown",Le.keydown),x.off(window,"resize",Se.cb.setHeight),clearTimeout(Se.timeoutID)),setFitness(){return(this.checked?x.addClass:x.rmClass)(r,`gal-${this.name.toLowerCase().replace(/\s+/g,"-")}`)},setHeight:u(100,(function(){let e,t,o;const{current:s,frame:n}=Se.nodes,{style:l}=s;if(a["Stretch to Fit"]&&(e=i.posts.get(s.dataset.post)?.files[+s.dataset.file].dimensions)){const[t,a]=e.split("x");let i=n.clientWidth,d=r.clientHeight-25;(s.dataRotate||0)%180==90&&([i,d]=[d,i]),o=Math.min(d,a/t*i),l.minHeight=o+"px",l.minWidth=t/a*o+"px"}else l.minHeight=l.minWidth=""
;return(s.dataRotate||0)%180==90?(l.maxWidth=a["Fit Height"]?r.clientHeight-25+"px":"none",l.maxHeight=a["Fit Width"]?`${n.clientWidth}px`:"none",t=(s.clientWidth-s.clientHeight)/2,l.margin=`${t}px ${-t}px`):l.maxWidth=l.maxHeight=l.margin=""})),setDelay(){return Se.delay=+this.value}},menu:{init(){if(!Se.enabled)return;const e=x.el("span",{textContent:"Gallery",className:"gallery-link"});return Ye.menu.addEntry({el:e,order:105,subEntries:Se.menu.createSubEntries()})},createSubEntry(e){const t=X.checkbox(e,e),o=t.firstElementChild;return["Hide Thumbnails","Fit Width","Fit Height"].includes(e)&&x.on(o,"change",Se.cb.setFitness),x.event("change",null,o),x.on(o,"change",x.cb.checked),["Hide Thumbnails","Fit Width","Fit Height","Stretch to Fit"].includes(e)&&x.on(o,"change",Se.cb.setHeight),{el:t}},createSubEntries(){const e=["Hide Thumbnails","Fit Width","Fit Height","Stretch to Fit","Scroll to Post"].map((e=>Se.menu.createSubEntry(e))),t=x.el("label",{
innerHTML:'Slide Delay: <input type="number" name="Slide Delay" min="0" step="any" class="field">'}),o=t.firstElementChild;return o.value=Se.delay,x.on(o,"change",Se.cb.setDelay),x.on(o,"change",x.cb.value),e.push({el:t}),e}}},Te={init(){if(["index","thread","archive"].includes(i.VIEW)&&a.Linkify)return a["Comment Expansion"]&&ue.callbacks.push(this.node),c.Post.push({name:"Linkify",cb:this.node}),Be.init()},node(){let e;if(this.isClone)return Be.events(this);if(!Te.regString.test(this.info.comment))return;for(e of S("a",this.nodes.comment))i.SITE.isLinkified?.(e)&&(x.addClass(e,"linkify"),T.useFaster&&T.fixLinks([e]),Be.process(e,this));const t=Te.process(this.nodes.comment);for(e of(T.useFaster&&T.fixLinks(t),t))Be.process(e,this)},process(e){let t;const o=/[^\s"]+/g,a=/[\s"]/,i=x.X(".//br|.//text()",e);let s=0;const n=[];for(;e=i.snapshotItem(s++);){var r,{data:l}=e;if(l&&"A"!==e.parentElement.nodeName)for(;r=o.exec(l);){var d,{index:c}=r,h=e,u=r[0]
;if((t=c+u.length)===l.length)for(o.lastIndex=0;d=i.snapshotItem(s++);){var p;if("BR"===d.nodeName||"P"===d.parentElement.nodeName&&!d.previousSibling){var g,f;if((g=u.match(/(https?:\/\/)?([a-z\d-]+\.)*[a-z\d-]+$/i))&&(f=i.snapshotItem(s)?.data?.match(/^(\.[a-z\d-]+)*\//i))&&0===(g[0]+f[0]).search(Te.regString))continue;break}if("A"===d.parentElement.nodeName&&!Te.regString.test(u))break;if(h=d,({data:l}=d),p=a.exec(l)){u+=l.slice(0,p.index),o.lastIndex=t=p.index,s--;break}({length:t}=l),u+=l}if(Te.regString.test(u)&&n.push(Te.makeRange(e,h,c,t)),!o.lastIndex||e!==h)break}}for(s=n.length;s--;)n[s]=Te.makeLink(n[s]);return n},regString:new RegExp('((https?|mailto|git|magnet|ftp|irc):([a-z\\d%/?])|([-a-z\\d]+[.])+(aero|asia|biz|cat|com|coop|dance|info|int|jobs|mobi|moe|museum|name|net|org|post|pro|tel|travel|xxx|xyz|edu|gov|mil|[a-z]{2})([:/]|(?![^\\s"]))|[\\d]{1,3}\\.[\\d]{1,3}\\.[\\d]{1,3}\\.[\\d]{1,3}|[-\\w\\d.@]+@[a-z\\d.-]+\\.[a-z\\d])',"i"),makeRange(e,t,o,a){
const i=document.createRange();return i.setStart(e,o),i.setEnd(t,a),i},makeLink(e){let t,o,a=e.toString(),i=a.search(Te.regString);if(i>0){for(a=a.slice(i);e.startOffset+i>=e.startContainer.data.length;)i--;i&&e.setStart(e.startContainer,e.startOffset+i)}for(i=0;/[)\]}>.,]/.test(t=a.charAt(a.length-(1+i)))&&(/[.,]/.test(t)||a.match(/[()\[\]{}<>]/g).length%2);)i++;if(i){for(a=a.slice(0,-i);e.endOffset-i<0;)i--;i&&e.setEnd(e.endContainer,e.endOffset-i)}/((mailto|magnet):|.+:\/\/)/.test(a)||(a=(/@/.test(a)?"mailto:":"http://")+a),(o=a.match(/^(https?:\/\/[^/]*%[0-9a-f]{2})(.*)$/i))&&(a=o[1].replace(/%([0-9a-f]{2})/gi,(function(e,t){return"25"===t?e:String.fromCharCode(parseInt(t,16))}))+o[2]);const s=x.el("a",{className:"linkify",rel:"noreferrer noopener",target:"_blank",href:a});return x.add(s,e.extractContents()),e.insertNode(s),s}},Re={init(){["index","thread","archive"].includes(i.VIEW)&&a["Time Formatting"]&&c.Post.push({name:"Time Formatting",cb:this.node})},node(){
if(!this.info.date||this.isClone)return;const{textContent:e}=this.nodes.date;this.nodes.date.textContent=e.match(/^\s*/)[0]+Re.format(this.info.date)+e.match(/\s*$/)[0]},format:(e,t=a.time)=>t.replace(/%(.)/g,(function(t,o){return x.hasOwn(Re.formatters,o)?Re.formatters[o].call(e):t})),zeroPad:e=>e<10?`0${e}`:e,formatterCache:new Map,formatters:{a(){let e=Re.formatterCache.get("a");return e||(e=Intl.DateTimeFormat(a.timeLocale||void 0,{weekday:"short"}),Re.formatterCache.set("a",e)),e.format(this)},A(){let e=Re.formatterCache.get("A");return e||(e=Intl.DateTimeFormat(a.timeLocale||void 0,{weekday:"long"}),Re.formatterCache.set("A",e)),e.format(this)},b(){let e=Re.formatterCache.get("b");return e||(e=Intl.DateTimeFormat(a.timeLocale||void 0,{month:"short"}),Re.formatterCache.set("b",e)),e.format(this)},B(){let e=Re.formatterCache.get("B");return e||(e=Intl.DateTimeFormat(a.timeLocale||void 0,{month:"long"}),Re.formatterCache.set("B",e)),e.format(this)},d(){
return Re.zeroPad(this.getDate())},e(){return this.getDate()},H(){return Re.zeroPad(this.getHours())},I(){return Re.zeroPad(this.getHours()%12||12)},k(){return this.getHours()},l(){return this.getHours()%12||12},m(){return Re.zeroPad(this.getMonth()+1)},n(){return this.getMonth()+1},M(){return Re.zeroPad(this.getMinutes())},p(){let e=Re.formatterCache.get("p");e||(e=Intl.DateTimeFormat(a.timeLocale||void 0,{hour:"numeric",hour12:!0}),Re.formatterCache.set("p",e));return e.formatToParts(this).find((e=>"dayPeriod"===e.type)).value},P(){return Re.formatters.p.call(this).toLowerCase()},S(){return Re.zeroPad(this.getSeconds())},y(){return this.getFullYear().toString().slice(2)},Y(){return this.getFullYear()},"%":()=>"%"}};var Be={init(){if(["index","thread","archive"].includes(i.VIEW)&&a.Linkify&&(a.Embedding||a["Link Title"]||a["Cover Preview"])){for(var e of(this.types=p(),this.ordered_types))this.types[e.key]=e;a.Embedding&&"archive"!==i.VIEW&&(this.dialog=X.dialog("embedding",{
innerHTML:'<div> <div class="move"></div> <a href="javascript:;" class="jump" title="Jump to post">→</a> <a href="javascript:;" class="close" title="Close">×</a> </div> <div id="media-embed"><div></div></div>'}),this.media=x("#media-embed",this.dialog),x.one(n,"4chanXInitFinished",this.ready),x.on(n,"IndexRefreshInternal",(()=>i.posts.forEach((function(e){for(e of[e,...e.clones])for(var t of e.nodes.embedlinks)Be.cb.catalogRemove.call(t)}))))),Be.shouldFetchTitles()&&x.on(n,"4chanXInitFinished PostsInserted",(function(){for(const e of Object.values(Be.types))e.title?.batchSize&&Be.flushTitles(e.title)}))}},events(e){let t,o,s;if("archive"!==i.VIEW){if(a.Embedding)for(o=0,s=e.nodes.embedlinks=S(".embedder",e.nodes.comment);t=s[o++];)x.on(t,"click",Be.cb.click),x.hasClass(t,"embedded")&&Be.cb.toggle.call(t);if(a["Cover Preview"])for(o=0,s=S(".linkify",e.nodes.comment);t=s[o++];){var n;(n=Be.services(t))&&Be.preview(n)}else;}},process(e,t){let o
;if((a.Embedding||a["Link Title"]||a["Cover Preview"])&&!x.x("ancestor::pre",e))return(o=Be.services(e))&&(o.post=t,a.Embedding&&"archive"!==i.VIEW&&Be.embed(o),Be.shouldFetchTitles()&&Be.title(o),a["Cover Preview"]&&"archive"!==i.VIEW)?Be.preview(o):void 0},services(e){const{href:t}=e;for(var o of Be.ordered_types){var a;if(a=o.regExp.exec(t))return{key:o.key,uid:a[1],options:a[2],link:e}}},embed(e){const{key:t,uid:o,options:i,link:s,post:n}=e,{href:l}=s;x.addClass(s,t.toLowerCase());const d=x.el("a",{className:"embedder",href:"javascript:;"},{innerHTML:"(<span>un</span>embed)"}),c={key:t,uid:o,options:i,href:l};for(var h in c){var u=c[h];d.dataset[h]=u}if(x.on(d,"click",Be.cb.click),x.after(s,[x.tn(" "),d]),n.nodes.embedlinks.push(d),a["Auto-embed"]&&!a["Floating Embeds"]&&!n.isFetchedQuote)return x.hasClass(r,"catalog-mode")?x.addClass(d,"embed-removed"):Be.cb.toggle.call(d)},ready(){if(Pt.isThisPageLegit())return x.addClass(Be.dialog,"empty"),
x.on(x(".close",Be.dialog),"click",Be.closeFloat),x.on(x(".move",Be.dialog),"mousedown",Be.dragEmbed),x.on(x(".jump",Be.dialog),"click",(function(){if(r.contains(Be.lastEmbed))return Ye.scrollTo(Be.lastEmbed)})),x.add(n.body,Be.dialog)},closeFloat:()=>(delete Be.lastEmbed,x.addClass(Be.dialog,"empty"),x.replace(Be.media.firstChild,x.el("div"))),dragEmbed(){const{style:e}=Be.media;return Be.dragEmbed.mouseup?(x.off(n,"mouseup",Be.dragEmbed),Be.dragEmbed.mouseup=!1,void(e.pointerEvents="")):(x.on(n,"mouseup",Be.dragEmbed),Be.dragEmbed.mouseup=!0,e.pointerEvents="none")},title(e){let t;const{key:o,uid:a,options:i,link:s,post:n}=e;if(t=Be.types[o].title)return x.addClass(s,o.toLowerCase()),t.batchSize?((t.queue||(t.queue=[])).push(e),t.queue.length>=t.batchSize?Be.flushTitles(t):void 0):Fe.cache(t.api(a),(function(){return Be.cb.title(this,e)}))},flushTitles(e){let t;const{queue:o}=e;if(!o?.length)return;e.queue=[];return Fe.cache(e.api(o.map((e=>e.uid))),(function(){
for(t of o)Be.cb.title(this,t)}))},preview(e){let t;const{key:o,uid:a,link:i}=e;if(t=Be.types[o].preview)return x.on(i,"mouseover",(function(e){const o=t.url(a),{height:s}=t,n=x.el("img",{src:o,id:"ihover"});return n.setAttribute("referrerpolicy","no-referrer"),x.add(Ye.hover,n),X.hover({root:i,el:n,latestEvent:e,endEvents:"mouseout click",height:s})}))},cb:{click(e){if(e.preventDefault(),x.hasClass(this,"embedded")||!a["Floating Embeds"]&&!x.hasClass(r,"catalog-mode"))return Be.cb.toggle.call(this);{let e;if(!(e=Be.media.firstChild))return;return x.replace(e,Be.cb.embed(this)),Be.lastEmbed=w.postFromNode(this).nodes.root,x.rmClass(Be.dialog,"empty")}},toggle(){return x.hasClass(this,"embedded")?x.rm(this.nextElementSibling):x.after(this,Be.cb.embed(this)),x.toggleClass(this,"embedded")},embed(e){let t,o;const a=x.el("div",{className:"media-embed"});return x.add(a,t=(o=Be.types[e.dataset.key]).el(e)),t.style.cssText=null!=o.style?o.style:"border: none; width: 640px; height: 360px;",a},
catalogRemove(){const e=x.hasClass(r,"catalog-mode");if(e&&x.hasClass(this,"embedded")||!e&&x.hasClass(this,"embed-removed"))return Be.cb.toggle.call(this),x.toggleClass(this,"embed-removed")},title(e,t){let o;const{key:a,uid:i,options:s,link:n,post:r}=t,l=Be.types[a].title;let{status:d}=e;if([200,304].includes(d)&&l.status&&(d=l.status(e.response)[0]),d)for(var c of(o=`[${a}] ${(()=>{switch(d){case 200:case 304:return o=l.text(e.response,i),"string"==typeof o?o:o=n.textContent;case 404:return"Not Found";case 403:case 401:return"Forbidden or Private";default:return`${d}'d`}})()}`,n.dataset.original=n.textContent,n.textContent=o,r.clones))for(var h of S("a.linkify",c.nodes.comment))h.href===n.href&&(null==h.dataset.original&&(h.dataset.original=h.textContent),h.textContent=o)}},ordered_types:[{key:"audio",regExp:/^[^?#]+\.(?:mp3|m4a|oga|wav|flac)(?:[?#]|$)/i,style:"",el:e=>x.el("audio",{controls:!0,preload:"auto",src:e.dataset.href})},{key:"image",
regExp:/^[^?#]+\.(?:gif|png|jpg|jpeg|bmp|webp)(?::\w+)?(?:[?#]|$)/i,style:"",el(e){const t=s(e.dataset.href);return x.el("div",{innerHTML:`<a target="_blank" href="${t}"><img src="${t}" style="max-width: 80vw; max-height: 80vh;"></a>`})}},{key:"video",regExp:/^[^?#]+\.(?:og[gv]|webm|mp4)(?:[?#]|$)/i,style:"max-width: 80vw; max-height: 80vh;",el(e){const t=x.el("video",{hidden:!0,controls:!0,preload:"auto",src:e.dataset.href,loop:T.test(e.dataset.href.split("/")[2])});return x.on(t,"loadedmetadata",(function(){return 0===t.videoHeight&&t.parentNode?x.replace(t,Be.types.audio.el(e)):t.hidden=!1})),t}},{key:"PeerTube",regExp:/^(\w+:\/\/[^\/]+\/videos\/watch\/\w{8}-\w{4}-\w{4}-\w{4}-\w{12})(.*)/,el(e){let t;const o=(t=e.dataset.options.match(/[?&](start=\w+)/))?`?${t[1]}`:"",a=x.el("iframe",{src:e.dataset.uid.replace("/videos/watch/","/videos/embed/")+o});return a.setAttribute("allowfullscreen","true"),a}},{key:"BitChute",regExp:/^\w+:\/\/(?:www\.)?bitchute\.com\/video\/([\w\-]+)/,el(e){
const t=x.el("iframe",{src:`https://www.bitchute.com/embed/${e.dataset.uid}/`});return t.setAttribute("allowfullscreen","true"),t}},{key:"Clyp",regExp:/^\w+:\/\/(?:www\.)?clyp\.it\/(\w{8})/,style:"border: 0; width: 640px; height: 160px;",el:e=>x.el("iframe",{src:`https://clyp.it/${e.dataset.uid}/widget`}),title:{api:e=>`https://api.clyp.it/oembed?url=https://clyp.it/${e}`,text:e=>e.title}},{key:"Dailymotion",regExp:/^\w+:\/\/(?:(?:www\.)?dailymotion\.com\/(?:embed\/)?video|dai\.ly)\/([A-Za-z0-9]+)[^?]*(.*)/,el(e){let t;const o=(t=e.dataset.options.match(/[?&](start=\d+)/))?`?${t[1]}`:"",a=x.el("iframe",{src:`//www.dailymotion.com/embed/video/${e.dataset.uid}${o}`});return a.setAttribute("allowfullscreen","true"),a},title:{api:e=>`https://api.dailymotion.com/video/${e}`,text:e=>e.title},preview:{url:e=>`https://www.dailymotion.com/thumbnail/video/${e}`,height:240}},{key:"Gfycat",regExp:/^\w+:\/\/(?:www\.)?gfycat\.com\/(?:iframe\/)?(\w+)/,el(e){const t=x.el("iframe",{
src:`//gfycat.com/ifr/${e.dataset.uid}`});return t.setAttribute("allowfullscreen","true"),t}},{key:"Gist",regExp:/^\w+:\/\/gist\.github\.com\/[\w\-]+\/(\w+)/,style:"",el:function(){let e=0;return function(t){const o=x.el("pre",{hidden:!0,id:"gist-embed-"+e++});return Fe.cache(`https://api.github.com/gists/${t.dataset.uid}`,(function(){return o.textContent=Object.values(this.response.files)[0].content,o.className="prettyprint",x.global("prettyPrint",{id:o.id}),o.hidden=!1})),o}}(),title:{api:e=>`https://api.github.com/gists/${e}`,text({files:e}){for(var t in e)if(e.hasOwnProperty(t))return t}}},{key:"InstallGentoo",regExp:/^\w+:\/\/paste\.installgentoo\.com\/view\/(?:raw\/|download\/|embed\/)?(\w+)/,el:e=>x.el("iframe",{src:`https://paste.installgentoo.com/view/embed/${e.dataset.uid}`})},{key:"LiveLeak",regExp:/^\w+:\/\/(?:\w+\.)?liveleak\.com\/.*\?.*[tif]=(\w+)/,el(e){const t=x.el("iframe",{src:`https://www.liveleak.com/e/${e.dataset.uid}`})
;return t.setAttribute("allowfullscreen","true"),t}},{key:"Loopvid",regExp:/^\w+:\/\/(?:www\.)?loopvid.appspot.com\/#?((?:pf|kd|lv|gd|gh|db|dx|nn|cp|wu|ig|ky|mf|m2|pc|1c|pi|ni|wl|ko|mm|ic|gc)\/[\w\-\/]+(?:,[\w\-\/]+)*|fc\/\w+\/\d+|https?:\/\/.+)/,style:"max-width: 80vw; max-height: 80vh;",el(e){const t=x.el("video",{controls:!0,preload:"auto",loop:!0});if(/^http/.test(e.dataset.uid))return x.add(t,x.el("source",{src:e.dataset.uid})),t;const[o,a,i]=e.dataset.uid.match(/(\w+)\/(.*)/),s=(()=>{switch(a){case"gd":case"wu":case"fc":return[""];case"gc":return["giant","fat","zippy"];default:return[".webm",".mp4"]}})();for(var n of i.split(","))for(var r of s){var l=`${n}${r}`,d=(()=>{switch(a){case"pf":return[`https://kastden.org/_loopvid_media/pf/${l}`,`https://web.archive.org/web/2/http://a.pomf.se/${l}`];case"kd":return[`https://kastden.org/loopvid/${l}`];case"lv":return[`https://lv.kastden.org/${l}`];case"gd":return[`https://docs.google.com/uc?export=download&id=${l}`];case"gh":
return[`https://googledrive.com/host/${l}`];case"db":return[`https://dl.dropboxusercontent.com/u/${l}`];case"dx":return[`https://dl.dropboxusercontent.com/${l}`];case"nn":return[`https://kastden.org/_loopvid_media/nn/${l}`];case"cp":return[`https://copy.com/${l}`];case"wu":return[`http://webmup.com/${l}/vid.webm`];case"ig":return[`https://i.imgur.com/${l}`];case"ky":return[`https://kastden.org/_loopvid_media/ky/${l}`];case"mf":return[`https://kastden.org/_loopvid_media/mf/${l}`,`https://web.archive.org/web/2/https://d.maxfile.ro/${l}`];case"m2":return[`https://kastden.org/_loopvid_media/m2/${l}`];case"pc":return[`https://kastden.org/_loopvid_media/pc/${l}`,`https://web.archive.org/web/2/http://a.pomf.cat/${l}`];case"1c":return[`http://b.1339.cf/${l}`];case"pi":return[`https://kastden.org/_loopvid_media/pi/${l}`,`https://web.archive.org/web/2/https://u.pomf.is/${l}`];case"ni":return[`https://kastden.org/_loopvid_media/ni/${l}`,`https://web.archive.org/web/2/https://u.nya.is/${l}`]
;case"wl":return[`http://webm.land/media/${l}`];case"ko":return[`https://kordy.kastden.org/loopvid/${l}`];case"mm":return[`https://kastden.org/_loopvid_media/mm/${l}`,`https://web.archive.org/web/2/https://my.mixtape.moe/${l}`];case"ic":return[`https://media.8ch.net/file_store/${l}`];case"fc":return[`//${T.host()}/${l}.webm`];case"gc":return[`https://${r}.gfycat.com/${n}.webm`]}})();for(var c of d)x.add(t,x.el("source",{src:c}))}return t}},{key:"Openings.moe",regExp:/^\w+:\/\/openings.moe\/\?video=([^.&=]+)/,style:"width: 1280px; height: 720px; max-width: 80vw; max-height: 80vh;",el(e){const t=x.el("iframe",{src:`https://openings.moe/?video=${e.dataset.uid}`});return t.setAttribute("allowfullscreen","true"),t}},{key:"Pastebin",regExp:/^\w+:\/\/(?:\w+\.)?pastebin\.com\/(?!u\/)(?:[\w.]+(?:\/|\?i\=))?(\w+)/,el:e=>x.el("iframe",{src:`//pastebin.com/embed_iframe.php?i=${e.dataset.uid}`})},{key:"SoundCloud",regExp:/^\w+:\/\/(?:www\.)?(?:soundcloud\.com\/|snd\.sc\/)([\w\-\/]+)/,
style:"border: 0; width: 500px; height: 400px;",el:e=>x.el("iframe",{src:`https://w.soundcloud.com/player/?visual=true&show_comments=false&url=https%3A%2F%2Fsoundcloud.com%2F${encodeURIComponent(e.dataset.uid)}`}),title:{api:e=>`${location.protocol}//soundcloud.com/oembed?format=json&url=https%3A%2F%2Fsoundcloud.com%2F${encodeURIComponent(e)}`,text:e=>e.title}},{key:"StrawPoll",regExp:/^\w+:\/\/(?:www\.)?strawpoll\.me\/(?:embed_\d+\/)?(\d+(?:\/r)?)/,style:"border: 0; width: 600px; height: 406px;",el:e=>x.el("iframe",{src:`https://www.strawpoll.me/embed_1/${e.dataset.uid}`})},{key:"Streamable",regExp:/^\w+:\/\/(?:www\.)?streamable\.com\/(\w+)/,el(e){const t=x.el("iframe",{src:`https://streamable.com/o/${e.dataset.uid}`});return t.setAttribute("allowfullscreen","true"),t},title:{api:e=>`https://api.streamable.com/oembed?url=https://streamable.com/${e}`,text:e=>e.title}},{key:"TwitchTV",regExp:/^\w+:\/\/(?:www\.|secure\.|clips\.|m\.)?twitch\.tv\/(\w[^#\&\?]*)/,el(e){
let t,o=e.dataset.href.match(/^\w+:\/\/(?:(clips\.)|\w+\.)?twitch\.tv\/(?:\w+\/)?(clip\/)?(\w[^#\&\?]*)/);if(o[1]||o[2])t=`//clips.twitch.tv/embed?clip=${o[3]}&parent=${location.hostname}`;else{let a;o=e.dataset.uid.match(/(\w+)(?:\/(?:v\/)?(\d+))?/),t=`//player.twitch.tv/?${o[2]?`video=v${o[2]}`:`channel=${o[1]}`}&autoplay=false&parent=${location.hostname}`,(a=e.dataset.href.match(/\bt=(\w+)/))&&(t+=`&time=${a[1]}`)}const a=x.el("iframe",{src:t});return a.setAttribute("allowfullscreen","true"),a}},{key:"Twitter",regExp:/^\w+:\/\/(?:www\.|mobile\.)?(?:(?:(?:fx|vx)?twitter|(?:fixup|fixv)?x|twittpr|xcancel)\.com|nitter\.\w+.\w+)\/(\w+\/status\/\d+)/,style:"border: none; width: 550px; height: 250px; overflow: hidden; resize: both;",el(e){if("tf"===a.XEmbedder){const a=x.el("iframe");x.on(a,"load",(function(){return this.contentWindow.postMessage({element:"t",query:"height"},"https://twitframe.com")}));var t=function(e){
if(e.source===a.contentWindow&&"https://twitframe.com"===e.origin)return x.off(window,"message",t),(o||a).style.height=+x.minmax(e.data.height,250,.8*r.clientHeight)+"px"};if(x.on(window,"message",t),a.src=`https://twitframe.com/show?url=https://twitter.com/${e.dataset.uid}`,"gecko"===x.engine){a.style.cssText="border: none; width: 100%; height: 100%;";var o=x.el("div");return x.add(o,a),o}return a}return function(e){const t=x.el("div",{innerHTML:'<blockquote class="twitter-tweet">Loading&hellip;</blockquote>'}),o=a.fxtLang?`/${a.fxtLang}`:"";return Fe.cachePromise(`${a.fxtUrl}/${e.dataset.uid}${o}`).then((async e=>{if(404===e.status)return void(t.textContent="404: tweet not found");const{tweet:i}=e.response,s=0==+a.fxtMaxReplies?[]:await async function(e){if(!e?.replying_to_status)return[];const t=+a.fxtMaxReplies;let i=[];i.push(e);for(let e=0;e<t;e++){const t=(await Fe.cachePromise(`https://api.fxtwitter.com/${i[e].replying_to}/status/${i[e].replying_to_status}${o}`)).response
;if(i.push(t.tweet),!t.tweet?.replying_to_status)break}return i}(i);function n(e){return e.media?.all?.map((e=>{switch(e.type){case"photo":return C("div",{class:"fxt-media"},C("a",{href:e.url,target:"_blank",referrerpolicy:"no-referrer"},C("img",{src:e.url,alt:e.altText,width:e.width,height:e.height,referrerpolicy:"no-referrer"})));case"video":case"gif":return C("div",{class:"fxt-media"},C("video",{controls:!0,width:e.width,height:e.height,poster:e.thumbnail_url,preload:"meta"},C("source",{src:e.url,type:e.format})));default:console.warn(`FxTwitter media type ${e.type} not recognized`)}}))||[]}function r(e){let t=0,o=-1;return e.poll.choices.forEach(((e,a)=>{e.percentage>t&&(t=e.percentage,o=a)})),C("div",{class:"fxt-poll"},...e.poll.choices.map(((e,t)=>C("div",{class:"fxt-choice "+(t===o?"highlight":"")},C("span",{class:"choice_label"},e.label),C("span",{class:"choice_percentage"},e.percentage,"%"),C("div",{class:"bar",style:`width: ${e.percentage}%`})))),C("div",{class:"total-votes"
},e.poll.total_votes.toLocaleString()," votes"))}function l(e){return e?.translation?.target_lang&&e?.translation?.source_lang!==e?.translation?.target_lang?C(I,null,C("hr",null),C("p",null,"Translated from ",e.translation.source_lang_en),C("p",{lang:e.translation.target_lang},...c(e.translation.text))):""}function d(e){return C("div",{class:"fxt-meta"},C("a",{class:"fxt-meta_profile",href:e.author.url,title:e.author.description,target:"_blank",referrerpolicy:"no-referrer"},C("img",{src:e.author.avatar_url,referrerpolicy:"no-referrer"}),C("div",{class:"fxt-meta_author"},C("span",{class:"fxt-meta_author_username"},e.author.name),C("span",{class:"fxt-meta_author_account"},"@",e.author.screen_name))),C("a",{href:e.url,title:"Open tweet in a new tab",target:"_blank",referrerpolicy:"no-referrer"},M.raw("link")))}function c(e){const t=[];let o=0;for(const a of e.matchAll(/(?:@|\#)\w+/g))t.push(e.slice(o,a.index),C("a",{
href:`https://x.com/${a[0].startsWith("#")?"hashtag/":""}${a[0].slice(1)}`,target:"_blank",referrerpolicy:"no-referrer"},a[0])),o=a.index+a[0].length;return t.push(e.slice(o)),t}function h(e,t=!1){const o=e?.quote&&t?h(e.quote,!1):"",a=e?.poll?r(e):"",i=l(e),s=e.media?.all?n(e):[];return C("div",{class:"fxt-quote"},d(e),C("div",{class:"fxt-text",lang:e.lang},...c(e.text),i),C("div",{class:"fxt-media_container "+(e.media?.all?.length>1?"fxt-media-multiple":"")},a,...s),o)}let u=[];if(s.length>1){u.push({innerHTML:"<em>Replying To</em><br/>",[y]:!0});for(let e=s.length-1;e>0;e--)u.push(h(s[e],!0))}const p=n(i),g=i?.quote?h(i.quote):"",f=i?.poll?r(i):"",m=function(e){return Re.format(new Date(e.created_at))}(i),b=o?l(i):"",v=C("article",{class:"fxt-card"},d(i),C("div",{class:"fxt-text",lang:i.lang},...c(i.text),b),C("div",{class:"fxt-media_container "+(i.media?.all?.length>1?"fxt-media-multiple":"")},f,...p),g,C("div",{class:"fxt-stats"},C("div",{class:"fxt-stats_time"},m),C("div",{
class:"fxt-stats_meta"},C("span",{class:"fxt-likes"},M.raw("comment"),i.replies.toLocaleString()),C("span",{class:"fxt-reposts"},M.raw("shuffle"),i.retweets.toLocaleString()),C("span",{class:"fxt-replies"},M.raw("heart"),i.likes.toLocaleString()))));t.innerHTML=v.innerHTML;for(const e of t.getElementsByClassName("fxt-text"))Te.process(e);t.style.resize=null,t.style.height="fit-content",t.style.width="fit-content",t.style.overflow="auto"})),t}(e)}},{key:"VidLii",regExp:/^\w+:\/\/(?:www\.)?vidlii\.com\/watch\?v=(\w{11})/,style:"border: none; width: 640px; height: 392px;",el(e){const t=x.el("iframe",{src:`https://www.vidlii.com/embed?v=${e.dataset.uid}&a=0`});return t.setAttribute("allowfullscreen","true"),t}},{key:"Vimeo",regExp:/^\w+:\/\/(?:www\.)?vimeo\.com\/(\d+)/,el(e){const t=x.el("iframe",{src:`//player.vimeo.com/video/${e.dataset.uid}?wmode=opaque`});return t.setAttribute("allowfullscreen","true"),t},title:{api:e=>`https://vimeo.com/api/oembed.json?url=https://vimeo.com/${e}`,
text:e=>e.title}},{key:"Vine",regExp:/^\w+:\/\/(?:www\.)?vine\.co\/v\/(\w+)/,style:"border: none; width: 500px; height: 500px;",el:e=>x.el("iframe",{src:`https://vine.co/v/${e.dataset.uid}/card`})},{key:"Vocaroo",regExp:/^\w+:\/\/(?:(?:www\.|old\.)?vocaroo\.com|voca\.ro)\/((?:i\/)?\w+)/,style:"",el(e){const t=x.el("iframe");return t.width=300,t.height=60,t.setAttribute("frameborder",0),t.src=`https://vocaroo.com/embed/${e.dataset.uid.replace(/^i\//,"")}?autoplay=0`,t}},{key:"YouTube",regExp:/^\w+:\/\/(?:youtu.be\/|[\w.]*youtube[\w.]*\/.*(?:v=|\bembed\/|\bv\/|shorts\/|live\/|watch\/))([\w\-]{11})(.*)/,el(e){let t=e.dataset.options.match(/\b(?:star)?t\=(\w+)/);t&&(t=t[1]),t&&!/^\d+$/.test(t)&&(t+=" 0h0m0s",t=3600*t.match(/(\d+)h/)[1]+60*t.match(/(\d+)m/)[1]+1*t.match(/(\d+)s/)[1]);const o=x.el("iframe",{src:`//www.youtube.com/embed/${e.dataset.uid}?rel=0&wmode=opaque${t?"&start="+t:""}`});return o.setAttribute("allowfullscreen","true"),o},title:{
api:e=>`https://www.youtube.com/oembed?url=https%3A//www.youtube.com/watch%3Fv%3D${e}&format=json`,text:e=>e.title,status(e){if(e.error){const t=e.error.match(/^(\d*)\s*(.*)/);return[+t[1],t[2]]}return[200,"OK"]}},preview:{url:e=>`https://img.youtube.com/vi/${e}/0.jpg`,height:360}}],shouldFetchTitles:()=>!!a["Link Title"]&&(!!a["Link Title in the catalog"]||"catalog"!==i.VIEW&&!("index"===i.VIEW&&"catalog"===a["Index Mode"]))},Ne={init(){let e;if(this.audio=x.el("audio"),"gecko"!==x.engine&&(this.audio.src=this.beep),x.on(this.audio,"error",(()=>{new Ke("error",this.audio.error.message||"Error when trying to play thread updater beep.",15)})),"thread"!==i.VIEW||!a["Thread Updater"])return;this.enabled=!0,a["Updater and Stats in Header"]?(this.dialog=e=x.el("span",{id:"updater"}),x.extend(e,{innerHTML:'<span id="update-status" class="empty"></span><span id="update-timer" class="empty" title="Update now"></span>'}),Ye.addShortcut("updater",e,100)):(this.dialog=e=X.dialog("updater",{
innerHTML:'<div class="move"></div><span id="update-status" class="empty"></span><span id="update-timer" class="empty" title="Update now"></span>'}),x.addClass(r,"float"),x.ready((()=>x.add(n.body,e)))),this.checkPostCount=0,this.timer=x("#update-timer",e),this.status=x("#update-status",e),x.on(this.timer,"click",this.update),x.on(this.status,"click",this.update);const t=x.el("span",{className:"brackets-wrap updatelink"});x.extend(t,{innerHTML:'<a href="javascript:;">Update</a>'}),Pt.ready((function(){let e;if(e=x(".navLinksBot"))return x.add(e,[x.tn(" "),t])})),x.on(t.firstElementChild,"click",this.update);const o=[];for(const e in h.updater.checkbox){var s=h.updater.checkbox[e];const t=X.checkbox(e,e);t.title=s[1];var l=t.firstElementChild;x.on(l,"change",x.cb.checked),"Scroll BG"===l.name?(x.on(l,"change",this.cb.scrollBG),this.cb.scrollBG()):"Auto Update"===l.name&&x.on(l,"change",this.setInterval),o.push({el:t})}return this.settings=x.el("span",{
innerHTML:'<a href="javascript:;">Interval</a>'}),x.on(this.settings,"click",this.intervalShortcut),o.push({el:this.settings}),Ye.menu.addEntry(this.entry={el:x.el("span",{textContent:"Updater"}),order:110,subEntries:o}),c.Thread.push({name:"Thread Updater",cb:this.node})},node(){return Ne.thread=this,Ne.root=this.nodes.root,Ne.outdateCount=0,Ne.postIDs=[],Ne.fileIDs=[],this.posts.forEach((function(e){if(Ne.postIDs.push(e.ID),e.file)return Ne.fileIDs.push(e.ID)})),Ne.cb.interval.call(x.el("input",{value:a.Interval})),x.on(n,"QRPostSuccessful",Ne.cb.checkpost),x.on(n,"visibilitychange",Ne.cb.visibility),Ne.setInterval()},
/*
      http://freesound.org/people/pierrecartoons1979/sounds/90112/
      cc-by-nc-3.0
      */
beep:"data:audio/wav;base64,UklGRjQDAABXQVZFZm10IBAAAAABAAEAgD4AAIA+AAABAAgAc21wbDwAAABBAAADAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABkYXRhzAIAAGMms8em0tleMV4zIpLVo8nhfSlcPR102Ki+5JspVEkdVtKzs+K1NEhUIT7DwKrcy0g6WygsrM2k1NpiLl0zIY/WpMrjgCdbPhxw2Kq+5Z4qUkkdU9K1s+K5NkVTITzBwqnczko3WikrqM+l1NxlLF0zIIvXpsnjgydZPhxs2ay95aIrUEkdUdC3suK8N0NUIjq+xKrcz002WioppdGm091pK1w0IIjYp8jkhydXPxxq2K295aUrTkoeTs65suK+OUFUIzi7xqrb0VA0WSoootKm0t5tKlo1H4TYqMfkiydWQBxm16+85actTEseS8y7seHAPD9TIza5yKra01QyWSson9On0d5wKVk2H4DYqcfkjidUQB1j1rG75KsvSkseScu8seDCPz1TJDW2yara1FYxWSwnm9Sn0N9zKVg2H33ZqsXkkihSQR1g1bK65K0wSEsfR8i+seDEQTxUJTOzy6rY1VowWC0mmNWoz993KVc3H3rYq8TklSlRQh1d1LS647AyR0wgRMbAsN/GRDpTJTKwzKrX1l4vVy4lldWpzt97KVY4IXbUr8LZljVPRCxhw7W3z6ZISkw1VK+4sMWvXEhSPk6buay9sm5JVkZNiLWqtrJ+TldNTnquqbCwilZXU1BwpKirrpNgWFhTaZmnpquZbFlbVmWOpaOonHZcXlljhaGhpZ1+YWBdYn2cn6GdhmdhYGN3lp2enIttY2Jjco+bnJuOdGZlZXCImJqakHpoZ2Zug5WYmZJ/bGlobX6RlpeSg3BqaW16jZSVkoZ0bGtteImSk5KIeG5tbnaFkJKRinxxbm91gY2QkIt/c3BwdH6Kj4+LgnZxcXR8iI2OjIR5c3J0e4WLjYuFe3VzdHmCioyLhn52dHR5gIiKioeAeHV1eH+GiYqHgXp2dnh9hIiJh4J8eHd4fIKHiIeDfXl4eHyBhoeHhH96eHmA",
playBeep(e=!0){const{audio:t}=Ne,o=a.beepSource||Ne.beep;t.src!==o&&(t.src=o),t.volume=Math.max(.01,Math.min(+a.beepVolume,1)),t.paused?t.play():e&&x.one(t,"ended",Ne.playBeep)},cb:{checkpost(e){if(e.detail.threadID===Ne.thread.ID)return Ne.postID=e.detail.postID,Ne.checkPostCount=0,Ne.outdateCount=0,Ne.setInterval()},visibility(){if(!n.hidden)return Ne.outdateCount=0,Ne.seconds>Ne.interval?Ne.setInterval():void 0},scrollBG:()=>Ne.scrollBG=a["Scroll BG"]?()=>!0:()=>!n.hidden,interval(e){let t=parseInt(this.value,10);if(t<1&&(t=1),Ne.interval=this.value=t,e)return x.cb.value.call(this)},load(){if(this===Ne.req)switch(this.status){case 200:return Ne.parse(this),Ne.thread.isArchived?Ne.kill():Ne.setInterval();case 404:return x.ajax(i.SITE.urls.catalogJSON({boardID:Ne.thread.board.ID}),{onloadend(){let e;if(200===this.status){for(var t of(e=!0,this.response))for(var o of t.threads)if(o.no===Ne.thread.ID){e=!1;break}}else e=!1;e?Ne.kill():Ne.error(this)}});default:return Ne.error(this)}}},
kill:()=>(Ne.thread.kill(),Ne.setInterval(),x.event("ThreadUpdate",{404:!0,threadID:Ne.thread.fullID})),error:e=>(304===e.status&&Ne.set("status",""),Ne.setInterval(),e.status?304!==e.status?Ne.set("status",`${e.statusText} (${e.status})`,"warning"):void 0:Ne.set("status","Connection Error","warning")),setInterval(){if(clearTimeout(Ne.timeoutID),Ne.thread.isDead)return Ne.set("status",Ne.thread.isArchived?"Archived":"404","warning"),void Ne.set("timer","");if(Ne.postID&&Ne.checkPostCount<5)return Ne.set("timer","...","loading"),void(Ne.timeoutID=setTimeout(Ne.update,++Ne.checkPostCount*g));if(!a["Auto Update"])return void Ne.set("timer","Update");const{interval:e}=Ne;if(a["Optional Increase"]){const t=n.hidden?10:5,o=Math.min(Ne.outdateCount,t),a=(Math.floor(.1*e)||1)*o*o;Ne.seconds=x.minmax(a,e,300)}else Ne.seconds=e;return Ne.timeout()},intervalShortcut(){We.open("Advanced");const e=x.id("fourchanx-settings");return x("input[name=Interval]",e).focus()},set(e,t,o){let a;const i=Ne[e]
;return(a=i.firstChild)?a.data=t:i.textContent=t,i.className=o??(""===t?"empty":"")},timeout:()=>(Ne.seconds?(Ne.set("timer",Ne.seconds),Ne.timeoutID=setTimeout(Ne.timeout,1e3)):(Ne.outdateCount++,Ne.update()),Ne.seconds--),update(){let e;return clearTimeout(Ne.timeoutID),Ne.set("timer","...","loading"),(e=Ne.req)&&(delete Ne.req,e.abort()),Ne.req=x.whenModified(i.SITE.urls.threadJSON({boardID:Ne.thread.board.ID,threadID:Ne.thread.ID}),"ThreadUpdater",Ne.cb.load,{timeout:f})},updateThreadStatus(e,t){if(Ne.thread[`is${e}`]===t)return;if(Ne.thread.setStatus(e,t),"Closed"===e&&Ne.thread.isArchived)return;return new Ke("info",`The thread is ${"Sticky"===e?t?"now a sticky":"not a sticky anymore":t?"now closed":"not closed anymore"}.`,30)},parse(e){let t,o,s;const l=e.response.posts,d=l[0],c=Ne.thread,{board:h}=c,u=Ne.postIDs[Ne.postIDs.length-1];if(l[l.length-1].no<u&&new Date(e.getResponseHeader("Last-Modified"))-c.posts.get(u).info.date<3e4)return
;i.SITE.Build.spoilerRange[h]=d.custom_spoiler,c.setStatus("Archived",!!d.archived),Ne.updateThreadStatus("Sticky",!!d.sticky),Ne.updateThreadStatus("Closed",!!d.closed),c.postLimit=!!d.bumplimit,c.fileLimit=!!d.imagelimit,d.unique_ips&&(c.ipCount=d.unique_ips);const p=[],g=[],f=[],m=[];for(var b of l)if(t=b.no,g.push(t),b.fsize&&f.push(t),!(t<=u))if(!(s=c.posts.get(t))||s.isFetchedQuote){m.push(`${h}.${t}`);var v=i.SITE.Build.postFromObject(b,h.ID);p.push(new ae(v,c,h)),Ne.postID===t&&delete Ne.postID}else s.resurrect();const A=[];for(t of Ne.postIDs)g.includes(t)||(c.posts.get(t).kill(),A.push(`${h}.${t}`));Ne.postIDs=g;const w=[];for(t of Ne.fileIDs)f.includes(t)||A.includes(`${h}.${t}`)||(c.posts.get(t).kill(!0),w.push(`${h}.${t}`));if(Ne.fileIDs=f,p.length){Ne.set("status",`+${p.length}`,"new"),Ne.outdateCount=0;const e=fe.posts?.size,t=fe.postsQuotingYou?.size;Pt.callbackNodes("Post",p),!n.hidden&&n.hasFocus()||(a["Beep Quoting You"]&&fe.postsQuotingYou?.size>t?(Ne.playBeep(),
a.Beep&&Ne.playBeep()):a.Beep&&fe.posts?.size>0&&0===e&&Ne.playBeep());const o=a["Auto Scroll"]&&Ne.scrollBG()&&Ne.root.getBoundingClientRect().bottom-r.clientHeight<25;let i=null;for(s of p)xe.insert(s)||(i||(i=s.nodes.root),x.add(Ne.root,s.nodes.root));x.event("PostsInserted",null,Ne.root),o&&(a["Bottom Scroll"]?window.scrollTo(0,n.body.clientHeight):i&&Ye.scrollTo(i))}else Ne.set("status","");return d.unique_ips&&(o=x.id("unique-ips"))&&(o.textContent=d.unique_ips,o.previousSibling.textContent=o.previousSibling.textContent.replace(/\b(?:is|are)\b/,1===d.unique_ips?"is":"are"),o.nextSibling.textContent=o.nextSibling.textContent.replace(/\bposters?\b/,1===d.unique_ips?"poster":"posters")),x.event("ThreadUpdate",{404:!1,threadID:c.fullID,newPosts:m,deletedPosts:A,deletedFiles:w,postCount:d.replies+1,fileCount:d.images+!!d.fsize,ipCount:d.unique_ips})}},Le={init(){if(a.Keybinds){for(var e in h.hotkeys)x.sync(e,Le.sync);var t=function(){for(var e of(x.off(n,"4chanXInitFinished",t),
x.on(n,"keydown",Le.keydown),S("[accesskey]")))e.removeAttribute("accesskey")};return x.on(n,"4chanXInitFinished",t)}},sync:(e,t)=>a[t]=e,keydown(e){let t,o,s,n,r;if(!(t=Le.keyCode(e)))return;const{target:l}=e;if(!["INPUT","TEXTAREA"].includes(l.nodeName)||/(Esc|Alt|Ctrl|Meta|Shift\+\w{2,})/.test(t)&&!/^Alt\+(\d|Up|Down|Left|Right)$/.test(t)){switch(["index","thread"].includes(i.VIEW)&&(s=Z.getThread(),o=w.threadFromRoot(s)),t){case a["Toggle board list"]:if(!a["Custom Board Navigation"])return;Ye.toggleBoardList();break;case a["Toggle header"]:Ye.toggleBarVisibility();break;case a["Open empty QR"]:if(!Me.postingIsEnabled)return;Le.qr();break;case a["Open QR"]:if(!Me.postingIsEnabled||!s)return;Le.qr(s);break;case a["Open settings"]:We.open();break;case a.Close:
if(We.dialog)We.close();else if((r=S(".notification")).length)for(var d of r)x(".close",d).click();else if(Me.nodes?.preview)Me.closePreview();else if(Me.nodes&&!Me.nodes.el.hidden&&"none"!==window.getComputedStyle(Me.nodes.form).display)a["Persistent QR"]?Me.hide():Me.close();else{if(!Be.lastEmbed)return;Be.closeFloat()}break;case a["Spoiler tags"]:if("TEXTAREA"!==l.nodeName)return;Le.tags("spoiler",l);break;case a["Code tags"]:if("TEXTAREA"!==l.nodeName)return;Le.tags("code",l);break;case a["Eqn tags"]:if("TEXTAREA"!==l.nodeName)return;Le.tags("eqn",l);break;case a["Math tags"]:if("TEXTAREA"!==l.nodeName)return;Le.tags("math",l);break;case a["SJIS tags"]:if("TEXTAREA"!==l.nodeName)return;Le.tags("sjis",l);break;case a["Toggle sage"]:if(!Me.nodes||Me.nodes.el.hidden)return;Le.sage();break;case a["Toggle Cooldown"]:if(!Me.nodes||Me.nodes.el.hidden||!x.hasClass(Me.nodes.fileSubmit,"custom-cooldown"))return;Me.toggleCustomCooldown();break;case a["Post from URL"]:
if(!Me.postingIsEnabled)return;Me.handleUrl("");break;case a["Add new post"]:if(!Me.postingIsEnabled)return;Me.addPost();break;case a["Submit QR"]:if(!Me.nodes||Me.nodes.el.hidden)return;Me.status()||Me.submit();break;case a.Update:switch(i.VIEW){case"thread":if(!Ne.enabled)return;Ne.update();break;case"index":if(!Ie.enabled)return;Ie.update();break;default:return}break;case a.Watch:if(!ve.enabled||!o)return;ve.toggle(o);break;case a["Update thread watcher"]:if(!ve.enabled)return;ve.buttonFetchAll();break;case a["Toggle thread watcher"]:if(!ve.enabled)return;ve.toggleWatcher();break;case a["Toggle threading"]:if(!xe.ready)return;xe.toggleThreading();break;case a["Mark thread read"]:if("index"!==i.VIEW||!o||!be.enabled)return;be.markRead.call(s);break;case a["Expand image"]:if(!oe.enabled||!s)return;var c=w.postFromNode(Le.post(s));c.file&&oe.toggle(c);break;case a["Expand images"]:if(!oe.enabled)return;oe.cb.toggleAll();break;case a["Open Gallery"]:if(!Se.enabled)return;Se.cb.toggle()
;break;case a.fappeTyme:if(!De.nodes?.fappe)return;De.toggle("fappe");break;case a.werkTyme:if(!De.nodes?.werk)return;De.toggle("werk");break;case a["Front page"]:Ie.enabled?Ie.userPageNav(1):location.href=`/${i.BOARD}/`;break;case a["Open front page"]:x.open(`${location.origin}/${i.BOARD}/`);break;case a["Next page"]:if("index"!==i.VIEW||i.SITE.isOnePage?.(i.BOARD))return;if(Ie.enabled){if(!["paged","infinite"].includes(a["Index Mode"]))return;x(".next button",Ie.pagelist).click()}else x(i.SITE.selectors.nav.next)?.click();break;case a["Previous page"]:if("index"!==i.VIEW||i.SITE.isOnePage?.(i.BOARD))return;if(Ie.enabled){if(!["paged","infinite"].includes(a["Index Mode"]))return;x(".prev button",Ie.pagelist).click()}else x(i.SITE.selectors.nav.prev)?.click();break;case a["Search form"]:if("index"!==i.VIEW)return;var h=Ie.enabled?Ie.searchInput:i.SITE.selectors.searchBox?x(i.SITE.selectors.searchBox):void 0;if(!h)return;Ye.scrollToIfNeeded(h),h.focus();break;case a["Paged mode"]:
if(!Ie.enabledOn(i.BOARD))return;location.href="index"===i.VIEW?"#paged":`/${i.BOARD}/#paged`;break;case a["Infinite scrolling mode"]:if(!Ie.enabledOn(i.BOARD))return;location.href="index"===i.VIEW?"#infinite":`/${i.BOARD}/#infinite`;break;case a["All pages mode"]:if(!Ie.enabledOn(i.BOARD))return;location.href="index"===i.VIEW?"#all-pages":`/${i.BOARD}/#all-pages`;break;case a["Open catalog"]:if(!(n=_e.catalog()))return;location.href=n;break;case a["Cycle sort type"]:if(!Ie.enabled)return;Ie.cycleSortType();break;case a["Next thread"]:if("index"!==i.VIEW||!s)return;Z.scroll(1);break;case a["Previous thread"]:if("index"!==i.VIEW||!s)return;Z.scroll(-1);break;case a["Expand thread"]:if("index"!==i.VIEW||!s)return;me.toggle(o),Ye.scrollTo(s);break;case a["Open thread"]:if("index"!==i.VIEW||!s)return;Le.open(o);break;case a["Open thread tab"]:if("index"!==i.VIEW||!s)return;Le.open(o,!0);break;case a["Next reply"]:if(!s)return;Le.hl(1,s);break;case a["Previous reply"]:if(!s)return
;Le.hl(-1,s);break;case a["Deselect reply"]:if(!s)return;Le.hl(0,s);break;case a.Hide:if(!o||!Ce.db)return;Ye.scrollTo(s),Ce.toggle(o);break;case a["Quick Filter MD5"]:if(!s)return;c=Le.post(s),Le.hl(1,s),Je.quickFilterMD5.call(c,e);break;case a["Previous Post Quoting You"]:if(!s||!pe.db)return;pe.cb.seek("preceding");break;case a["Next Post Quoting You"]:if(!s||!pe.db)return;pe.cb.seek("following");break;default:return}return e.preventDefault(),e.stopPropagation()}},keyCode(e){let t=(()=>{let t;switch(t=e.keyCode){case 8:return"";case 13:return"Enter";case 27:return"Esc";case 32:return"Space";case 37:return"Left";case 38:return"Up";case 39:return"Right";case 40:return"Down";case 188:return"Comma";case 190:return"Period";case 191:return"Slash";case 59:case 186:return"Semicolon";default:return 48<=t&&t<=57||65<=t&&t<=90?String.fromCharCode(t).toLowerCase():96<=t&&t<=105?String.fromCharCode(t-48):null}})();return t&&(e.altKey&&(t="Alt+"+t),e.ctrlKey&&(t="Ctrl+"+t),
e.metaKey&&(t="Meta+"+t),e.shiftKey&&(t="Shift+"+t)),t},post(e){const t=i.SITE.selectors;return x(`${t.postContainer}${t.highlightable.reply}.${i.SITE.classes.highlight}`,e)||x(`${i.SITE.isOPContainerThread?t.thread:t.postContainer}${t.highlightable.op}`,e)},qr:e=>(Me.open(),null!=e&&Me.quote.call(Le.post(e)),Me.nodes.com.focus()),tags(e,t){se.ready((function(){const{config:t}=i.BOARD;if(!(()=>{switch(e){case"spoiler":return!!t.spoilers;case"code":return!!t.code_tags;case"math":case"eqn":return!!t.math_tags;case"sjis":return!!t.sjis_tags}})())return new Ke("warning",`[${e}] tags are not supported on /${i.BOARD}/.`,20)}));const{value:o}=t,a=t.selectionStart,s=t.selectionEnd;t.value=o.slice(0,a)+`[${e}]`+o.slice(a,s)+`[/${e}]`+o.slice(s);const n=`[${e}]`.length+s;return t.setSelectionRange(n,n),x.event("input",null,t)},sage(){const e=/sage/i.test(Me.nodes.email.value);return Me.nodes.email.value=e?"":"sage"},open(e,t){if("index"!==i.VIEW)return;const o=w.url("thread",e)
;return t?x.open(o):location.href=o},hl(e,t){const o=`${i.SITE.selectors.postContainer}${i.SITE.selectors.highlightable.reply}`,{highlight:a}=i.SITE.classes,s=x(`${o}.${a}`,t);if(!e)return void(s&&x.rmClass(s,a));if(s){const{height:t}=s.getBoundingClientRect();if(Ye.getTopOf(s)>=-t&&Ye.getBottomOf(s)>=-t){let t;const{root:n}=w.postFromNode(s).nodes;if(!(t=x.x(`${1===e?"following":"preceding"}-sibling::${i.SITE.xpath.replyContainer}[not(@hidden) and not(child::div[@class='stub'])][1]`,n)))return;return t.matches(o)||(t=x(o,t)),Ye.scrollToIfNeeded(t,1===e),x.addClass(t,a),void x.rmClass(s,a)}x.rmClass(s,a)}const n=S(o,t);for(var r of(-1===e&&n.reverse(),n))if(1===e&&Ye.getTopOf(r)>0||-1===e&&Ye.getBottomOf(r)>0)return void x.addClass(r,a)}};const Pe={cache:{init(){return x.on(n,"SaveCaptcha",(e=>this.saveAPI(e.detail))),x.on(n,"NoCaptcha",(e=>this.noCaptcha(e.detail)))},captchas:[],getCount(){return this.captchas.length},neededRaw(){
return!(this.haveCookie()||this.captchas.length||Me.req||this.submitCB)&&(Me.posts.length>1||a["Auto-load captcha"]||!Me.posts[0].isOnlyQuotes()||Me.posts[0].file)},needed(){return this.neededRaw()&&x.event("LoadCaptcha")},haveCookie:()=>/\b_ct=/.test(n.cookie)&&"new"!==Me.posts[0].thread,getOne(){let e;return delete this.prerequested,this.clear(),(e=this.captchas.shift())?(this.count(),e):null},request(e){if(this.submitCB||!x.event("RequestCaptcha",{isReply:e}))return e=>(this.submitCB=e,this.updateCount())},abort(){if(this.submitCB)return delete this.submitCB,x.event("AbortCaptcha"),this.updateCount()},saveAPI(e){let t;return(t=this.submitCB)?(delete this.submitCB,t(e),this.updateCount()):this.save(e)},noCaptcha(e){let t;if(t=this.submitCB)return this.haveCookie()&&!e?.error||(Me.error(e?.error||"Failed to retrieve captcha."),Me.captcha.setup(n.activeElement===Me.nodes.status)),delete this.submitCB,t(),this.updateCount()},save(e){let t;return(t=this.submitCB)?(this.abort(),
void t(e)):(this.captchas.push(e),this.captchas.sort(((e,t)=>e.timeout-t.timeout)),this.count())},clear(){if(this.captchas.length){let e;const t=Date.now();for(e=0;e<this.captchas.length;e++){if(this.captchas[e].timeout>t)break}if(e)return this.captchas=this.captchas.slice(e),this.count()}},count(){return clearTimeout(this.timer),this.captchas.length&&(this.timer=setTimeout(this.clear.bind(this),this.captchas[0].timeout-Date.now())),this.updateCount()},updateCount(){return x.event("CaptchaCount",this.captchas.length)}},replace:$,t:O,v2:{lifetime:12e4,init(){if(n.cookie.indexOf("pass_enabled=1")>=0)return;if(!(this.isEnabled=!!x("#g-recaptcha, #captcha-forced-noscript")||!x.id("postForm")))return;(this.noscript=a["Force Noscript Captcha"]||!Pt.jsEnabled)&&x.addClass(Me.nodes.el,"noscript-captcha"),Pe.cache.init(),x.on(n,"CaptchaCount",this.count.bind(this));const e=x.el("div",{className:"captcha-root"});x.extend(e,{
innerHTML:'<div class="captcha-counter"><a href="javascript:;"></a></div>'});const t=x(".captcha-counter > a",e);return this.nodes={root:e,counter:t},this.count(),x.addClass(Me.nodes.el,"has-captcha","captcha-v2"),x.after(Me.nodes.com.parentNode,e),x.on(t,"click",this.toggle.bind(this)),x.on(t,"keydown",(e=>{if("Space"===Le.keyCode(e))return this.toggle(),e.preventDefault(),e.stopPropagation()})),x.on(window,"captcha:success",(()=>x.queueTask((()=>this.save(!1)))))},timeouts:{},prevNeeded:0,noscriptURL(){let e,t=`https://www.google.com/recaptcha/api/fallback?k=${o.recaptchaKey}`;return(e=a.captchaLanguage.trim())&&(t+=`&hl=${encodeURIComponent(e)}`),t},moreNeeded(){return x.queueTask((()=>{const e=Pe.cache.needed();return e&&!this.prevNeeded&&this.setup(Me.cooldown.auto&&n.activeElement===Me.nodes.status),this.prevNeeded=e}))},toggle(){return this.nodes.container&&!this.timeouts.destroy?this.destroy():this.setup(!0,!0)},setup(e,t){if(this.isEnabled&&(Pe.cache.needed()||t)){
if(e&&(x.addClass(Me.nodes.el,"focus"),this.nodes.counter.focus()),this.timeouts.destroy)return clearTimeout(this.timeouts.destroy),delete this.timeouts.destroy,this.reload();if(!this.nodes.container)return this.nodes.container=x.el("div",{className:"captcha-container"}),x.prepend(this.nodes.root,this.nodes.container),new MutationObserver(this.afterSetup.bind(this)).observe(this.nodes.container,{childList:!0,subtree:!0}),this.noscript?this.setupNoscript():this.setupJS();x.queueTask((()=>{let e;if(this.nodes.container&&n.activeElement===this.nodes.counter&&(e=x('iframe[src^="https://www.google.com/recaptcha/"]',this.nodes.container)))return e.focus(),Me.focus()}))}},setupNoscript(){const e=x.el("iframe",{id:"qr-captcha-iframe",scrolling:"no",src:this.noscriptURL()}),t=x.el("div"),o=x.el("textarea");return x.add(t,o),x.add(this.nodes.container,[e,t])},setupJS(){x.global("setupCaptcha",{recaptchaKey:o.recaptchaKey})},afterSetup(e){for(var t of e)for(var o of t.addedNodes){var a,i
;(a=x.x('./descendant-or-self::iframe[starts-with(@src, "https://www.google.com/recaptcha/")]',o))&&this.setupIFrame(a),(i=x.x("./descendant-or-self::textarea",o))&&this.setupTextArea(i)}},setupIFrame(e){let t;if(r.contains(e))return Pe.replace.iframe(e),x.addClass(Me.nodes.el,"captcha-open"),this.fixQRPosition(),x.on(e,"load",this.fixQRPosition),n.activeElement===this.nodes.counter&&e.focus(),["blink","edge"].includes(x.engine)&&(t=e.parentNode,S("#qr .captcha-container > div > div:first-of-type").includes(t))?x.on(e.parentNode,"scroll",(function(){return this.scrollTop=0})):void 0},fixQRPosition(){if(Me.nodes.el.getBoundingClientRect().bottom>r.clientHeight)return Me.nodes.el.style.top="",Me.nodes.el.style.bottom="0px"},setupTextArea(e){return x.one(e,"input",(()=>this.save(!0)))},destroy(){if(this.isEnabled)return delete this.timeouts.destroy,x.rmClass(Me.nodes.el,"captcha-open"),this.nodes.container?(x.global("resetCaptcha"),x.rm(this.nodes.container),
delete this.nodes.container):void 0},getOne:e=>Pe.cache.getOne(e),save(e,t){Pe.cache.save({response:t||x("textarea",this.nodes.container).value,timeout:Date.now()+this.lifetime});const o="IFRAME"===n.activeElement?.nodeName&&/https?:\/\/www\.google\.com\/recaptcha\//.test(n.activeElement.src);if(Pe.cache.needed()?(o&&(Me.cooldown.auto||a["Post on Captcha Completion"]?this.nodes.counter.focus():Me.nodes.status.focus()),this.reload()):(e?this.destroy():null==this.timeouts.destroy&&(this.timeouts.destroy=setTimeout(this.destroy.bind(this),3e3)),o&&Me.nodes.status.focus()),a["Post on Captcha Completion"]&&!Me.cooldown.auto)return Me.submit()},count(){const e=Pe.cache.getCount(),t=Pe.cache.submitCB?"...":"";return this.nodes.counter.textContent=`Captchas: ${e}${t}`,this.moreNeeded()},reload(){if(x('iframe[src^="https://www.google.com/recaptcha/api/fallback?"]',this.nodes.container))return this.destroy(),this.setup(!1,!0);x.global("resetCaptcha")},occupied(){
return!!this.nodes.container&&!this.timeouts.destroy}}};var Me={postingIsEnabled:!1,captcha:void 0,min_width:0,min_height:0,max_width:0,max_height:0,max_size:0,max_size_video:0,max_comment:0,max_width_video:0,max_height_video:0,max_duration_video:0,forcedAnon:!1,spoiler:!1,link:void 0,post:void 0,posts:void 0,nodes:void 0,shortcut:void 0,hasFocus:!1,req:void 0,selected:void 0,mimeTypes:["image/jpeg","image/png","image/gif","application/pdf","application/vnd.adobe.flash.movie","application/x-shockwave-flash","video/webm","video/mp4"],validExtension:/\.(jpe?g|png|gif|pdf|swf|webm|mp4)$/i,typeFromExtension:{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",pdf:"application/pdf",swf:"application/vnd.adobe.flash.movie",webm:"video/webm",mp4:"video/mp4"},extensionFromType:{"image/jpeg":"jpg","image/png":"png","image/gif":"gif","application/pdf":"pdf","application/vnd.adobe.flash.movie":"swf","application/x-shockwave-flash":"swf","video/webm":"webm","video/mp4":"mp4"},init(){
let e;a["Quick Reply"]&&(this.posts=[],x.on(n,"4chanXInitFinished",(()=>se.ready(Me.initReady))),c.Post.push({name:"Quick Reply",cb:this.node}),this.shortcut=e=x.el("a",{className:"disabled",title:"Quick Reply",href:"javascript:;"}),M.set(this.shortcut,"comment","Quick Reply"),x.on(e,"click",(function(){Me.postingIsEnabled&&(a["Persistent QR"]||!Me.nodes||Me.nodes.el.hidden?(Me.open(),Me.nodes.com.focus()):Me.close())})),Ye.addShortcut("qr",e,540),window.addEventListener("message",(e=>{e.data?.twister?.error&&Me.error(x.el("div",{innerHTML:e.data.twister.error}))})))},initReady(){let e;const t=x("#g-recaptcha, #captcha-forced-noscript")?"v2":"t";Me.captcha=Pe[t],Me.postingIsEnabled=!0;const{config:o}=i.BOARD,s=(e,t)=>+(o[e]??t);if(Me.min_width=s("min_image_width",1),Me.min_height=s("min_image_height",1),Me.max_width=Me.max_height=1e4,Me.max_size=s("max_filesize",4194304),Me.max_size_video=s("max_webm_filesize",Me.max_size),Me.max_comment=s("max_comment_chars",2e3),
Me.max_width_video=Me.max_height_video=2048,Me.max_duration_video=s("max_webm_duration",120),Me.forcedAnon=!!o.forced_anon,Me.spoiler=!!o.spoilers,e=x.id("togglePostFormLink")){const t=x.el("h1",{className:"qr-link-container"});x.extend(t,{innerHTML:`<a href="javascript:;" class="qr-link">${"thread"===i.VIEW?"Reply to Thread":"Start a Thread"}</a>`}),Me.link=t.firstElementChild,x.on(t.firstChild,"click",(function(){return Me.open(),Me.nodes.com.focus()})),x.before(e,t),e.firstElementChild.textContent="Original Form"}if("thread"===i.VIEW){let e;const t=x.el("div",{className:"brackets-wrap qr-link-container-bottom"});x.extend(t,{innerHTML:'<a href="javascript:;" class="qr-link-bottom">Reply to Thread</a>'}),x.on(t.firstElementChild,"click",(function(){return Me.open(),Me.nodes.com.focus()})),(e=x(".navLinksBot"))&&x.prepend(e,t)}if(x.on(n,"QRGetFile",Me.getFile),x.on(n,"QRDrawFile",Me.drawFile),x.on(n,"QRSetFile",Me.setFile),x.on(n,"paste",Me.paste),x.on(n,"dragover",Me.dragOver),
x.on(n,"drop",Me.dropFile),x.on(n,"dragstart dragend",Me.drag),x.on(n,"IndexRefreshInternal",Me.generatePostableThreadsList),x.on(n,"ThreadUpdate",Me.statusCheck),a["Persistent QR"])return Me.open(),a["Auto Hide QR"]?Me.hide():void 0},statusCheck(){if(!Me.nodes)return;const{thread:e}=Me.posts[0];return"new"!==e&&i.threads.get(`${i.BOARD}.${e}`).isDead?Me.abort():Me.status()},node(){if(x.on(this.nodes.quote,"click",Me.quote),this.isFetchedQuote)return Me.generatePostableThreadsList()},open(){if(Me.nodes)Me.nodes.el.hidden&&Me.captcha.setup(),Me.nodes.el.hidden=!1,Me.unhide();else try{Me.dialog()}catch(e){return delete Me.nodes,void Pt.handleErrors({message:"Quick Reply dialog creation crashed.",error:e})}return x.rmClass(Me.shortcut,"disabled")},close(){if(!Me.req){for(var e of(Me.nodes.el.hidden=!0,Me.cleanNotifications(),Me.blur(),x.rmClass(Me.nodes.el,"dump"),x.addClass(Me.shortcut,"disabled"),new Me.post(!0),Me.posts.splice(0,Me.posts.length-1)))e.delete()
;return Me.cooldown.auto=!1,Me.status(),Me.captcha.destroy()}Me.abort()},focus:()=>x.queueTask((function(){if(!Me.inBubble())return Me.hasFocus=n.activeElement&&Me.nodes.el.contains(n.activeElement),Me.nodes.el.classList.toggle("focus",Me.hasFocus)})),inBubble(){const e=S('iframe[src^="https://www.google.com/recaptcha/api2/frame"]');return e.includes(n.activeElement)||e.some((e=>"hidden"!==getComputedStyle(e).visibility&&e.getBoundingClientRect().bottom>0))},hide:()=>(Me.blur(),x.addClass(Me.nodes.el,"autohide"),Me.nodes.autohide.checked=!0),unhide:()=>(x.rmClass(Me.nodes.el,"autohide"),Me.nodes.autohide.checked=!1),toggleHide(){return this.checked?Me.hide():Me.unhide()},blur(){if(Me.nodes.el.contains(n.activeElement))return n.activeElement.blur()},toggleSJIS:e=>(e.preventDefault(),a.sjisPreview=!a.sjisPreview,x.set("sjisPreview",a.sjisPreview),Me.nodes.el.classList.toggle("sjis-preview",a.sjisPreview)),
texPreviewShow:()=>x.hasClass(Me.nodes.el,"tex-preview")?Me.texPreviewHide():(x.addClass(Me.nodes.el,"tex-preview"),Me.nodes.texPreview.textContent=Me.nodes.com.value,x.event("mathjax",null,Me.nodes.texPreview)),texPreviewHide:()=>x.rmClass(Me.nodes.el,"tex-preview"),addPost(){const e=Me.nodes&&!Me.nodes.el.hidden;return Me.open(),e&&(x.addClass(Me.nodes.el,"dump"),new Me.post(!0)),Me.nodes.com.focus()},setCustomCooldown:e=>(a.customCooldownEnabled=e,Me.cooldown.customCooldown=e,Me.nodes.customCooldown.classList.toggle("disabled",!e)),toggleCustomCooldown(){const e=x.hasClass(Me.nodes.customCooldown,"disabled");return Me.setCustomCooldown(e),x.set("customCooldownEnabled",e)},error(e,t){let o;Me.open(),"string"==typeof e?o=x.tn(e):(o=e,o.removeAttribute("style"));const a=new Ke("warning",o);if(Me.notifications.push(a),Ye.areNotificationsEnabled){if(n.hidden||!t&&!n.hasFocus()){const e=new Notification(o.textContent,{body:o.textContent,icon:F.logo});if(e.onclick=()=>window.focus(),
"gecko"!==x.engine)return e.onclose=()=>a.close(),e.onshow=()=>setTimeout((function(){return e.onclose=null,e.close()}),7e3)}}else if(n.hidden&&!Me.cooldown.auto)return alert(o.textContent)},connectionError:()=>x.el("span",{innerHTML:'Connection error while posting. [<a href="'+s(o.upstreamFaq)+'#connection-errors" target="_blank">More info</a>]'}),notifications:[],cleanNotifications(){for(var e of Me.notifications)e.close();return Me.notifications=[]},status(){let e,t;if(!Me.nodes)return;const{thread:o}=Me.posts[0];"new"!==o&&i.threads.get(`${i.BOARD}.${o}`).isDead&&(t="Dead",e=!0,Me.cooldown.auto=!1),t=Me.req?Me.req.progress:Me.cooldown.seconds||t;const{status:a}=Me.nodes;a.value=t?Me.cooldown.auto?`Auto ${t}`:t:"Submit",a.disabled=e||!1},openPost(){if(Me.open(),Me.selected.isLocked){const e=Me.posts.indexOf(Me.selected);return(Me.posts[e+1]||new Me.post).select(),x.addClass(Me.nodes.el,"dump"),Me.cooldown.auto=!0}},quote(e){let t;if(e?.preventDefault(),!Me.postingIsEnabled)return
;const o=n.getSelection(),a=w.postFromNode(this),{root:s}=a.nodes,r=new Range;r.selectNode(s);let l=a.board.ID===i.BOARD.ID?`>>${a}\n`:`>>>/${a.board}/${a}\n`;for(let e=0;e<o.rangeCount;e++)try{var d,c;if(t=o.getRangeAt(e),t.compareBoundaryPoints(Range.START_TO_START,r)<0&&t.setStartBefore(s),t.compareBoundaryPoints(Range.END_TO_END,r)>0&&t.setEndAfter(s),!t.toString().trim())continue;var h=t.cloneContents(),u=t.commonAncestorContainer;for(c of(x.x('ancestor-or-self::*[self::s or contains(@class,"removed-spoiler")]',u)&&(x.prepend(h,x.tn("[spoiler]")),x.add(h,x.tn("[/spoiler]"))),(d=x.x('ancestor-or-self::pre[contains(@class,"prettyprint")]',u))&&(x.prepend(h,x.tn("[code]")),x.add(h,x.tn("[/code]"))),S(d?"br":".prettyprint br",h)))x.replace(c,x.tn("\n"));for(c of S("br",h))c!==h.lastChild&&x.replace(c,x.tn("\n>"));for(c of(i.SITE.insertTags?.(h),S(".linkify[data-original]",h)))x.replace(c,x.tn(c.dataset.original))
;for(c of S(".embedder",h))" "===c.previousSibling?.nodeValue&&x.rm(c.previousSibling),x.rm(c);l+=`>${h.textContent.trim()}\n`}catch(e){}Me.openPost();const{com:p,thread:g}=Me.nodes;p.value||(g.value=w.threadFromNode(this));const f=Me.selected.isOnlyQuotes(),m=p.selectionStart;return p.value=p.value.slice(0,m)+l+p.value.slice(p.selectionEnd),t=m+l.length,p.setSelectionRange(t,t),p.focus(),f&&(Me.selected.quotedText=p.value),Me.selected.save(p),Me.selected.save(g)},characterCount(){const e=Me.nodes.charCount,t=Me.nodes.com.value.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length;e.textContent=t.toString(),e.hidden=t<Me.max_comment/2;return Me.nodes.splitPost.hidden=t<Me.max_comment,(t>Me.max_comment?x.addClass:x.rmClass)(e,"warning")},splitPost(){if(Me.selected.isLocked)return;if(Me.nodes.com.value.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length<Me.max_comment)return;const e=Me.nodes.com.value;let t=0,o=0;const a=Me.posts.indexOf(Me.selected);Me.selected.setComment("")
;for(const a of e.split("\n")){const e=a.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length+1;if(e+t>Me.max_comment){new Me.post(!0).setComment(a),t=e,o++}else{const o=[Me.selected.com,a].filter((e=>null!==e)).join("\n");Me.selected.setComment(o),t+=e}}const i=Me.posts.length-o,s=Me.posts.splice(i,o);Me.posts.splice(a+1,0,...s);const n=[...Me.nodes.dumpList.children],r=n.splice(i,o);n.splice(a+1,0,...r);for(const e of n)Me.nodes.dumpList.appendChild(e);Me.nodes.el.classList.add("dump")},getFile:()=>x.event("QRFile",Me.selected?.file),drawFile(e){const t=Me.selected?.file;if(!t||!/^(image|video)\//.test(t.type))return;const o=/^video\//.test(t),a=x.el(o?"video":"img");return x.on(a,"error",(()=>Me.openError())),x.on(a,o?"loadeddata":"load",(function(){return e.target.getContext("2d").drawImage(a,0,0),URL.revokeObjectURL(a.src),x.event("QRImageDrawn",null,e.target)})),a.src=URL.createObjectURL(t)},openError(){const e=x.el("div");return x.extend(e,{
innerHTML:'Could not open file. [<a href="'+s(o.upstreamFaq)+'#error-reading-metadata" target="_blank">More info</a>]'}),Me.error(e)},setFile(e){const{file:t,name:o,source:a}=e.detail;return null!=o&&(t.name=o),null!=a&&(t.source=a),Me.open(),Me.handleFiles([t])},drag(e){const t="dragstart"===e.type?x.off:x.on;return t(n,"dragover",Me.dragOver),t(n,"drop",Me.dropFile)},dragOver:e=>(e.preventDefault(),e.dataTransfer.dropEffect="copy"),dropFile(e){if(e.dataTransfer.files.length)return e.preventDefault(),Me.open(),Me.handleFiles(e.dataTransfer.files)},paste(e){if(!e.clipboardData.items)return;let t=null,o=-1;for(var i of e.clipboardData.items){var s;if("file"===i.kind&&(s=i.getAsFile())){var n=2*+(s.size<=Me.max_size)+ +("image/png"===s.type);n>o&&(t=s,o=n)}}if(t){const{type:e}=t,o=new Blob([t],{type:e});o.name=`${a.pastedname}.${x.getOwn(Me.extensionFromType,e)||"jpg"}`,Me.open(),Me.handleFiles([o])}},pasteFF(){const{pasteArea:e}=Me.nodes;if(!e.childNodes.length)return;const t=S("img",e)
;for(var o of(x.rmAll(e),t)){var i,{src:s}=o;if(i=s.match(/data:(image\/(\w+));base64,(.+)/)){var n=atob(i[3]),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);var l=new Blob([r],{type:i[1]});l.name=`${a.pastedname}.${i[2]}`,Me.handleFiles([l])}else/^https?:\/\//.test(s)&&Me.handleUrl(s)}},handleUrl(e){Me.open(),Me.selected.preventAutoPost(),Fe.permission((function(){const t=prompt("Enter a URL:",e);t&&(Me.nodes.fileButton.focus(),Fe.file(t,(function(e){e&&!/^text\//.test(e.type)?Me.handleFiles([e]):Me.error("Can't load file.")})))}))},handleFiles(e){if(this!==Me&&(e=[...this.files],this.value=null),e.length){for(var t of(Me.cleanNotifications(),e))Me.handleFile(t,e.length);return x.addClass(Me.nodes.el,"dump"),n.activeElement===Me.nodes.fileButton&&x.hasClass(Me.nodes.fileSubmit,"has-file")?Me.nodes.filename.focus():void 0}},handleFile(e,t){let o;const a=/^text\//.test(e.type);return 1===t?o=Me.selected:(o=Me.posts[Me.posts.length-1],
(a?o.com||o.pasting:o.file)&&(o=new Me.post)),o[a?"pasteText":"setFile"](e)},openFileInput(){if(!Me.nodes.fileButton.disabled)return Me.nodes.fileInput.click(),Me.nodes.fileButton.focus()},generatePostableThreadsList(){if(!Me.nodes)return;const e=Me.nodes.thread,t=[e.firstElementChild];for(var o of i.BOARD.threads.keys)t.push(x.el("option",{value:o,textContent:`Thread ${o}`}));const a=e.value;return x.rmAll(e),x.add(e,t),e.value=a,e.value!==a?(e.value="thread"===i.VIEW?i.THREADID:"new",("thread"===i.VIEW?x.addClass:x.rmClass)(Me.nodes.el,"reply-to-thread")):void 0},dialog(){let e,t,o,s;Me.nodes=o={el:e=X.dialog("qr",{
innerHTML:'<div class="move"> <label> <input type="checkbox" id="autohide" title="Auto-hide"> Quick Reply </label> <a href="javascript:;" class="close" title="Close">✕</a> <select data-name="thread" title="Create a new thread / Reply"> <option value="new">New thread</option> </select> </div> <form> <div class="persona"> <button type="button" id="sjis-toggle" title="Toggle Mona font">∀</button> <button type="button" id="tex-preview-button" title="Preview TeX">T<sub>E</sub>X</button> <input name="name" data-name="name" list="list-name" placeholder="Name" class="field" size="1"> <input name="email" data-name="email" list="list-email" placeholder="Options" class="field" size="1"> <input name="sub" data-name="sub" list="list-sub" placeholder="Subject" class="field" size="1" maxlength="100"> </div> <div class="textarea"> <textarea data-name="com" placeholder="Comment" class="field"></textarea> <span id="char-count"></span> <div id="tex-preview"></div> </div> <div id="dump-list-container"> <div id="dump-list"></div> <a id="add-post" href="javascript:;" title="Add a post">+</a> </div> <div class="oekaki" hidden> <input type="button" id="qr-draw-button" value="Draw"> <label><span>Width:</span><input name="oekaki-width" value="400" type="number" class="field" size="1"></label> <label><span>Height:</span><input name="oekaki-height" value="400" type="number" class="field" size="1"></label> <span class="oekaki-bg" title="Background Color"><input name="oekaki-bg" type="checkbox" checked><input name="oekaki-bgcolor" type="color" value="#ffffff"></span> </div> <div id="file-n-submit"> <span class="row"> <input type="button" id="qr-file-button" value="Files"> <span id="qr-filename-container" class="field"> <span id="qr-no-file">No selected file</span> <input id="qr-filename" data-name="filename" spellcheck="false"> <label id="qr-spoiler-label"> <input type="checkbox" id="qr-file-spoiler" title="Spoiler image"> <a class="checkbox-letter">S</a> </label> </span> </span> <span class="row space"> <span class="row"> <a href="javascript:;" id="qr-oekaki-button" title="Edit in Tegaki">✎︎</a> <a href="javascript:;" id="qr-jpg" title="Compress to jpg">C</a> <a href="javascript:;" id="qr-view" title="Preview">V</a> <a href="javascript:;" id="qr-randomize" title="Randomize filename">R</a> <a href="javascript:;" id="qr-restore-name" title="Reset filename">U</a> <a href="javascript:;" id="qr-filerm" title="Remove file">✕</a> <a href="javascript:;" id="url-button" title="Post from URL">🔗︎</a> <a href="javascript:;" hidden id="paste-area" title="Select to paste images" tabindex="-1" contentEditable="true">📋︎</a> <a href="javascript:;" id="custom-cooldown-button" title="Toggle custom cooldown" class="disabled">🕒︎</a> <a href="javascript:;" id="split-post" title="Split into multiple posts" hidden>✂️</a> <a href="javascript:;" id="dump-button" title="Dump list">➕︎</a> </span> <input type="submit"> </span> </div> <select data-default="4" name="filetag"> <option value="0">Hentai</option> <option value="6">Porn</option> <option value="1">Japanese</option> <option value="2">Anime</option> <option value="3">Game</option> <option value="5">Loop</option> <option value="4" selected>Other</option> </select> <input type="file" multiple> </form> <datalist id="list-name"></datalist> <datalist id="list-email"></datalist> <datalist id="list-sub"></datalist>'
})};const r=(t,a)=>o[t]=x(a,e);r("move",".move"),r("autohide","#autohide"),r("close",".close"),r("thread","select"),r("form","form"),r("sjisToggle","#sjis-toggle"),r("texButton","#tex-preview-button"),r("name","[data-name=name]"),r("email","[data-name=email]"),r("sub","[data-name=sub]"),r("com","[data-name=com]"),r("charCount","#char-count"),r("texPreview","#tex-preview"),r("dumpList","#dump-list"),r("addPost","#add-post"),r("oekaki",".oekaki"),r("drawButton","#qr-draw-button"),r("randomizeButton","#qr-randomize"),r("compress","#qr-jpg"),r("view","#qr-view"),r("restoreNameButton","#qr-restore-name"),r("fileSubmit","#file-n-submit"),r("fileButton","#qr-file-button"),r("noFile","#qr-no-file"),r("filename","#qr-filename"),r("spoiler","#qr-file-spoiler"),r("oekakiButton","#qr-oekaki-button"),r("fileRM","#qr-filerm"),r("urlButton","#url-button"),r("pasteArea","#paste-area"),r("customCooldown","#custom-cooldown-button"),r("dumpButton","#dump-button"),r("status","[type=submit]"),
r("flashTag","[name=filetag]"),r("fileInput","[type=file]"),r("splitPost","#split-post");const{config:l}=i.BOARD,{classList:d}=Me.nodes.el;d.toggle("forced-anon",Me.forcedAnon),d.toggle("has-spoiler",Me.spoiler),d.toggle("has-sjis",!!l.sjis_tags),d.toggle("has-math",!!l.math_tags),d.toggle("sjis-preview",!!l.sjis_tags&&a.sjisPreview),d.toggle("show-new-thread-option",a["Show New Thread Option in Threads"]),parseInt(a.customCooldown,10)>0&&(x.addClass(Me.nodes.fileSubmit,"custom-cooldown"),x.get("customCooldownEnabled",a.customCooldownEnabled,(function({customCooldownEnabled:e}){return Me.setCustomCooldown(e),x.sync("customCooldownEnabled",Me.setCustomCooldown)}))),Me.flagsInput(),x.on(o.autohide,"change",Me.toggleHide),x.on(o.close,"click",Me.close),x.on(o.status,"click",Me.submit),x.on(o.form,"submit",Me.submit),x.on(o.sjisToggle,"click",Me.toggleSJIS),x.on(o.texButton,"mousedown",Me.texPreviewShow),x.on(o.texButton,"mouseup",Me.texPreviewHide),
x.on(o.addPost,"click",(()=>new Me.post(!0))),x.on(o.drawButton,"click",Me.oekaki.draw),x.on(o.fileButton,"click",Me.openFileInput),x.on(o.noFile,"click",Me.openFileInput),x.on(o.randomizeButton,"click",(()=>{Me.selected.randomizeName()})),x.on(o.compress,"click",(async()=>{Me.handleFiles([await Me.convert(Me.selected.file)])})),x.on(o.view,"click",Me.preview),x.on(o.restoreNameButton,"click",(()=>{Me.selected.restoreName()})),x.on(o.filename,"focus",(function(){return x.addClass(this.parentNode,"focus")})),x.on(o.filename,"blur",(function(){return x.rmClass(this.parentNode,"focus")})),x.on(o.spoiler,"change",(()=>Me.selected.nodes.spoiler.click())),x.on(o.oekakiButton,"click",Me.oekaki.button),x.on(o.fileRM,"click",(()=>Me.selected.rmFile())),x.on(o.urlButton,"click",(()=>Me.handleUrl(""))),x.on(o.customCooldown,"click",Me.toggleCustomCooldown),x.on(o.dumpButton,"click",(()=>o.el.classList.toggle("dump"))),x.on(o.fileInput,"change",Me.handleFiles),
x.on(o.splitPost,"click",Me.splitPost),window.addEventListener("focus",Me.focus,!0),window.addEventListener("blur",Me.focus,!0),x.on(n,"click",Me.focus),"gecko"!==x.engine||window.DataTransferItemList||(o.pasteArea.hidden=!1),new MutationObserver(Me.pasteFF).observe(o.pasteArea,{childList:!0});const c=["thread","name","email","sub","com","filename","flag"];let h=0;const u=function(){Me.selected.save(this)};for(;s=c[h++];){var p;(p=o[s])&&(t="SELECT"===p.nodeName?"change":"input",x.on(o[s],t,u))}a["Remember QR Size"]&&(x.get("QR Size","",(e=>o.com.style.cssText=e["QR Size"])),x.on(o.com,"mouseup",(function(e){0===e.button&&x.set("QR Size",this.style.cssText)}))),Me.generatePostableThreadsList(),Me.persona.load(),new Me.post(!0),Me.status(),Me.cooldown.setup(),Me.captcha.init(),x.add(n.body,e),Me.captcha.setup(),Me.oekaki.setup(),x.event("QRDialogCreation",null,e),M.set(o.oekakiButton,"pencil"),M.set(o.urlButton,"link"),M.set(o.pasteArea,"clipboard"),M.set(o.customCooldown,"clock"),
M.set(o.randomizeButton,"shuffle"),M.set(o.compress,"shrink"),M.set(o.view,"eye"),M.set(o.restoreNameButton,"undo"),M.set(o.splitPost,"scissors")},flags(){const e=x.el("select",{name:"flag",className:"flagSelector"}),t=(t,o)=>x.add(e,x.el("option",{value:t,textContent:o}));for(var o in t("0",i.BOARD.config.country_flags?"Geographic Location":"None"),i.BOARD.config.board_flags){t(o,i.BOARD.config.board_flags[o])}return e},flagsInput(){const{nodes:e}=Me;if(e&&(e.flag&&(x.rm(e.flag),delete e.flag),i.BOARD.config.board_flags)){const t=Me.flags();return t.dataset.name="flag",t.dataset.default="0",e.flag=t,x.add(e.form,t)}},submit(e){let t,o,s;e?.preventDefault();const r=e?.shiftKey;if(Me.req)return void Me.abort();if(x.forceSync("cooldowns"),Me.cooldown.seconds){if(!r)return Me.cooldown.auto=!Me.cooldown.auto,void Me.status();Me.cooldown.clear()}const l=Me.posts[0];delete l.quotedText,l.forceSave();let d=l.thread;const c=i.BOARD.threads.get(d)
;if("f"===i.BOARD.ID&&"new"===d&&(s=Me.nodes.flashTag.value),"new"===d?(d=null,i.BOARD.config.require_subject&&!l.sub?o="New threads require a subject.":i.BOARD.config.text_only||l.file||(o="No file selected.")):i.BOARD.threads.get(d).isClosed?o="You can't reply to this thread anymore.":l.com||l.file?l.file&&c.fileLimit&&(o="Max limit of image replies has been reached."):o="No comment or file.","r9k"!==i.BOARD.ID||l.com?.match(/[a-z-]/i)||o||(o="Original comment required."),!Me.captcha.isEnabled||Me.captcha===Pe.v2&&/\b_ct=/.test(n.cookie)&&d||o&&!r||(t=Me.captcha.getOne(!!d),Me.captcha===Pe.v2&&(t||(t=Pe.cache.request(!!d))),t||(o="No valid captcha.",Me.captcha.setup(!Me.cooldown.auto||n.activeElement===Me.nodes.status))),Me.cleanNotifications(),o&&!r)return Me.cooldown.auto=!1,Me.status(),void Me.error(o);Me.cooldown.auto=Me.posts.length>1,l.lock();const h={MAX_FILE_SIZE:Me.max_size,mode:"regist",pwd:Me.persona.getPassword(),resto:d,name:Me.forcedAnon?void 0:l.name,email:l.email,
sub:Me.forcedAnon||d?void 0:l.sub,com:l.com,upfile:l.file,filetag:s,spoiler:l.spoiler,flag:l.flag},u={responseType:"document",withCredentials:!0,onloadend:Me.response,form:x.formData(h)};a["Show Upload Progress"]&&(u.onprogress=function(e){if(this===Me.req?.upload)return e.loaded<e.total?Me.req.progress=`${Math.round(e.loaded/e.total*100)}%`:(Me.req.isUploadFinished=!0,Me.req.progress="..."),Me.status()});let p=function(e){if(null!=e)if(Me.currentCaptcha=e,Me.captcha===Pe.v2)null!=e.challenge?(u.form.append("recaptcha_challenge_field",e.challenge),u.form.append("recaptcha_response_field",e.response)):u.form.append("g-recaptcha-response",e.response);else for(var t in e){var o=e[t];u.form.append(t,o)}Me.req=x.ajax(`https://sys.${location.hostname.split(".")[1]}.org/${i.BOARD}/post`,u),Me.req.progress="..."};"function"==typeof t?(Me.req={progress:"...",abort(){Me.captcha===Pe.v2&&Pe.cache.abort(),p=null}},t((function(e){if(Me.captcha===Pe.v2&&Pe.cache.haveCookie()){if(p?.(),
e)return Pe.cache.save(e)}else e?p?.(e):(delete Me.req,l.unlock(),Me.cooldown.auto=!!Pe.cache.getCount(),Me.status())}))):p(t),Me.status()},response(){let e,t;if(this!==Me.req)return;delete Me.req;const o=Me.posts[0];if(o.unlock(),t=this.response?.getElementById("errmsg")){const e=x("a",t);e&&(e.target="_blank")}else(e=!this.response||"Post successful!"!==this.response.title)?(t=Me.connectionError(),Me.captcha===Pe.v2&&Me.currentCaptcha&&Pe.cache.save(Me.currentCaptcha)):200!==this.status&&(t=`Error ${this.statusText} (${this.status})`);if(e||Me.captcha.setUsed?.(),delete Me.currentCaptcha,t){let a;if(Me.errorCount=(Me.errorCount||0)+1,/captcha|verification/i.test(t.textContent))/mistyped/i.test(t.textContent)?t="You mistyped the CAPTCHA, or the CAPTCHA malfunctioned.":/expired/i.test(t.textContent)&&(t="This CAPTCHA is no longer valid because it has expired."),Me.cooldown.auto=!1;else if(e)Me.errorCount>=5?Me.cooldown.auto=!1:(Me.cooldown.auto=Me.captcha.isEnabled||e,
Me.cooldown.addDelay(o,2));else if(t.textContent&&(a=t.textContent.match(/\d+\s+(?:minute|second)/gi))&&!/duplicate|hour/i.test(t.textContent)){Me.cooldown.auto=!/have\s+been\s+muted/i.test(t.textContent);let e=0;for(var s of a)e+=(/minute/i.test(s)?60:1)*+s.match(/\d+/)[0];/muted/i.test(t.textContent)?Me.cooldown.addMute(e):Me.cooldown.addDelay(o,e)}else Me.cooldown.auto=!1;return Me.captcha.setup(Me.cooldown.auto&&[Me.nodes.status,n.body].includes(n.activeElement)),Me.status(),void Me.error(t)}delete Me.errorCount;const r=x("h1",this.response);let[l,d,c]=r.nextSibling.textContent.match(/thread:(\d+),no:(\d+)/);c=+c,d=+d||c;const h=d!==c;x.event("QRPostSuccessful",{boardID:i.BOARD.ID,threadID:d,postID:c}),x.event("QRPostSuccessful_",{boardID:i.BOARD.ID,threadID:d,postID:c});const u=Me.posts.length-1;Me.cooldown.auto=u&&h;const p=!function(){for(var e of Me.posts.slice(1))if(e.thread===o.thread)return!0}();u?(o.rm(),
Me.captcha.setup(n.activeElement===Me.nodes.status)):a["Persistent QR"]?(o.rm(),a["Auto Hide QR"]?Me.hide():Me.blur()):Me.close(),Me.cleanNotifications(),a["Posting Success Notifications"]&&Me.notifications.push(new Ke("success",r.textContent,5)),Me.cooldown.add(d,c);const g=d===c?`${window.location.origin}/${i.BOARD}/thread/${d}`:d!==i.THREADID&&p&&a["Open Post in New Tab"]?`${window.location.origin}/${i.BOARD}/thread/${d}#p${c}`:void 0;if(g){const e=a["Open Post in New Tab"]||u?()=>x.open(g):()=>location.href=g;d===c?Me.waitForThread(g,e):e()}Me.status()},waitForThread(e,t){let o=0;var a=function(){x.ajax(e,{onloadend(){return o++,o>=6||200===this.status?t():setTimeout(a,o*g)},responseType:"text",type:"HEAD"})};a()},abort(){let e;(e=Me.req)&&!Me.req.isUploadFinished&&(delete Me.req,e.abort(),Me.captcha===Pe.v2&&Me.currentCaptcha&&Pe.cache.save(Me.currentCaptcha),delete Me.currentCaptcha,Me.posts[0].unlock(),Me.cooldown.auto=!1,
Me.notifications.push(new Ke("info","QR upload aborted.",5))),Me.status()},getMaxSize(e){let t=Me.max_size;return e.type.startsWith("video/")&&(t=Math.min(t,Me.max_size_video)),t},async convert(e,t="jpeg",o){const a=o?.maxSize||this.getMaxSize(e),i=o?.img||await createImageBitmap(e),s=o?.width||i.width,n=o?.height||i.height,r=e.name.replace(/\.[a-z]+$/i,"."+t),l="image/"+t;let d,c,h;window.OffscreenCanvas?(d=new OffscreenCanvas(s,n),c=(e,t)=>d.convertToBlob({type:e,quality:t})):(d=x.el("canvas",{width:s,height:n}),c=(e,t)=>new Promise((o=>{d.toBlob(o,e,t)})));let u=.9;d.getContext("2d").drawImage(i,0,0,s,n);do{h=new File([await c(l,u)],r,{type:l}),u-=.1}while("jpeg"===t&&h.size>a&&u>=.1);return h.size>=e.size&&h.type===e.type?(new Ke("warning","New jpeg file isn't smaller than the old one, so it won't be used.",3),e):h},previewUrl:void 0,preview(){if(Me.selected.file){if(Me.nodes.preview=x.el("div",{id:"overlay",className:"media-preview"}),x.add(n.body,Me.nodes.preview),
Me.previewUrl=URL.createObjectURL(Me.selected.file),Me.selected.file.type.startsWith("video/")){const e=x.el("video",{controls:!0,src:Me.previewUrl,autoplay:!0});x.add(Me.nodes.preview,e),e.focus()}else x.add(Me.nodes.preview,x.el("img",{src:Me.previewUrl}));Me.nodes.preview.addEventListener("click",(e=>{"VIDEO"!==e.target.tagName&&Me.closePreview()}))}},closePreview(){Me.nodes.preview.remove(),URL.revokeObjectURL(Me.previewUrl)},cooldown:{seconds:0,delays:{deletion:60},maxDelay:0,isSetup:!1,auto:!1,data:{},init(){a["Quick Reply"]&&(this.data=a.cooldowns,this.changes=p(),x.sync("cooldowns",this.sync))},setup(){for(var e in x.extend(Me.cooldown.delays,i.BOARD.cooldowns()),Me.cooldown.maxDelay=0,Me.cooldown.delays){var t=Me.cooldown.delays[e];["thread","thread_global"].includes(e)||(Me.cooldown.maxDelay=Math.max(Me.cooldown.maxDelay,t))}Me.cooldown.isSetup=!0,Me.cooldown.start()},start(){const{data:e}=Me.cooldown
;!a.Cooldown||!Me.cooldown.isSetup||Me.cooldown.isCounting||Object.keys(e[i.BOARD.ID]||{}).length+Object.keys(e.global||{}).length<=0||(Me.cooldown.isCounting=!0,Me.cooldown.count())},sync(e){Me.cooldown.data=e||p(),Me.cooldown.start()},add(e,t){if(!a.Cooldown)return;const o=Date.now(),s=i.BOARD.ID;Me.cooldown.set(s,o,{threadID:e,postID:t}),e===t&&Me.cooldown.set("global",o,{boardID:s,threadID:e,postID:t}),Me.cooldown.save(),Me.cooldown.start()},addDelay(e,t){if(!a.Cooldown)return;const o=Me.cooldown.categorize(e);o.delay=t,Me.cooldown.set(i.BOARD.ID,Date.now(),o),Me.cooldown.save(),Me.cooldown.start()},addMute(e){a.Cooldown&&(Me.cooldown.set(i.BOARD.ID,Date.now(),{type:"mute",delay:e}),Me.cooldown.save(),Me.cooldown.start())},delete(e){let t;if(!Me.cooldown.data)return;const o=Me.cooldown.data[e.board.ID]||(Me.cooldown.data[e.board.ID]=p());for(var a in o)t=o[a],null==t.delay&&t.threadID===e.thread.ID&&t.postID===e.ID&&Me.cooldown.set(e.board.ID,a,null);Me.cooldown.save()},
secondsDeletion(e){if(!Me.cooldown.data||!a.Cooldown)return 0;const t=Me.cooldown.data[e.board.ID]||p();for(var o in t){var i=t[o];if(null==i.delay&&i.threadID===e.thread.ID&&i.postID===e.ID){var s=Me.cooldown.delays.deletion-Math.floor((Date.now()-o)/g);return Math.max(s,0)}}return 0},categorize:e=>"new"===e.thread?{type:"thread"}:{type:e.file?"image":"reply",threadID:+e.thread},mergeChange(e,t,o,a){a?(e[t]||(e[t]=p()))[o]=a:t in e&&(delete e[t][o],0===Object.keys(e[t]).length&&delete e[t])},set(e,t,o){Me.cooldown.mergeChange(Me.cooldown.data,e,t,o),(Me.cooldown.changes[e]||(Me.cooldown.changes[e]=p()))[t]=o},save(){const{changes:e}=Me.cooldown;Object.keys(e).length&&x.get("cooldowns",p(),(function({cooldowns:e}){for(var t in Me.cooldown.changes){for(var o in Me.cooldown.changes[t]){var a=Me.cooldown.changes[t][o];Me.cooldown.mergeChange(e,t,o,a)}Me.cooldown.data=e}x.set("cooldowns",e,(()=>Me.cooldown.changes=p()))}))},clear(){Me.cooldown.data=p(),Me.cooldown.changes=p(),
Me.cooldown.auto=!1,Me.cooldown.update(),x.queueTask(x.delete,"cooldowns")},update(){let e;if(!Me.cooldown.isCounting)return;let t=!1,o=0;const s=Date.now(),{type:n,threadID:r}=Me.cooldown.categorize(Me.posts[0]);let l=0;if(a.Cooldown)for(var d of[i.BOARD.ID,"global"]){var c=Me.cooldown.data[d]||(Me.cooldown.data[d]=p());for(var h in c){e=c[h],h=+h;var u=Math.floor((s-h)/g);if(u<0)Me.cooldown.set(d,h,null),t=!0;else if(null==e.delay){var f=e.threadID!==e.postID?Me.cooldown.maxDelay:Me.cooldown.delays["global"===d?"thread_global":"thread"];if(Me.cooldown.customCooldown&&(f=Math.max(f,parseInt(a.customCooldown,10))),f<=u)Me.cooldown.set(d,h,null),t=!0;else if("thread"===n==(e.threadID===e.postID)&&e.boardID!==i.BOARD.ID){var m="global"===d?"_global":"";l=Math.max(l,Me.cooldown.delays[n+m]-u),Me.cooldown.customCooldown&&(l=Math.max(l,parseInt(a.customCooldown,10)-u))}}else e.delay<=u?(Me.cooldown.set(d,h,null),t=!0):(e.type===n&&e.threadID===r||"mute"===e.type)&&(l=Math.max(l,e.delay-u))}
o+=Object.keys(c).length}t&&Me.cooldown.save,o?(clearTimeout(Me.cooldown.timeout),Me.cooldown.timeout=setTimeout(Me.cooldown.count,g)):delete Me.cooldown.isCounting;const b=l!==Me.cooldown.seconds;Me.cooldown.seconds=l,b&&Me.status()},count(){Me.cooldown.update(),0===Me.cooldown.seconds&&Me.cooldown.auto&&!Me.req&&Me.submit()}},oekaki:{menu:{init(){if(!(["index","thread"].includes(i.VIEW)&&a.Menu&&a["Edit Link"]&&a["Quick Reply"]))return;const e=x.el("a",{className:"edit-link",href:"javascript:;",textContent:"Edit image"});x.on(e,"click",this.editFile),ne.menu.addEntry({el:e,order:90,open(e){Me.oekaki.menu.post=e;const{file:t}=e;return Me.postingIsEnabled&&!!t&&(t.isImage||t.isVideo)}})},editFile(){const{post:e}=Me.oekaki.menu;Me.quote.call(e.nodes.post);const{isVideo:t}=e.file,o=e.file.fullImage?.currentTime||0;return Fe.file(e.file.url,(function(a){if(a)if(t){const t=x.el("video");x.on(t,"loadedmetadata",(function(){x.on(t,"seeked",(function(){const o=x.el("canvas",{
width:t.videoWidth,height:t.videoHeight});o.getContext("2d").drawImage(t,0,0),o.toBlob((function(t){t.name=e.file.name.replace(/\.\w+$/,"")+".png",Me.handleFiles([t]),Me.oekaki.edit()}))})),t.currentTime=o})),x.on(t,"error",(()=>Me.openError())),t.src=URL.createObjectURL(a)}else a.name=e.file.name,Me.handleFiles([a]),Me.oekaki.edit();else Me.error("Can't load file.")}))}},setup(){x.global("setupQR")},load(e){if(x('script[src^="//s.4cdn.org/js/tegaki"]',n.head))e();else{const t=x.el("link",{rel:"stylesheet",href:`//s.4cdn.org/css/tegaki.${Date.now()}.css`}),o=x.el("script",{src:`//s.4cdn.org/js/tegaki.min.${Date.now()}.js`});let a=0;const i=function(){2==++a&&e()};x.on(t,"load",i),x.on(o,"load",i),x.add(n.head,[t,o])}},draw:()=>x.global("qrTegakiDraw"),button(){Me.selected.file?Me.oekaki.edit():Me.oekaki.toggle()},edit(){Me.oekaki.load((()=>x.global("qrTegakiLoad")))},toggle(){Me.oekaki.load((()=>Me.nodes.oekaki.hidden=!Me.nodes.oekaki.hidden))}},persona:{always:{},types:{name:[],
email:[],sub:[]},init(){if(a["Quick Reply"]||a.Menu&&a["Delete Link"])for(var e of a["QR.personas"].split("\n"))Me.persona.parseItem(e.trim())},parseItem(e){if("#"===e[0])return;const t=e.match(/(name|options|email|subject|password):"(.*)"/i);if(!t)return;let o,[a,s,n]=t;e=e.replace(a,"");const r=e.match(/boards:([^;]+)/i)?.[1].toLowerCase()||"global";("global"===r||(o=i.BOARD.ID,r.split(",").includes(o)))&&("password"!==s?("options"===s&&(s="email"),"subject"===s&&(s="sub"),/always/i.test(e)&&(Me.persona.always[s]=n),Me.persona.types[s].includes(n)||Me.persona.types[s].push(n)):Me.persona.pwd=n)},load(){for(var e in Me.persona.types){var t=Me.persona.types[e],o=x(`#list-${e}`,Me.nodes.el);for(var a of t)a&&x.add(o,x.el("option",{textContent:a}))}},getPassword(){let e;return null!=Me.persona.pwd?Me.persona.pwd:(e=n.cookie.match(/4chan_pass=([^;]+)/))?decodeURIComponent(e[1]):""},get(e){x.get("QR.persona",{},(({"QR.persona":t})=>e(t)))},set(e){
x.get("QR.persona",{},(function({"QR.persona":t}){t={name:e.name,flag:e.flag},x.set("QR.persona",t)}))}}};Me.post=class{constructor(e){this.select=this.select.bind(this);const t=x.el("a",{className:"qr-preview",draggable:!0,href:"javascript:;"});x.extend(t,{innerHTML:'<a class="remove" title="Remove">✕</a><label class="qr-preview-spoiler"><input type="checkbox"> Spoiler</label><span id="qr-preview-comment"></span><br /><span id="qr-preview-name"></span>'});const[o,s,n,,r]=t.childNodes;for(var l of(this.nodes={el:t,rm:o,spoiler:s.firstChild,span:n,spanFileName:r},x.on(t,"click",this.select),x.on(this.nodes.rm,"click",(e=>{e.stopPropagation(),this.rm()})),x.on(this.nodes.spoiler,"change",(e=>(this.spoiler=e.target.checked,this===Me.selected&&(Me.nodes.spoiler.checked=this.spoiler),this.preventAutoPost()))),S("label",t)))x.on(l,"click",(e=>e.stopPropagation()));for(var d of(x.add(Me.nodes.dumpList,t),
["dragStart","dragEnter","dragLeave","dragOver","dragEnd","drop"]))x.on(t,d.toLowerCase(),this[d]);this.thread="thread"===i.VIEW?i.THREADID:"new";const c=Me.posts[Me.posts.length-1];Me.posts.push(this),this.nodes.spoiler.checked=this.spoiler=!(!c||!a["Remember Spoiler"])&&c.spoiler,Me.persona.get((e=>{this.name="name"in Me.persona.always?Me.persona.always.name:c?c.name:e.name,this.email="email"in Me.persona.always?Me.persona.always.email:"",this.sub="sub"in Me.persona.always?Me.persona.always.sub:"",Me.nodes.flag&&(this.flag=c?c.flag:e.flag&&e.flag in i.BOARD.config.board_flags?e.flag:void 0),Me.selected===this&&this.load()})),e&&this.select(),this.unlock(),Me.captcha.moreNeeded()}rm(){this.delete();const e=Me.posts.indexOf(this);1===Me.posts.length?(new Me.post(!0),x.rmClass(Me.nodes.el,"dump")):this===Me.selected&&(Me.posts[e-1]||Me.posts[e+1]).select(),Me.posts.splice(e,1),Me.status(),Me.captcha.updateThread?.()}delete(){x.rm(this.nodes.el),URL.revokeObjectURL(this.URL),
this.dismissErrors()}lock(e=!0){if(this.isLocked=e,this===Me.selected){for(var t of["thread","name","email","sub","com","fileButton","filename","spoiler","flag"]){var o;(o=Me.nodes[t])&&(o.disabled=e)}this.nodes.rm.style.visibility=e?"hidden":"",this.nodes.spoiler.disabled=e,this.nodes.el.draggable=!e}}unlock(){this.lock(!1)}select(){Me.selected&&(Me.selected.nodes.el.removeAttribute("id"),Me.selected.forceSave()),Me.selected=this,this.lock(this.isLocked),this.nodes.el.id="selected";const e=this.nodes.el.getBoundingClientRect(),t=this.nodes.el.parentNode.getBoundingClientRect();this.nodes.el.parentNode.scrollLeft+=e.left+e.width/2-t.left-t.width/2,this.load()}load(){for(var e of["thread","name","email","sub","com","filename","flag"]){var t;(t=Me.nodes[e])&&(t.value=this[e]||t.dataset.default||"")}("new"!==this.thread?x.addClass:x.rmClass)(Me.nodes.el,"reply-to-thread"),this.showFileData(),Me.characterCount()}save(e,t){if("checkbox"===e.type)return void(this.spoiler=e.checked)
;const{name:o}=e.dataset;if(!["thread","name","email","sub","com","filename","flag"].includes(o))return;const a=this[o]||e.dataset.default||null;switch(this[o]=e.value||e.dataset.default||null,o){case"thread":("new"!==this.thread?x.addClass:x.rmClass)(Me.nodes.el,"reply-to-thread"),Me.status(),Me.captcha.updateThread?.();break;case"com":this.updateComment();break;case"filename":if(!this.file)return;this.saveFilename(),this.updateFilename();break;case"name":case"flag":this[o]!==a&&Me.persona.set(this)}t||this.preventAutoPost()}forceSave(){if(this===Me.selected)for(var e of["thread","name","email","sub","com","filename","spoiler","flag"]){var t;(t=Me.nodes[e])&&this.save(t,!0)}}preventAutoPost(){Me.cooldown.auto&&this===Me.posts[0]&&(Me.cooldown.update(),Me.cooldown.seconds<=5&&(Me.cooldown.auto=!1))}setComment(e){return this.com=e||null,this===Me.selected&&(Me.nodes.com.value=this.com),this.updateComment()}updateComment(){this===Me.selected&&Me.characterCount(),
this.nodes.span.textContent=this.com,Me.captcha.moreNeeded()}isOnlyQuotes(){return(this.com||"").trim()===(this.quotedText||"").trim()}static rmErrored(e){e.stopPropagation();for(let e=Me.posts.length-1;e>=0;e--){var t,o=Me.posts[e];if(t=o.errors)for(var a of t)if(r.contains(a)){o.rm();break}}}error(e,t,o){const a=x.el("div",{className:e});x.extend(a,{innerHTML:t+(o?` [<a href="${s(o)}" target="_blank">More info</a>]`:"")+'<br>[<a href="javascript:;">delete post</a>] [<a href="javascript:;">delete all</a>]'}),(this.errors||(this.errors=[])).push(a);const[i,n]=S("a",a);x.on(a,"click",(()=>{Me.posts.includes(this)&&this.select()})),x.on(i,"click",(e=>{e.stopPropagation(),Me.posts.includes(this)&&this.rm()})),x.on(n,"click",Me.post.rmErrored),Me.error(a,!0)}fileError(e,t){this.error("file-error",`${this.filename}: ${e}`,t)}dismissErrors(e=()=>!0){if(this.errors)for(var t of this.errors)r.contains(t)&&e(t)&&t.parentNode.previousElementSibling.click()}async validateFile(e){
if(location.hostname.endsWith("4chan.org")&&!Me.mimeTypes.includes(e.type)){if(!e.type.startsWith("image/"))throw new Error("Unsupported file type.");{const t=`The ${e.type.slice(6)} image was converted to png.`;e=await Me.convert(e,"png"),new Ke("info",t,3)}}const t=Me.getMaxSize(e);if(e.type.startsWith("image/")){let o=await createImageBitmap(e);const{width:a,height:i}=o;let s=a,n=i;if(s>Me.max_width&&(n=Math.round(n*(Me.max_width/s)),s=Me.max_width),n>Me.max_height&&(s=Math.round(s*(Me.max_height/n)),n=Me.max_height),s===a&&n===i||(e=await Me.convert(e,"image/jpeg"===e.type?"jpeg":"png",{width:s,height:n,img:o}),o=void 0,new Ke("warning",`Image was too large got shrunk from ${a} * ${i} to ${s} * ${n}.It might have lost animation.`)),e.size>t){const a=e.size;e=await Me.convert(e,"jpeg",{maxSize:t,img:o}),new Ke("warning",`Image was too large (${x.bytesToString(a)}) and got converted to jpg (${x.bytesToString(e.size)}). It might have lost transparency or animation.`)}
}else if(e.size>t)throw new Error(`File too large (file: ${x.bytesToString(e.size)}, max: ${x.bytesToString(t)}).`);return e}async setFile(e){try{this.file=e,this.filename=e.name,this.originalName=e.name,this.file=await this.validateFile(e),this.originalName=e.name,a["Randomize Filename"]&&"f"!==i.BOARD.ID&&!this.file.name.toLowerCase().includes("[sound=")?this.randomizeName(!1):this.filename=this.file.name,this.filesize=x.bytesToString(this.file.size),x.addClass(this.nodes.el,"has-file","has-"+this.file.type.split("/")[0]),Me.captcha.moreNeeded(),URL.revokeObjectURL(this.URL),this.saveFilename(),this===Me.selected?this.showFileData():this.updateFilename(),this.rmMetadata(),this.nodes.el.dataset.type=this.file.type,this.nodes.el.style.backgroundImage="",/^(image|video)\//.test(this.file.type)?(this.nodes.spanFileName.textContent="",this.readFile()):this.nodes.spanFileName.textContent=this.file.name.match(/\.([^\.]+)$/)[1]}catch(e){console.error(e),
this.fileError(e?.message||e||"unknown error when setting a file")}this.preventAutoPost()}randomizeName(e=!0){this.filename=""+(1e3*Date.now()-Math.floor(365*Math.random()*b*1e3));const t=this.file.name.match(Me.validExtension);t&&(this.filename+=t[0]),e&&(Me.nodes.filename.value=this.filename)}restoreName(){Me.nodes.filename.value=this.filename=this.originalName}readFile(){const e=/^video\//.test(this.file.type),t=x.el(e?"video":"img");if(e&&!t.canPlayType(this.file.type))return;const a=e?"loadeddata":"load";var i=()=>{x.off(t,a,i),x.off(t,"error",s),this.checkDimensions(t),this.setThumbnail(t),x.event("QRMetadata",null,this.nodes.el)},s=()=>{x.off(t,a,i),x.off(t,"error",s),this.fileError(`Corrupt ${e?"video":"image"} or error reading metadata.`,o.upstreamFaq+"#error-reading-metadata"),URL.revokeObjectURL(t.src),this.nodes.el.removeAttribute("data-height"),x.event("QRMetadata",null,this.nodes.el)};this.nodes.el.dataset.height="loading",x.on(t,a,i),x.on(t,"error",s),
t.src=URL.createObjectURL(this.file)}checkDimensions(e){let t,o;if("IMG"===e.tagName)({height:t,width:o}=e),this.nodes.el.dataset.height=t,this.nodes.el.dataset.width=o,(t>Me.max_height||o>Me.max_width)&&this.fileError(`Image too large (image: ${t}x${o}px, max: ${Me.max_height}x${Me.max_width}px)`),(t<Me.min_height||o<Me.min_width)&&this.fileError(`Image too small (image: ${t}x${o}px, min: ${Me.min_height}x${Me.min_width}px)`);else{const{videoHeight:t,videoWidth:o,duration:a}=e;this.nodes.el.dataset.height=t,this.nodes.el.dataset.width=o,this.nodes.el.dataset.duration=a;const s=Math.min(Me.max_height,Me.max_height_video),n=Math.min(Me.max_width,Me.max_width_video);(t>s||o>n)&&this.fileError(`Video too large (video: ${t}x${o}px, max: ${s}x${n}px)`),(t<Me.min_height||o<Me.min_width)&&this.fileError(`Video too small (video: ${t}x${o}px, min: ${Me.min_height}x${Me.min_width}px)`),
isFinite(a)?a>Me.max_duration_video&&this.fileError(`Video too long (video: ${a}s, max: ${Me.max_duration_video}s)`):this.fileError("Video lacks duration metadata (try remuxing)"),se.noAudio(i.BOARD.ID)&&x.hasAudio(e)&&this.fileError("Audio not allowed")}}setThumbnail(e){let t,o;const a="VIDEO"===e.tagName;let i=180*window.devicePixelRatio;if("image/gif"===this.file.type&&(i*=3),a)t=e.videoHeight,o=e.videoWidth;else if(({height:t,width:o}=e),t<i||o<i)return this.URL=e.src,void(this.nodes.el.style.backgroundImage=`url(${this.URL})`);t<=o?(o*=i/t,t=i):(t*=i/o,o=i);const s=x.el("canvas");s.height=t,s.width=o;const n=()=>{s.getContext("2d").drawImage(e,0,0,o,t),URL.revokeObjectURL(e.src),s.toBlob((e=>{this.URL=URL.createObjectURL(e),this.nodes.el.style.backgroundImage=`url(${this.URL})`}))};a?(e.currentTime=0,e.addEventListener("seeked",n)):n()}rmFile(){this.isLocked||(delete this.file,delete this.filename,delete this.filesize,this.nodes.el.removeAttribute("title"),
Me.nodes.filename.removeAttribute("title"),this.rmMetadata(),this.nodes.el.style.backgroundImage="",x.rmClass(this.nodes.el,"has-file","has-image","has-video"),this.showFileData(),URL.revokeObjectURL(this.URL),this.dismissErrors((e=>x.hasClass(e,"file-error"))),this.preventAutoPost())}rmMetadata(){for(var e of["type","height","width","duration"])this.nodes.el.removeAttribute(`data-${e}`)}saveFilename(){this.file.newName=(this.filename||"").replace(/[/\\]/g,"-"),Me.validExtension.test(this.filename)||(this.file.newName+=`.${x.getOwn(Me.extensionFromType,this.file.type)||"jpg"}`)}updateFilename(){const e=`${this.filename} (${this.filesize})`;this.nodes.el.title=e,this===Me.selected&&(Me.nodes.filename.title=e)}showFileData(){this.file?(this.updateFilename(),Me.nodes.filename.value=this.filename,x.addClass(Me.nodes.oekaki,"has-file"),x.addClass(Me.nodes.fileSubmit,"has-file","has-"+this.file.type.split("/")[0])):(x.rmClass(Me.nodes.oekaki,"has-file"),
x.rmClass(Me.nodes.fileSubmit,"has-file","has-image","has-video")),null!=this.file?.source?Me.nodes.fileSubmit.dataset.source=this.file.source:Me.nodes.fileSubmit.removeAttribute("data-source"),Me.nodes.spoiler.checked=this.spoiler}pasteText(e){this.pasting=!0,this.preventAutoPost();const t=new FileReader;t.onload=e=>{const{result:t}=e.target;this.setComment(this.com?`${this.com}\n${t}`:t),delete this.pasting},t.readAsText(e)}dragStart(e){const{left:t,top:o}=this.getBoundingClientRect();e.dataTransfer.setDragImage(this,e.clientX-t,e.clientY-o),x.addClass(this,"drag")}dragEnd(){x.rmClass(this,"drag")}dragEnter(){x.addClass(this,"over")}dragLeave(){x.rmClass(this,"over")}dragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}drop(){if(x.rmClass(this,"over"),!this.draggable)return;const e=x(".drag",this.parentNode),t=e=>{for(let t=0;t<e.parentNode.children.length;t++)if(e.parentNode.children[t]===e)return t;return-1},o=t(e),a=t(this)
;if(Me.posts[o].isLocked||Me.posts[a].isLocked)return;(o<a?x.after:x.before)(this,e);const i=Me.posts.splice(o,1)[0];Me.posts.splice(a,0,i),Me.status(),Me.captcha.updateThread?.()}};var Fe={binary(e,t,o=p()){e=e.replace(/^((?:https?:)?\/\/(?:\w+\.)?(?:4chan|4channel|4cdn)\.org)\/adv\//,"$1//adv/");const a=function(){return x.ajax(e,{headers:o,responseType:"arraybuffer",onloadend(){return this.status&&this.response?t(new Uint8Array(this.response),this.getAllResponseHeaders()):t(null)}})};if(void 0===window.GM_xmlhttpRequest||null===window.GM_xmlhttpRequest)return void a();const i={method:"GET",anonymous:!0,url:e,headers:o,responseType:"arraybuffer",overrideMimeType:"text/plain; charset=x-user-defined",onload(e){let o;if(e.response instanceof ArrayBuffer)o=new Uint8Array(e.response);else{const t=e.responseText;o=new Uint8Array(t.length);let a=0;for(;a<t.length;)o[a]=t.charCodeAt(a),a++}return t(o,e.responseHeaders)},onerror:()=>t(null),onabort:()=>t(null)};try{
return(GM?.xmlHttpRequest||GM_xmlhttpRequest)(i)}catch(e){return a()}},file:(e,t)=>Fe.binary(e,(function(o,a){if(null==o)return t(null);let i=e.match(/([^\/?#]+)\/*(?:$|[?#])/)?.[1];const s=a.match(/Content-Type:\s*(.*)/i)?.[1],n=a.match(/Content-Disposition:\s*(.*)/i)?.[1];let r=s?.match(/[^;]*/)[0]||"application/octet-stream";const l=n?.match(/\bfilename\s*=\s*"((\\"|[^"])+)"/i)?.[1]||s?.match(/\bname\s*=\s*"((\\"|[^"])+)"/i)?.[1];l&&(i=l.replace(/\\"/g,'"')),/^text\/plain;\s*charset=x-user-defined$/i.test(r)&&(r=x.getOwn(Me.typeFromExtension,i.match(/[^.]*$/)[0].toLowerCase())||"application/octet-stream");const d=new Blob([o],{type:r});return d.name=i,t(d)})),Request:function(){const e=class{static initClass(){this.prototype.status=0,this.prototype.statusText="",this.prototype.response=null,this.prototype.responseHeaderString=null}getResponseHeader(e){if(null==this.responseHeaders&&null!=this.responseHeaderString)for(var t of(this.responseHeaders=p(),
this.responseHeaderString.split("\r\n"))){var o;if((o=t.indexOf(":"))>=0){var a=t.slice(0,o).trim().toLowerCase(),i=t.slice(o+1).trim();this.responseHeaders[a]=i}}return this.responseHeaders?.[e.toLowerCase()]??null}abort(){}onloadend(){}};return e.initClass(),e}(),ajax(e,t={}){let o,{onloadend:a,timeout:i,responseType:s,headers:n}=t;null==s&&(s="json");const r=new Fe.Request;if(r.onloadend=a,null==window.GM?.xmlHttpRequest&&null==window.GM_xmlhttpRequest)return x.ajax(e,t);const l={method:"GET",anonymous:!0,url:e,headers:n,timeout:i,onload(t){try{let o=t.responseText;if("json"===s)try{o=JSON.parse(t.responseText)}catch(e){console.error(e),console.error(t)}x.extend(r,{url:e,headers:n,response:o,status:t.status,statusText:t.statusText,responseHeaderString:t.responseHeaders})}catch(e){}return r.onloadend()},onerror:()=>r.onloadend(),onabort:()=>r.onloadend(),ontimeout:()=>r.onloadend()};try{o=(GM?.xmlHttpRequest||GM_xmlhttpRequest)(l)}catch(o){return x.ajax(e,t)}
return o&&"function"==typeof o.abort&&(r.abort=function(){try{return o.abort()}catch(e){}}),r},ajaxPromise:(e,t={})=>new Promise((o=>Fe.ajax(e,{...t,onloadend(){o(this)}}))),cache:(e,t)=>x.cache(e,t,{ajax:Fe.ajax}),cachePromise:e=>new Promise((t=>{Fe.cache(e,(function(){t(this)}))})),permission:(e,t,o)=>e()},$e={pause(e){if("VIDEO"===e.nodeName)return e.pause(),x.off(e,"volumechange",ee.change),e.muted=!0},rewind(e){if("VIDEO"===e.nodeName){if(e.readyState>=e.HAVE_METADATA)return e.currentTime=0}else if(/\.gif$/.test(e.src))return x.queueTask((()=>e.src=e.src))},pushCache:e=>($e.cache=e,x.on(e,"error",$e.cacheError)),popCache(){const e=$e.cache;return x.off(e,"error",$e.cacheError),delete $e.cache,e},cacheError(){if($e.cache===this)return delete $e.cache},decodeError(e,t){let o;return e.error?.code===MediaError.MEDIA_ERR_DECODE&&((o=x(".warning",t.thumb.parentNode))||(o=x.el("div",{className:"warning"}),x.after(t.thumb,o)),o.textContent="Error: Corrupt or unplayable video",!0)},
isFromArchive:e=>"yotsuba"===i.SITE.software&&!T.test(e.src.split("/")[2]),error(e,t,o,s,n){let r;const l=o.url.split("/");let d=null;if("yotsuba"===i.SITE.software&&a["404 Redirect"]&&(d=Xe.to("file",{boardID:t.board.ID,filename:l[l.length-1]})),d&&Xe.securityCheck(d)||(d=null),(t.isDead||o.isDead)&&!$e.isFromArchive(e))return n(d);if(null!=s&&(r=setTimeout((()=>n(d)),s)),t.isDead||o.isDead)return;const c=function(){if(!$e.isFromArchive(e))return null!=s&&clearTimeout(r),n(d)},h=i.SITE.urls.threadJSON?.(t);if(h){var u=function(e){let a,s;if(404===this.status){let a;!e&&(a=i.SITE.urls.archivedThreadJSON?.(t))?x.ajax(a,{onloadend(){return u.call(this,!0)}}):t.kill(!t.isClone,o.index)}if(200!==this.status)return c();for(s of this.response.posts)if(s.no===t.ID)break;return s.no!==t.ID?(t.kill(),c()):(a=o.docIndex,i.SITE.Build.parseJSON(s,t.board).filesDeleted.includes(a)?(t.kill(!0),c()):d=o.url)};return x.ajax(h,{onloadend(){return u.call(this)}})}},
onControls:e=>a["Show Controls"]&&a["Click Passthrough"]&&"VIDEO"===e.target.nodeName||e.target.controls&&e.target.getBoundingClientRect().bottom-e.clientY<35,download(e){if("blob:"===this.protocol)return!0;e.preventDefault();const{href:t,download:o}=this;return Fe.file(t,(function(e){if(e){const t=x.el("a",{href:URL.createObjectURL(e),download:o,hidden:!0});return x.add(n.body,t),t.click(),x.rm(t)}return new Ke("warning",`Could not download ${t}`,20)}))}};const Oe=C("div",{class:"box-inner"},C("div",{class:"boxbar"},C("h2",null,"Trouble buying a 4chan Pass? (a message from 4chan X)",C("a",{href:"javascript:;",style:"text-decoration: none; float: right; margin-right: 4px;",title:"Close"},"×"))),C("div",{class:"boxcontent"},"Check the 4chan X wiki for ",C("a",{href:`${o.captchaFAQ}#alternatives`,target:"_blank",rel:"noopener"},"alternative solutions"),".")),qe={init(){if(a.passMessageClosed)return;const e=x.el("div",{className:"box-outer top-box"},Oe)
;e.style.cssText="padding-bottom: 0;";const t=x("a",e);return x.on(t,"click",(function(){return x.rm(e),x.set("passMessageClosed",!0)})),x.ready((function(){let t;return(t=x.id("hd"))?x.after(t,e):x.prepend(n.body,e)}))}};var He={init(){let e;if(e=location.search.match(/\bno=(\d+)/))return Pe.replace.init(),this.postID=+e[1],x.ready(this.ready)},ready:()=>(x.addStyle(R.report),a["Archive Report"]&&He.archive(),new MutationObserver((function(){return He.fit('iframe[src^="https://www.google.com/recaptcha/api2/frame"]'),He.fit("body")})).observe(n.body,{childList:!0,attributes:!0,subtree:!0}),He.fit("body")),fit(e){let t;if(!(t=x(e,r))||"hidden"===getComputedStyle(t).visibility)return;const o=t.getBoundingClientRect().bottom-r.clientHeight+8;return o>0?window.resizeBy(0,o):void 0},archive(){let e,t;if(!(t=Xe.report(i.BOARD.ID)).length)return;const o=x("form"),a=x.id("reportTypes"),s=x("h3"),n=x.el("fieldset",{id:"archive-report",hidden:!0},{
innerHTML:'<legend><label><input id="archive-report-enabled" type="checkbox">Report illegal content to archives</label></legend> <label for="archive-report-reason">Details</label> <textarea id="archive-report-reason" disabled>Illegal content</textarea> <button id="archive-report-submit" hidden>Submit</button>'}),r=x("#archive-report-enabled",n),l=x("#archive-report-reason",n),d=x("#archive-report-submit",n);if(x.on(r,"change",(function(){return l.disabled=!this.checked})),o&&a?(n.hidden=!x('[value="31"]',a).checked,x.on(a,"change",(function(e){return n.hidden="31"!==e.target.value,He.fit("body")})),x.after(a,n),He.fit("body"),x.one(o,"submit",(function(e){if(!n.hidden&&r.checked)return e.preventDefault(),He.archiveSubmit(t,l.value,(e=>(this.action="#archiveresults="+encodeURIComponent(JSON.stringify(e)),this.submit())))}))):s&&(n.hidden=/Report submitted!/.test(s.textContent),x.on(r,"change",(function(){return d.hidden=!this.checked})),x.after(s,n),
x.on(d,"click",(()=>He.archiveSubmit(t,l.value,He.archiveResults)))),e=location.hash.match(/^#archiveresults=(.*)$/))try{return He.archiveResults(JSON.parse(decodeURIComponent(e[1])))}catch(e){}},archiveSubmit(e,t,o){const a=x.formData({board:i.BOARD.ID,num:He.postID,reason:t}),s=[];for(var[n,r]of e)!function(t,i){x.ajax(i,{onloadend(){if(s.push([t,this.response||{error:""}]),s.length===e.length)return o(s)},form:a})}(n,r)},archiveResults(e){const t=x.id("archive-report");for(var[o,a]of e){var i=x.el("h3",{className:"archive-report-response"});"success"in a?(x.addClass(i,"archive-report-success"),i.textContent=`${o}: ${a.success}`):(x.addClass(i,"archive-report-error"),i.textContent=`${o}: ${a.error||"Error reporting post."}`),t?x.before(t,i):x.add(n.body,i)}}};const je={init(){if(a["Remember Your Posts"])return x.ready(this.ready)},ready(){if("Post successful!"!==n.title)return;let[e,t,o]=x("h1").nextSibling.textContent.match(/thread:(\d+),no:(\d+)/);o=+o,t=+t||o
;return new q("yourPosts").set({boardID:i.BOARD.ID,threadID:t,postID:o,val:!0})}};const Ue={isOPContainerThread:!1,hasIPCount:!0,archivedBoardsKnown:!0,urls:{thread:({boardID:e,threadID:t})=>`${location.protocol}//${se.domain(e)}/${e}/thread/${t}`,post:({postID:e})=>`#p${e}`,index:({boardID:e})=>`${location.protocol}//${se.domain(e)}/${e}/`,catalog:({boardID:e})=>"f"===e?void 0:`${location.protocol}//${se.domain(e)}/${e}/catalog`,archive:({boardID:e})=>se.isArchived(e)?`${location.protocol}//${se.domain(e)}/${e}/archive`:void 0,threadJSON:({boardID:e,threadID:t})=>`${location.protocol}//a.4cdn.org/${e}/thread/${t}.json`,threadsListJSON:({boardID:e})=>`${location.protocol}//a.4cdn.org/${e}/threads.json`,archiveListJSON:({boardID:e})=>se.isArchived(e)?`${location.protocol}//a.4cdn.org/${e}/archive.json`:"",catalogJSON:({boardID:e})=>`${location.protocol}//a.4cdn.org/${e}/catalog.json`,file({boardID:e},t){const o="f"===e?T.flashHost():T.host();return`${location.protocol}//${o}/${e}/${t}`
},thumb:({boardID:e},t)=>`${location.protocol}//${T.thumbHost()}/${e}/${t}`},isPrunedByAge:({boardID:e})=>"f"===e,areMD5sDeferred:({boardID:e})=>"f"===e,isOnePage:({boardID:e})=>"f"===e,noAudio:({boardID:e})=>se.noAudio(e),selectors:{board:".board",thread:".thread",threadDivider:".board > hr",summary:"a.summary",postContainer:".postContainer",replyOriginal:".replyContainer:not([data-clone])",sideArrows:"div.sideArrows",post:".post",infoRoot:".postInfo",info:{subject:".subject",name:".name",email:".useremail",tripcode:".postertrip",uniqueIDRoot:".posteruid",uniqueID:".posteruid > .hand",capcode:".capcode.hand",pass:".n-pu",flag:".flag, .bfl",date:".dateTime",nameBlock:".nameBlock",quote:".postNum > a:nth-of-type(2)",reply:".replylink"},icons:{isSticky:".stickyIcon",isClosed:".closedIcon",isArchived:".archivedIcon"},file:{text:".file > :first-child",link:".fileText > a",thumb:"a.fileThumb > [data-md5]"},thumbLink:"a.fileThumb",highlightable:{op:".opContainer",reply:" > .reply",catalog:""
},comment:".postMessage",spoiler:"s",quotelink:":not(pre) > .quotelink",catalog:{board:"#threads",thread:".thread",thumb:".thumb"},boardList:"#boardNavDesktop > .boardList",boardListBottom:"#boardNavDesktopFoot > .boardList",styleSheet:"link[title=switch]",psa:"#globalMessage",psaTop:"#globalToggle",searchBox:"#search-box",nav:{prev:".prev > form > [type=submit]",next:".next > form > [type=submit]"}},classes:{highlight:"highlight"},xpath:{thread:'div[contains(concat(" ",@class," ")," thread ")]',postContainer:'div[contains(@class,"postContainer")]',replyContainer:'div[contains(@class,"replyContainer")]'},regexp:{quotelink:new RegExp("^https?://boards\\.4chan(?:nel)?\\.org/+([^/]+)/+thread/+(\\d+)(?:[/?][^#]*)?(?:#p(\\d+))?$"),quotelinkHTML:/<a [^>]*\bhref="(?:(?:\/\/boards\.4chan(?:nel)?\.org)?\/([^\/]+)\/thread\/)?(\d+)?(?:#p(\d+))?"/g,pass:/^https?:\/\/www\.4chan(?:nel)?\.org\/+pass(?:$|[?#])/,captcha:/^https?:\/\/sys\.4chan(?:nel)?\.org\/+captcha(?:$|[?#])/},
bgColoredEl:()=>x.el("div",{className:"reply"}),isThisPageLegit:()=>["boards.4chan.org","boards.4channel.org"].includes(location.hostname)&&n.doctype&&!x('link[href*="favicon-status.ico"]',n.head)&&!["4chan - Temporarily Offline","4chan - Error","504 Gateway Time-out","MathJax Equation Source"].includes(n.title),is404:()=>["4chan - Temporarily Offline","4chan - 404 Not Found"].includes(n.title)||"thread"===i.VIEW&&x(".board")&&!x(".opContainer"),isIncomplete:()=>["index","thread"].includes(i.VIEW)&&!x(".board + *"),isBoardlessPage:e=>["www.4chan.org","www.4channel.org"].includes(e.hostname),isAuxiliaryPage:e=>!["boards.4chan.org","boards.4channel.org"].includes(e.hostname),isFileURL:e=>T.test(e.hostname),initAuxiliary(){switch(location.hostname){case"www.4chan.org":case"www.4channel.org":return void(Ue.regexp.pass.test(location.href)?qe.init():(x.onExists(r,"body",(()=>x.addStyle(R.www))),Pe.replace.init()));case"sys.4chan.org":case"sys.4channel.org":
var e=location.pathname.split(/\/+/);if("imgboard.php"===e[2]){let e;/\bmode=report\b/.test(location.search)?He.init():(e=location.search.match(/\bres=(\d+)/))&&x.ready((function(){if(a["404 Redirect"]&&"Error: Specified thread does not exist."===x.id("errmsg")?.textContent)return Xe.navigate("thread",{boardID:i.BOARD.ID,postID:+e[1]})}))}else"post"===e[2]&&je.init();return}},scriptData(){for(var e of S("script:not([src])",n.head))if(/\bcooldowns *=/.test(e.textContent))return e.textContent;return""},parseThreadMetadata(e){let t;const o=this.scriptData();if(e.postLimit=/\bbumplimit *= *1\b/.test(o),e.fileLimit=/\bimagelimit *= *1\b/.test(o),e.ipCount=(t=o.match(/\bunique_ips *= *(\d+)\b/))?+t[1]:void 0,"f"===i.BOARD.ID&&e.OP.file){const{file:t}=e.OP;return x.ajax(this.urls.threadJSON({boardID:"f",threadID:e.ID}),{timeout:f,onloadend(){if(this.response)return t.text.dataset.md5=t.MD5=this.response.posts[0].md5}})}},parseNodes(e,t){if("f"===e.boardID)return(()=>{const e=[]
;for(var o of["Sticky","Closed"]){var a;(a=x(`img[alt=${o}]`,t.info))&&e.push(x.addClass(a,`${o.toLowerCase()}Icon`,"retina"))}return e})()},parseDate:e=>new Date(1e3*e.dataset.utc),parseFile(e,t){let o;const{text:a,link:i,thumb:s}=t;if(!(o=i.nextSibling?.textContent.match(/\(([\d.]+ [KMG]?B).*\)/)))return!1;if(x.extend(t,{name:a.title||i.title||i.textContent,size:o[1],dimensions:o[0].match(/\d+x\d+/)?.[0],tag:o[0].match(/,[^,]*, ([a-z]+)\)/i)?.[1],MD5:a.dataset.md5}),s&&(x.extend(t,{thumbURL:s.src,MD5:s.dataset.md5,isSpoiler:x.hasClass(s.parentNode,"imgspoiler")}),t.isSpoiler)){let o;t.thumbURL=(o=i.href.match(/\d+(?=\.\w+$)/))?`${location.protocol}//${T.thumbHost()}/${e.board}/${o[0]}s.jpg`:void 0}return!0},cleanComment(e){let t;if(t=x(".abbr",e)){for(var o of S(".abbr + br, .exif",e))x.rm(o);for(let e=0;e<2;e++){var a;(a=t.previousSibling)&&"BR"===a.nodeName&&x.rm(a)}return x.rm(t)}},cleanCommentDisplay(e){let t;return(t=x("b",e))&&/^Rolled /.test(t.textContent)&&x.rm(t),
x.rm(x(".fortune",e))},insertTags(e){let t;for(t of S("s, .removed-spoiler",e))x.replace(t,[x.tn("[spoiler]"),...t.childNodes,x.tn("[/spoiler]")]);for(t of S(".prettyprint",e))x.replace(t,[x.tn("[code]"),...t.childNodes,x.tn("[/code]")])},hasCORS:e=>e.split("/").slice(0,3).join("/")===location.protocol+"//a.4cdn.org",sfwBoards:e=>se.sfwBoards(e),uidColor(e){let t=0,o=0;for(;o<8;)t=(t<<5)-t+e.charCodeAt(o++);return t>>8&16777215},isLinkified:e=>T.test(e.hostname),testNativeExtension:()=>x.global("testNativeExtension",{}),transformBoardList(){let e;const t=[],o=()=>x.el("span",{className:"spacer"}),a=x.X(".//a|.//text()[not(ancestor::a)]",x(Ue.selectors.boardList));let i=0;for(;e=a.snapshotItem(i++);)switch(e.nodeName){case"#text":for(var s of e.nodeValue){var n=x.el("span",{textContent:s});" "===s&&(n.className="space"),"]"===s&&t.push(o()),t.push(n),"["===s&&t.push(o())}break;case"A":var r=e.cloneNode(!0);t.push(r)}return t},Build:{staticPath:"//s.4cdn.org/image/",
gifIcon:window.devicePixelRatio>=2?"@2x.gif":".gif",spoilerRange:Object.create(null),shortFilename(e){const t=e.match(/\.?[^\.]*$/)[0];return e.length-t.length>30?`${e.match(/(?:[\uD800-\uDBFF][\uDC00-\uDFFF]|[^]){0,25}/)[0]}(...)${t}`:e},spoilerThumb(e){let t;return(t=this.spoilerRange[e])?`${this.staticPath}spoiler-${e}${Math.floor(1+t*Math.random())}.png`:`${this.staticPath}spoiler.png`},sameThread:(e,t)=>"thread"===i.VIEW&&i.BOARD.ID===e&&i.THREADID===+t,threadURL:(e,t)=>e!==i.BOARD.ID?`//${se.domain(e)}/${e}/thread/${t}`:"thread"!==i.VIEW||+t!==i.THREADID?`/${e}/thread/${t}`:"",postURL(e,t,o){return`${this.threadURL(e,t)}#p${o}`},parseJSON(e,{siteID:t,boardID:o}){const a={ID:e.no,postID:e.no,threadID:e.resto||e.no,boardID:o,siteID:t,isReply:!!e.resto,isSticky:!!e.sticky,isClosed:!!e.closed,isArchived:!!e.archived,threadReplies:e.replies,threadImages:e.images,fileDeleted:!!e.filedeleted,filesDeleted:e.filedeleted?[0]:[]};for(var i in a.info={subject:x.unescape(e.sub),
email:x.unescape(e.email),name:x.unescape(e.name)||"",tripcode:e.trip,pass:null!=e.since4pass?`${e.since4pass}`:void 0,uniqueID:e.id,flagCode:e.country,flagCodeTroll:e.board_flag,flag:x.unescape(e.country_name||e.flag_name),dateUTC:e.time,dateText:e.now,commentHTML:{innerHTML:e.com||"",[y]:!0}},e.capcode&&(a.info.capcode=e.capcode.replace(/_highlight$/,"").replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase())),a.capcodeHighlight=/_highlight$/.test(e.capcode),delete a.info.uniqueID),a.files=[],e.ext&&(a.file=this.parseJSONFile(e,{siteID:t,boardID:o}),a.files.push(a.file)),a.extra=p(),e)"x"===i[0]&&(a.extra[i]=e[i]);return a},parseJSONFile(e,{siteID:t,boardID:o}){const a=i.sites[t],s="yotsuba"===a.software&&"f"===o?`${encodeURIComponent(e.filename)}${e.ext}`:`${e.tim}${e.ext}`,n={name:x.unescape(e.filename)+e.ext,url:a.urls.file({siteID:t,boardID:o},s),height:e.h,width:e.w,MD5:e.md5,size:x.bytesToString(e.fsize),thumbURL:a.urls.thumb({siteID:t,boardID:o},`${e.tim}s.jpg`),theight:e.tn_h,
twidth:e.tn_w,isSpoiler:!!e.spoiler,tag:e.tag,hasDownscale:!!e.m_img};return null==e.h||/\.pdf$/.test(n.url)||(n.dimensions=`${n.width}x${n.height}`),n},parseComment:e=>(e=e.replace(/<br\b[^<]*>/gi,"\n").replace(/\n\n<span\b[^<]* class="abbr"[^]*$/i,"").replace(/<[^>]*>/g,""),x.unescape(e)),parseCommentDisplay(e){if(!a["Remove Spoilers"]&&!a["Reveal Spoilers"]){let t;for(;(t=e.replace(/<s>(?:(?!<\/?s>).)*<\/s>/g,"[spoiler]"))!==e;)e=t}return e=e.replace(/^<b\b[^<]*>Rolled [^<]*<\/b>/i,"").replace(/<span\b[^<]* class="fortune"[^]*$/i,""),this.parseComment(e).trim().replace(/\s+$/gm,"")},postFromObject(e,t){const o=this.parseJSON(e,{boardID:t,siteID:i.SITE.ID});return this.post(o)},post(e){const{ID:t,threadID:o,boardID:a,file:s}=e,{subject:n,email:r,name:l,tripcode:d,capcode:c,pass:h,uniqueID:u,flagCode:p,flagCodeTroll:g,flag:f,dateUTC:m,dateText:b,commentHTML:v}=e.info,{staticPath:A,gifIcon:w}=this;let k,D,E;if(c)if(E=c.toLowerCase(),"Founder"===c)D="the Founder",
k="4chan's Founder";else if("Verified"===c)D="Verified Users",k="";else{const e=x.getOwn({Admin:"Administrator",Mod:"Moderator"},c)||c;D=`${e}s`,k=`a 4chan ${e}`}const T=this.threadURL(a,o),R=function(e,t,o,a,s,n,r,l,d,c,h,u,p,g,f,m,b,v,A,x,w,y,k){const I=[C("span",{class:"name"+(a?" capcode":"")},n)];r&&I.push(" ",C("span",{class:"postertrip"},r)),l&&I.push(" ",C("span",{title:`Pass user since ${l}`,class:"n-pu"})),a&&I.push(" ",C("strong",{class:`capcode hand id_${d}`,title:`Highlight posts by ${c}`},"## ",a));const D=s?[" ",C("a",{href:`mailto:${s}`,class:"useremail"},...I)]:I;"f"===y&&!t.isReply||p||D.push(" "),p&&D.push(C("img",{src:`${h}${d}icon${u}`,alt:`${a} Icon`,title:`This user is ${p}.`,class:"identityIcon retina"})),g&&!a&&D.push(C("span",{class:`posteruid id_${g}`},"(ID: ",C("span",{class:"hand",title:"Highlight posts by this ID"},g),")")),m&&D.push(" ",C("span",{title:f,class:`flag flag-${m.toLowerCase()}`})),b&&D.push(" ",C("span",{title:f,
class:`bfl bfl-${b.toLowerCase()}`}));const E=[C("a",{href:x,title:"Link to this post"},"No."),C("a",{href:w,title:"Reply to this post"},e)];if(t.isSticky){const e=`${h}sticky${u}`;E.push(" "),"f"===y?E.push(C("img",{src:e,alt:"Sticky",title:"Sticky",style:"height: 18px; width: 18px;"})):E.push(C("img",{src:e,alt:"Sticky",title:"Sticky",class:"stickyIcon retina"}))}if(t.isClosed&&!t.isArchived){E.push(" ");const e=`${h}closed${u}`;"f"===y?E.push(C("img",{src:e,alt:"Closed",title:"Closed",style:"height: 18px; width: 18px;"})):E.push(C("img",{src:e,alt:"Closed",title:"Closed",class:"closedIcon retina"}))}return t.isArchived&&E.push(" ",C("img",{src:`${h}archived${u}`,alt:"Archived",title:"Archived",class:"archivedIcon retina"})),t.isReply||"index"!==i.VIEW||E.push("   ",C("span",null,"[",C("a",{href:`/${y}/thread/${k}`,class:"replylink"},"Reply"),"]")),C("div",{class:"postInfo desktop",id:`pi${e}`},C("input",{type:"checkbox",name:e,value:"delete"
})," ",...!t.isReply||"f"===y||o?[C("span",{class:"subject"},o)," "]:[],C("span",{class:"nameBlock"+(a?` capcode${a}`:"")},...D)," ",C("span",{class:"dateTime","data-utc":v},A)," ",C("span",{class:"postNum"+(" f"!==y||t.isReply?" desktop":"")},...E))}(t,e,n,c,r,l,d,h,E,D,A,w,k,u,f,p,g,m,b,`${T}#p${t}`,this.sameThread(a,o)?`javascript:quote('${+t}');`:`${T}#q${t}`,a,o);let B,N,L,P;s&&(B=/^https?:(?=\/\/i\.4cdn\.org\/)/,N=s.url.replace(B,""),L=this.shortFilename(s.name),P=s.isSpoiler?this.spoilerThumb(a):s.thumbURL.replace(B,""));const M=function(e,t,o,a,i,s,n,r,l){if(e){const n=[];return"f"===o?n.push(C("div",{class:"fileInfo","data-md5":e.MD5},C("span",{class:"fileText",id:`fT${t}`},"File: ",C("a",{"data-width":e.width,"data-height":e.height,href:a,target:"_blank"},e.name),"-(",e.size,", ",e.dimensions,e.tag?", "+e.tag:"",")"))):n.push(C("div",{class:"fileText",id:`fT${t}`,title:e.isSpoiler?e.name:null},"File: ",C("a",{title:e.name===i||e.isSpoiler?null:e.name,href:a,target:"_blank"
},e.isSpoiler?"Spoiler Image":i),` (${e.size}, ${e.dimensions||"PDF"})`),C("a",{class:"fileThumb"+(e.isSpoiler?" imgspoiler":""),href:a,target:"_blank","data-m":e.hasDownscale?"":null},C("img",{src:s,alt:e.size,"data-md5":e.MD5,style:`height: ${e.isSpoiler?"100":e.theight}px; width: ${e.isSpoiler?"100":e.twidth}px;`,loading:"lazy"}))),C("div",{class:"file",id:`f${t}`},...n)}return n.fileDeleted?C("div",{class:"file",id:`f${t}`},C("span",{class:"fileThumb"},C("img",{src:`${r}filedeleted-res${l}`,alt:"File deleted.",class:"fileDeletedRes retina"}))):{innerHTML:"",[y]:!0}}(s,t,a,N,L,P,e,A,w),F=e.isReply?"reply":"op",$=e.isReply?[R,M]:[M,R];$.push(C("blockquote",{class:"postMessage",id:`m${t}`},v)),e.isReply||null==e.threadReplies||$.push(C("span",{class:"summary preview-summary"},this.summaryText("",e.threadReplies,e.threadImages,!0)));const O=C(I,null,e.isReply?C("div",{class:"sideArrows",id:`sa${t}`},">>"):"",C("div",{id:`p${t}`,class:`post ${F}${e.capcodeHighlight?" highlightPost":""}`
},...$)),q=x.el("div",{className:`postContainer ${F}Container`,id:`pc${t}`});for(var H of(x.extend(q,O),S(".quotelink",q))){var j,U=H.getAttribute("href");if("#"===U[0])this.sameThread(a,o)||(H.href=this.threadURL(a,o)+U);else(j=H.href.match(Ue.regexp.quotelink))&&this.sameThread(j[1],j[2])&&(H.href=U.match(/(#[^#]*)?$/)[0]||"#")}return q},summaryText(e,t,o,a=!1){let i="";return e&&(i+=`${e} `),i+=`${t} post${1==t?"":"s"}`,+o&&(i+=` and ${o} image repl${o>1?"ies":"y"}`),a?i:`${i} ${"-"===e?"shown":"omitted"}.`},summary(e,t,o,a){return x.el("a",{className:"summary",textContent:this.summaryText("",o,a),href:`/${e}/thread/${t}`})},thread(e,t,o){let a;if((a=e.nodes.root)?x.rmAll(a):e.nodes.root=a=x.el("div",{className:"thread",id:`t${t.no}`}),this.hat&&x.add(a,this.hat.cloneNode(!1)),x.add(a,e.OP.nodes.root),t.omitted_posts||!o&&t.replies){const[i,s]=o?[t.omitted_posts,t.images-t.last_replies.filter((e=>!!e.ext)).length]:[t.replies,t.images],n=this.summary(e.board.ID,t.no,i,s);x.add(a,n)}
return a},catalogThread(e,t,o){let i,s,n;const{staticPath:r,gifIcon:l}=this,{tn_w:d,tn_h:c}=t;if(t.spoiler&&!a["Reveal Spoiler Thumbnails"]){let t;n=`${r}spoiler`,(t=this.spoilerRange[e.board])&&(n+=`-${e.board}`+Math.floor(1+t*Math.random())),n+=".png",s="spoiler-file",i="--tn-w: 100; --tn-h: 100;"}else if(t.filedeleted)n=`${r}filedeleted-res${l}`,s="deleted-file";else if(e.OP.file){n=e.OP.file.thumbURL;const t=250/Math.max(d,c);i=`--tn-w: ${d*t}; --tn-h: ${c*t};`}else n=`${r}nofile.png`,s="no-file";const h=t.replies+1,u=t.images+!!t.ext,p=x.el("div",function(e,t,o,a,i,s,n,r,l){return C(I,null,C("a",{class:"catalog-link",href:`/${e.board}/thread/${e.ID}`},C("img",o?{src:t,class:`catalog-thumb ${o}`}:{src:t,class:"catalog-thumb","data-width":a.tn_w,"data-height":a.tn_h})),C("div",{class:"catalog-stats"},C("span",{title:"Posts / Files / Page"},C("span",{class:"post-count"+(a.bumplimit?" warning":"")},i)," / ",C("span",{class:"file-count"+(a.imagelimit?" warning":"")},s)," / ",C("span",{
class:"page-count"},n)),C("span",{class:"catalog-icons"},e.isSticky?C("img",{src:`${r}sticky${l}`,class:"stickyIcon",title:"Sticky"}):"",e.isClosed?C("img",{src:`${r}closed${l}`,class:"closedIcon",title:"Closed"}):"")))}(e,n,s,t,h,u,o,r,l));for(var g of(x.before(e.OP.nodes.info,[...p.childNodes]),S("br",e.OP.nodes.comment)))g.previousSibling&&"BR"===g.previousSibling.nodeName&&x.addClass(g,"extra-linebreak");const f=x.el("div",{className:"thread catalog-thread",id:`t${e}`});return e.OP.highlights&&x.addClass(f,...e.OP.highlights),e.OP.file||x.addClass(f,"noFile"),f.style.cssText=i||"",f},catalogReply(e,t){let o="";t.com&&(o=this.parseCommentDisplay(t.com).replace(/>>\d+/g,"").trim().replace(/\n+/g," // ")),t.ext&&(o||(o=`${x.unescape(t.filename)}${t.ext}`)),t.com&&(o||(o=x.unescape(t.com.replace(/<br\b[^<]*>/gi," // ")))),o||(o=" "),o.length>73&&(o=`${o.slice(0,70)}...`);const a=this.postURL(e.board.ID,e.ID,t.no);return x.el("div",{className:"catalog-reply"
},C(I,null,C("span",null,C("time",{"data-utc":1e3*t.time,"data-abbrev":"1"},"..."),": "),C("a",{class:"catalog-reply-excerpt",href:a},o),C("a",{class:"catalog-reply-preview",href:a},"...")))}}},Ve={isOPContainerThread:!0,mayLackJSON:!0,threadModTimeIgnoresSage:!0,disabledFeatures:["Resurrect Quotes","Quick Reply Personas","Quick Reply","Cooldown","Report Link","Delete Link","Edit Link","Quote Inlining","Quote Previewing","Quote Backlinks","File Info Formatting","Image Expansion","Image Expansion (Menu)","Comment Expansion","Thread Expansion","Favicon","Quote Threading","Thread Updater","Banner","Flash Features","Reply Pruning"],detect(){for(var e of S("script:not([src])",n.head)){var t;if(t=e.textContent.match(/\bvar configRoot=(".*?")/)){var o=p();try{var a=JSON.parse(t[1]);"/"===a[0]?o.root=location.origin+a:/^https?:/.test(a)&&(o.root=a)}catch(e){}return o}}return!1},awaitBoard(e){if(x.id("react-ui")){const t=this.selectors=Object.create(this.selectors);return t.boardFor={
index:".page-container"},t.thread='div[id^="thread_"]',Pt.mounted(e)}return e()},urls:{thread:({siteID:e,boardID:t,threadID:o},i)=>`${a.siteProperties[e]?.root||`http://${e}/`}${t}/${i?"archive/":""}res/${o}.html`,post:({postID:e})=>`#${e}`,index:({siteID:e,boardID:t})=>`${a.siteProperties[e]?.root||`http://${e}/`}${t}/`,catalog:({siteID:e,boardID:t})=>`${a.siteProperties[e]?.root||`http://${e}/`}${t}/catalog.html`,threadJSON({siteID:e,boardID:t,threadID:o},i){const s=a.siteProperties[e]?.root;return s?`${s}${t}/${i?"archive/":""}res/${o}.json`:""},archivedThreadJSON:e=>Ve.urls.threadJSON(e,!0),threadsListJSON({siteID:e,boardID:t}){const o=a.siteProperties[e]?.root;return o?`${o}${t}/threads.json`:""},archiveListJSON({siteID:e,boardID:t}){const o=a.siteProperties[e]?.root;return o?`${o}${t}/archive/archive.json`:""},catalogJSON({siteID:e,boardID:t}){const o=a.siteProperties[e]?.root;return o?`${o}${t}/catalog.json`:""},
file:({siteID:e,boardID:t},o)=>`${a.siteProperties[e]?.root||`http://${e}/`}${t}/${o}`,thumb:(e,t)=>Ve.urls.file(e,t)},selectors:{board:'form[name="postcontrols"]',thread:'input[name="board"] ~ div[id^="thread_"]',threadDivider:'div[id^="thread_"] > hr:last-child',summary:".omitted",postContainer:'div[id^="reply_"]:not(.hidden)',opBottom:".op",replyOriginal:'div[id^="reply_"]:not(.hidden)',infoRoot:".intro",info:{subject:".subject",name:".name",email:".email",tripcode:".trip",uniqueID:".poster_id",capcode:".capcode",flag:".flag",date:"time",nameBlock:"label",quote:'a[href*="#q"]',reply:'a[href*="/res/"]:not([href*="#"])'},icons:{isSticky:".fa-thumb-tack",isClosed:".fa-lock"},file:{text:".fileinfo",link:".fileinfo > a",thumb:"a > .post-image"},thumbLink:".file > a",multifile:".files > .file",highlightable:{op:" > .op",reply:".reply",catalog:" > .thread"},comment:".body",spoiler:".spoiler",quotelink:'a[onclick*="highlightReply("]',catalog:{board:"#Grid",thread:".mix",
thumb:".thread-image"},boardList:".boardlist",boardListBottom:".boardlist.bottom",styleSheet:"#stylesheet",psa:".blotter",nav:{prev:".pages > form > [value=Previous]",next:".pages > form > [value=Next]"}},classes:{highlight:"highlighted"},xpath:{thread:'div[starts-with(@id,"thread_")]',postContainer:'div[starts-with(@id,"reply_") or starts-with(@id,"thread_")]',replyContainer:'div[starts-with(@id,"reply_")]'},regexp:{quotelink:new RegExp("/([^/]+)/res/(\\d+)(?:\\.\\w+)?#(\\d+)$"),quotelinkHTML:/<a [^>]*\bhref="[^"]*\/([^\/]+)\/res\/(\d+)(?:\.\w+)?#(\d+)"/g},Build:{parseJSON(e,t){const o=Ue.Build.parseJSON(e,t);if("deleted"===e.ext&&(delete o.file,x.extend(o,{files:[],fileDeleted:!0,filesDeleted:[0]})),e.extra_files){let a;for(let i=0;i<e.extra_files.length;i++){"deleted"===e.extra_files[i].ext?o.filesDeleted.push(i):(a=Ue.Build.parseJSONFile(e,t),o.files.push(a))}o.files.length&&(o.file=o.files[0])}return o},parseComment:e=>(e=e.replace(/<br\b[^<]*>/gi,"\n").replace(/<[^>]*>/g,""),
x.unescape(e))},bgColoredEl:()=>x.el("div",{className:"post reply"}),isFileURL:e=>/\/src\/[^\/]+/.test(e.pathname),preParsingFixes(e){let t;if(t=x('a > input[name="board"]',e))return x.before(t.parentNode,t)},parseNodes(e,t){let o;if(t.uniqueID)return;let a="",i=t.nameBlock.nextSibling;for(;i&&3===i.nodeType;)a+=i.textContent,i=i.nextSibling;if(o=a.match(/(\s*ID:\s*)(\S+)/)){let e;t.info.normalize();let{nextSibling:a}=t.nameBlock;return a=a.splitText(o[1].length),a.splitText(o[2].length),t.uniqueID=e=x.el("span",{className:"poster_id"}),x.replace(a,e),x.add(e,a)}},parseDate(e){let t=Date.parse(e.getAttribute("datetime")?.trim());return isNaN(t)?(t=Date.parse(e.textContent.trim()+" UTC"),isNaN(t)?void 0:new Date(t)):new Date(t)},parseFile(e,t){let o,a;const{text:i,link:s,thumb:n}=t;if(x.x(`ancestor::${this.xpath.postContainer}[1]`,i)!==e.nodes.root)return!1;if(!(a=s.nextSibling?.textContent.includes("(")?s.nextSibling:s.nextElementSibling))return!1
;if(!(o=a.textContent.match(/\((.*,\s*)?([\d.]+ ?[KMG]?B).*\)/)))return!1;const r=x(".postfilename",i);return x.extend(t,{name:r?r.title||r.textContent:s.pathname.match(/[^/]*$/)[0],size:o[2],dimensions:o[0].match(/\d+x\d+/)?.[0]}),n&&x.extend(t,{thumbURL:/\/static\//.test(n.src)&&x.isImage(s.href)?s.href:n.src,isSpoiler:/^Spoiler/i.test(o[1]||"")||"Spoiler Image"===s.textContent}),!0},isThumbExpanded:e=>x.hasClass(e.thumb.parentNode,"expanded")||"true"===e.thumb.parentNode.dataset.expanded,isLinkified:e=>/\bnofollow\b/.test(e.rel),catalogPin:e=>e.dataset.sticky="true"},Qe={tinyboard:Ve,yotsuba:Ue};var ze={init(){if(["index","thread","archive"].includes(i.VIEW)&&a["File Info Formatting"])return c.Post.push({name:"File Info Formatting",cb:this.node})},node(){if(!this.file)return;if(this.isClone){let e;for(e of S(".file-info .download-button",this.file.text))x.on(e,"click",$e.download);for(e of S(".file-info .quick-filter-md5",this.file.text))x.on(e,"click",Je.quickFilterMD5);return}
const e=x.el("span",{className:"fileText-original"});x.prepend(this.file.link.parentNode,e),x.add(e,[this.file.link.previousSibling,this.file.link,this.file.link.nextSibling]);const t=x.el("span",{className:"file-info"});return ze.format(a.fileInfo,this,t),x.prepend(this.file.text,t)},format(e,t,o){let a;const i=[];for(a of(e.replace(/%(.)|[^%]+/g,(function(e,o){return i.push(x.hasOwn(ze.formatters,o)?ze.formatters[o].call(t):{innerHTML:s(e)}),""})),x.extend(o,{innerHTML:s.cat(i)}),S(".download-button",o)))x.on(a,"click",$e.download);for(a of S(".quick-filter-md5",o))x.on(a,"click",Je.quickFilterMD5)},formatters:{t(){return{innerHTML:s(this.file.url.match(/[^/]*$/)[0]),[y]:!0}},T(){return C("a",{href:this.file.url,target:"_blank"},ze.formatters.t.call(this))},l(){return C("a",{href:this.file.url,target:"_blank"},ze.formatters.n.call(this))},L(){return C("a",{href:this.file.url,target:"_blank"},ze.formatters.N.call(this))},n(){
const e=this.file.name,t=Qe.yotsuba.Build.shortFilename(this.file.name,this.isReply);return e===t?{innerHTML:s(e),[y]:!0}:C("span",{class:"fnswitch"},C("span",{class:"fntrunc"},t),C("span",{class:"fnfull"},e))},N(){return{innerHTML:s(this.file.name),[y]:!0}},d(){return C("a",{href:this.file.url,download:this.file.name,class:"download-button"},M.raw("download"))},f:()=>({innerHTML:'<a href="javascript:;" class="quick-filter-md5">✕</a>',[y]:!0}),p(){return{innerHTML:this.file.isSpoiler?"Spoiler, ":"",[y]:!0}},s(){return{innerHTML:s(this.file.size),[y]:!0}},B(){return{innerHTML:Math.round(this.file.sizeInBytes)+" Bytes",[y]:!0}},K(){return{innerHTML:Math.round(this.file.sizeInBytes/1024)+" KB",[y]:!0}},M(){return{innerHTML:Math.round(this.file.sizeInBytes/1048576*100)/100+" MB",[y]:!0}},r(){return{innerHTML:s(this.file.dimensions||"PDF"),[y]:!0}},g(){return{innerHTML:this.file.tag?", "+s(this.file.tag):"",[y]:!0}},"%":()=>({innerHTML:"%",[y]:!0})}},We={dialog:void 0,init(){
const e=x.el("a",{className:"settings-link",title:`${o.name} Settings`,href:"javascript:;"});M.set(e,"wrench","Settings"),x.on(e,"click",We.open),Ye.addShortcut("settings",e,820);const t=this.addSection;t("Main",this.main),t("Filter",this.filter),t("Sauce",this.sauce),t("Advanced",this.advanced),t("Keybinds",this.keybinds),x.on(n,"AddSettingsSection",We.addSection),x.on(n,"OpenSettings",(e=>We.open(e.detail))),"yotsuba"===i.SITE.software&&a["Disable Native Extension"]&&x.global(x.hasStorage?"disableNativeExtension":"disableNativeExtensionNoStorage")},open(e){let t,o;if(We.dialog)return;x.event("CloseMenu"),We.dialog=t=x.el("div",{id:"overlay"},E),x.on(x(".export",t),"click",We.export),x.on(x(".import",t),"click",We.import),x.on(x(".reset",t),"click",We.reset),x.on(x("input",t),"change",We.onImport);const a=[];for(var i of We.sections){var s=x.el("a",{className:`tab-${i.hyphenatedTitle}`,textContent:i.title,href:"javascript:;"});x.on(s,"click",We.openSection.bind(i)),
a.push(s,x.tn(" | ")),i.title===e&&(o=s)}a.pop(),x.add(x(".sections-list",t),a),"none"!==e&&(o||a[0]).click(),x.on(x(".close",t),"click",We.close),x.on(window,"beforeunload",We.close),x.on(t,"click",(()=>{"INPUT"!==n.activeElement?.tagName&&"TEXTAREA"!==n.activeElement?.tagName&&We.close()})),x.on(t.firstElementChild,"click",(e=>e.stopPropagation())),x.add(n.body,t),x.event("OpenSettings",null,t)},close(){We.dialog&&(n.activeElement?.blur(),x.rm(We.dialog),delete We.dialog)},sections:[],addSection(e,t){"string"!=typeof e&&({title:e,open:t}=e.detail);const o=e.toLowerCase().replace(/\s+/g,"-");We.sections.push({title:e,hyphenatedTitle:o,open:t})},openSection(){let e;(e=x(".tab-selected",We.dialog))&&x.rmClass(e,"tab-selected"),x.addClass(x(`.tab-${this.hyphenatedTitle}`,We.dialog),"tab-selected");const t=x("section",We.dialog);x.rmAll(t),t.className=`section-${this.hyphenatedTitle}`,this.open(t,i),t.scrollTop=0,x.event("OpenSettings",null,t)},warnings:{localStorage(e){if(x.cantSync){
const t=x.cantSet?"save your settings":"synchronize settings between tabs";e(x.el("li",{textContent:`${o.name} needs local storage to ${t}.\nEnable it on boards.${location.hostname.split(".")[1]}.org in your browser's privacy settings (may be listed as part of "local data" or "cookies").`}))}},ads(e){x.onExists(r,".adg-rects > .desktop",(t=>x.onExists(t,"iframe",(function(){const t=Xe.to("thread",{boardID:"qa",threadID:362590});e(x.el("li",C(I,null,"To protect yourself from ",C("a",{href:t,target:"_blank"},"malicious ads"),", you should ",C("a",{href:"https://github.com/gorhill/uBlock#ublock-origin",target:"_blank"},"block ads")," on 4chan.")))}))))}},main(e){let t;const s=x.el("fieldset",{hidden:!0},{innerHTML:"<legend>Warnings</legend><ul></ul>"}),n=function(e){x.add(x("ul",s),e),s.hidden=!1};for(t in We.warnings){(0,We.warnings[t])(n)}x.add(e,s);const r=p(),l=p(),d=function(e,o){const i=[e],s=[];for(t in o){var n=o[t];if(n instanceof Array){var d=n[1],c=x.el("div",{
innerHTML:`<label><input type="checkbox" name="${t}">${t}</label><span class="description">: ${d}</span>`});c.dataset.name=t;var h=x("input",c);x.on(h,"change",x.cb.checked),x.on(h,"change",(function(){this.parentNode.parentNode.dataset.checked=this.checked})),r[t]=a[t],l[t]=h;var u=n[2]||0;if(i.length<=u){var p=x.el("div",{className:"suboption-list"});x.add(i[i.length-1].lastElementChild,p),i[u]=p}else i.length>u+1&&i.splice(u+1,i.length-(u+1));s.push(x.add(i[u],c))}}return s};for(var c in h.main){var u=h.main[c],g=x.el("fieldset",{innerHTML:`<legend>${c}</legend>`});d(g,u),"Posting and Captchas"===c&&x.add(g,x.el("p",{innerHTML:'For more info on captcha options and issues, see the <a href="'+o.captchaFAQ+'" target="_blank">captcha FAQ</a>.'})),x.add(e,g)}d(x('div[data-name="JSON Index"] > .suboption-list',e),h.Index),x.get(r,(function(e){for(t in e){var o=e[t];l[t].checked=o,l[t].parentNode.parentNode.dataset.checked=o}}));const f=x.el("div",{
innerHTML:'<button></button><span class="description">: Clear manually-hidden threads and posts on all boards. Reload the page to apply.'}),m=x("button",f);x.get({hiddenThreads:p(),hiddenPosts:p()},(function({hiddenThreads:e,hiddenPosts:t}){let o,a,i,s,n=0;for(a in e)if(i=e[a],"boards"!==a)for(a in i.boards)o=i.boards[a],n+=Object.keys(o).length;for(a in e.boards)o=e.boards[a],n+=Object.keys(o).length;for(a in t)if(i=t[a],"boards"!==a)for(a in i.boards)for(a in o=i.boards[a],o)s=o[a],n+=Object.keys(s).length;for(a in t.boards)for(a in o=t.boards[a],o)s=o[a],n+=Object.keys(s).length;m.textContent=`Hidden: ${n}`})),x.on(m,"click",(function(){this.textContent="Hidden: 0",x.get("hiddenThreads",p(),(function({hiddenThreads:e}){if(x.hasStorage&&"yotsuba"===i.SITE.software){let t;for(t in e["4chan.org"]?.boards)localStorage.removeItem(`4chan-hide-t-${t}`);for(t in e.boards)localStorage.removeItem(`4chan-hide-t-${t}`)}x.delete(["hiddenThreads","hiddenPosts"])}))})),
x('input[name="Stubs"]',e).closest("fieldset").insertAdjacentElement("beforeend",f)},isExportModalOpen:!1,async export(){let e=a["Export History"],t=!1;if(a["Ask to Export History"]){if(We.isExportModalOpen)return;const o=X.dialog("export-dialog",{innerHTML:'<form id="export-form"> <div class="move">Export settings</div> <label><input name="history" type="checkbox" />Export history (last read, your posts, etc)</label><br /> <label><input name="ask" type="checkbox" checked />Ask every time.</label><br /> <button type="submit">Export</button> <button type="button" id="cancel-export">Cancel</button> </form>'}),i=x("form",o),{history:s,ask:r}=i.elements;s.checked=a["Export History"],x.add(n.body,o);const l=x(".export",We.dialog).getBoundingClientRect();if(o.style.top=`${l.y+l.height}px`,o.style.left=`${l.x}px`,We.isExportModalOpen=!0,await new Promise((a=>{const n=()=>{o.remove(),a(),We.isExportModalOpen=!1};x.on(i,"submit",(t=>{t.preventDefault(),e=s.checked,x.set("Export History",e),
x.set("Ask to Export History",r.checked),n()})),x.on(x("#cancel-export",o),"click",(()=>{t=!0,n()}))})),t)return}const o=p();x.extend(o,a),e||(delete o.hiddenThreads,delete o.hiddenPosts,delete o.hiddenPosterIds,delete o.lastReadPosts,delete o.yourPosts,delete o.watchedThreads,delete o.cooldowns,delete o["Index Sort"]),x.get(o,(function(e){delete e.boardConfig,We.downloadExport({version:i.VERSION,date:Date.now(),Conf:e})}))},downloadExport(e){const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),s=x.el("a",{download:`${o.name} v${i.VERSION}-${e.date}.json`,href:a}),n=x(".imp-exp-result",We.dialog);x.rmAll(n),x.add(n,s),s.click()},import(){x("input[type=file]",this.parentNode).click()},onImport(){let e;if(!(e=this.files[0]))return;this.value=null;const t=x(".imp-exp-result");if(!confirm("Your current settings will be entirely overwritten, are you sure?"))return void(t.textContent="Import aborted.");const o=new FileReader;o.onload=function(e){
try{We.loadSettings(p.json(e.target.result),(function(e){e?t.textContent="Import failed due to an error.":confirm("Import successful. Reload now?")&&window.location.reload()}))}catch(e){const o=e;t.textContent="Import failed due to an error.",l.error(o.stack)}},o.readAsText(e)},upgrade(e,t){let a,i,s;const n=p(),r=(t,o)=>e[t]=n[t]=o;if(a='"'===t[0])try{t=JSON.parse(t)}catch(e){}const l=t.replace(/^XT /i,"").replace(/\d+/g,(e=>e.padStart(5,"0")));if(a)for(i in e)if(s=e[i],"string"==typeof s)try{r(i,JSON.parse(s))}catch(e){}return l<"00001.00014.00016.00001"&&null!=e.archiveLists&&r("archiveLists",e.archiveLists.replace("https://mayhemydg.github.io/archives.json/archives.json","https://nstepien.github.io/archives.json/archives.json")),
l<"00001.00014.00016.00007"&&null!=e.sauces&&r("sauces",e.sauces.replace(/https:\/\/www\.deviantart\.com\/gallery\/#\/d%\$1%\$2;regexp:\/\^\\w\+_by_\\w\+\[_-\]d\(\[\\da-z\]\{6\}\)\\b\|\^d\(\[\\da-z\]\{6\}\)-\[\\da-z\]\{8\}-\//g,'javascript:void(open("https://www.deviantart.com/"+%$1.replace(/_/g,"-")+"/art/"+parseInt(%$2,36)));regexp:/^\\w+_by_(\\w+)[_-]d([\\da-z]{6})\\b/').replace(/\/\/imgops\.com\/%URL/g,"//imgops.com/start?url=%URL")),l<"00001.00014.00017.00002"&&null!=e.jsWhitelist&&r("jsWhitelist",e.jsWhitelist+"\n\nhttps://hcaptcha.com\nhttps://*.hcaptcha.com"),l<"00001.00014.00020.00004"&&null!=e.archiveLists&&r("archiveLists",e.archiveLists.replace("https://nstepien.github.io/archives.json/archives.json","https://4chenz.github.io/archives.json/archives.json")),
l<"00001.00014.00022.00003"&&e.sauces&&(r("sauces",e.sauces.replace(/^#?\s*https:\/\/www\.google\.com\/searchbyimage\?image_url=%(IMG|T?URL)&safe=off(?=$|;)/gm,"https://www.google.com/searchbyimage?sbisrc=4chanx&image_url=%$1&safe=off")),"00001.00014.00022.00002"!==l||/\bsbisrc=/.test(e.sauces)||r("sauces",e.sauces.replace(/^#?\s*https:\/\/lens\.google\.com\/uploadbyurl\?url=%(IMG|T?URL)(?=$|;)/m,"https://www.google.com/searchbyimage?sbisrc=4chanx&image_url=%$1&safe=off"))),l<"00002.00003.00001.00000"&&e.boardnav&&r("boardnav",e.boardnav.replace('[external-text:"FAQ","4chan XT"]',`[external-text:"FAQ","${o.faq}"]`)),l<"00002.00003.00006.00000"&&r("RelativeTime",e["Relative Post Dates"]?e["Relative Date Title"]?"Hover":"Show":"No"),"00002.00009.00000.00000"===l&&(r("XEmbedder",e["Embed Tweets inline with fxTwitter"]?"fxt":"tf"),r("fxtMaxReplies",e["Resolve Tweet Replies"]?e["Resolve all Tweet Replies"]?100:1:0),r("fxtLang",e["Translate non-English Tweets to English"]?"en":"")),n},
loadSettings(e,t){e.version!==i.VERSION&&We.upgrade(e.Conf,e.version),x.clear((function(o){if(o)return t(o);x.set(e.Conf,t)}))},reset(){confirm("Your current settings will be entirely wiped, are you sure?")&&x.clear((function(e){e?x(".imp-exp-result").textContent="Import failed due to an error.":confirm("Reset successful. Reload now?")&&window.location.reload()}))},filter(e){x.extend(e,{
innerHTML:'<select name="filter"> <option value="guide">Guide</option> <option value="general">General</option> <option value="postID">Post number</option> <option value="name">Name</option> <option value="uniqueID">Unique ID</option> <option value="tripcode">Tripcode</option> <option value="capcode">Capcode</option> <option value="pass">Pass Date</option> <option value="email">Email</option> <option value="subject">Subject</option> <option value="comment">Comment</option> <option value="flag">Flag</option> <option value="filename">Filename</option> <option value="dimensions">Image dimensions</option> <option value="filesize">Filesize</option> <option value="MD5">Image MD5</option> </select> <div></div>'});const t=x("select",e);x.on(t,"change",We.selectFilter),We.selectFilter.call(t)},selectFilter(){let e;const t=this.nextElementSibling;if("guide"!==(e=this.value)){if(!x.hasOwn(h.filter,e))return;x.rmAll(t);const o=x.el("textarea",{name:e,className:"field",spellcheck:!1})
;return x.on(o,"change",x.cb.value),void x.get(e,a[e],(function(a){o.value=a[e],x.add(t,o)}))}const o=Object.keys(h.filter).filter((e=>"general"!==e)).join(",​");x.extend(t,{
innerHTML:'<div class="warning"><code>Filter</code> is disabled.</div> <p> Use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions" target="_blank">regular expressions</a>, one per line.<br> Lines starting with a <code>#</code> will be ignored.<br> For example, <code>/weeaboo/i</code> will filter posts containing the string `<code>weeaboo</code>`, case-insensitive.<br> MD5 and Unique ID filtering use exact string matching, not regular expressions. </p> <ul>You can use these settings with each regular expression, separate them with semicolons: <li> Per boards, separate them with commas. It is global if not specified. Use <code>sfw</code> and <code>nsfw</code> to reference all worksafe or not-worksafe boards.<br> For example: <code>boards:a,jp;</code>.<br> To specify boards on a particular site, put the beginning of the domain and a slash character before the list.<br> Any initial <code>www.</code> should not be included, and all 4chan domains are considered <code>4chan.org</code>.<br> For example: <code>boards:4:a,jp,sama:a,z;</code>.<br> An asterisk can be used to specify all boards on a site.<br> For example: <code>boards:4:*;</code>.<br> </li> <li> Show a custom reason in the stub. If not given, the type and regex will be shown.<br> For example: <code>reason:This is bait;</code> </li> <li> Select boards to be excluded from the filter. The syntax is the same as for the <code>boards:</code> option above.<br> For example: <code>exclude:vg,v;</code>. </li> <li> Filter OPs only along with their threads (`only`) or replies only (`no`).<br> For example: <code>op:only;</code> or <code>op:no;</code>. </li> <li> Filter only posts with files (`only`) or only posts without files (`no`).<br> For example: <code>file:only;</code> or <code>file:no;</code>. </li> <li> Overrule the `Show Stubs` setting if specified: create a stub (`yes`) or not (`no`).<br> For example: <code>stub:yes;</code> or <code>stub:no;</code>. </li> <li> Highlight instead of hiding. You can specify a class name to use with a userstyle.<br> For example: <code>highlight;</code> or <code>highlight:wallpaper;</code>. </li> <li> Highlighted OPs will have their threads put on top of the board index by default.<br> For example: <code>top:yes;</code> or <code>top:no;</code>. </li> <li>Show a desktop notification instead of hiding: <code>notify;</code>.</li> <li>Hide all posts from this poster: <code>poster;</code>.</li> <li>Recursively hide replies: <code>replies;</code>.</li> <li>Hide anyway even if highlighting. The highlight class will be applied to the stub: <code>hide;</code>.</li> <li> Filters in the "General" section apply to multiple fields, by default <code>subject,name,filename,comment</code>.<br> The fields can be specified with the <code>type</code> option, separated by commas.<br> For example: <code id="filterTypes"></code>.<br> Types can also be combined with a <code>+</code> sign; this indicates the filter applies to the given fields joined by newlines.<br> For example: <code>type:filename+filesize+dimensions;</code>.<br> </li> </ul>'
}),x("#filterTypes",t).textContent=`type:​${o};`,x(".warning",t).hidden=a.Filter},sauce(e){x.extend(e,{
innerHTML:'<div class="warning"><code>Sauce</code> is disabled.</div> <input id="sauce-doc-expand" type="checkbox" hidden> <div id="sauce-doc"> <label for="sauce-doc-expand">[expand]</label> <div>These parameters will be replaced by their corresponding values in the URL and displayed text:</div> <ul> <li><code>%IMG</code>: Full image URL for GIF, JPG, and PNG; thumbnail URL for other types.</li> <li><code>%URL</code>: Full image URL.</li> <li><code>%TURL</code>: Thumbnail URL.</li> <li><code>%name</code>: Original file name.</li> <li><code>%board</code>: Current board.</li> <li><code>%MD5</code>: MD5 hash in base64.</li> <li><code>%sMD5</code>: MD5 hash in base64 using <code>-</code> and <code>_</code>.</li> <li><code>%hMD5</code>: MD5 hash in hexadecimal.</li> <li><code>%$0</code>: Matched regular expression within the filename.</li> <li><code>%$1</code>, <code>%$2</code>, <code>%$3</code>, ... : Subexpressions within the matched regular expression.</li> <li><code>%%</code>, <code>%semi</code>: Literal <code>%</code> and <code>;</code>.</li> </ul> <div>Lines starting with a <code>#</code> will be ignored.</div> <div>You can specify a display text by appending <code>;text:[text]</code> to the URL.</div> <div>You can specify the applicable boards/sites by appending <code>;boards:[board1],[board2]</code>. See the Filter guide for details.</div> <div>You can specify the applicable file types by appending <code>;types:[extension1],[extension2]</code>.</div> <div>You can specify a regular expression the filename must match by appending <code>;regexp:[regular expression]</code>.</div> </div> <textarea hidden name="sauces" class="field" spellcheck="false"></textarea>'
}),x(".warning",e).hidden=a.Sauce;const t=x("textarea",e);x.get("sauces",a.sauces,(function(e){t.value=e.sauces,t.hidden=!1})),x.on(t,"change",x.cb.value)},advanced(e){let t,o;for(var i of(x.extend(e,{
innerHTML:'<fieldset> <legend>Archives</legend> <div class="warning" data-feature="404 Redirect"><code>404 Redirect</code> is disabled.</div> <select id="archive-board-select"></select> <table id="archive-table"> <thead> <th>Thread redirection</th> <th>Thread fetching</th> <th>Post fetching</th> <th>File redirection</th> </thead> <tbody></tbody> </table> <br> <div> <b>Archive Lists</b>: Each line below should be an archive list in <a href="https://github.com/4chenz/archives.json/blob/gh-pages/CONTRIBUTING.md" target="_blank">this format</a> or a URL to load an archive list from.<br> Archive properties can be overriden by another item with the same <code>uid</code> (or if absent, its <code>name</code>). </div> <textarea hidden name="archiveLists" class="field" spellcheck="false"></textarea> <button id="update-archives">Update now</button> Last updated: <time id="lastarchivecheck"></time> <label><input type="checkbox" name="archiveAutoUpdate"> Auto-update</label> </fieldset>  <fieldset> <legend>External Catalog</legend> <div class="warning" data-feature="External Catalog"><code>External Catalog</code> is disabled. This will be used only as a fallback.</div> <div> URLs of external catalog sites, where <code>%board</code> is to be replaced by the board name.<br> Each URL should be followed by <code>;boards:</code> and optionally <code>;exclude:</code> and a list of supported/excluded boards in the format explained in the Filter guide. </div> <textarea hidden name="externalCatalogURLs" class="field" spellcheck="false"></textarea> </fieldset>  <fieldset> <legend>Override 4chan Image Host</legend> <div>Change 4chan image links to this domain. Leave blank for no change.</div> <div><input name="fourchanImageHost" class="field" spellcheck="false" list="list-fourchanImageHost"></div> <datalist id="list-fourchanImageHost"></datalist> </fieldset>  <fieldset> <legend>Captcha Language</legend> <div>Choose from <a href="https://developers.google.com/recaptcha/docs/language" target="_blank">list of language codes</a>. Leave blank to autoselect.</div> <div><input name="captchaLanguage" class="field" spellcheck="false"></div> </fieldset>  <fieldset> <legend>Custom Board Navigation</legend> <div><textarea hidden name="boardnav" class="field" spellcheck="false"></textarea></div> <span class="note">New lines will be converted into spaces.</span><br><br> <div class="note">In the following examples for /g/, <code>g</code> can be changed to a different board ID (<code>a</code>, <code>b</code>, etc...), the current board (<code>current</code>), or the Twitter link (<code>@</code>).</div> <div>Board link: <code>g</code></div> <div>Archive link: <code>g-archive</code></div> <div>Internal archive link: <code>g-expired</code></div> <div>Title link: <code>g-title</code></div> <div>Board link (Replace with title when on that board): <code>g-replace</code></div> <div>Full text link: <code>g-full</code></div> <div>Custom text link: <code>g-text:&quot;Install Gentoo&quot;</code></div> <div>Index-only link: <code>g-index</code></div> <div>Catalog-only link: <code>g-catalog</code></div> <div>Index mode: <code>g-mode:&quot;infinite scrolling&quot;</code></div> <div>Index sort: <code>g-sort:&quot;creation date rev&quot;</code></div> <div>External link: <code>external-text:&quot;Google&quot;,&quot;http://www.google.com&quot;</code></div> <div>Open in new tab: <code>g-nt</code></div> <div>Combinations are possible: <code>g-index-text:&quot;Technology Index&quot;</code></div> <div>Full board list toggle: <code>toggle-all</code></div> <br> <div class="note"> <code>[ toggle-all ] [current-title] [g-title / a-title / jp-title] [x / wsg / h] [t-text:&quot;Piracy&quot;]</code><br> will give you<br> <code>[ + ] [Technology] [Technology / Anime & Manga / Otaku Culture] [x / wsg / h] [Piracy]</code><br> if you are on /g/. </div> <div class="note"> For custom styling, you can wrap groups or individual links in <code>{{</code> and <code>}}</code>, to wrap them in a span. You can also add classes in double quotes right after the {{. For example: <br /> <code>[g-title] {{"favorites"[a-title / jp-title]}}</code><br /> Results in:<br /> <code>[&lt;a [...] &gt;Technology&lt;/a&gt;] &lt;span class="favorites"&gt;[&lt;a [...] &gt;Anime &amp;amp; Manga&lt;/a&gt; / &lt;a [...] &gt;Otaku Culture&lt;/a&gt;]&lt;/span&gt;</code> </div> </fieldset>  <fieldset> <legend> Time Formatting <span class="warning" data-feature="Time Formatting">is disabled, relative time setting still applies.</span> </legend> <div><input name="time" class="field" spellcheck="false">: <span class="time-preview"></span></div> <div>Supported <a href="http://man7.org/linux/man-pages/man1/date.1.html" target="_blank">format specifiers</a>:</div> <div>Day: <code>%a</code>, <code>%A</code>, <code>%d</code>, <code>%e</code></div> <div>Month: <code>%m</code>, <code>%b</code>, <code>%B</code>, <code>%n</code> (Not zero padded)</div> <div>Year: <code>%y</code>, <code>%Y</code></div> <div>Hour: <code>%k</code>, <code>%H</code>, <code>%l</code>, <code>%I</code>, <code>%p</code>, <code>%P</code></div> <div>Minute: <code>%M</code></div> <div>Second: <code>%S</code></div> <div>Literal <code>%</code>: <code>%%</code></div> <div><a href="https://www.w3.org/International/articles/language-tags/" target="_blank">Language tag</a>: <input name="timeLocale" class="field" spellcheck="false"></div> <div>Relative time, like "3 minutes ago": <select name="RelativeTime"> <option value="No">Disabled</option> <option value="Hover">Show when hovering on the date</option> <option value="Show">Show relative time, and time and date on hover</option> <option value="Both">Show both timestamp and relative date</option> <option value="BothRelativeFirst">Show both relative date and timestamp</option> </select> </div> </fieldset>  <fieldset> <legend>Quote Backlinks formatting <span class="warning" data-feature="Quote Backlinks">is disabled.</span></legend> <div><input name="backlink" class="field" spellcheck="false">: <span class="backlink-preview"></span></div> </fieldset>  <fieldset> <legend>Default pasted content filename</legend> <div><input name="pastedname" class="field" spellcheck="false">.png</div> </fieldset>  <fieldset> <legend>File Info Formatting <span class="warning" data-feature="File Info Formatting">is disabled.</span></legend> <div><input name="fileInfo" class="field" spellcheck="false">: <span class="file-info file-info-preview"></span></div> <div>Link: <code>%l</code> (truncated), <code>%L</code> (untruncated), <code>%T</code> (4chan filename)</div> <div>Filename: <code>%n</code> (truncated), <code>%N</code> (untruncated), <code>%t</code> (4chan filename)</div> <div>Download button: <code>%d</code></div> <div>Quick filter MD5: <code>%f</code></div> <div>Spoiler indicator: <code>%p</code></div> <div>Size: <code>%B</code> (Bytes), <code>%K</code> (KB), <code>%M</code> (MB), <code>%s</code> (4chan default)</div> <div>Resolution: <code>%r</code> (Displays &#039;PDF&#039; for PDF files)</div> <div>Tag: <code>%g</code> <div>Literal <code>%</code>: <code>%%</code></div> </fieldset>  <fieldset> <legend>Quick Reply Personas</legend> <textarea hidden class="personafield field" name="QR.personas" spellcheck="false"></textarea> <p> One item per line.<br> Items will be added in the relevant input&#039;s auto-completion list.<br> Password items will always be used, since there is no password input.<br> Lines starting with a <code>#</code> will be ignored. </p> <ul>You can use these settings with each item, separate them with semicolons: <li>Possible items are: <code>name</code>, <code>options</code> (or equivalently <code>email</code>), <code>subject</code> and <code>password</code>.</li> <li>Wrap values of items with quotes, like this: <code>options:&quot;sage&quot;</code>.</li> <li>Force values as defaults with the <code>always</code> keyword, for example: <code>options:&quot;sage&quot;;always</code>.</li> <li>Select specific boards for an item, separated with commas, for example: <code>options:&quot;sage&quot;;boards:jp;always</code>.</li> </ul> </fieldset>  <fieldset> <legend>Unread Favicon <span class="warning" data-feature="Unread Favicon">is disabled.</span></legend> <select name="favicon"> <option value="ferongr">ferongr</option> <option value="xat-">xat-</option> <option value="4chanJS">4chanJS</option> <option value="Mayhem">Mayhem</option> <option value="Original">Original</option> <option value="Metro">Metro</option> </select> <span class="favicon-preview"></span> </fieldset>  <fieldset> <legend>Thread Updater <span class="warning" data-feature="Thread Updater">is disabled.</span></legend> <div> Interval: <input type="number" name="Interval" class="field" min="1"> seconds </div> </fieldset>  <fieldset> <legend>Custom Cooldown Time</legend> <div> Seconds: <input type="number" name="customCooldown" class="field" min="0"> </div> </fieldset>  <fieldset> <legend> <label><input type="checkbox" name="Custom CSS"> Custom CSS</label> </legend> <div>For more information about customizing 4chan X&#039;s CSS, see the <a href="https://github.com/ccd0/4chan-x/wiki/Styling-Guide" target="_blank">styling guide</a>.</div> <button id="apply-css">Apply CSS</button> <textarea hidden name="usercss" class="field" spellcheck="false"></textarea> </fieldset>  <fieldset> <legend>Javascript Whitelist</legend> <div> Sources from which Javascript is allowed to be loaded by <a href="http://content-security-policy.com/#source_list" target="_blank">Content Security Policy</a>.<br> Lines starting with a <code>#</code> will be ignored. Remove or comment out all lines to allow everything. </div> <textarea hidden name="jsWhitelist" class="field" spellcheck="false"></textarea> </fieldset>  <fieldset> <legend>Known Banners</legend> <div>List of known banners, used for click-to-change feature.</div> <textarea hidden name="knownBanners" class="field" spellcheck="false"></textarea> </fieldset>  <fieldset> <legend>X (formerly Twitter) embeds</legend> <div>Only applies if embeds are enabled in the main settings</div> <label>Service to use for embeds <select name="XEmbedder"> <option value="fxt">FxTwitter</option> <option value="tf">Twitframe</option> </select> </label><br /> <label> Language to translate FxTwitter embeds to, as a two character ISO code, like <code>en</code>. Leave empty for no translation. <input name="fxtLang" maxlength="2" class="field" /> </label><br /> <label>FxTwitter endpoint <input name="fxtUrl" type="url" class="field" /></label><br /> <label>FxTwitter maximum amount of replies include <input name="fxtMaxReplies" type="number" min="0" step="1" max="100" class="field" /> </label> </fieldset>  <fieldset> <legend>Thread updater sound</legend> <label> Sound volume, between 0 and 1: <input name="beepVolume" type="number" min=".01" max="1" step=".01" class="field" /> </label><br /> <label> Sound url. Can be a base64 one starting with <code>data:</code>. Leave empty for the default beep. <input type="string" name="beepSource" class="field wide" /> </label> </fieldset>'
}),S(".warning",e)))i.hidden=a[i.dataset.feature];const s=p();for(t of S("[name]",e))s[t.name]=t;x.on(s.archiveLists,"change",(function(){x.set("lastarchivecheck",0),a.lastarchivecheck=0,x.id("lastarchivecheck").textContent="never"}));const n=p();for(o in s)if(t=s[o],!["Interval","Custom CSS","timeLocale"].includes(o)){n[o]=a[o];var r="SELECT"===t.nodeName||["checkbox","radio"].includes(t.type)||"TEXTAREA"===t.nodeName&&!(o in We)?"change":"input";x.on(t,r,x.cb["checkbox"===t.type?"checked":"value"]),o in We&&x.on(t,r,We[o])}x.get(n,(function(e){for(var o in e){var a=e[o];t=s[o],t["checkbox"===t.type?"checked":"value"]=a,t.hidden=!1,o in We&&We[o].call(t)}}));const l=x.id("list-fourchanImageHost");for(var d of T.suggestions)x.add(l,x.el("option",{textContent:d}));const c=s.Interval,h=s["Custom CSS"],u=x("#apply-css",e),g=s.timeLocale;c.value=a.Interval,h.checked=a["Custom CSS"],s.usercss.disabled=!a["Custom CSS"],u.disabled=!a["Custom CSS"],g.value=a.timeLocale,
x.on(c,"change",Ne.cb.interval),x.on(h,"change",We.togglecss),x.on(u,"click",(()=>N.update())),x.on(g,"change",We.setTimeLocale);const f=p();for(o of["archives","selectedArchives","lastarchivecheck"])f[o]=a[o];x.get(f,(function(t){x.extend(a,t),Xe.selectArchives(),We.addArchiveTable(e)}));const m=x("#archive-board-select",e),b=x("#archive-table",e),v=x("#update-archives",e);x.on(m,"change",(function(){x("tbody > :not([hidden])",b).hidden=!0,x(`tbody > .${this.value}`,b).hidden=!1})),x.on(v,"click",(()=>Xe.update((()=>We.addArchiveTable(e))))),x.on(s.beepVolume,"change",(()=>{Ne.playBeep(!1)})),x.on(s.beepSource,"change",(()=>{Ne.playBeep(!1)}))},addArchiveTable(e){let t,o;x("#lastarchivecheck",e).textContent=0===a.lastarchivecheck?"never":new Date(a.lastarchivecheck).toLocaleString();const s=x("#archive-board-select",e),n=x("#archive-table",e),r=x("tbody",e);x.rmAll(s),x.rmAll(r);const l=p()
;for(var{uid:d,name:c,boards:h,files:u,software:g}of a.archives)if(["fuuka","foolfuuka"].includes(g))for(t of h){o=l[t]||(l[t]={thread:[],threadJSON:[],post:[],file:[]}),o.threadJSON||(o.threadJSON=[]);var f=[d??c,c];o.thread.push(f),"foolfuuka"===g&&(o.post.push(f),o.threadJSON.push(f)),u.includes(t)&&o.file.push(f)}const m=[],b=[];for(t of Object.keys(l).sort()){var v=x.el("tr",{className:`board-${t}`});for(var A of(v.hidden=t!==i.BOARD.ID,b.push(x.el("option",{textContent:`/${t}/`,value:`board-${t}`,selected:t===i.BOARD.ID})),o=l[t],["thread","threadJSON","post","file"]))x.add(v,We.addArchiveCell(t,o,A));m.push(v)}if(0!==m.length)for(t in s.hidden=n.hidden=!1,i.BOARD.ID in l||(m[0].hidden=!1),x.add(s,b),x.add(r,m),a.selectedArchives){var w=a.selectedArchives[t];for(var y in w){var k,I=w[y];(k=x(`select[data-boardid='${t}'][data-type='${y}']`,r))&&(k.value=JSON.stringify(I),k.value||(k.value=k.firstChild.value))}}else s.hidden=n.hidden=!0},addArchiveCell(e,t,o){
const{length:a}=t[o],i=x.el("td",{className:"archive-cell"});if(!a)return i.textContent="--",i;const s=[];let n=0;for(;n<a;){var r=t[o][n++];s.push(x.el("option",{value:JSON.stringify(r[0]),textContent:r[1]}))}x.extend(i,{innerHTML:"<select></select>"});const l=i.firstElementChild;return(l.disabled=1===a)||(l.setAttribute("data-boardid",e),l.setAttribute("data-type",o),x.on(l,"change",We.saveSelectedArchive)),x.add(l,s),i},saveSelectedArchive(){x.get("selectedArchives",a.selectedArchives,(({selectedArchives:e})=>{(e[this.dataset.boardid]||(e[this.dataset.boardid]=p()))[this.dataset.type]=JSON.parse(this.value),x.set("selectedArchives",e),a.selectedArchives=e,Xe.selectArchives()}))},boardnav(){Ye.generateBoardList(this.value)},time(){this.nextElementSibling.textContent=Re.format(new Date,this.value)},timeLocale(){We.time.call(x("[name=time]",We.dialog))},backlink(){this.nextElementSibling.textContent=this.value.replace(/%(?:id|%)/g,(e=>({"%id":"123456789","%%":"%"}[e])))},fileInfo(){
const e={isReply:!0,file:{url:`//${T.host()}/g/1334437723720.jpg`,name:"d9bb2efc98dd0df141a94399ff5880b7.jpg",size:"276 KB",sizeInBytes:282624,dimensions:"1280x720",isImage:!0,isVideo:!1,isSpoiler:!0,tag:"Loop"}};ze.format(this.value,e,this.nextElementSibling)},favicon(){F.switch(),"thread"===i.VIEW&&a["Unread Favicon"]&&fe.update();const e=this.nextElementSibling.children,t=F,o=[t.SFW,t.unreadSFW,t.unreadSFWY,t.NSFW,t.unreadNSFW,t.unreadNSFWY,t.dead,t.unreadDead,t.unreadDeadY];for(let t=0;t<o.length;t++){var s=o[t];e[t]||x.add(this.nextElementSibling,x.el("img")),e[t].src=s}},togglecss(){(x("textarea[name=usercss]",x.x("ancestor::fieldset[1]",this)).disabled=x.id("apply-css").disabled=!this.checked)?N.rmStyle():N.addStyle(),x.cb.checked.call(this)},setTimeLocale(e){const t=e.target;try{""!==t.value&&new Intl.DateTimeFormat(t.value),t.setCustomValidity(""),Re.formatterCache.clear(),x.cb.value.call(t),We.timeLocale.call(t)}catch(e){t.setCustomValidity("Locale not recognized"),
t.reportValidity()}},keybinds(e){let t;x.extend(e,{innerHTML:'<div class="warning"><code>Keybinds</code> are disabled.</div> <div>Allowed keys: <kbd>a-z</kbd>, <kbd>0-9</kbd>, <kbd>Ctrl</kbd>, <kbd>Shift</kbd>, <kbd>Alt</kbd>, <kbd>Meta</kbd>, <kbd>Enter</kbd>, <kbd>Esc</kbd>, <kbd>Up</kbd>, <kbd>Down</kbd>, <kbd>Right</kbd>, <kbd>Left</kbd>.</div> <div>Press <kbd>Backspace</kbd> to disable a keybind.</div> <table><tbody> <tr><th>Actions</th><th>Keybinds</th></tr> </tbody></table>'}),x(".warning",e).hidden=a.Keybinds;const o=x("tbody",e),i=p(),s=p();for(t in h.hotkeys){var n=h.hotkeys[t],r=x.el("tr",{innerHTML:`<td>${n[1]}</td><td><input class="field"></td>`}),l=x("input",r);l.name=t,l.spellcheck=!1,i[t]=a[t],s[t]=l,x.on(l,"keydown",We.keybind),x.add(o,r)}x.get(i,(function(e){for(t in e){var o=e[t];s[t].value=o}}))},keybind(e){let t;9!==e.keyCode&&(e.preventDefault(),e.stopPropagation(),(t=Le.keyCode(e))&&(this.value=t,x.cb.value.call(this)))}},Je={filters:new Map,init(){
if(["index","thread","catalog"].includes(i.VIEW)&&a.Filter&&("catalog"!==i.VIEW||a["Filter in Native Catalog"])){for(var e in a["Filtered Backlinks"]||x.addClass(r,"hide-backlinks"),h.filter)for(var t of a[e].split("\n")){let i,s,n,r,l=!0,d=0,c=!1,h=!1,u=!1,p=!1,g=!1,f=a.Stubs;if("#"===t[0])continue;const m=t.match(/\/(.*)\/(\w*)/);if(!m)continue;if("uniqueID"===e||"MD5"===e)s=m[1];else try{s=RegExp(m[1],m[2])}catch(o){new Ke("warning",[x.tn(`Invalid ${e} filter:`),x.el("br"),x.tn(t),x.el("br"),x.tn(o.message)],60);continue}const b=t.length>m[0].length?t.replace(m[0],""):"";if(b){c=this.parseBoards(b.match(/(?:^|;)\s*boards:([^;]+)/)?.[1]),h=this.parseBoards(b.match(/(?:^|;)\s*exclude:([^;]+)/)?.[1]);const e=b.match(/(?:^|;)\s*op:(no|only)/)?.[1]||"";d=x.getOwn({no:1,only:2},e)||0;const t=b.match(/(?:^|;)\s*file:(no|only)/)?.[1]||"";d|=x.getOwn({no:4,only:8},t)||0,f=(()=>{switch(b.match(/(?:^|;)\s*stub:(yes|no)/)?.[1]){case"yes":return!0;case"no":return!1;default:return a.Stubs}})(),
g=/(?:^|;)\s*notify/.test(b);const o=b.match(/(?:^|;)\s*highlight(?::([\w-]+))?/);o&&(i=o[1]||"filter-highlight",n="yes"===(b.match(/(?:^|;)\s*top:(yes|no)/)?.[1]||"yes"),l=/(?:^|;)\s*hide(?:[;:]|$)/.test(b)),l=l||!(i||g),r=b.match(/(?:^|;)\s*reason:([^;$]+)/)?.[1],u=/(?:^|;)\s*poster(?:[;:]|$)/.test(b),p=/(?:^|;)\s*replies(?:[;:]|$)/.test(b)}const v={regexp:s,boards:c,excludes:h,mask:d,hide:l,stub:f,hl:i,top:n,noti:g,reason:r,poster:u,replies:p};if("general"===e){const e=b.match(/(?:^|;)\s*type:([^;]*)/)?.[1].split(",")||["subject","name","filename","comment"];for(var o of e)this.filters.get(o)?.push(v)??this.filters.set(o,[v])}else this.filters.get(e)?.push(v)??this.filters.set(e,[v])}if(this.filters.size){for(const e of["MD5","uniqueID"]){const t=this.filters.get(e);if(!t)continue;const o=new Map;for(const e of t)o.get(e.regexp)?.push(e)??o.set(e.regexp,[e]);this.filters.set(e,o)}return"catalog"===i.VIEW?Je.catalog():c.Post.push({name:"Filter",cb:this.node})}}},parseBoards(e){let t
;if(!e)return!1;if(t=Je.parseBoardsMemo[e])return t;t=p();let o="";for(var a of e.split(","))for(var s in a.includes(":")&&([o,a]=a.split(":").slice(-2)),i.sites){var n=i.sites[s];if(s.slice(0,o.length)===o)if(["nsfw","sfw"].includes(a))for(var r of n.sfwBoards?.("sfw"===a)||[])t[`${s}/${r}`]=!0;else t[`${s}/${encodeURIComponent(a)}`]=!0}return Je.parseBoardsMemo[e]=t,t},parseBoardsMemo:p(),test(e,t=!0){if(e.filterResults)return e.filterResults;let o,a,i=!1,s=!0,n=!1,r=!1,l=!1,d=!1;pe.isYou(e)&&(t=!1);let c=e.isReply?2:1;c|=e.file?4:8;const h=`${e.siteID}/${e.boardID}`,u=`${e.siteID}/*`;for(const p of Je.filters.keys())for(const g of Je.values(p,e)){const e=Je.filters.get(p),f=Array.isArray(e)?e:e.get(g);if(!f)continue;const m="uniqueID"===p||"MD5"===p;for(const e of f)e.boards&&!e.boards[h]&&!e.boards[u]||e.excludes&&(e.excludes[h]||e.excludes[u])||e.mask&c||!(m?e.regexp===g:e.regexp.test(g))||(e.hide&&t&&(i=!0,s&&(({stub:s}=e),
(a||(a=[])).push(e.reason||`Filtered ${p} ${e.regexp}`))),e.hl&&!o?.includes(e.hl)&&(o||(o=[])).push(e.hl),n||({top:n}=e),e.noti&&(r=!0),e.poster&&(l=!0),e.replies&&(d=!0))}return e.filterResults={hide:i,stub:s,hl:o,top:n,noti:r,poster:l,replies:d,reasons:a},e.filterResults},node(){if(this.isClone||!this.isReply&&!this.thread.nodes.root)return;const{hide:e,stub:t,hl:o,noti:s,poster:n,replies:r}=Je.test(this,!this.isFetchedQuote&&(this.isReply||"index"===i.VIEW));let l;if(n&&this.info.uniqueID){l=`Hidden because it's the same poster as ${this.ID} (${this.filterResults.reasons})`;const{uniqueID:a}=this.info,i={regexp:a,boards:!1,excludes:!1,mask:0,hide:e,stub:t,replies:r,hl:o?.[0],reason:l},s=Je.filters.get("uniqueID");s?s.get(a)?.push(i)??s.set(a,[i]):Je.filters.set("uniqueID",(new Map).set(a,[i]))}if(e&&(this.isReply?(le.hide(this,t),r&&re.applyAndAdd(le.hide,this,t,void 0,`Hidden recursively from ${this.ID}`),n&&this.info.uniqueID&&i.posts.forEach((e=>{
e.info.uniqueID===this.info.uniqueID&&e!==this&&(le.hide(e,t,r,l),r&&re.applyAndAdd(le.hide,e,t,void 0,`Hidden recursively from ${e.ID}`))}))):Ce.hide(this.thread,t)),o&&(this.highlights=o,x.addClass(this.nodes.root,...o),this.isReply)){const e=(e,...t)=>{x.addClass(e.nodes.root,...t)};r&&re.applyAndAdd(e,this,...o),n&&this.info.uniqueID&&i.posts.forEach((t=>{t.info.uniqueID===this.info.uniqueID&&t!==this&&(x.addClass(t.nodes.root,...o),r&&re.applyAndAdd(e,t,...o))}))}s&&fe.posts&&this.ID>fe.lastReadPost&&!pe.isYou(this)&&fe.openNotification(this," triggered a notification filter"),this.file?.thumbLink&&x.on(this.file.thumbLink,"click",(e=>{e.shiftKey&&a["MD5 Quick Filter in Threads"]&&(Je.quickFilterMD5.call(this),e.preventDefault(),e.stopImmediatePropagation())}))},catalog(){let e;if(e=i.SITE.urls.catalogJSON?.(i.BOARD))return Je.catalogData=p(),x.ajax(e,{onloadend:Je.catalogParse}),c.CatalogThreadNative.push({name:"Filter",cb:this.catalogNode})},catalogParse(){
if([200,404].includes(this.status)){for(var e of this.response)for(var t of e.threads)Je.catalogData[t.no]=t;i.BOARD.threads.forEach((function(e){if(e.catalogViewNative)return Je.catalogNode.call(e.catalogViewNative)}))}else new Ke("warning","Failed to fetch catalog JSON data. "+(this.status?`Error ${this.statusText} (${this.status})`:"Connection Error"),1)},catalogNode(){if(this.boardID!==i.BOARD.ID||!Je.catalogData[this.ID])return;if(pe.db?.get({siteID:i.SITE.ID,boardID:this.boardID,threadID:this.ID,postID:this.ID}))return;const{hide:e,hl:t,top:o}=Je.test(i.SITE.Build.parseJSON(Je.catalogData[this.ID],this));e&&(this.nodes.root.hidden=!0),t&&(this.highlights=t,x.addClass(this.nodes.root,...t)),o&&(x.prepend(this.nodes.root.parentNode,this.nodes.root),i.SITE.catalogPin?.(this.nodes.root))},isHidden:e=>!!Je.test(e).hide,valueF:{postID:e=>[`${e.ID}`],name:e=>void 0===e.info.name?[]:[e.info.name],uniqueID:e=>[e.info.uniqueID||""],tripcode:e=>void 0===e.info.tripcode?[]:[e.info.tripcode],
capcode:e=>void 0===e.info.capcode?[]:[e.info.capcode],pass:e=>[e.info.pass],email:e=>[e.info.email],subject:e=>[e.info.subject||(e.isReply?void 0:"")],comment:e=>(null==e.info.comment&&(e.info.comment=i.sites[e.siteID]?.Build?.parseComment?.(e.info.commentHTML.innerHTML)),[e.info.comment]),flag:e=>void 0===e.info.flag?[]:[e.info.flag],filename:e=>e.files.map((e=>e.name)),dimensions:e=>e.files.map((e=>e.dimensions)),filesize:e=>e.files.map((e=>e.size)),MD5:e=>e.files.map((e=>e.MD5))},values:(e,t)=>x.hasOwn(Je.valueF,e)?Je.valueF[e](t).filter((e=>null!=e)):[e.split("+").map((function(e){let o;return(o=x.getOwn(Je.valueF,e))?o(t).map((e=>e||"")).join("\n"):""})).join("\n")],addFilter(e,t,o){if(x.hasOwn(h.filter,e))return x.get(e,a[e],(function(a){let i=a[e];return i=i?`${i}\n${t}`:t,x.set(e,i,o)}))},removeFilters:(e,t,o)=>x.get(e,a[e],(function(a){let i=a[e];const s=(Array.isArray(t)?t:[...t.values()].flat()).map(Je.escape).join("|")
;return i=i.replace(RegExp(`(?:$\n|^)(?:${s})$`,"mg"),""),x.set(e,i,o)})),showFilters(e){We.open("Filter");const t=x(".section-container"),o=x("select[name=filter]",t);return o.value=e,We.selectFilter.call(o),x.onExists(t,"textarea",(function(e){const t=e.textLength;return e.setSelectionRange(t,t),e.focus()}))},quickFilterMD5(){const e=this instanceof ae?this:w.postFromNode(this),t=e.files.filter((e=>e.MD5));if(!t.length)return;const o=t.map((e=>`/${e.MD5}/`)).join("\n");Je.addFilter("MD5",o);const s=e.origin||e;if(s.isReply?le.hide(s,void 0,void 0,t.map((e=>`Filtered MD5 ${e.MD5}`)).join(" & ")):"index"===i.VIEW&&Ce.hide(s.thread),!a["MD5 Quick Filter Notifications"])return void(e.nodes.post.getBoundingClientRect().height&&new Ke("info","MD5 filtered.",2));let{notice:n}=Je.quickFilterMD5;if(n)n.filters.push(o),n.posts.push(s),x("span",n.el).textContent=`${n.filters.length} MD5s filtered.`,n.resetTimer();else{const e=x.el("div",{
innerHTML:'<span>MD5 filtered.</span> [<a href="javascript:;">show</a>] [<a href="javascript:;">undo</a>]'});n=Je.quickFilterMD5.notice=new Ke("info",e,10,(()=>delete Je.quickFilterMD5.notice)),n.filters=[o],n.posts=[s];const t=S("a",e);x.on(t[0],"click",Je.quickFilterCB.show.bind(n)),x.on(t[1],"click",Je.quickFilterCB.undo.bind(n))}},quickFilterCB:{show(){return Je.showFilters("MD5"),this.close()},undo(){for(var e of(Je.removeFilters("MD5",this.filters),this.posts))e.isReply?le.show(e):"index"===i.VIEW&&Ce.show(e.thread);return this.close()}},escape:e=>e.replace(/\/|\\|\^|\$|\n|\.|\(|\)|\{|\}|\[|\]|\?|\*|\+|\|/g,(e=>"\n"===e?"\\n":`\\${e}`)),menu:{init(){if(!["index","thread"].includes(i.VIEW)||!a.Menu||!a.Filter)return;const e={el:x.el("div",{textContent:"Filter"}),order:50,open:e=>(Je.menu.post=e,!0),subEntries:[]}
;for(var t of[["Name","name"],["Unique ID","uniqueID"],["Tripcode","tripcode"],["Capcode","capcode"],["Pass Date","pass"],["Email","email"],["Subject","subject"],["Comment","comment"],["Flag","flag"],["Filename","filename"],["Image dimensions","dimensions"],["Filesize","filesize"],["Image MD5","MD5"]])e.subEntries.push(Je.menu.createSubEntry(t[0],t[1]));return ne.menu.addEntry(e)},createSubEntry(e,t){const o=x.el("a",{href:"javascript:;",textContent:e});return o.dataset.type=t,x.on(o,"click",Je.menu.makeFilter),{el:o,open:e=>Je.values(t,e).length}},makeFilter(){const{type:e}=this.dataset,t=Je.values(e,Je.menu.post).map((t=>["uniqueID","MD5"].includes(e)?`/${t}/`:`/^${Je.escape(t)}$/`)).join("\n");return Je.addFilter(e,t,(()=>Je.showFilters(e)))}}},Ge={defaultProperties:{"4chan.org":{software:"yotsuba"},"4channel.org":{canonical:"4chan.org"},"4cdn.org":{canonical:"4chan.org"},"notso.smuglo.li":{canonical:"smuglo.li"},"smugloli.net":{canonical:"smuglo.li"},"smug.nepu.moe":{
canonical:"smuglo.li"}},init(e){x.extend(a.siteProperties,Ge.defaultProperties);let t=Ge.resolve();t&&x.hasOwn(Qe,a.siteProperties[t].software)&&(this.set(t),e()),x.onExists(r,"body",(()=>{for(var o in Qe){var s;if(s=Qe[o].detect?.()){s.software=o,t=location.hostname.replace(/^www\./,"");var n=a.siteProperties[t]||(a.siteProperties[t]=p()),r=0;for(var l in s)n[l]!==s[l]&&(n[l]=s[l],r++);return r&&x.set("siteProperties",a.siteProperties),void(i.SITE||(this.set(t),e()))}}}))},resolve(e=location){let{hostname:t}=e;for(;t&&!x.hasOwn(a.siteProperties,t);)t=t.replace(/^[^.]*\.?/,"");if(t){let e;(e=a.siteProperties[t].canonical)&&(t=e)}return t},parseURL(e){const t=Ge.resolve(e);return Pt.parseURL(i.sites[t],e)},set(e){for(var t in a.siteProperties){var o,s=a.siteProperties[t];if(!s.canonical){var{software:n}=s;n&&x.hasOwn(Qe,n)&&(i.sites[t]=o=Object.create(Qe[n]),x.extend(o,{ID:t,siteID:t,properties:s,software:n}))}}return i.SITE=i.sites[e]}},_e={init(){
if("yotsuba"===i.SITE.software&&(a["External Catalog"]||a["JSON Index"])&&(!a["JSON Index"]||"index"!==i.VIEW)){const e=(()=>{switch(i.VIEW){case"thread":case"archive":return".navLinks.desktop > a";case"catalog":return".navLinks > :first-child > a";case"index":return"#ctrl-top > a, .cataloglink > a"}})();x.ready((function(){for(var t of S(e)){var s;switch(t.pathname.replace(/\/+/g,"/")){case`/${i.BOARD}/`:a["JSON Index"]&&(t.textContent="Index"),t.href=_e.index();break;case`/${i.BOARD}/catalog`:t.href=_e.catalog()}if("catalog"===i.VIEW&&(s=_e.catalog())!==i.SITE.urls.catalog?.(i.BOARD)){var n=t.parentNode.cloneNode(!0),r=n.firstElementChild;r.href=s,r.textContent=r.hostname===location.hostname?`${o.name} Catalog`:"External Catalog",x.after(t.parentNode,[x.tn(" "),n])}}}))}if("yotsuba"===i.SITE.software&&a["JSON Index"]&&a[`Use ${o.name} Catalog`]&&c.Post.push({name:"Catalog Link Rewrite",cb:this.node}),this.enabled=a["Catalog Links"]){let e
;_e.el=e=X.checkbox("Header catalog links","Catalog Links"),e.id="toggleCatalog";const t=x("input",e);return x.on(t,"change",this.toggle),x.sync("Header catalog links",_e.set),Ye.menu.addEntry({el:e,order:95})}},node(){for(var e of S("a",this.nodes.comment)){var t;(t=e.href.match(/^https?:\/\/(boards\.4chan(?:nel)?\.org\/[^\/]+)\/catalog(#s=.*)?/))&&(e.href=`//${t[1]}/${t[2]||"#catalog"}`)}},toggle(){return x.event("CloseMenu"),x.set("Header catalog links",this.checked),_e.set(this.checked)},set:e=>(a["Header catalog links"]=e,_e.setLinks(Ye.boardList),_e.setLinks(Ye.bottomBoardList),_e.el.title=`Turn catalog links ${e?"off":"on"}.`,x("input",_e.el).checked=e),setLinks(e){if(!(_e.enabled??a["Catalog Links"])||!e)return;const t=/(?:index)?(?:\.\w+)?$/;for(var o of S("a:not([data-only])",e)){var{siteID:i,boardID:s}=o.dataset;if(!i||!s){var n;if(({siteID:i,boardID:s,VIEW:n}=Ge.parseURL(o)),!i||!s||!["index","catalog"].includes(n)||!o.dataset.indexOptions&&o.href.replace(t,"")!==(w.url(n,{
siteID:i,boardID:s})||"").replace(t,""))continue;x.extend(o.dataset,{siteID:i,boardID:s})}var r={siteID:i,boardID:s},l=a["Header catalog links"]?_e.catalog(r):w.url("index",r);l&&(o.href=l,o.dataset.indexOptions&&l.split("#")[0]===w.url("index",r)&&(o.href+=(o.hash?"/":"#")+o.dataset.indexOptions))}},externalParse(){for(var e of(_e.externalList=p(),a.externalCatalogURLs.split("\n")))if("#"!==e[0]){var t=e.split(";")[0],o=Je.parseBoards(e.match(/;boards:([^;]+)/)?.[1]||"*"),i=Je.parseBoards(e.match(/;exclude:([^;]+)/)?.[1])||p();for(var s in o)i[s]||i[s.split("/")[0]+"/*"]||(_e.externalList[s]=t)}},external({siteID:e,boardID:t}){_e.externalList||_e.externalParse();const o=_e.externalList[`${e}/${t}`]||_e.externalList[`${e}/*`];return o?o.replace(/%board/g,t):void 0},jsonIndex:(e,t)=>i.SITE.ID===e.siteID&&i.BOARD.ID===e.boardID&&"index"===i.VIEW?t:w.url("index",e)+t,catalog(e=i.BOARD){let t,s
;return a["External Catalog"]&&(t=_e.external(e))?t:Ie.enabledOn(e)&&a[`Use ${o.name} Catalog`]?_e.jsonIndex(e,"#catalog"):(s=w.url("catalog",e))?s:_e.external(e)},index:(e=i.BOARD)=>Ie.enabledOn(e)?_e.jsonIndex(e,"#index"):w.url("index",e)},Ye={init(){x.onExists(r,"body",(()=>{if(Pt.isThisPageLegit())return x.add(this.bar,[this.noticesRoot,this.toggle]),x.prepend(n.body,this.bar),x.add(n.body,Ye.hover),this.setBarPosition(a["Bottom Header"])})),this.menu=new X.Menu("header");const e=x.el("span",{className:"menu-button"});x.extend(e,{innerHTML:"<i></i>"});const t=X.checkbox,o=t("Fixed Header","Fixed Header"),s=t("Header auto-hide","Auto-hide header"),l=t("Header auto-hide on scroll","Auto-hide header on scroll"),d=t("Bottom Header","Bottom header"),c=t("Centered links","Centered links"),h=t("Custom Board Navigation","Custom board navigation"),u=t("Bottom Board List","Hide bottom board list"),p=t("Shortcut Icons","Shortcut Icons"),g=x.el("a",{textContent:"Edit custom board navigation",
href:"javascript:;"});if(this.barFixedToggler=o.firstElementChild,this.scrollHeaderToggler=l.firstElementChild,this.barPositionToggler=d.firstElementChild,this.linkJustifyToggler=c.firstElementChild,this.headerToggler=s.firstElementChild,this.footerToggler=u.firstElementChild,this.shortcutToggler=p.firstElementChild,this.customNavToggler=h.firstElementChild,x.on(e,"click",this.menuToggle),x.on(this.headerToggler,"change",this.toggleBarVisibility),x.on(this.barFixedToggler,"change",this.toggleBarFixed),x.on(this.barPositionToggler,"change",this.toggleBarPosition),x.on(this.scrollHeaderToggler,"change",this.toggleHideBarOnScroll),x.on(this.linkJustifyToggler,"change",this.toggleLinkJustify),x.on(this.footerToggler,"change",this.toggleFooterVisibility),x.on(this.shortcutToggler,"change",this.toggleShortcutIcons),x.on(this.customNavToggler,"change",this.toggleCustomNav),x.on(g,"click",this.editCustomNav),this.setBarFixed(a["Fixed Header"]),
this.setHideBarOnScroll(a["Header auto-hide on scroll"]),this.setBarVisibility(a["Header auto-hide"]),this.setLinkJustify(a["Centered links"]),this.setShortcutIcons(a["Shortcut Icons"]),this.setFooterVisibility(a["Bottom Board List"]),x.sync("Fixed Header",this.setBarFixed),x.sync("Header auto-hide on scroll",this.setHideBarOnScroll),x.sync("Bottom Header",this.setBarPosition),x.sync("Shortcut Icons",this.setShortcutIcons),x.sync("Header auto-hide",this.setBarVisibility),x.sync("Centered links",this.setLinkJustify),x.sync("Bottom Board List",this.setFooterVisibility),this.addShortcut("menu",e,900),this.menu.addEntry({el:x.el("span",{textContent:"Header"}),order:107,subEntries:[{el:o},{el:s},{el:l},{el:d},{el:c},{el:u},{el:p},{el:h},{el:g}]}),x.on(n,"CreateNotification",this.createNotification),this.setBoardList(),x.onExists(r,`${i.SITE.selectors.boardList} + *`,Ye.generateFullBoardList),Pt.ready((function(){let e;if("yotsuba"===i.SITE.software&&!(e=x.id("boardNavDesktopFoot"))){let t
;if(!(t=x.id("absbot")))return;e=x.id("boardNavDesktop").cloneNode(!0),e.id="boardNavDesktopFoot",x("#navtopright",e).id="navbotright",x("#settingsWindowLink",e).id="settingsWindowLinkBot",x.before(t,e),x.global("stubCloneTopNav")}if(Ye.bottomBoardList=x(i.SITE.selectors.boardListBottom)){for(var t of S("a",Ye.bottomBoardList))t.hostname===location.hostname&&t.pathname.split("/")[1]===i.BOARD.ID&&(t.className="current");return _e.setLinks(Ye.bottomBoardList)}})),"yotsuba"===i.SITE.software&&("catalog"===i.VIEW||!a["Disable Native Extension"])){const e=x.el("a",{href:"javascript:;"});"catalog"===i.VIEW?(e.title=e.textContent="Catalog Settings",M.set(e,"bookOpen","Catalog Settings"),this.addShortcut("native",e,810)):(e.title=e.textContent="4chan Settings",e.className="native-settings",this.addShortcut("native",e,810)),x.on(e,"click",(()=>x.id("settingsWindowLink").click()))}return this.enableDesktopNotifications()},bar:x.el("div",{id:"header-bar"}),noticesRoot:x.el("div",{
id:"notifications"}),shortcuts:x.el("span",{id:"shortcuts"}),hover:x.el("div",{id:"hoverUI"}),toggle:x.el("div",{id:"scroll-marker"}),setBoardList(){let e;Ye.boardList=e=x.el("span",{id:"board-list"}),x.extend(e,{innerHTML:'<span id="custom-board-list"></span><span id="full-board-list" hidden><span class="hide-board-list-container brackets-wrap"><a href="javascript:;" class="hide-board-list-button">&nbsp;-&nbsp;</a></span> <span class="boardList"></span></span>'});const t=x(".hide-board-list-button",e);return x.on(t,"click",Ye.toggleBoardList),x.prepend(Ye.bar,[Ye.boardList,Ye.shortcuts]),Ye.setCustomNav(a["Custom Board Navigation"]),Ye.generateBoardList(a.boardnav),x.sync("Custom Board Navigation",Ye.setCustomNav),x.sync("boardnav",Ye.generateBoardList)},generateFullBoardList(){let e;e=i.SITE.transformBoardList?i.SITE.transformBoardList():[...x(i.SITE.selectors.boardList).cloneNode(!0).childNodes];const t=x(".boardList",Ye.boardList);for(var o of(x.add(t,e),
S("a",t)))o.hostname===location.hostname&&o.pathname.split("/")[1]===i.BOARD.ID&&(o.className="current");return _e.setLinks(t)},generateBoardList(e){const t=x("#custom-board-list",Ye.boardList);if(x.rmAll(t),!e)return;const o=(e=e.replace(/(\r\n|\n|\r)/g," ")).split(/(\{\{(?:"[^"]+")?|\}\})/),a=[];let i=t;return o.forEach((e=>{if(e.startsWith("{{")){const t=x.el("span");x.add(i,t),a.push(t),i=t,e.length>2&&(t.className=e.slice(3,-1))}else if("}}"===e)a.pop(),i=a.length>0?a[a.length-1]:t;else{const t=/[\w@]+(-(all|title|replace|full|index|catalog|archive|expired|nt|(mode|sort|text):"[^"]+"(,"[^"]+")?))*|[^\w@]+/g;(e.match(t)||[]).map((e=>Ye.mapCustomNavigation(e))).forEach((e=>i.appendChild(e)))}})),_e.setLinks(t)},mapCustomNavigation(e){let t,o,s,n;if(/^[^\w@]/.test(e))return x.tn(e);let r=n=null;e=e.replace(/-text:"([^"]+)"(?:,"([^"]+)")?/g,(function(e,t,o){return r=t,n=o,""}));let l=[];if(e=e.replace(/-(?:mode|sort):"([^"]+)"/g,(function(e,t){
return l.push(t.toLowerCase().replace(/\ /g,"-")),""})),l=l.join("/"),/^toggle-all/.test(e))return t=x.el("a",{className:"show-board-list-button",textContent:r||"+",href:"javascript:;"}),x.on(t,"click",Ye.toggleBoardList),t;if(/^external/.test(e))return t=x.el("a",{href:n||"javascript:;",textContent:r||"+",className:"external"}),/-nt/.test(e)&&(t.target="_blank",t.rel="noopener"),t;let d=e.split("-")[0];if("current"===d){if(!["boards.4chan.org","boards.4channel.org"].includes(location.hostname))return t=x.el("a",{href:`/${i.BOARD.ID}/`,textContent:r||decodeURIComponent(i.BOARD.ID),className:"current"}),/-nt/.test(e)&&(t.target="_blank",t.rel="noopener"),/-index/.test(e)?t.dataset.only="index":/-catalog/.test(e)?(t.dataset.only="catalog",t.href+="catalog.html"):/-(archive|expired)/.test(e)&&(t=t.firstChild),t;d=i.BOARD.ID}if(t=function(){let e;return"@"===d?x.el("a",{href:"https://twitter.com/4chan",title:"4chan Twitter",className:"navSmall",textContent:"@"}):(t=x.el("a",{
href:`//${se.domain(d)}/${d}/`,textContent:d,title:se.title(d)}),["catalog","archive"].includes(i.VIEW)&&(e=w.url(i.VIEW,{siteID:"4chan.org",boardID:d}))&&(t.href=e),t.hostname===location.hostname&&d===i.BOARD.ID&&(t.className="current"),t)}(),t.textContent=/-title/.test(e)||/-replace/.test(e)&&t.hostname===location.hostname&&d===i.BOARD.ID?t.title||t.textContent:/-full/.test(e)?`/${d}/`+(t.title?` - ${t.title}`:""):r||d,s=e.match(/-(index|catalog)/)){const e=_e[s[1]]({siteID:"4chan.org",boardID:d});if(!e)return t.firstChild;t.dataset.only=s[1],t.href=e,"catalog"===s[1]&&x.addClass(t,"catalog")}if(a["JSON Index"]&&l&&(t.dataset.indexOptions=l,["boards.4chan.org","boards.4channel.org"].includes(t.hostname)&&""===t.pathname.split("/")[2]&&(t.href+=(t.hash?"/":"#")+l)),/-archive/.test(e)){if(!(o=Xe.to("board",{boardID:d})))return t.firstChild;t.href=o}if(/-expired/.test(e)){if(!se.isArchived(d))return t.firstChild;t.href=`//${se.domain(d)}/${d}/archive`}
return/-nt/.test(e)&&(t.target="_blank",t.rel="noopener"),t},toggleBoardList(){const{bar:e}=Ye,t=x("#custom-board-list",e),o=x("#full-board-list",e),a=!o.hidden;return t.hidden=!a,o.hidden=a},setLinkJustify:e=>(Ye.linkJustifyToggler.checked=e,e?x.addClass(r,"centered-links"):x.rmClass(r,"centered-links")),toggleLinkJustify(){x.event("CloseMenu");const e="INPUT"===this.nodeName?this.checked:void 0;return Ye.setLinkJustify(e),x.set("Centered links",e)},setBarFixed:e=>(Ye.barFixedToggler.checked=e,e?(x.addClass(r,"fixed"),x.addClass(Ye.bar,"dialog")):(x.rmClass(r,"fixed"),x.rmClass(Ye.bar,"dialog"))),toggleBarFixed(){return x.event("CloseMenu"),Ye.setBarFixed(this.checked),a["Fixed Header"]=this.checked,x.set("Fixed Header",this.checked)},setShortcutIcons:e=>(Ye.shortcutToggler.checked=e,e?x.addClass(r,"shortcut-icons"):x.rmClass(r,"shortcut-icons")),toggleShortcutIcons(){return x.event("CloseMenu"),Ye.setShortcutIcons(this.checked),a["Shortcut Icons"]=this.checked,
x.set("Shortcut Icons",this.checked)},setBarVisibility:e=>(Ye.headerToggler.checked=e,x.event("CloseMenu"),(e?x.addClass:x.rmClass)(Ye.bar,"autohide"),(e?x.addClass:x.rmClass)(r,"autohide")),toggleBarVisibility(){const e="INPUT"===this.nodeName?this.checked:!x.hasClass(Ye.bar,"autohide");a["Header auto-hide"]=e,x.set("Header auto-hide",e),Ye.setBarVisibility(e);return new Ke("info","The header bar will "+(e?"automatically hide itself.":"remain visible."),2)},setHideBarOnScroll(e){if(Ye.scrollHeaderToggler.checked=e,!e)return x.off(window,"scroll",Ye.hideBarOnScroll),x.rmClass(Ye.bar,"scroll"),Ye.bar.classList.toggle("autohide",a["Header auto-hide"]);x.on(window,"scroll",Ye.hideBarOnScroll)},toggleHideBarOnScroll(){const e=this.checked;return x.cb.checked.call(this),Ye.setHideBarOnScroll(e)},hideBarOnScroll(){const e=window.pageYOffset;return e>(Ye.previousOffset||0)?x.addClass(Ye.bar,"autohide","scroll"):x.rmClass(Ye.bar,"autohide","scroll"),Ye.previousOffset=e},setBarPosition(e){
Ye.barPositionToggler&&(Ye.barPositionToggler.checked=e),x.event("CloseMenu");const t=e?["bottom-header","top-header","after"]:["top-header","bottom-header","add"];return x.addClass(r,t[0]),x.rmClass(r,t[1]),x[t[2]](Ye.bar,Ye.noticesRoot)},toggleBarPosition(){return x.cb.checked.call(this),Ye.setBarPosition(this.checked)},setFooterVisibility:e=>(Ye.footerToggler.checked=e,r.classList.toggle("hide-bottom-board-list",e)),toggleFooterVisibility(){x.event("CloseMenu");const e="INPUT"===this.nodeName?this.checked:x.hasClass(r,"hide-bottom-board-list");Ye.setFooterVisibility(e),x.set("Bottom Board List",e);return new Ke("info",e?"The bottom navigation will now be hidden.":"The bottom navigation will remain visible.",2)},setCustomNav(e){Ye.customNavToggler.checked=e;const t=x("#custom-board-list",Ye.bar),o=x("#full-board-list",Ye.bar),a=x(".hide-board-list-container",o);return[t.hidden,o.hidden,a.hidden]=e?[!1,!0,!1]:[!0,!1,!0]},toggleCustomNav(){return x.cb.checked.call(this),
Ye.setCustomNav(this.checked)},editCustomNav(){We.open("Advanced");const e=x.id("fourchanx-settings");return x("[name=boardnav]",e).focus()},scrollTo(e,t,o){let i,s;if(e.offsetParent)if(t){if(s=Ye.getBottomOf(e),a["Fixed Header"]&&a["Header auto-hide on scroll"]&&a["Bottom header"]&&(({height:i}=Ye.bar.getBoundingClientRect()),s<=0?Ye.isHidden()||(s+=i):Ye.isHidden()&&(s-=i)),!o||s<0)return window.scrollBy(0,-s)}else if(s=Ye.getTopOf(e),a["Fixed Header"]&&a["Header auto-hide on scroll"]&&!a["Bottom header"]&&(({height:i}=Ye.bar.getBoundingClientRect()),s>=0?Ye.isHidden()||(s+=i):Ye.isHidden()&&(s-=i)),!o||s<0)return window.scrollBy(0,s)},scrollToIfNeeded:(e,t)=>Ye.scrollTo(e,t,!0),getTopOf(e){let{top:t}=e.getBoundingClientRect();if(a["Fixed Header"]&&!a["Bottom Header"]){const e=Ye.toggle.getBoundingClientRect();t-=e.top+e.height}return t},getBottomOf(e){const{clientHeight:t}=r;let o=t-e.getBoundingClientRect().bottom;if(a["Fixed Header"]&&a["Bottom Header"]){
const e=Ye.toggle.getBoundingClientRect();o-=t-e.bottom+e.height}return o},isNodeVisible(e){if(n.hidden||!r.contains(e))return!1;const{height:t}=e.getBoundingClientRect();return Ye.getTopOf(e)+t>=0&&Ye.getBottomOf(e)+t>=0},isHidden(){const{top:e}=Ye.bar.getBoundingClientRect();return a["Bottom header"]?e===r.clientHeight:e<0},addShortcut(e,t,o){const a=x.el("span",{id:`shortcut-${e}`,className:"shortcut brackets-wrap"});for(var i of(x.add(a,t),a.dataset.index=o.toString(),S("[data-index]",Ye.shortcuts)))if(+i.dataset.index>+o)return void x.before(i,a);return x.add(Ye.shortcuts,a)},rmShortcut:e=>x.rm(e.parentElement),menuToggle(e){return Ye.menu.toggle(e,this,i)},createNotification(e){const{type:t,content:o,lifetime:a}=e.detail;return new Ke(t,o,a)},areNotificationsEnabled:!1,enableDesktopNotifications(){let e;if(!window.Notification||!a["Desktop Notifications"])return;switch(Notification.permission){case"granted":return void(Ye.areNotificationsEnabled=!0);case"denied":return}
const t=x.el("span",{innerHTML:`${o.name} needs your permission to show desktop notifications. [<a href="${s(o.upstreamFaq)}#why-is-4chan-x-asking-for-permission-to-show-desktop-notifications" target="_blank">FAQ</a>]<br><button>Authorize</button> or <button>Disable</button>`}),[i,n]=S("button",t);return x.on(i,"click",(()=>Notification.requestPermission((function(t){if(Ye.areNotificationsEnabled="granted"===t,"default"!==t)return e.close()})))),x.on(n,"click",(function(){return x.set("Desktop Notifications",!1),e.close()})),e=new Ke("info",t)}};class Ke{constructor(e,t,o,a){this.add=this.add.bind(this),this.close=this.close.bind(this),this.timeout=o,this.onclose=a,this.el=x.el("div",{innerHTML:'<a href="javascript:;" class="close" title="Close">✕</a><div class="message"></div>'}),this.el.style.opacity=0,this.setType(e),x.on(this.el.firstElementChild,"click",this.close),"string"==typeof t&&(t=x.tn(t)),x.add(this.el.lastElementChild,t),x.ready(this.add)}setType(e){
this.el.className=`notification ${e}`}add(){this.closed||(n.hidden?x.on(n,"visibilitychange",this.add):(x.off(n,"visibilitychange",this.add),x.add(Ye.noticesRoot,this.el),this.el.clientHeight,this.el.style.opacity=1,this.timeout&&(this.timeoutId=setTimeout(this.close,this.timeout*g))))}close(){this.timeoutId&&clearTimeout(this.timeoutId),this.closed=!0,x.off(n,"visibilitychange",this.add),x.rm(this.el),this.onclose?.()}resetTimer(){this.timeout&&(clearTimeout(this.timeoutId),this.timeoutId=setTimeout(this.close,this.timeout*g))}}var Xe={archives:[{uid:3,name:"4plebs",domain:"archive.4plebs.org",http:!0,https:!0,software:"foolfuuka",boards:["adv","f","hr","mlpol","mo","o","pol","s4s","sp","tg","trv","tv","x"],files:["adv","f","hr","mlpol","mo","o","pol","s4s","sp","tg","trv","tv","x"],reports:!0},{uid:10,name:"warosu",domain:"warosu.org",http:!1,https:!0,software:"fuuka",boards:["3","biz","cgl","ck","diy","fa","ic","jp","lit","sci","vr","vt"],
files:["3","biz","cgl","ck","diy","fa","ic","jp","lit","sci","vr","vt"],search:["biz","cgl","ck","diy","fa","ic","jp","lit","sci","vr","vt"]},{uid:23,name:"Desuarchive",domain:"desuarchive.org",http:!0,https:!0,software:"foolfuuka",boards:["a","aco","an","c","cgl","co","d","fit","g","his","int","k","m","mlp","mu","q","qa","r9k","tg","trash","vr","wsg"],files:["a","aco","an","c","cgl","co","d","fit","g","his","int","k","m","mlp","mu","q","qa","r9k","tg","trash","vr"],reports:!0},{uid:24,name:"fireden.net",domain:"boards.fireden.net",http:!1,https:!0,software:"foolfuuka",boards:["cm","co","ic","sci","vip","y"],files:["cm","co","ic","sci","vip","y"],search:["cm","co","ic","sci","y"]},{uid:25,name:"arch.b4k.co",domain:"arch.b4k.co",http:!0,https:!0,software:"foolfuuka",boards:["g","mlp","qb","v","vg","vm","vmg","vp","vrpg","vst"],files:["qb","v","vg","vm","vmg","vp","vrpg","vst"],search:["qb","v","vg","vm","vmg","vp","vrpg","vst"]},{uid:29,name:"Archived.Moe",domain:"archived.moe",http:!0,
https:!0,software:"foolfuuka",boards:["3","a","aco","adv","an","asp","b","bant","biz","c","can","cgl","ck","cm","co","cock","con","d","diy","e","f","fa","fap","fit","fitlit","g","gd","gif","h","hc","his","hm","hr","i","ic","int","jp","k","lgbt","lit","m","mlp","mlpol","mo","mtv","mu","n","news","o","out","outsoc","p","po","pol","pw","q","qa","qb","qst","r","r9k","s","s4s","sci","soc","sp","spa","t","tg","toy","trash","trv","tv","u","v","vg","vint","vip","vm","vmg","vp","vr","vrpg","vst","vt","w","wg","wsg","wsr","x","xs","y"],files:["can","cock","con","fap","fitlit","gd","mlpol","mo","mtv","outsoc","po","q","qb","qst","spa","vint","vip"],search:["aco","adv","an","asp","b","bant","biz","c","can","cgl","ck","cm","cock","con","d","diy","e","f","fap","fitlit","gd","gif","h","hc","his","hm","hr","i","ic","lgbt","lit","mlpol","mo","mtv","n","news","o","out","outsoc","p","po","pw","q","qa","qst","r","s","soc","spa","trv","u","vint","vip","vrpg","w","wg","wsg","wsr","x","y"],reports:!0},{
uid:30,name:"TheBArchive.com",domain:"thebarchive.com",http:!0,https:!0,software:"foolfuuka",boards:["b","bant"],files:["b","bant"],reports:!0},{uid:31,name:"Archive Of Sins",domain:"archiveofsins.com",http:!0,https:!0,software:"foolfuuka",boards:["h","hc","hm","i","lgbt","r","s","soc","t","u"],files:["h","hc","hm","i","lgbt","r","s","soc","t","u"],reports:!0},{uid:36,name:"palanq.win",domain:"archive.palanq.win",http:!1,https:!0,software:"foolfuuka",boards:["bant","c","con","e","i","n","news","out","p","pw","qst","toy","vip","vp","vt","w","wg","wsr"],files:["bant","c","e","i","n","news","out","p","pw","qst","toy","vip","vp","vt","w","wg","wsr"],reports:!0},{uid:37,name:"Eientei",domain:"eientei.xyz",http:!1,https:!0,software:"Eientei",boards:["3","i","sci","xs"],files:["3","i","sci","xs"],reports:!0}],data:null,init(){if(this.selectArchives(),a.archiveAutoUpdate){const e=Date.now();(e-2*b>=a.lastarchivecheck||a.lastarchivecheck>e)&&this.update()}},selectArchives(){const e={
thread:new Map,threadJSON:new Map,post:new Map,file:new Map},t=p();for(const i of a.archives){for(var o of["boards","files"])i[o]instanceof Array||(i[o]=[]);const{uid:a,name:s,boards:n,files:r,software:l}=i;if(["fuuka","foolfuuka"].includes(l)){t[JSON.stringify(a??s)]=i;for(const t of n)e.thread.has(t)||e.thread.set(t,i),!e.file.has(t)&&r.includes(t)&&e.file.set(t,i),"foolfuuka"===l&&(e.threadJSON.has(t)||e.threadJSON.set(t,i),e.post.has(t)||e.post.set(t,i))}}for(const o in a.selectedArchives){var i=a.selectedArchives[o];for(const[a,n]of Object.entries(i)){var s;if((s=t[JSON.stringify(n)])&&x.hasOwn(e,a)){("file"===a?s.files:s.boards).includes(o)&&e[a].set(o,s)}}}Xe.data=e},update(e){let t;const o=[],i=[];let s=0;for(t of a.archiveLists.split("\n"))"#"!==t[0]&&(t=t.trim(),t&&o.push(t));const n=(e,t,o)=>new Ke("warning",`Error ${t} archive data from\n${e}\n${o}`,20),r=t=>function(){
if(200!==this.status)return n(o[t],"fetching",this.status?`Error ${this.statusText} (${this.status})`:"Connection Error");let{response:a}=this;return a instanceof Array||(a=[a]),i[t]=a,s++,s===o.length?Xe.parse(i,e):void 0};if(o.length)for(let e=0;e<o.length;e++)if(t=o[e],["[","{"].includes(t[0])){var l;try{l=JSON.parse(t)}catch(e){n(t,"parsing",e.message);continue}r(e).call({status:200,response:l})}else Fe.ajax(t,{onloadend:r(e)});else Xe.parse([],e)},parse(e,t){const o=[],i=p();for(var s of e)for(var n of s){var r=JSON.stringify(n.uid??n.name);r in i?x.extend(i[r],n):(i[r]=p.clone(n),o.push(n))}const l={archives:o,lastarchivecheck:Date.now()};return x.set(l),x.extend(a,l),Xe.selectArchives(),t?.()},to(e,t){const o=(["search","board"].includes(e)?Xe.data.thread:Xe.data[e]).get(t.boardID);return o?Xe[e](o,t):""},protocol(e){let{protocol:t}=location;return x.getOwn(e,t.slice(0,-1))||(t="https:"===t?"http:":"https:"),`${t}//`},thread(e,{boardID:t,threadID:o,postID:a}){
let i=o?`${t}/thread/${o}`:`${t}/post/${a}`;return"foolfuuka"===e.software&&(i+="/"),o&&a&&(i+="foolfuuka"===e.software?`#${a}`:`#p${a}`),`${Xe.protocol(e)}${e.domain}/${i}`},threadJSON:(e,{boardID:t,threadID:o})=>`${Xe.protocol(e)}${e.domain}/_/api/chan/thread/?board=${t}&num=${o}`,post(e,{boardID:t,postID:o}){const a=`${Xe.protocol(e)}${e.domain}/_/api/chan/post/?board=${t}&num=${o}`;return Xe.securityCheck(a)?a:""},file(e,{boardID:t,filename:o}){if(!o)return"";if("f"===t)o=encodeURIComponent(x.unescape(decodeURIComponent(o)));else if(/[sm]\.jpg$/.test(o))return"";if("arch.b4k.co"===e.name){const[e,t]=o.split(".");e.length>13&&(o=`${e.slice(0,-3)}.${t}`)}return`${Xe.protocol(e)}${e.domain}/${t}/full_image/${o}`},board:(e,{boardID:t})=>`${Xe.protocol(e)}${e.domain}/${t}/`,search(e,{boardID:t,type:o,value:a}){"capcode"===(o="name"===o?"username":"MD5"===o?"image":o)?a=x.getOwn({Developer:"dev",Verified:"ver"},a)||a.toLowerCase():"image"===o&&(a=a.replace(/[+/=]/g,(e=>({"+":"-","/":"_",
"=":""}[e])))),a=encodeURIComponent(a);const i="foolfuuka"===e.software?`${t}/search/${o}/${a}/`:"image"===o?`${t}/image/${a}`:`${t}/?task=search2&search_${o}=${a}`;return`${Xe.protocol(e)}${e.domain}/${i}`},report(e){const t=[];for(var o of a.archives){var{software:i,https:s,reports:n,boards:r,name:l,domain:d}=o;"foolfuuka"===i&&s&&n&&r instanceof Array&&r.includes(e)&&t.push([l,`https://${d}/_/api/chan/offsite_report/`])}return t},securityCheck:e=>/^https:\/\//.test(e)||"http:"===location.protocol||a["Exempt Archives from Encryption"],navigate(e,t,o){Xe.data||Xe.init();const a=Xe.to(e,t);return a&&(Xe.securityCheck(a)||confirm(`Redirect to ${a}?\n\nYour connection will not be encrypted.`))?location.replace(a):o?location.replace(o):void 0}};class Ze{toString(){return this.ID}constructor(e){this.nodes={root:e,thumb:x(i.SITE.selectors.catalog.thumb,e)},this.siteID=i.SITE.ID,this.boardID=this.nodes.thumb.parentNode.pathname.split(/\/+/)[1],
this.board=i.boards[this.boardID]||new ce(this.boardID),this.ID=this.threadID=+(e.dataset.id||e.id).match(/\d*$/)[0],this.thread=this.board.threads.get(this.ID)||new j(this.ID,this.board)}}const et={init(){if(a.Anonymize)return x.addClass(r,"anonymize")}};var tt={init(){if(["index","thread"].includes(i.VIEW))return a["Image Hover"]&&c.Post.push({name:"Image Hover",cb:this.node}),a["Image Hover in Catalog"]?c.CatalogThread.push({name:"Image Hover",cb:this.catalogNode}):void 0},node(){return this.files.filter((e=>(e.isImage||e.isVideo)&&e.thumb)).map((e=>x.on(e.thumb,"mouseover",tt.mouseover(this,e))))},catalogNode(){const e=this.thread.OP.files[0];if(e&&(e.isImage||e.isVideo))return x.on(this.nodes.thumb,"mouseover",tt.mouseover(this.thread.OP,e))},mouseover:(e,t)=>function(o){let s,n,l;if(!r.contains(this))return;const{isVideo:d}=t;if(t.isExpanding||t.isExpanded||i.SITE.isThumbExpanded?.(t))return;const c=tt.error(e,t)
;if($e.cache?.dataset.fileID===`${e.fullID}.${t.index}`?(s=$e.popCache(),x.on(s,"error",c)):(s=x.el(d?"video":"img"),s.dataset.fileID=`${e.fullID}.${t.index}`,x.on(s,"error",c),s.src=t.url),a["Restart when Opened"]&&($e.rewind(s),$e.rewind(this)),s.id="ihover",x.add(Ye.hover,s),d&&(s.loop=!0,s.controls=!1,ee.setup(s),a.Autoplay&&(s.play(),"VIDEO"===this.nodeName&&(this.currentTime=s.currentTime))),t.dimensions){[l,n]=t.dimensions.split("x").map((e=>+e));const e=r.clientWidth,o=r.clientHeight-X.hover.padding,a=Math.min(1,e/l,o/n);l*=a,n*=a,s.style.maxWidth=`${l}px`,s.style.maxHeight=`${n}px`}return X.hover({root:this,el:s,latestEvent:o,endEvents:"mouseout click",height:n,width:l,noRemove:!0,cb:()=>(x.off(s,"error",c),$e.pushCache(s),$e.pause(s),x.rm(s),s.removeAttribute("style"))})},error:(e,t)=>function(){if(!$e.decodeError(this,t))return $e.error(this,e,t,3e3,(e=>e?this.src=e+(this.src===e?"?"+Date.now():""):x.rm(this)))}},ot={init(){
if(!["index","thread","archive"].includes(i.VIEW))return;const e=a["Replace JPG"]||a["Replace PNG"]||a["Replace GIF"]||a["Replace WEBM"];if(!a["Image Prefetching"]&&!e)return;if(c.Post.push({name:"Image Replace",cb:this.node}),x.on(n,"PostsInserted",(function(){if(ot.prefetchEnabled||e)return i.posts.forEach(ot.prefetchAll)})),a["Replace WEBM"]&&x.on(n,"scroll visibilitychange 4chanXInitFinished PostsInserted",this.playVideos),!a["Image Prefetching"]||!["index","thread"].includes(i.VIEW))return;const t=x.el("a",{href:"javascript:;",title:"Prefetch Images",className:"disabled"});return M.set(t,"bolt","Prefetch"),x.on(t,"click",this.toggle),Ye.addShortcut("prefetch",t,525)},node(){if(!this.isClone)for(var e of this.files)a["Replace WEBM"]&&e.isVideo&&ot.replaceVideo(this,e),ot.prefetch(this,e)},replaceVideo(e,t){const{thumb:o}=t,a=x.el("video",{preload:"none",loop:!0,muted:!0,poster:o.src||o.dataset.src,textContent:o.alt,className:o.className})
;for(var i of(a.setAttribute("muted","muted"),a.dataset.md5=o.dataset.md5,["height","width","maxHeight","maxWidth"]))a.style[i]=o.style[i];return a.src=t.url,x.replace(o,a),t.thumb=a,t.videoThumb=!0},prefetch(e,t){let o,i;const{isImage:s,isVideo:n,thumb:l,url:d}=t;if(t.isPrefetched||!s&&!n||e.isHidden||e.thread.isHidden)return;n?i="WEBM":(i=d.match(/\.([^.]+)$/)?.[1].toUpperCase(),"JPEG"===i&&(i="JPG"));const c=a[`Replace ${i}`]&&!/spoiler/.test(l.src||l.dataset.src);if(!c&&!ot.prefetchEnabled)return;if(x.hasClass(r,"catalog-mode"))return;if(![e,...e.clones].some((e=>r.contains(e.nodes.root))))return;if(t.isPrefetched=!0,t.videoThumb){for(o of e.clones)o.file.thumb.preload="auto";return l.preload="auto",void("gecko"===x.engine&&x.on(l,"loadeddata",(function(){return this.removeAttribute("poster")})))}const h=x.el(s?"img":"video");return n&&(h.preload="auto"),c&&s&&x.on(h,"load",(function(){for(o of e.clones)o.file.thumb.src=d;return l.src=d})),h.src=d},prefetchAll(e){
for(var t of e.files)ot.prefetch(e,t)},toggle(){ot.prefetchEnabled=!ot.prefetchEnabled,this.classList.toggle("disabled",!ot.prefetchEnabled),ot.prefetchEnabled&&i.posts.forEach(ot.prefetchAll)},playVideos(){const e=x.id("qp")?.firstElementChild;return i.posts.forEach((function(t){for(t of[t,...t.clones])for(var o of t.files)if(o.videoThumb){var{thumb:a}=o;Ye.isNodeVisible(a)||t.nodes.root===e?a.play():a.pause()}}))}},at={init(){if(a["WEBM Metadata"]&&["index","thread"].includes(i.VIEW))return c.Post.push({name:"WEBM Metadata",cb:this.node})},node(){for(let o=0;o<this.files.length;o++){var e,t=this.files[o];if(/webm$/i.test(t.url))this.isClone?e=x(".webm-title",t.text):((e=x.el("span",{className:"webm-title"})).dataset.index=o,x.extend(e,{innerHTML:'<a href="javascript:;"></a>'}),x.add(t.text,[x.tn(" "),e])),1===e.children.length&&x.one(e.lastElementChild,"mouseover focus",at.load)}},load(){x.rmClass(this.parentNode,"error"),x.addClass(this.parentNode,"loading")
;const{index:e}=this.parentNode.dataset;return Fe.binary(w.postFromNode(this).files[+e].url,(e=>{if(x.rmClass(this.parentNode,"loading"),null!=e){const t=at.parse(e),o=x.el("span",{textContent:t||""});return null==t&&x.addClass(this.parentNode,"not-found"),x.before(this,o),this.parentNode.tabIndex=0,n.activeElement===this&&this.parentNode.focus(),this.tabIndex=-1}return x.addClass(this.parentNode,"error"),x.one(this,"click",at.load)}),{Range:"bytes=0-9999"})},parse(e){const t=function(){let t=e[o++],a=0;for(;t<128>>a;)a++;for(t^=128>>a;a--&&o<e.length;)t=t<<8^e[o++];return t};for(var o=0;o<e.length;){var a=t(),i=t();if(15273===a){for(var s="";i--&&o<e.length;)s+=String.fromCharCode(e[o++]);return decodeURIComponent(escape(s))}[139690087,88713574].includes(a)||(o+=i)}return null}};const it={init(){if(["index","thread","archive"].includes(i.VIEW)&&a["Reveal Spoiler Thumbnails"])return c.Post.push({name:"Reveal Spoiler Thumbnails",cb:this.node})},node(){
if(!this.isClone)for(var e of this.files)if(e.thumb&&e.isSpoiler){var{thumb:t}=e;t.removeAttribute("style"),t.style.maxHeight=t.style.maxWidth=this.isReply?"125px":"250px",t.src?t.src=e.thumbURL:t.dataset.src=e.thumbURL}}},st={init(){if("yotsuba"!==i.SITE.software||!["index","thread"].includes(i.VIEW)||!a.Menu||!a["Archive Link"])return;const e={el:x.el("div",{textContent:"Archive"}),order:60,open:({ID:e,thread:t,board:o})=>!!Xe.to("thread",{postID:e,threadID:t.ID,boardID:o.ID}),subEntries:[]};for(var t of[["Post","post"],["Name","name"],["Tripcode","tripcode"],["Capcode","capcode"],["Subject","subject"],["Flag","country"],["Filename","filename"],["Image MD5","MD5"]])e.subEntries.push(this.createSubEntry(t[0],t[1]));return ne.menu.addEntry(e)},createSubEntry(e,t){const o=x.el("a",{textContent:e,target:"_blank"}),a="post"===t?function({ID:e,thread:t,board:a}){return o.href=Xe.to("thread",{postID:e,threadID:t.ID,boardID:a.ID}),!0}:function(e){
const a="country"===t&&e.info.flagCodeTroll?"troll_country":t,i="country"===t?e.info.flagCode||e.info.flagCodeTroll?.toLowerCase():Je.values(t,e)[0];return!!i&&(o.href=Xe.to("search",{boardID:e.board.ID,type:a,value:i,isSearch:!0}),!0)};return{el:o,open:a}}};var nt={init(){if(!["index","thread"].includes(i.VIEW)||!a.Menu||!a["Copy Text Link"])return;const e=x.el("a",{className:"copy-text-link",href:"javascript:;",textContent:"Copy Text"});return x.on(e,"click",nt.copy),ne.menu.addEntry({el:e,order:12,open:e=>(nt.text=(e.origin||e).commentOrig(),!0)})},copy(){const e=x.el("textarea",{className:"copy-text-element",value:nt.text});x.add(n.body,e),e.select();try{n.execCommand("copy")}catch(e){}return x.rm(e)}},rt={auto:[p(),p()],init(){if(!["index","thread"].includes(i.VIEW)||!a.Menu||!a["Delete Link"])return;const e=x.el("div",{className:"delete-link",textContent:"Delete"}),t=x.el("a",{className:"delete-post",href:"javascript:;"}),o=x.el("a",{className:"delete-file",href:"javascript:;"})
;this.nodes={menu:e.firstChild,links:[t,o]};const s={el:t,open:()=>(t.textContent=rt.linkText(!1),x.on(t,"click",rt.toggle),!0)},n={el:o,open:({file:e})=>!(!e||e.isDead)&&(o.textContent=rt.linkText(!0),x.on(o,"click",rt.toggle),!0)};return ne.menu.addEntry({el:e,order:40,open:e=>!e.isDead&&(rt.post=e,rt.nodes.menu.textContent=rt.menuText(),rt.cooldown.start(e),!0),subEntries:[s,n]})},menuText(){let e;return(e=rt.cooldown.seconds[rt.post.fullID])?`Delete (${e})`:"Delete"},linkText(e){let t=e?"File":"Post";return rt.auto[+e][rt.post.fullID]&&(t=`Deleting ${t.toLowerCase()}...`),t},toggle(){const{post:e}=rt,t=x.hasClass(this,"delete-file"),o=rt.auto[+t];if(o[e.fullID]?delete o[e.fullID]:o[e.fullID]=!0,this.textContent=rt.linkText(t),!rt.cooldown.seconds[e.fullID])return rt.delete(e,t)},delete(e,t){const o=rt.nodes.links[+t];delete rt.auto[+t][e.fullID],e.fullID===rt.post.fullID&&x.off(o,"click",rt.toggle);const a={mode:"usrdel",onlyimgdel:t,pwd:Me.persona.getPassword()}
;return a[+e.ID]="delete",x.ajax(x.id("delform").action.replace(`/${i.BOARD}/`,`/${e.board}/`),{responseType:"document",withCredentials:!0,onloadend(){return rt.load(o,e,t,this.response)},form:x.formData(a)})},load(e,t,o,i){let s;if(!i)return new Ke("warning","Connection error, please retry.",20),void(t.fullID===rt.post.fullID&&x.on(e,"click",rt.toggle));if(e.textContent=rt.linkText(o),"4chan - Banned"===i.title){const e=x.el("span",{innerHTML:'You can&#039;t delete posts because you are <a href="//www.4chan.org/banned" target="_blank">banned</a>.'});return new Ke("warning",e,20)}if(s=i.getElementById("errmsg")){if(new Ke("warning",s.textContent,20),t.fullID===rt.post.fullID&&x.on(e,"click",rt.toggle),Me.cooldown.data&&a.Cooldown&&/\bwait\b/i.test(s.textContent))return rt.cooldown.start(t,5),rt.auto[+o][t.fullID]=!0,rt.nodes.links[+o].textContent=rt.linkText(o)}else if(o||Me.cooldown.delete(t),"Updating index..."===i.title&&(t.origin||t).kill(o),
t.fullID===rt.post.fullID)return e.textContent="Deleted"},cooldown:{seconds:p(),start(e,t){if(null==rt.cooldown.seconds[e.fullID])return null==t&&(t=Me.cooldown.secondsDeletion(e)),t>0?(rt.cooldown.seconds[e.fullID]=t,rt.cooldown.count(e)):void 0},count(e){if(e.fullID===rt.post.fullID&&(rt.nodes.menu.textContent=rt.menuText()),rt.cooldown.seconds[e.fullID]>0&&a.Cooldown)rt.cooldown.seconds[e.fullID]--,setTimeout(rt.cooldown.count,1e3,e);else for(var t of(delete rt.cooldown.seconds[e.fullID],[!1,!0]))rt.auto[+t][e.fullID]&&rt.delete(e,t)}}};const lt={init(){if(!["index","thread"].includes(i.VIEW)||!a.Menu||!a["Download Link"])return;const e=x.el("a",{className:"download-link",textContent:"Download file"});return x.on(e,"click",$e.download),ne.menu.addEntry({el:e,order:100,open:({file:t})=>!!t&&(e.href=t.url,e.download=t.name,!0)})}};var dt={init(){if(!["index","thread"].includes(i.VIEW)||!a.Menu||!a["Report Link"])return;const e=x.el("a",{className:"report-link",href:"javascript:;",
textContent:"Report"});return x.on(e,"click",dt.report),ne.menu.addEntry({el:e,order:10,open:e=>(dt.url=`//sys.${location.hostname.split(".")[1]}.org/${e.board}/imgboard.php?mode=report&no=${e}`,n.cookie.indexOf("pass_enabled=1")>=0?dt.dims="width=350,height=275":dt.dims="width=400,height=550",!0)})},report(){const{url:e,dims:t}=dt,o=Date.now(),a=`toolbar=0,scrollbars=1,location=0,status=1,menubar=0,resizable=1,${t}`;return window.open(e,o,a)}},ct={init(){if(a["Disable Autoplaying Sounds"]){for(var e of(x.addClass(r,"anti-autoplay"),S("audio[autoplay]",r)))this.stop(e);return window.addEventListener("loadstart",(e=>this.stop(e.target)),!0),c.Post.push({name:"Disable Autoplaying Sounds",cb:this.node}),x.ready((()=>this.process(n.body)))}},stop(e){if(e.autoplay&&(e.pause(),e.autoplay=!1,!e.controls))return e.controls=!0,x.addClass(e,"controls-added")},node(){return ct.process(this.nodes.comment)},process(e){
for(var t of S('iframe[src*="youtube"][src*="autoplay=1"]',e))ct.processVideo(t,"src");for(var o of S('object[data*="youtube"][data*="autoplay=1"]',e))ct.processVideo(o,"data")},processVideo:(e,t)=>(e[t]=e[t].replace(/\?autoplay=1&?/,"?").replace("&autoplay=1",""),"none"===window.getComputedStyle(e).display&&(e.style.display="block"),x.addClass(e,"autoplay-removed"))},ht={init(){if(a["Custom Board Titles"]&&(this.db=new q("customTitles",null,!0)),x.asap((()=>n.body),(()=>x.asap((()=>x("hr")),ht.ready))),"f"!==i.BOARD.ID)return Pt.ready((()=>x.queueTask(ht.load)))},ready(){const e=x(".boardBanner"),{children:t}=e;if("thread"===i.VIEW&&a["Remove Thread Excerpt"]&&ht.setTitle(t[1].textContent),t[0].title="Click to change",x.on(t[0],"click",ht.cb.toggle),a["Custom Board Titles"]&&(ht.custom(t[1]),t[2]))return ht.custom(t[2])},load(){const e=x.id("bannerCnt");if(!e.firstChild){const t=x.el("img",{alt:"4chan",src:"//s.4cdn.org/image/title/"+e.dataset.src});return x.add(e,t)}},
setTitle:e=>null!=fe.title?(fe.title=e,fe.update()):n.title=e,cb:{toggle(){ht.choices?.length||(ht.choices=a.knownBanners.split(",").slice());const e=Math.floor(ht.choices.length*Math.random()),t=ht.choices.splice(e,1);return x("img",this.parentNode).src=`//s.4cdn.org/image/title/${t}`},click(e){if(e.ctrlKey||e.metaKey){for(var t of(null==ht.original[this.className]&&(ht.original[this.className]=this.cloneNode(!0)),this.contentEditable=!0,S("br",this)))x.replace(t,x.tn("\n"));return this.focus()}},keydown(e){if(e.stopPropagation(),!e.shiftKey&&13===e.keyCode)return this.blur()},blur(){for(var e of S("br",this))x.replace(e,x.tn("\n"));return(this.textContent=this.textContent.replace(/\n*$/,""))?(this.contentEditable=!1,ht.db.set({boardID:i.BOARD.ID,threadID:this.className,val:{title:this.textContent,orig:ht.original[this.className].textContent}})):(x.rmAll(this),x.add(this,[...ht.original[this.className].cloneNode(!0).childNodes]),ht.db.delete({boardID:i.BOARD.ID,threadID:this.className
}))}},original:p(),custom(e){let t;const{className:o}=e;for(var s of(e.title=`Ctrl/⌘+click to edit board ${o.slice(5).toLowerCase()}`,e.spellcheck=!1,["click","keydown","blur"]))x.on(e,s,ht.cb[s]);if(t=ht.db.get({boardID:i.BOARD.ID,threadID:o}))return a["Persistent Custom Board Titles"]||t.orig===e.textContent?(ht.original[o]=e.cloneNode(!0),e.textContent=t.title):ht.db.delete({boardID:i.BOARD.ID,threadID:o})}},ut={init(){if("f"===i.BOARD.ID&&a["Enable Native Flash Embedding"])return x.ready(ut.initReady)},initReady(){x.hasStorage?x.global("initFlash"):("thread"===i.VIEW&&x.global("setThreadId"),x.global("initFlashNoStorage"))}},pt={init(){if("yotsuba"===i.SITE.software&&["index","thread","archive"].includes(i.VIEW))return se.ready(this.initBoard),Pt.ready(this.initReady)},initBoard(){if(i.BOARD.config.code_tags&&(x.on(window,"prettyprint:cb",(function(e){let t,o
;if((t=i.posts.get(e.detail.ID))&&(o=S(".prettyprint",t.nodes.comment)[+e.detail.i]))return x.hasClass(o,"prettyprinted")?void 0:(o.innerHTML=e.detail.html,x.addClass(o,"prettyprinted"))})),x.global("fourChanPrettyPrintListener"),c.Post.push({name:"Parse [code] tags",cb:pt.code}),i.posts.forEach((function(e){if(e.callbacksExecuted)return c.Post.execute(e,["Parse [code] tags"],!0)})),ue.callbacks.push(pt.code)),i.BOARD.config.math_tags)return x.global("fourChanMathjaxListener"),c.Post.push({name:"Parse [math] tags",cb:pt.math}),i.posts.forEach((function(e){if(e.callbacksExecuted)return c.Post.execute(e,["Parse [math] tags"],!0)})),ue.callbacks.push(pt.math)},initReady:()=>x.global("disable4chanIdHl"),code(){if(!this.isClone)return x.ready((()=>{const e=S(".prettyprint",this.nodes.comment);for(let o=0;o<e.length;o++){var t=e[o];x.hasClass(t,"prettyprinted")||x.event("prettyprint",{ID:this.fullID,i:o,html:t.innerHTML},window)}}))},math(){let e
;if(/\[(math|eqn)\]/.test(this.nodes.comment.textContent)){if((e=S("wbr",this.nodes.comment)).length){for(var t of e)x.rm(t);this.nodes.comment.normalize()}var o=()=>{if(r.contains(this.nodes.comment))return x.off(n,"PostsInserted",o),x.event("mathjax",null,this.nodes.comment)};return x.on(n,"PostsInserted",o),o()}}},gt={init(){if(["index","thread"].includes(i.VIEW)&&a["Color User IDs"])return this.ids=p(),this.ids.Heaven=[0,0,0,"#fff"],c.Post.push({name:"Color User IDs",cb:this.node})},node(){let e,t;if(this.isClone||!(t=this.info.uniqueID)||!(e=this.nodes.uniqueID))return;const o=gt.ids[t]||gt.compute(t),{style:a}=e;return a.color=o[3],a.backgroundColor=`rgb(${o[0]},${o[1]},${o[2]})`,x.addClass(e,"painted")},compute(e){const t=i.SITE.uidColor?i.SITE.uidColor(e):parseInt(e,16),o=[t>>16&255,t>>8&255,255&t];return o.push(x.luma(o)>125?"#000":"#fff"),this.ids[e]=o}},ft={init(){if(["index","thread"].includes(i.VIEW))return c.Post.push({name:"Highlight by User ID",cb:this.node})},
uniqueID:null,node(){if(this.nodes.uniqueIDRoot&&x.on(this.nodes.uniqueIDRoot,"click",ft.click(this)),this.nodes.capcode&&x.on(this.nodes.capcode,"click",ft.click(this)),!this.isClone)return ft.set(this)},set(e){const t=(e.info.uniqueID||e.info.capcode)===ft.uniqueID;return x[t?"addClass":"rmClass"](e.nodes.post,"highlight")},click:e=>function(){const t=e.info.uniqueID||e.info.capcode;return ft.uniqueID=ft.uniqueID===t?null:t,i.posts.forEach(ft.set)}},mt={init(){if("thread"===i.VIEW&&a["Count Posts by ID"])return c.Thread.push({name:"Count Posts by ID",cb(){return mt.thread=this}}),c.Post.push({name:"Count Posts by ID",cb:this.node})},node(){if(this.nodes.uniqueID&&this.thread===mt.thread)return x.on(this.nodes.uniqueID,"mouseover",mt.count)},count(){const{uniqueID:e}=w.postFromNode(this).info;let t=0;return mt.thread.posts.forEach((function(o){if(o.info.uniqueID===e)return t++})),this.title=`${t} post${1===t?"":"s"} by this ID`}},bt={init(){
if("yotsuba"===i.SITE.software&&["index","thread"].includes(i.VIEW))return c.Post.push({name:"Mod Contact Links",cb:this.node})},node(){let e;if(this.isClone||!x.hasOwn(bt.specific,this.info.capcode))return;const t=x.el("span",{className:"contact-links brackets-wrap"});if(x.extend(t,bt.template(this.info.capcode)),x.after(this.nodes.capcode,t),(e=this.info.comment.match(/This thread was moved to >>>\/(\w+)\//))&&x.hasOwn(bt.moveNote,e[1])){const t=x.el("div",{className:"move-note"});return x.extend(t,bt.moveNote[e[1]]),x.add(this.nodes.post,t)}},template:e=>({innerHTML:'<a href="https://www.4chan.org/feedback" target="_blank">feedback</a>'+bt.specific[e]().innerHTML}),specific:{Mod:()=>({innerHTML:' <a href="https://www.4chan-x.net/4chan-irc.html" target="_blank">IRC</a>'}),Manager:()=>bt.specific.Mod(),Developer:()=>({innerHTML:' <a href="https://github.com/4chan" target="_blank">github</a>'}),Admin:()=>({
innerHTML:' <a href="https://twitter.com/hiroyuki_ni" target="_blank">twitter</a>'})},moveNote:{qa:{innerHTML:'Moving a thread to /qa/ does not imply mods will read it. If you wish to contact mods, use <a href="https://www.4chan.org/feedback" target="_blank">feedback</a><span class="invisible"> (https://www.4chan.org/feedback)</span> or <a href="https://www.4chan-x.net/4chan-irc.html" target="_blank">IRC</a><span class="invisible"> (https://www.4chan-x.net/4chan-irc.html)</span>.'}}};const vt={init(){if(!a["Normalize URL"])return;let e=location.pathname.split(/\/+/);if("yotsuba"===i.SITE.software)switch(i.VIEW){case"thread":e[2]="thread",e=e.slice(0,4);break;case"index":e=e.slice(0,3)}return e=e.join("/"),location.pathname!==e?history.replaceState(history.state,"",`${location.protocol}//${location.host}${e}${location.hash}`):void 0}};var At={init(){if(a["Unique ID and Capcode Navigation"]&&["index","thread"].includes(i.VIEW))return this.buttons=this.makeButtons(),c.Post.push({
name:"Post Jumper",cb:this.node})},node(){if(this.isClone)for(var e of S(".postJumper",this.nodes.info))At.addListeners(e);else if(this.nodes.uniqueIDRoot&&At.addButtons(this,"uniqueID"),this.nodes.capcode)return At.addButtons(this,"capcode")},addButtons(e,t){const o=e.info[t],a=At.buttons.cloneNode(!0);return x.extend(a.dataset,{type:t,value:o}),x.after(e.nodes[t+("capcode"===t?"":"Root")],a),At.addListeners(a)},addListeners:e=>(x.on(e.firstChild,"click",At.buttonClick),x.on(e.lastChild,"click",At.buttonClick)),buttonClick(){let e;const t=x.hasClass(this,"prev")?-1:1;if(e=At.find(this.parentNode,t))return At.scroll(this.parentNode,e)},find(e,t){const{type:o,value:a}=e.dataset,i=`span[contains(@class,"postJumper") and @data-value="${a}" and @data-type="${o}"]`,s=t<0?"preceding":"following";let n=e;for(;n=x.x(`${s}::${i}`,n);)if(n.getBoundingClientRect().height)return n;if((n=x.x(`(//${i})[${t<0?"last()":"1"}]`))&&n.getBoundingClientRect().height)return n
;for(;(n=x.x(`${s}::${i}`,n))&&n!==e;)if(n.getBoundingClientRect().height)return n;return null},makeButtons(){const e=x.el("span",{className:"postJumper"});return x.extend(e,{innerHTML:'<a href="javascript:;" class="'+s("prev")+'">'+s("⏫")+'</a><a href="javascript:;" class="'+s("next")+'">'+s("⏬")+"</a>"}),e},scroll(e,t){const o=e.getBoundingClientRect().top,a=t.getBoundingClientRect().top;return window.scrollBy(0,a-o)}};const xt={init(){let e;if("yotsuba"===i.SITE.software&&"qa"===i.BOARD.ID){e=x.el("div",{className:"fcx-announcement"},{innerHTML:'Stay in touch with your <a href="https://www.4chan-x.net/qa_friends.html" target="_blank" rel="noopener">/qa/ friends</a>!'}),x.onExists(r,".boardBanner",(t=>x.after(t,e)))}if("samachan.org"in a.siteProperties&&!a.PSAseen.includes("samachan"))return e=x.el("span",{
innerHTML:'<a href="https://sushigirl.us/yakuza/res/776.html" target="_blank" rel="noopener">Looking for a new home?<br>Some former Samachan users are regrouping on SushiChan.</a><br>(a message from 4chan X)'}),Pt.ready((function(){return new Ke("info",e),a.PSAseen.push("samachan"),x.set("PSAseen",a.PSAseen)}))}};var wt={init(){if(a["Announcement Hiding"]&&i.SITE.selectors.psa)return x.addClass(r,"hide-announcement"),x.onExists(r,i.SITE.selectors.psa,this.setup),x.ready((function(){if(!x(i.SITE.selectors.psa))return x.rmClass(r,"hide-announcement")}))},setup(e){let t,o;wt.psa=e,wt.text=e.dataset.utc??e.innerHTML,i.SITE.selectors.psaTop&&(o=x(i.SITE.selectors.psaTop)?.previousElementSibling)&&"HR"===o.nodeName&&(wt.hr=o),wt.content=x.el("div");const s={el:x.el("a",{textContent:"Show announcement",className:"show-announcement",href:"javascript:;"}),order:50,open:()=>e.hidden};return Ye.menu.addEntry(s),x.on(s.el,"click",wt.toggle),wt.btn=t=x.el("a",{
title:"Mark announcement as read and hide.",className:"hide-announcement-button",href:"javascript:;",textContent:"➖︎"}),x.on(t,"click",wt.toggle),"HR"===e.firstChild?.tagName?x.after(e.firstChild,t):x.prepend(e,t),wt.sync(a.hiddenPSAList),x.rmClass(r,"hide-announcement"),x.sync("hiddenPSAList",wt.sync)},toggle(){const e=x.hasClass(this,"hide-announcement-button"),t=function(t){return e?t[i.SITE.ID]=wt.text:delete t[i.SITE.ID]};return t(a.hiddenPSAList),wt.sync(a.hiddenPSAList),x.get("hiddenPSAList",a.hiddenPSAList,(function({hiddenPSAList:e}){return t(e),x.set("hiddenPSAList",e)}))},sync(e){const{psa:t,content:o}=wt;t.hidden=e[i.SITE.ID]===wt.text,t.hidden?x.add(o,[...t.childNodes]):x.add(t,[...o.childNodes]),wt.hr&&(wt.hr.hidden=t.hidden)}},yt={init(){if(a["Reveal Spoilers"]&&x.addClass(r,"reveal-spoilers"),a["Remove Spoilers"])return c.Post.push({name:"Reveal Spoilers",cb:this.node}),"archive"===i.VIEW?x.ready((()=>yt.unspoiler(x.id("arc-list")))):void 0},node(){
return yt.unspoiler(this.nodes.comment)},unspoiler(e){const t=S(i.SITE.selectors.spoiler,e);for(var o of t){var a=x.el("span",{className:"removed-spoiler"});x.replace(o,a),x.add(a,[...o.childNodes])}}},kt={init(){if("index"===i.VIEW&&a["Open Threads in New Tab"])return c.Post.push({name:"Thread Links",cb:this.node}),c.CatalogThread.push({name:"Thread Links",cb:this.catalogNode})},node(){if(!this.isReply&&!this.isClone)return kt.process(this.nodes.reply)},catalogNode(){return kt.process(this.nodes.thumb.parentNode)},process:e=>e.target="_blank"};const It={init(){if("tinyboard"===i.SITE.software)return"thread"===i.VIEW?Pt.ready((()=>x.global("initTinyBoard",{boardID:i.BOARD.ID,threadID:i.THREADID.toString()}))):void 0}};var Ct={init(){if("yotsuba"===i.SITE.software&&"thread"===i.VIEW&&a["Mark New IPs"])return c.Thread.push({name:"Mark New IPs",cb:this.node})},node(){return Ct.ipCount=this.ipCount,Ct.postCount=this.posts.keys.length,x.on(n,"ThreadUpdate",Ct.onUpdate)},onUpdate(e){let t
;const{ipCount:o,postCount:a,newPosts:s,deletedPosts:n}=e.detail;if(null!=o){switch(o-Ct.ipCount){case a-Ct.postCount+n.length:var r=Ct.ipCount;for(t of s)Ct.markNew(i.posts.get(t),++r);break;case-n.length:for(t of s)Ct.markOld(i.posts.get(t))}return Ct.ipCount=o,Ct.postCount=a}},markNew(e,t){const o=Math.floor(t/10)%10==1?"th":["st","nd","rd"][t%10-1]||"th",a=x.el("span",{className:"ip-counter",textContent:`(${t})`});return e.nodes.nameBlock.title=`This is the ${t}${o} IP in the thread.`,x.add(e.nodes.nameBlock,[x.tn(" "),a]),x.addClass(e.nodes.root,"new-ip")},markOld:e=>(e.nodes.nameBlock.title="Not the first post from this IP.",x.addClass(e.nodes.root,"old-ip"))},Dt={postCount:0,fileCount:0,postIndex:0,init(){let e;if("thread"!==i.VIEW||!a["Thread Stats"])return;a["Page Count in Stats"]&&(this[i.SITE.isPrunedByAge?.(i.BOARD)?"showPurgePos":"showPage"]=!0);const t={
innerHTML:'<span id="post-count">?</span> / <span id="file-count">?</span>'+(a["IP Count in Stats"]&&i.SITE.hasIPCount?' / <span id="ip-count">?</span>':"")+(a["Page Count in Stats"]?' / <span id="page-count">?</span>':"")};let o="Posts / Files";return a["IP Count in Stats"]&&i.SITE.hasIPCount&&(o+=" / IPs"),a["Page Count in Stats"]&&(this.showPurgePos?o+=" / Purge Position":(o+=" / Page",a["Purge Position"]&&(o+=" (Purge Position)"))),a["Updater and Stats in Header"]?(this.dialog=e=x.el("span",{id:"thread-stats",title:o}),x.extend(e,t),Ye.addShortcut("stats",e,200)):(this.dialog=e=X.dialog("thread-stats",{innerHTML:'<div class="move" title="'+s(o)+'">'+t.innerHTML+"</div>"}),x.addClass(r,"float"),x.ready((()=>x.add(n.body,e)))),this.postCountEl=x("#post-count",e),this.fileCountEl=x("#file-count",e),this.ipCountEl=x("#ip-count",e),this.pageCountEl=x("#page-count",e),this.pageCountEl&&x.on(this.pageCountEl,"click",Dt.fetchPage),c.Thread.push({name:"Thread Stats",cb:this.node})},node(){
return Dt.thread=this,Dt.count(),Dt.update(),Dt.fetchPage(),x.on(n,"PostsInserted",(()=>x.queueTask(Dt.onPostsInserted))),x.on(n,"ThreadUpdate",Dt.onUpdate)},count(){const{posts:e}=Dt.thread,t=e.keys.length;for(let a=Dt.postIndex,i=t;a<i;a++){var o=e.get(e.keys[a]);o.isFetchedQuote||(Dt.postCount++,Dt.fileCount+=o.files.length)}Dt.postIndex=t},onUpdate(e){if(e.detail[404])return;const{postCount:t,fileCount:o}=e.detail;return x.extend(Dt,{postCount:t,fileCount:o}),Dt.postIndex=Dt.thread.posts.keys.length,Dt.update(),Dt.showPage&&"1"!==Dt.pageCountEl.textContent?Dt.fetchPage():void 0},onPostsInserted(){if(!(Dt.thread.posts.keys.length<=Dt.postIndex))return Dt.count(),Dt.update(),Dt.showPage&&"1"!==Dt.pageCountEl.textContent?Dt.fetchPage():void 0},update(){const{thread:e,postCountEl:t,fileCountEl:o,ipCountEl:a}=Dt;if(t.textContent=Dt.postCount,o.textContent=Dt.fileCount,a)if(e.ipCount)a.textContent=e.ipCount;else if(i.BOARD?.config.user_ids){const e=new Set;i.posts.forEach((t=>{
e.add(t.info.uniqueID)})),a.textContent=e.size}else a.textContent="?";t.classList.toggle("warning",e.postLimit&&!e.isSticky),o.classList.toggle("warning",e.fileLimit&&!e.isSticky)},fetchPage(){if(Dt.pageCountEl){if(clearTimeout(Dt.timeout),Dt.thread.isDead)return Dt.pageCountEl.textContent="Dead",void x.addClass(Dt.pageCountEl,"warning");Dt.timeout=setTimeout(Dt.fetchPage,a["Purge Position"]&&Dt.pageCountEl.classList.contains("warning")?5e3:12e4),x.whenModified(i.SITE.urls.threadsListJSON(Dt.thread),"ThreadStats",Dt.onThreadsLoad)}},onThreadsLoad(){if(200===this.status){let e,t;if(Dt.showPurgePos){let o=1;for(e of this.response)for(t of e.threads)t.no<Dt.thread.ID&&o++;Dt.pageCountEl.textContent=o,Dt.pageCountEl.classList.toggle("warning",1===o)}else{let o,i=o=0;for(e of this.response)o+=e.threads.length;for(let s=0;s<this.response.length;s++)for(t of(e=this.response[s],e.threads)){if(t.no===Dt.thread.ID){Dt.pageCountEl.textContent=s+1;const e=i>=o-this.response[0].threads.length
;return Dt.pageCountEl.classList.toggle("warning",e),e&&a["Purge Position"]&&(Dt.pageCountEl.textContent+=` (${o-i-1})`),Dt.lastPageUpdate=new Date(t.last_modified*g),void Dt.retry()}i++}}}else 304===this.status&&Dt.retry()},retry(){!Dt.showPage||"1"===Dt.pageCountEl.textContent||i.SITE.threadModTimeIgnoresSage||Dt.thread.posts.get(Dt.thread.lastPost).info.date<=Dt.lastPageUpdate||(clearTimeout(Dt.timeout),Dt.timeout=setTimeout(Dt.fetchPage,5e3))}};const Et={init(){if("yotsuba"===i.SITE.software&&a["Pass Link"])return Pt.ready(this.ready)},ready(){let e;if(!(e=x.id("styleSelector")))return;const t=x.el("span",{className:"brackets-wrap pass-link-container"});return x.extend(t,{innerHTML:'<a href="javascript:;">4chan Pass</a>'}),x.on(t.firstElementChild,"click",(()=>window.open(`//sys.${location.hostname.split(".")[1]}.org/auth`,Date.now(),"width=500,height=280,toolbar=0"))),x.before(e.previousSibling,[t,x.tn("  ")])}};var St={init(){
if(["index","thread"].includes(i.VIEW)&&a["Quote Inlining"])return a["Comment Expansion"]&&ue.callbacks.push(this.node),c.Post.push({name:"Quote Inlining",cb:this.node})},node(){const{process:e}=St,{isClone:t}=this;for(var o of this.nodes.quotelinks.concat([...this.nodes.backlinks],this.nodes.archivelinks))e(o,t)},process:(e,t)=>(a["Quote Hash Navigation"]&&(t||x.after(e,St.qiQuote(e,x.hasClass(e,"filtered")))),x.on(e,"click",St.toggle)),qiQuote(e,t){let o="hashlink";return t&&(o+=" filtered"),x.el("a",{className:o,textContent:"#",href:e.href})},toggle(e){if(x.modifiedClick(e))return;const{boardID:t,threadID:o,postID:s}=w.postDataFromLink(this);if(a["Inline Cross-thread Quotes Only"]&&"thread"===i.VIEW&&i.posts.get(`${t}.${s}`)?.nodes.root.offsetParent)return;if(x.hasClass(r,"catalog-mode"))return;e.preventDefault();const n=w.postFromNode(this),{context:l}=n;if(x.hasClass(this,"inlined"))St.rm(this,t,o,s,l);else{if(x.x(`ancestor::div[@data-full-i-d='${t}.${s}']`,this))return
;St.add(this,t,o,s,l,n)}return this.classList.toggle("inlined")},findRoot:(e,t)=>x.x(t?'ancestor::*[parent::*[contains(@class,"post")]][1]':"ancestor-or-self::*[parent::blockquote][1]",e),add(e,t,o,s,n,r){let l;const d=x.hasClass(e,"backlink"),c=x.el("div",{className:"inline"});c.dataset.fullID=`${t}.${s}`;const h=St.findRoot(e,d);x.after(h,c);const u=x.x('ancestor::*[contains(@class,"postContainer")][1]',h);if(x.addClass(u,"hasInline"),new ye(t,o,s,c,r),(l=i.posts.get(`${t}.${s}`))&&n.thread===l.thread&&(d&&a["Forward Hiding"]&&(x.addClass(l.nodes.root,"forwarded"),l.forwarded++||(l.forwarded=1)),fe.posts))return fe.readSinglePost(l)},rm(e,t,o,s,n){let r,l;const d=x.hasClass(e,"backlink");let c=St.findRoot(e,d);c=x.x(`following-sibling::div[@data-full-i-d='${t}.${s}'][1]`,c);const h=x.x('ancestor::*[contains(@class,"postContainer")][1]',c),{parentNode:u}=c;if(x.rm(c),x.event("PostsRemoved",null,u),x(".inline",h)||x.rmClass(h,"hasInline"),!(r=c.firstElementChild))return
;const p=i.posts.get(`${t}.${s}`);for(p.rmClone(r.dataset.clone),a["Forward Hiding"]&&d&&n.thread===i.threads.get(`${t}.${o}`)&&! --p.forwarded&&(delete p.forwarded,x.rmClass(p.nodes.root,"forwarded"));l=x(".inlined",r);)({boardID:t,threadID:o,postID:s}=w.postDataFromLink(l)),St.rm(l,t,o,s,n),x.rmClass(l,"inlined")}},Tt={containers:p(),init(){if(["index","thread"].includes(i.VIEW)&&a["Quote Backlinks"])return(this.bottomBacklinks=a["Bottom Backlinks"])&&x.addClass(r,"bottom-backlinks"),c.Post.push({name:"Quote Backlinking Part 1",cb:this.firstNode}),c.Post.push({name:"Quote Backlinking Part 2",cb:this.secondNode})},firstNode(){if(this.isClone||!this.quotes.length||this.isRebuilt)return;const e=a["Mark Quotes of You"]&&pe.isYou(this),t=x.el("a",{href:i.SITE.Build.postURL(this.board.ID,this.thread.ID,this.ID),className:this.isHidden?"filtered backlink":"backlink",textContent:a.backlink.replace(/%(?:id|%)/g,(e=>({"%id":this.ID,"%%":"%"}[e])))})
;for(var o of(e&&x.add(t,pe.mark.cloneNode(!0)),this.quotes)){var s,n=[Tt.getContainer(o)];if((s=i.posts.get(o))&&s.nodes.backlinkContainer)for(var r of s.clones)n.push(r.nodes.backlinkContainer);for(var l of n){var d=t.cloneNode(!0),c=l.firstChild?[x.tn(" "),d]:[d];if(a["Quote Previewing"]&&x.on(d,"mouseover",ke.mouseover),a["Quote Inlining"]&&(x.on(d,"click",St.toggle),a["Quote Hash Navigation"])){var h=St.qiQuote(d,x.hasClass(d,"filtered"));c.push(h)}x.add(l,c)}}},secondNode(){if(this.isClone&&(this.origin.isReply||a["OP Backlinks"]))return void(this.nodes.backlinkContainer=x(".container",this.nodes.post));if(!this.isReply&&!a["OP Backlinks"])return;const e=Tt.getContainer(this.fullID);return this.nodes.backlinkContainer=e,Tt.bottomBacklinks?x.add(this.nodes.post,e):x.add(this.nodes.info,e)},getContainer(e){return this.containers[e]||(this.containers[e]=x.el("span",{className:"container"}))}},Rt={init(){
if(["index","thread"].includes(i.VIEW)&&a["Mark Cross-thread Quotes"])return a["Comment Expansion"]&&ue.callbacks.push(this.node),this.mark=x.el("span",{textContent:" (Cross-thread)",className:"qmark-ct"}),c.Post.push({name:"Mark Cross-thread Quotes",cb:this.node})},node(){if(this.isClone&&this.thread===this.context.thread)return;const{board:e,thread:t}=this.context;for(var o of this.nodes.quotelinks){var{boardID:a,threadID:i}=w.postDataFromLink(o);i&&(this.isClone&&x.rm(x(".qmark-ct",o)),a===e.ID&&i!==t.ID&&x.add(o,Rt.mark.cloneNode(!0)))}}},Bt={init(){if(["index","thread"].includes(i.VIEW)&&a["Mark OP Quotes"])return a["Comment Expansion"]&&ue.callbacks.push(this.node),this.mark=x.el("span",{textContent:" (OP)",className:"qmark-op"}),c.Post.push({name:"Mark OP Quotes",cb:this.node})},node(){let e,t,o;if(this.isClone&&this.thread===this.context.thread)return;if(!(o=this.quotes).length)return;const{quotelinks:a}=this.nodes
;if(this.isClone&&o.includes(this.thread.fullID))for(e=0;t=a[e++];)x.rm(x(".qmark-op",t));const{fullID:i}=this.context.thread;if(o.includes(i))for(e=0;t=a[e++];){var{boardID:s,postID:n}=w.postDataFromLink(t);`${s}.${n}`===i&&x.add(t,Bt.mark.cloneNode(!0))}}};const Nt={init(){if(["index","thread"].includes(i.VIEW)&&(a["Reply Hiding Buttons"]||a.Menu&&a["Reply Hiding Link"]||a.Filter))return c.Post.push({name:"Strike-through Quotes",cb:this.node})},node(){if(!this.isClone)for(var e of this.nodes.quotelinks){var{boardID:t,postID:o}=w.postDataFromLink(e);i.posts.get(`${t}.${o}`)?.isHidden&&x.addClass(e,"filtered")}}};var Lt={init(){if(["index","thread"].includes(i.VIEW)&&a["Resurrect Quotes"])return x.addClass(r,"resurrect-quotes"),a["Comment Expansion"]&&ue.callbacks.push(this.node),c.Post.push({name:"Resurrect Quotes",cb:this.node})},node(){if(this.isClone)this.nodes.archivelinks=S("a.linkify.quotelink",this.nodes.comment);else{
for(var e of S("a.linkify",this.nodes.comment))Lt.parseArchivelink.call(this,e);for(var t of S(".deadlink",this.nodes.comment))Lt.parseDeadlink.call(this,t)}},parseArchivelink(e){let t;if(!(t=e.pathname.match(/^\/([^/]+)\/thread\/S?(\d+)\/?$/)))return;if(["boards.4chan.org","boards.4channel.org"].includes(e.hostname))return;const o=t[1],a=t[2],i=e.hash.match(/^#[pq]?(\d+)$|$/)[1]||a;return Xe.to("post",{boardID:o,postID:i})?(x.addClass(e,"quotelink"),x.extend(e.dataset,{boardID:o,threadID:a,postID:i}),this.nodes.archivelinks.push(e)):void 0},parseDeadlink(e){let t,o,a,s;if(x.hasClass(e.parentNode,"prettyprint"))return void Lt.fixDeadlink(e);const n=e.textContent;if(!(s=n.match(/\d+$/)?.[0]))return;if("0"===s[0])return void Lt.fixDeadlink(e);const r=(o=n.match(/^>>>\/([a-z\d]+)/))?o[1]:this.board.ID,l=`${r}.${s}`;if(a=i.posts.get(l))a.isDead?(t=x.el("a",{href:i.SITE.Build.postURL(r,a.thread.ID,s),className:"quotelink deadlink",textContent:n}),x.add(t,ae.deadMark.cloneNode(!0)),
x.extend(t.dataset,{boardID:r,threadID:a.thread.ID,postID:s})):t=x.el("a",{href:i.SITE.Build.postURL(r,a.thread.ID,s),className:"quotelink",textContent:n});else{const e=Xe.to("thread",{boardID:r,threadID:0,postID:s}),o=Xe.to("post",{boardID:r,postID:s});(e||o)&&(t=x.el("a",{href:e||"javascript:;",className:"deadlink",textContent:n}),x.add(t,ae.deadMark.cloneNode(!0)),o&&(x.addClass(t,"quotelink"),x.extend(t.dataset,{boardID:r,postID:s})))}if(this.quotes.includes(l)||this.quotes.push(l),t)return x.replace(e,t),x.hasClass(t,"quotelink")?this.nodes.quotelinks.push(t):void 0;x.add(e,ae.deadMark.cloneNode(!0))},fixDeadlink(e){let t;if(!(t=e.previousSibling)||"BR"===t.nodeName){const t=x.el("span",{className:"quote"});x.before(e,t),x.add(t,e)}return x.replace(e,[...e.childNodes])}},Pt={init(){if("www.4chan.org"==window.location.hostname)return;let e;try{let e=window;if(`${o.name} antidup`in e)return;e[`${o.name} antidup`]=!0}catch(e){}try{
if(window.frameElement&&["","about:blank"].includes(window.frameElement.src))return}catch(e){}if(r&&x.hasClass(r,"fourchan-x"))return;x.asap(d,(function(){x.addClass(r,"fourchan-xt","fourchan-x","seaweedchan"),x.engine&&x.addClass(r,`ua-${x.engine}`),se.ready((()=>{null!=i.BOARD?.config.ws_board&&x.addClass(r,i.BOARD.config.ws_board?"ws":"nws")}))}));try{x.global("exposeVersion",{version:i.VERSION,buildDate:i.VERSION_DATE.getTime().toString()})}catch(e){console.error(e)}x.on(n,"4chanXInitFinished",(function(){return Pt.expectInitFinished?delete Pt.expectInitFinished:(new Ke("error",`Error: Multiple copies of ${o.name} or 4chan X are enabled.`),x.addClass(r,"tainted"))}));var t=function(){return n.removeEventListener("mounted",t,!0),Pt.isMounted=!0,Pt.mountedCBs.map((e=>(()=>{try{return e()}catch(e){}})()))};n.addEventListener("mounted",t,!0);var s=function(e,t){if(t instanceof Array)a[e]=p.clone(t[0]);else if("object"==typeof t)for(var o in t){var i=t[o];s(o,i)}else a[e]=t}
;for(var l of("boards.4chan.org"===location.hostname&&x.asap(d,(()=>x.onExists(r,"iframe[srcdoc]",x.rm))),s(null,h),q.keys))a[l]=p();a.customTitles=p.clone({"4chan.org":{boards:{qa:{boardTitle:{orig:"/qa/ - Question & Answer",title:"/qa/ - 2D/Random"}}}}}),a.boardConfig={boards:p()},a.archives=Xe.archives,a.selectedArchives=p(),a.cooldowns=p(),a["Index Sort"]=p();for(let e=0;e<2;e++)a[`Last Long Reply Thresholds ${e}`]=p();a.siteProperties=p(),a["Except Archives from Encryption"]=!1,a["JSON Navigation"]=!0,a["Oekaki Links"]=!0,a["Show Name and Subject"]=!1,a["QR Shortcut"]=!0,a["Bottom QR Link"]=!0,a["Toggleable Thread Watcher"]=!0,a.siteSoftware="",a["Use Faster Image Host"]="true",a["Captcha Fixes"]=!0,a.captchaServiceDomain="",a.captchaServiceKey=p(),!/\.4chan(?:nel)?\.org$/.test(location.hostname)||Qe.yotsuba.regexp.pass.test(location.href)||Qe.yotsuba.regexp.captcha.test(location.href)||S("script:not([src])",n).filter((e=>/this\[/.test(e.textContent))).length||(x.getSync||x.get)({
jsWhitelist:a.jsWhitelist},(({jsWhitelist:e})=>{const t=e.replace(/^#.*$/gm,"").replace(/[\s;]+/g," ").trim();/\S/.test(t)&&x.addCSP(`script-src ${t}`)}));const c=p();for(e in a)c[e]=void 0;c.previousversion=void 0,(x.getSync||x.get)(c,(function(t){x.asap(d,(function(){for(e in x.cantSet||(null==t.previousversion?(Pt.isFirstRun=!0,Pt.ready((function(){return x.set("previousversion",i.VERSION),We.open()}))):t.previousversion!==i.VERSION&&Pt.upgrade(t)),a){var o=a[e];a[e]=t[e]??o}Ge.init(Pt.initFeatures)}))}))},upgrade(e){const{previousversion:t}=e,a=We.upgrade(e,t);return e.previousversion=a.previousversion=i.VERSION,x.set(a,(function(){if(e["Show Updated Notifications"]??1){const e=x.el("span",{innerHTML:`${o.name} has been updated to <a href="${o.changelog}" target="_blank">version ${i.VERSION}</a>.`});return new Ke("info",e,15)}}))},parseURL(e=i.SITE,t=location){const o={};if(!e)return o;if(o.siteID=e.ID,e.isBoardlessPage?.(t))return o;const a=t.pathname.split(/\/+/)
;return o.boardID=a[1],e.isFileURL(t)?o.VIEW="file":e.isAuxiliaryPage?.(t)||(["thread","res"].includes(a[2])?(o.VIEW="thread",o.threadID=o.THREADID=+a[3].replace(/\.\w+$/,"")):"archive"===a[2]&&"res"===a[3]?(o.VIEW="thread",o.threadID=o.THREADID=+a[4].replace(/\.\w+$/,""),o.threadArchived=!0):/^(?:catalog|archive)(?:\.\w+)?$/.test(a[2])?o.VIEW=a[2].replace(/\.\w+$/,""):/^(?:index|\d*)(?:\.\w+)?$/.test(a[2])&&(o.VIEW="index")),o},initFeatures(){if(x.global("initMain"),Pt.jsEnabled=x.hasClass(r,"js-enabled"),x.extend(i,Pt.parseURL()),i.boardID&&(i.BOARD=new ce(i.boardID)),i.VIEW){if("file"!==i.VIEW){for(var[e,t]of(i.threads=new H,i.posts=new H,x.onExists(r,"body",Pt.initStyle),Pt.features))if(!i.SITE.disabledFeatures||!i.SITE.disabledFeatures.includes(e))try{t.init()}catch(t){Pt.handleErrors({message:`"${e}" initialization crashed.`,error:t})}return x.ready(Pt.initReady)}x.asap((()=>"loading"!==n.readyState),(function(){let e
;if("yotsuba"===i.SITE.software&&a["404 Redirect"]&&i.SITE.is404?.()){const e=location.pathname.split(/\/+/);return Xe.navigate("file",{boardID:i.BOARD.ID,filename:e[e.length-1]})}(e=x("video"))&&(a["Volume in New Tab"]&&ee.setup(e),a["Loop in New Tab"]&&(e.loop=!0,e.controls=!0,e.play()))}))}else i.SITE.initAuxiliary?.()},initStyle(){if(!Pt.isThisPageLegit())return;const e=x("link[href*=mobile]",n.head);return e&&(e.disabled=!0),r.dataset.host=location.host,x.addClass(r,`sw-${i.SITE.software}`),x.addClass(r,"thread"===i.VIEW?"thread-view":i.VIEW),x.onExists(r,".ad-cnt, .adg-rects > .desktop",(e=>x.onExists(e,"img, iframe",(()=>x.addClass(r,"ads-loaded"))))),a["Autohiding Scrollbar"]&&x.addClass(r,"autohiding-scrollbar"),x.ready((function(){if(n.body.clientHeight>r.clientHeight&&window.innerWidth===r.clientWidth!==a["Autohiding Scrollbar"])return a["Autohiding Scrollbar"]=!a["Autohiding Scrollbar"],x.set("Autohiding Scrollbar",a["Autohiding Scrollbar"]),
x.toggleClass(r,"autohiding-scrollbar")})),x.addStyle(R.sub(R.boards),"fourchanx-css"),Pt.bgColorStyle=x.el("style",{id:"fourchanx-bgcolor-css"}),Pt.setClass()},setClass(){let e,t,o;const a=["yotsuba","yotsuba-b","futaba","burichan","photon","tomorrow","spooky"];if("yotsuba"===i.SITE.software&&"catalog"===i.VIEW&&(e=x.id("base-css"))&&(t=e.href.match(/catalog_(\w+)/)?.[1].replace("_new","").replace(/_+/g,"-"),a.includes(t)))return void x.addClass(r,t);t=e=o=null;const s=function(){if("yotsuba"===i.SITE.software){for(var s of(x.rmClass(r,t),t=null,o))if(s.href===e?.href){t=s.title.toLowerCase().replace("new","").trim().replace(/\s+/g,"-"),"_special"===t&&(t=s.href.match(/[a-z]*(?=[^/]*$)/)[0]),a.includes(t)||(t=null);break}if(t)return x.addClass(r,t),void x.rm(Pt.bgColorStyle)}const l=i.SITE.bgColoredEl();l.style.position="absolute",l.style.visibility="hidden",x.add(n.body,l);let d=window.getComputedStyle(l).backgroundColor;x.rm(l);const c=d.match(/[\d.]+/g);if(!/^rgb\(/.test(d)){
const e=window.getComputedStyle(n.body);d=`${e.backgroundColor} ${e.backgroundImage} ${e.backgroundRepeat} ${e.backgroundPosition}`}let h=`.dialog, .suboption-list > div:last-of-type, :root.catalog-hover-expand .catalog-container:hover > .post {\n  background: ${d};\n}\n.unread-mark-read {\n  background-color: rgba(${c.slice(0,3).join(", ")}, ${.5*(c[3]||1)});\n}`;return x.luma(c)<100&&(h+=".watch-thread-link { --xt-watcher: #c8c8c8 }"),Pt.bgColorStyle.textContent=h,x.after(x.id("fourchanx-css"),Pt.bgColorStyle)};if(x.onExists(n.head,i.SITE.selectors.styleSheet,(function(t){return e=t,"yotsuba"===i.SITE.software&&(o=S('link[rel="alternate stylesheet"]',n.head)),new MutationObserver(s).observe(e,{attributes:!0,attributeFilter:["href"]}),x.on(e,"load",s),s()})),!e){for(var l of S('link[rel="stylesheet"]',n.head))x.on(l,"load",s);return s()}},initReady(){if(i.SITE.is404?.())"thread"===i.VIEW&&ve.set404(i.BOARD.ID,i.THREADID,(function(){if(a["404 Redirect"])return Xe.navigate("thread",{
boardID:i.BOARD.ID,threadID:i.THREADID,postID:+location.hash.match(/\d+/)},`/${i.BOARD}/`)}));else{if(i.SITE.isIncomplete?.()){const e=x.el("div",{innerHTML:'The page didn&#039;t load completely.<br>Some features may not work unless you <a href="javascript:;">reload</a>.'});x.on(x("a",e),"click",(()=>location.reload())),new Ke("warning",e)}"catalog"===i.VIEW?Pt.initCatalog():Ie.enabled?(Pt.expectInitFinished=!0,x.event("4chanXInitFinished")):i.SITE.awaitBoard?i.SITE.awaitBoard(Pt.initThread):Pt.initThread()}},initThread(){let e;const t=i.SITE.selectors;if(e=x(t.boardFor?.[i.VIEW]||t.board)){const o=[],a=[],s=[];try{i.SITE.preParsingFixes?.(e)}catch(e){}Pt.addThreadsObserver=new MutationObserver(Pt.addThreads),Pt.addPostsObserver=new MutationObserver(Pt.addPosts),Pt.addThreadsObserver.observe(e,{childList:!0}),Pt.parseThreads(S(t.thread,e),o,a,s),s.length&&Pt.handleErrors(s),"thread"===i.VIEW&&(i.threadArchived&&(o[0].isArchived=!0,o[0].kill()),i.SITE.parseThreadMetadata?.(o[0])),
setTimeout((()=>{Pt.callbackNodes("Thread",o),Pt.callbackNodesDB("Post",a,(function(){for(var e of a)xe.insert(e);Pt.expectInitFinished=!0,x.event("4chanXInitFinished")}))}),0)}else Pt.expectInitFinished=!0,x.event("4chanXInitFinished")},parseThreads(e,t,o,a){for(var s of e){var n=(()=>{let e;return(e=s.dataset.board)?(e=encodeURIComponent(e),i.boards[e]||new ce(e)):i.BOARD})(),r=+s.id.match(/\d*$/)[0];if(!r||n.threads.get(r)?.nodes.root)return;var l=new j(r,n);l.nodes.root=s,t.push(l);var d=S(i.SITE.selectors.postContainer,s);i.SITE.isOPContainerThread&&d.unshift(s),Pt.parsePosts(d,l,o,a),Pt.addPostsObserver.observe(s,{childList:!0})}},parsePosts(e,t,o,a){for(var s of e)if((!s.dataset.fullID||!i.posts.get(s.dataset.fullID))&&x(i.SITE.selectors.comment,s))try{o.push(new ae(s,t,t.board))}catch(e){a.push({message:`Parsing of Post No.${s.id.match(/\d+/)} failed. Post will be skipped.`,error:e,html:s.outerHTML})}},addThreads(e){const t=[]
;for(var o of e)for(var a of o.addedNodes)a.nodeType===Node.ELEMENT_NODE&&a.matches(i.SITE.selectors.thread)&&t.push(a);if(!t.length)return;const s=[],n=[],r=[];Pt.parseThreads(t,s,n,r),r.length&&Pt.handleErrors(r),Pt.callbackNodes("Thread",s),Pt.callbackNodesDB("Post",n,(()=>x.event("PostsInserted",null,e[0].target)))},addPosts(e){let t;const o=[],a=[],s=[],n=[];for(var l of e){t=w.threadFromRoot(l.target);var d=[];for(var c of l.addedNodes)c.nodeType===Node.ELEMENT_NODE&&(c.matches(i.SITE.selectors.postContainer)||(c=x(i.SITE.selectors.postContainer,c)))&&d.push(c);var h=s.length;Pt.parsePosts(d,t,s,n),s.length>h&&!o.includes(t)&&o.push(t);var u=!1;for(var p of l.removedNodes)if(w.postFromRoot(p)?.nodes.root===p&&!r.contains(p)){u=!0;break}u&&!a.includes(t)&&a.push(t)}n.length&&Pt.handleErrors(n),Pt.callbackNodesDB("Post",s,(function(){for(t of o)x.event("PostsInserted",null,t.nodes.root);for(t of a)x.event("PostsRemoved",null,t.nodes.root)}))},initCatalog(){let e
;const t=i.SITE.selectors.catalog;if(t&&(e=x(t.board))){const o=[],a=[];Pt.addCatalogThreadsObserver=new MutationObserver(Pt.addCatalogThreads),Pt.addCatalogThreadsObserver.observe(e,{childList:!0}),Pt.parseCatalogThreads(S(t.thread,e),o,a),a.length&&Pt.handleErrors(a),Pt.callbackNodes("CatalogThreadNative",o)}return Pt.expectInitFinished=!0,x.event("4chanXInitFinished")},parseCatalogThreads(e,t,o){for(var a of e)try{var i=new Ze(a);i.thread.catalogViewNative?.nodes.root!==a&&(i.thread.catalogViewNative=i,t.push(i))}catch(e){o.push({message:`Parsing of Catalog Thread No.${(a.dataset.id||a.id).match(/\d+/)} failed. Thread will be skipped.`,error:e,html:a.outerHTML})}},addCatalogThreads(e){const t=[];for(var o of e)for(var a of o.addedNodes)a.nodeType===Node.ELEMENT_NODE&&a.matches(i.SITE.selectors.catalog.thread)&&t.push(a);if(!t.length)return;const s=[],n=[];return Pt.parseCatalogThreads(t,s,n),n.length&&Pt.handleErrors(n),Pt.callbackNodes("CatalogThreadNative",s)},callbackNodes(e,t){
let o,a=0;const i=c[e];for(;o=t[a++];)i.execute(o)},callbackNodesDB(e,t,o){let a=0;const i=c[e],s=function(){let e;return!!(e=t[a])&&(i.execute(e),++a%250)};var n=function(){for(;s(););t[a]?setTimeout(n,0):o&&o()};n()},handleErrors(e){let t;if(n.body&&x.hasClass(n.body,"fourchan_x")&&!x.hasClass(r,"tainted")&&(new Ke("error",`Error: Multiple copies of ${o.name} or 4chan X are enabled.`),x.addClass(r,"tainted")),i.SITE.testNativeExtension&&!x.hasClass(r,"tainted")&&i.SITE.testNativeExtension().then((({enabled:e})=>{if(e&&(x.addClass(r,"tainted"),a["Disable Native Extension"]&&!Pt.isFirstRun)){const e=x.el("div",{innerHTML:'Failed to disable the native extension. You may need to <a href="'+s(o.upstreamFaq)+'#blocking-native-extension" target="_blank">block it</a>.'});new Ke("error",e)}})),e instanceof Array?1===e.length&&(t=e[0]):t=e,t)return void new Ke("error",Pt.parseError(t,Pt.reportLink([t])),15);const l=x.el("div",{
innerHTML:`${e.length} errors occurred.${Pt.reportLink(e).innerHTML} [<a href="javascript:;">show</a>]`});x.on(l.lastElementChild,"click",(function(){return[this.textContent,d.hidden]="show"===this.textContent?["hide",!1]:["show",!0]}));var d=x.el("div",{hidden:!0});for(t of e)x.add(d,Pt.parseError(t));return new Ke("error",[l,d],30)},parseError(e,t){l.error(e.message,e.error.stack);const a=x.el("div",{innerHTML:s(e.message)+(t?t.innerHTML:"")}),n=x.el("div",{textContent:`${e.error.name||"Error"}: ${e.error.message||"see console for details"}`}),r=e.error.stack?.match(/\d+(?=:\d+\)?$)/gm)?.join().replace(/^/," at ")||"";return[a,n,x.el("div",{textContent:`(${o.name} ${o.fork} v${i.VERSION} ${v} on ${x.engine}${r})`})]},reportLink(e){let t;const a=e[0];let s=a.message;e.length>1&&(s+=` (+${e.length-1} other errors)`);let n="";const r=function(e){if(encodeURIComponent(s+n+e+"\n").length<=o.newIssueMaxLength-o.newIssue.replace(/%(title|details)/,"").length)return n+=e+"\n"}
;r(`[Please describe the steps needed to reproduce this error.]\n\nScript: ${o.name} ${o.fork} v${i.VERSION} ${v}\nURL: ${location.href}\nUser agent: ${navigator.userAgent}`),"userscript"===v&&(t="undefined"!=typeof GM&&null!==GM?GM.info:"undefined"!=typeof GM_info&&null!==GM_info?GM_info:void 0)&&r(`Userscript manager: ${t.scriptHandler} ${t.version}`),r("\n"+a.error),a.error.stack&&r(a.error.stack.replace(a.error.toString(),"").trim()),a.html&&r("\n`"+a.html+"`"),n=n.replace(/file:\/{3}.+\//g,"");return{innerHTML:`<span class="report-error"> [<a href="${o.newIssue.replace("%title",encodeURIComponent(s)).replace("%details",encodeURIComponent(n))}" target="_blank">report</a>]</span>`}},isThisPageLegit:()=>("thisPageIsLegit"in Pt||(Pt.thisPageIsLegit=i.SITE.isThisPageLegit?i.SITE.isThisPageLegit():!/^[45]\d\d\b/.test(document.title)&&!/\.(?:json|rss)$/.test(location.pathname)),Pt.thisPageIsLegit),ready:e=>x.ready((function(){if(Pt.isThisPageLegit())return e()})),
mounted:e=>Pt.isMounted?e():Pt.mountedCBs.push(e),mountedCBs:[],
features:[["Board Configuration",se],["Normalize URL",vt],["Delay Redirect on Post",he],["Captcha Configuration",$],["Image Host Rewriting",T],["Redirect",Xe],["Header",Ye],["Catalog Links",_e],["Settings",We],["Index Generator",Ie],["Disable Autoplay",ct],["Announcement Hiding",wt],["Fourchan thingies",pt],["Tinyboard Glue",It],["Color User IDs",gt],["Highlight by User ID",ft],["Count Posts by ID",mt],["Custom CSS",N],["Thread Links",kt],["Linkify",Te],["Reveal Spoilers",yt],["Resurrect Quotes",Lt],["Filter",Je],["Thread Hiding Buttons",Ce],["Reply Hiding Buttons",le],["Recursive",re],["Strike-through Quotes",Nt],["Quick Reply Personas",Me.persona],["Quick Reply",Me],["Cooldown",Me.cooldown],["Post Jumper",At],["Pass Link",Et],["Menu",ne],["Index Generator (Menu)",Ie.menu],["Report Link",dt],["Copy Text Link",nt],["Thread Hiding (Menu)",Ce.menu],["Reply Hiding (Menu)",le.menu],["Delete Link",rt],["Filter (Menu)",Je.menu],["Edit Link",Me.oekaki.menu],["Download Link",lt],["Archive Link",st],["Quote Inlining",St],["Quote Previewing",ke],["Quote Backlinks",Tt],["Mark Quotes of You",pe],["Mark OP Quotes",Bt],["Mark Cross-thread Quotes",Rt],["Anonymize",et],["Time Formatting",Re],["Relative Post Dates",de],["File Info Formatting",ze],["Fappe Tyme",De],["Gallery",Se],["Gallery (menu)",Se.menu],["Sauce",Ee],["Image Expansion",oe],["Image Expansion (Menu)",oe.menu],["Reveal Spoiler Thumbnails",it],["Image Loading",ot],["Image Hover",tt],["Volume Control",ee],["WEBM Metadata",at],["Comment Expansion",ue],["Thread Expansion",me],["Favicon",F],["Unread",fe],["Unread Line in Index",be],["Quote Threading",xe],["Thread Stats",Dt],["Thread Updater",Ne],["Thread Watcher",ve],["Thread Watcher (Menu)",ve.menu],["Mark New IPs",Ct],["Index Navigation",Z],["Keybinds",Le],["Banner",ht],["Announcements",xt],["Flash Features",ut],["Reply Pruning",Ae],["Mod Contact Links",bt],["Restore deleted posts from archive",we]]
};x.ready((()=>Pt.init()))}();
//# sourceMappingURL=4chan-XT.min.user.js.map
